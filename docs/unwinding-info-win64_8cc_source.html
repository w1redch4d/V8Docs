<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>v8: src/diagnostics/unwinding-info-win64.cc Source File</title>
<link rel="icon" href="v8.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="v8.png"/></td>
  <td id="projectalign">
   <div id="projectname">v8
   </div>
   <div id="projectbrief">V8 is Googleâ€™s open source high-performance JavaScript and WebAssembly engine, written in C++. It is used in Chrome and in Node.js, among others. It implements ECMAScript and WebAssembly, and runs on Windows, macOS, and Linux systems that use x64, IA-32, or ARM processors. V8 can be embedded into any C++ application.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('unwinding-info-win64_8cc_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">unwinding-info-win64.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="unwinding-info-win64_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright 2019 the V8 project authors. All rights reserved.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// found in the LICENSE file.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &quot;<a class="code" href="unwinding-info-win64_8h.html">src/diagnostics/unwinding-info-win64.h</a>&quot;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &quot;<a class="code" href="macro-assembler_8h.html">src/codegen/macro-assembler.h</a>&quot;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &quot;<a class="code" href="src_2utils_2allocation_8h.html">src/utils/allocation.h</a>&quot;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#if defined(V8_OS_WIN_X64)</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="assembler-x64_8h.html">src/codegen/x64/assembler-x64.h</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#elif defined(V8_OS_WIN_ARM64)</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="assembler-arm64-inl_8h.html">src/codegen/arm64/assembler-arm64-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="macro-assembler-arm64-inl_8h.html">src/codegen/arm64/macro-assembler-arm64-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#error &quot;Unsupported OS&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#endif  </span><span class="comment">// V8_OS_WIN_X64</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;windows.h&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">// This has to come after windows.h.</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;versionhelpers.h&gt;</span>  <span class="comment">// For IsWindows8OrGreater().</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacev8.html">v8</a> {</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="keyword">namespace </span><a class="code hl_variable" href="namespacev8_1_1internal.html#a5031451934208565c827c86d9eb86c5a">internal</a> {</div>
<div class="foldopen" id="foldopen00026" data-start="{" data-end="}">
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html">   26</a></span><span class="keyword">namespace </span>win64_unwindinfo {</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a20ff65fbee22333032da4f6012ef52cb">   28</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a20ff65fbee22333032da4f6012ef52cb">CanEmitUnwindInfoForBuiltins</a>() { <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.win64_unwinding_info; }</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="foldopen" id="foldopen00030" data-start="{" data-end="}">
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2af86e498cb6c3f31bc898c6b40d287e">   30</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2af86e498cb6c3f31bc898c6b40d287e">CanRegisterUnwindInfoForNonABICompliantCodeRange</a>() {</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>  <span class="keywordflow">return</span> !<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.jitless;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>}</div>
</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="foldopen" id="foldopen00034" data-start="{" data-end="}">
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a19d8cf495349114ec091b4b54088ed4c">   34</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a19d8cf495349114ec091b4b54088ed4c">RegisterUnwindInfoForExceptionHandlingOnly</a>() {</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2af86e498cb6c3f31bc898c6b40d287e">CanRegisterUnwindInfoForNonABICompliantCodeRange</a>());</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#if defined(V8_OS_WIN_ARM64)</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>  <span class="keywordflow">return</span> !<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.win64_unwinding_info;</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>  <span class="keywordflow">return</span> !IsWindows8OrGreater() || !<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.win64_unwinding_info;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>}</div>
</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">   43</a></span>v8::UnhandledExceptionCallback <a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">unhandled_exception_callback_g</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="foldopen" id="foldopen00045" data-start="{" data-end="}">
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#af6d561e04a5719c9f5f9a78858451cfa">   45</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#af6d561e04a5719c9f5f9a78858451cfa">SetUnhandledExceptionCallback</a>(</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    v8::UnhandledExceptionCallback unhandled_exception_callback) {</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>  <a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">unhandled_exception_callback_g</a> = unhandled_exception_callback;</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>}</div>
</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">// This function is registered as exception handler for V8-generated code as</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">// part of the registration of unwinding info. It is referenced by</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="comment">// RegisterNonABICompliantCodeRange(), below, and by the unwinding info for</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">// builtins declared in the embedded blob.</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#aa2ca6571def5942b93adc7a1ed72b01d">   54</a></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#aa2ca6571def5942b93adc7a1ed72b01d">__declspec</a>(dllexport) <span class="keywordtype">int</span> CRASH_HANDLER_FUNCTION_NAME(</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a68c11bd830a29b78d65bb7640618a8e7">   55</a></span>    PEXCEPTION_RECORD ExceptionRecord, ULONG64 <a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a68c11bd830a29b78d65bb7640618a8e7">EstablisherFrame</a>,</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#ae4b7d96f9ac1451c2013010ee0da2e56">   56</a></span>    PCONTEXT ContextRecord, PDISPATCHER_CONTEXT <a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#af1ba02f12123d100eb843667da94fafa">DispatcherContext</a>) {</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">unhandled_exception_callback_g</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    EXCEPTION_POINTERS info = {ExceptionRecord, ContextRecord};</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">unhandled_exception_callback_g</a>(&amp;info);</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>  }</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>  <span class="keywordflow">return</span> ExceptionContinueSearch;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>}</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span> </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="preprocessor">#if defined(V8_OS_WIN_X64)</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="preprocessor">#pragma pack(push, 1)</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">/*</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment"> * From Windows SDK ehdata.h, which does not compile with Clang.</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="comment"> * See https://msdn.microsoft.com/en-us/library/ddssxxy8.aspx.</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment"> */</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="keyword">union </span>UNWIND_CODE {</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>  <span class="keyword">struct </span>{</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> CodeOffset;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> UnwindOp : 4;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> OpInfo : 4;</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>  };</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>  uint16_t FrameOffset;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>};</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="keyword">struct </span>UNWIND_INFO {</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> Version : 3;</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> Flags : 5;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> SizeOfProlog;</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> CountOfCodes;</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> FrameRegister : 4;</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> FrameOffset : 4;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>};</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kNumberOfUnwindCodes = 2;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kMaxExceptionThunkSize = 12;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="keyword">struct </span>V8UnwindData {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>  UNWIND_INFO unwind_info;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>  UNWIND_CODE unwind_codes[kNumberOfUnwindCodes];</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>  V8UnwindData() {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kOpPushNonvol = 0;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kOpSetFPReg = 3;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    unwind_info.Version = 1;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    unwind_info.Flags = UNW_FLAG_EHANDLER;</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    unwind_info.SizeOfProlog = kRbpPrefixLength;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    unwind_info.CountOfCodes = kRbpPrefixCodes;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    unwind_info.FrameRegister = rbp.code();</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    unwind_info.FrameOffset = 0;</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    unwind_codes[0].CodeOffset = kRbpPrefixLength;  <span class="comment">// movq rbp, rsp</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    unwind_codes[0].UnwindOp = kOpSetFPReg;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    unwind_codes[0].OpInfo = 0;</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    unwind_codes[1].CodeOffset = kPushRbpInstructionLength;  <span class="comment">// push rbp</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    unwind_codes[1].UnwindOp = kOpPushNonvol;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    unwind_codes[1].OpInfo = rbp.code();</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>};</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="keyword">struct </span>ExceptionHandlerUnwindData {</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>  UNWIND_INFO unwind_info;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>  ExceptionHandlerUnwindData() {</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    unwind_info.Version = 1;</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    unwind_info.Flags = UNW_FLAG_EHANDLER;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    unwind_info.SizeOfProlog = 0;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    unwind_info.CountOfCodes = 0;</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    unwind_info.FrameRegister = 0;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    unwind_info.FrameOffset = 0;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  }</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>};</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="keyword">struct </span>CodeRangeUnwindingRecord {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>  <span class="keywordtype">void</span>* dynamic_table;</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>  uint32_t runtime_function_count;</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>  V8UnwindData unwind_info;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>  uint32_t exception_handler;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>  uint8_t exception_thunk[kMaxExceptionThunkSize];</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  <a class="code hl_define" href="execution_2arguments_8h.html#a6ecc8298355f5ad7b603cd7638f35882">RUNTIME_FUNCTION</a> runtime_function[kDefaultRuntimeFunctionCount];</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>};</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="keyword">struct </span>ExceptionHandlerRecord {</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>  uint32_t runtime_function_count;</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>  <a class="code hl_define" href="execution_2arguments_8h.html#a6ecc8298355f5ad7b603cd7638f35882">RUNTIME_FUNCTION</a> runtime_function[kDefaultRuntimeFunctionCount];</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>  ExceptionHandlerUnwindData unwind_info;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>  uint32_t exception_handler;</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>  uint8_t exception_thunk[kMaxExceptionThunkSize];</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>};</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="preprocessor">#pragma pack(pop)</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>std::vector&lt;uint8_t&gt; GetUnwindInfoForBuiltinFunctions() {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>  V8UnwindData xdata;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>  <span class="keywordflow">return</span> std::vector&lt;uint8_t&gt;(</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>      <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(&amp;xdata),</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>      <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(&amp;xdata) + <span class="keyword">sizeof</span>(xdata));</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>}</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Record&gt;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="keywordtype">void</span> InitUnwindingRecord(Record* <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>, <span class="keywordtype">size_t</span> code_size_in_bytes) {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>  <span class="comment">// We assume that the first page of the code range is executable and</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>  <span class="comment">// committed and reserved to contain PDATA/XDATA.</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>  <span class="comment">// All addresses are 32bit relative offsets to start.</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[0].BeginAddress = 0;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[0].EndAddress =</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>      <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a><span class="keyword">&gt;</span>(code_size_in_bytes);</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[0].UnwindData = offsetof(Record, unwind_info);</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function_count = 1;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_handler = offsetof(Record, exception_thunk);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>  <span class="comment">// Hardcoded thunk.</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>  AccountingAllocator allocator;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>  AssemblerOptions <a class="code hl_variable" href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a>;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a>.record_reloc_info_for_serialization = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  MacroAssembler masm(&amp;allocator, <a class="code hl_variable" href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a>, <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a46f8496fa0c6e0a89acf3e6b8c660205a8cc8e60acfa3ae6089df773013fd73a2">CodeObjectRequired::kNo</a>,</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>                      <a class="code hl_function" href="namespacev8_1_1internal.html#a8a3ae23daeee374946d2d1749417314b">NewAssemblerBuffer</a>(64));</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  masm.movq(rax, <span class="keyword">reinterpret_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(&amp;CRASH_HANDLER_FUNCTION_NAME));</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>  masm.jmp(rax);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(masm.instruction_size(), <span class="keyword">sizeof</span>(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_thunk));</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>  memcpy(&amp;<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_thunk[0], masm.buffer_start(),</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>         masm.instruction_size());</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>}</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span> </div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="preprocessor">#elif defined(V8_OS_WIN_ARM64)</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="preprocessor">#pragma pack(push, 1)</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">// ARM64 unwind codes are defined in below doc.</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">// https://docs.microsoft.com/en-us/cpp/build/arm64-exception-handling#unwind-codes</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="keyword">enum</span> UnwindOp8Bit {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  OpNop = 0xE3,</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>  OpAllocS = 0x00,</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>  OpSaveFpLr = 0x40,</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>  OpSaveFpLrX = 0x80,</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>  OpSetFp = 0xE1,</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>  OpAddFp = 0xE2,</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>  OpEnd = 0xE4,</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>};</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="keyword">typedef</span> uint32_t UNWIND_CODE;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="keyword">constexpr</span> UNWIND_CODE Combine8BitUnwindCodes(uint8_t code0 = OpNop,</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                                             uint8_t code1 = OpNop,</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>                                             uint8_t code2 = OpNop,</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                                             uint8_t code3 = OpNop) {</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>  <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code0) | (<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code1) &lt;&lt; 8) |</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>         (<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code2) &lt;&lt; 16) |</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>         (<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code3) &lt;&lt; 24);</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">// UNWIND_INFO defines the static part (first 32-bit) of the .xdata record in</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">// below doc.</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">// https://docs.microsoft.com/en-us/cpp/build/arm64-exception-handling#xdata-records</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="keyword">struct </span>UNWIND_INFO {</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>  uint32_t FunctionLength : 18;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>  uint32_t Version : 2;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>  uint32_t <a class="code hl_function" href="flag-definitions_8h.html#aea315e922a204d2310a710fc8416122a">X</a> : 1;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>  uint32_t E : 1;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>  uint32_t EpilogCount : 5;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>  uint32_t CodeWords : 5;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>};</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kDefaultNumberOfUnwindCodeWords = 1;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kMaxExceptionThunkSize = 16;</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kFunctionLengthShiftSize = 2;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kFunctionLengthMask = (1 &lt;&lt; kFunctionLengthShiftSize) - 1;</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kAllocStackShiftSize = 4;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kAllocStackShiftMask = (1 &lt;&lt; kAllocStackShiftSize) - 1;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="comment">// Generate an unwind code for &quot;stp fp, lr, [sp, #pre_index_offset]!&quot;.</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>uint8_t MakeOpSaveFpLrX(<span class="keywordtype">int</span> pre_index_offset) {</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>  <span class="comment">// See unwind code save_fplr_x in</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>  <span class="comment">// https://docs.microsoft.com/en-us/cpp/build/arm64-exception-handling#unwind-codes</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(pre_index_offset, -8);</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(pre_index_offset, -512);</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kShiftSize = 3;</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kShiftMask = (1 &lt;&lt; kShiftSize) - 1;</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(pre_index_offset &amp; kShiftMask, 0);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>  <a class="code hl_define" href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a>(kShiftMask);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>  <span class="comment">// Solve for Z where -(Z+1)*8 = pre_index_offset.</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>  <span class="keywordtype">int</span> encoded_value = (-pre_index_offset &gt;&gt; kShiftSize) - 1;</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>  <span class="keywordflow">return</span> OpSaveFpLrX | encoded_value;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>}</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span><span class="comment">// Generate an unwind code for &quot;sub sp, sp, #stack_space&quot;.</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>uint8_t MakeOpAllocS(<span class="keywordtype">int</span> stack_space) {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>  <span class="comment">// See unwind code alloc_s in</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>  <span class="comment">// https://docs.microsoft.com/en-us/cpp/build/arm64-exception-handling#unwind-codes</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(stack_space, 0);</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(stack_space, 512);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(stack_space &amp; kAllocStackShiftMask, 0);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>  <span class="keywordflow">return</span> OpAllocS | (stack_space &gt;&gt; kAllocStackShiftSize);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>}</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="comment">// Generate the second byte of the unwind code for &quot;add fp, sp, #offset&quot;.</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>uint8_t MakeOpAddFpArgument(<span class="keywordtype">int</span> <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>) {</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>  <span class="comment">// See unwind code add_fp in</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  <span class="comment">// https://docs.microsoft.com/en-us/cpp/build/arm64-exception-handling#unwind-codes</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>, 0);</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kShiftSize = 3;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kShiftMask = (1 &lt;&lt; kShiftSize) - 1;</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> &amp; kShiftMask, 0);</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  <a class="code hl_define" href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a>(kShiftMask);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  <span class="keywordtype">int</span> encoded_value = <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> &gt;&gt; kShiftSize;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  <span class="comment">// Encoded value must fit in 8 bits.</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(encoded_value, 0xff);</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>  <span class="keywordflow">return</span> encoded_value;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>}</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span><span class="keyword">template</span> &lt;<span class="keywordtype">int</span> kNumberOfUnwindCodeWords = kDefaultNumberOfUnwindCodeWords&gt;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="keyword">struct </span>V8UnwindData {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  UNWIND_INFO unwind_info;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>  UNWIND_CODE unwind_codes[kNumberOfUnwindCodeWords];</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>  V8UnwindData() {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    memset(&amp;unwind_info, 0, <span class="keyword">sizeof</span>(UNWIND_INFO));</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    unwind_info.X = 1;  <span class="comment">// has exception handler after unwind-codes.</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    unwind_info.CodeWords = kNumberOfUnwindCodeWords;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="comment">// Generate unwind codes for the following prolog:</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="comment">// stp fp, lr, [sp, #-kCallerSPOffset]!</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="comment">// mov fp, sp</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="comment">// This is a very rough approximation of the actual function prologs used in</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <span class="comment">// V8. In particular, we often push other data before the (fp, lr) pair,</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <span class="comment">// meaning the stack pointer computed for the caller frame is wrong. That</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <span class="comment">// error is acceptable when the unwinding info for the caller frame also</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">// depends on fp rather than sp, as is the case for V8 builtins and runtime-</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="comment">// generated code.</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <span class="keyword">static_assert</span>(kNumberOfUnwindCodeWords &gt;= 1);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    unwind_codes[0] = Combine8BitUnwindCodes(</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        OpSetFp, MakeOpSaveFpLrX(-CommonFrameConstants::kCallerSPOffset),</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        OpEnd);</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="comment">// Fill the rest with nops.</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 1; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; kNumberOfUnwindCodeWords; ++<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>) {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>      unwind_codes[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>] = Combine8BitUnwindCodes();</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    }</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>  }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>};</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="keyword">struct </span>CodeRangeUnwindingRecord {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>  <span class="keywordtype">void</span>* dynamic_table;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>  uint32_t runtime_function_count;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>  V8UnwindData&lt;&gt; unwind_info;</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>  uint32_t exception_handler;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>  <span class="comment">// For Windows ARM64 unwinding, register 2 unwind_info for each code range,</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>  <span class="comment">// unwind_info for all full size ranges (1MB - 4 bytes) and unwind_info1 for</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>  <span class="comment">// the remaining non full size range. There is at most 1 range which is less</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>  <span class="comment">// than full size.</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>  V8UnwindData&lt;&gt; unwind_info1;</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>  uint32_t exception_handler1;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>  uint8_t exception_thunk[kMaxExceptionThunkSize];</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span> </div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>  <span class="comment">// More RUNTIME_FUNCTION structs could follow below array because the number</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>  <span class="comment">// of RUNTIME_FUNCTION needed to cover given code range is computed at</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>  <span class="comment">// runtime.</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>  <a class="code hl_define" href="execution_2arguments_8h.html#a6ecc8298355f5ad7b603cd7638f35882">RUNTIME_FUNCTION</a> runtime_function[kDefaultRuntimeFunctionCount];</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>};</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span><span class="preprocessor">#pragma pack(pop)</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>FrameOffsets::FrameOffsets()</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    : fp_to_saved_caller_fp(CommonFrameConstants::kCallerFPOffset),</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      fp_to_caller_sp(CommonFrameConstants::kCallerSPOffset) {}</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span><span class="keywordtype">bool</span> FrameOffsets::IsDefault()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>  FrameOffsets other;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>  <span class="keywordflow">return</span> fp_to_saved_caller_fp == other.fp_to_saved_caller_fp &amp;&amp;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>         fp_to_caller_sp == other.fp_to_caller_sp;</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>}</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>std::vector&lt;uint8_t&gt; GetUnwindInfoForBuiltinFunction(</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    uint32_t func_len, FrameOffsets fp_adjustment) {</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(func_len, kMaxFunctionLength);</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>((func_len &amp; kFunctionLengthMask), 0);</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>  <a class="code hl_define" href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a>(kFunctionLengthMask);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span> </div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>  <span class="comment">// The largest size of unwind data required for all options below.</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>  <span class="keyword">constexpr</span> <span class="keywordtype">int</span> kMaxNumberOfUnwindCodeWords = 2;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  V8UnwindData&lt;kMaxNumberOfUnwindCodeWords&gt; xdata;</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>  <span class="comment">// FunctionLength is ensured to be aligned at instruction size and Windows</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>  <span class="comment">// ARM64 doesn&#39;t encoding its 2 LSB.</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>  xdata.unwind_info.FunctionLength = func_len &gt;&gt; kFunctionLengthShiftSize;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span> </div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>  <span class="keywordflow">if</span> (fp_adjustment.IsDefault()) {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <span class="comment">// One code word is plenty.</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keyword">static_assert</span>(kDefaultNumberOfUnwindCodeWords &lt;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                  kMaxNumberOfUnwindCodeWords);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    xdata.unwind_info.CodeWords = kDefaultNumberOfUnwindCodeWords;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="comment">// We want to convey the following facts:</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="comment">// 1. The caller&#39;s fp is found at [fp + fp_to_saved_caller_fp].</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="comment">// 2. The caller&#39;s pc is found at [fp + fp_to_saved_caller_fp + 8].</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="comment">// 3. The caller&#39;s sp is equal to fp + fp_to_caller_sp.</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <span class="comment">// An imaginary prolog that would establish those relationships might look</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="comment">// like the following, with appropriate values for the various constants:</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="comment">// stp fp, lr, [sp, #pre_index_amount]!</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="comment">// sub sp, sp, #stack_space</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <span class="comment">// add fp, sp, offset_from_stack_top</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="comment">//</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="comment">// Why do we need offset_from_stack_top? The unwinding encoding for</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">// allocating stack space has 16-byte granularity, and the frame pointer has</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="comment">// only 8-byte alignment.</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    <span class="keywordtype">int</span> pre_index_amount =</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        fp_adjustment.fp_to_saved_caller_fp - fp_adjustment.fp_to_caller_sp;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <span class="keywordtype">int</span> stack_space = fp_adjustment.fp_to_saved_caller_fp;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <span class="keywordtype">int</span> offset_from_stack_top = stack_space &amp; kAllocStackShiftMask;</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    stack_space += offset_from_stack_top;</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    xdata.unwind_codes[0] = Combine8BitUnwindCodes(</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        OpAddFp, MakeOpAddFpArgument(offset_from_stack_top),</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        MakeOpAllocS(stack_space), MakeOpSaveFpLrX(pre_index_amount));</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    xdata.unwind_codes[1] = Combine8BitUnwindCodes(OpEnd);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>  }</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>  <span class="keywordflow">return</span> std::vector&lt;uint8_t&gt;(</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>      <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(&amp;xdata),</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>      <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>          &amp;xdata.unwind_codes[xdata.unwind_info.CodeWords]));</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>}</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Record&gt;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span><span class="keywordtype">void</span> InitUnwindingRecord(Record* <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>, <span class="keywordtype">size_t</span> code_size_in_bytes) {</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>  <span class="comment">// We assume that the first page of the code range is executable and</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  <span class="comment">// committed and reserved to contain multiple PDATA/XDATA to cover the whole</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>  <span class="comment">// range. All addresses are 32bit relative offsets to start.</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>  <span class="comment">// Maximum RUNTIME_FUNCTION count available in reserved memory, this includes</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>  <span class="comment">// static part in Record as kDefaultRuntimeFunctionCount plus dynamic part in</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>  <span class="comment">// the remaining reserved memory.</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>  <span class="keyword">constexpr</span> uint32_t max_runtime_function_count = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>      (kOSPageSize - <span class="keyword">sizeof</span>(Record)) / <span class="keyword">sizeof</span>(<a class="code hl_define" href="execution_2arguments_8h.html#a6ecc8298355f5ad7b603cd7638f35882">RUNTIME_FUNCTION</a>) +</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>      kDefaultRuntimeFunctionCount);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>  uint32_t runtime_function_index = 0;</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>  uint32_t current_unwind_start_address = 0;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  int64_t remaining_size_in_bytes = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(code_size_in_bytes);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  <span class="comment">// Divide the code range into chunks in size kMaxFunctionLength and create a</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>  <span class="comment">// RUNTIME_FUNCTION for each of them. All the chunks in the same size can</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>  <span class="comment">// share 1 unwind_info struct, but a separate unwind_info is needed for the</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>  <span class="comment">// last chunk if it is smaller than kMaxFunctionLength, because unlike X64,</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>  <span class="comment">// unwind_info encodes the function/chunk length.</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  <span class="keywordflow">while</span> (remaining_size_in_bytes &gt;= kMaxFunctionLength &amp;&amp;</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>         runtime_function_index &lt; max_runtime_function_count) {</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[runtime_function_index].BeginAddress =</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        current_unwind_start_address;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[runtime_function_index].UnwindData =</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a><span class="keyword">&gt;</span>(offsetof(Record, unwind_info));</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    runtime_function_index++;</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    current_unwind_start_address += kMaxFunctionLength;</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    remaining_size_in_bytes -= kMaxFunctionLength;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>  }</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>  <span class="comment">// FunctionLength is ensured to be aligned at instruction size and Windows</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>  <span class="comment">// ARM64 doesn&#39;t encoding 2 LSB.</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;unwind_info.unwind_info.FunctionLength = kMaxFunctionLength &gt;&gt; 2;</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>  <span class="keywordflow">if</span> (remaining_size_in_bytes &gt; 0 &amp;&amp;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>      runtime_function_index &lt; max_runtime_function_count) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(remaining_size_in_bytes % <a class="code hl_variable" href="namespacev8_1_1internal.html#ac915558733f2fceaec1860dd81c6df7f">kInstrSize</a>, 0);</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;unwind_info1.unwind_info.FunctionLength = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        remaining_size_in_bytes &gt;&gt; kFunctionLengthShiftSize);</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[runtime_function_index].BeginAddress =</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        current_unwind_start_address;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function[runtime_function_index].UnwindData =</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a><span class="keyword">&gt;</span>(offsetof(Record, unwind_info1));</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span> </div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    remaining_size_in_bytes -= kMaxFunctionLength;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_handler1 = offsetof(Record, exception_thunk);</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function_count = runtime_function_index + 1;</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function_count = runtime_function_index;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>  }</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>  <span class="comment">// 1 page can cover kMaximalCodeRangeSize for ARM64 (128MB). If</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>  <span class="comment">// kMaximalCodeRangeSize is changed for ARM64 and makes 1 page insufficient to</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>  <span class="comment">// cover it, more pages will need to reserved for unwind data.</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(remaining_size_in_bytes, 0);</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span> </div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_handler = offsetof(Record, exception_thunk);</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>  <span class="comment">// Hardcoded thunk.</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>  AccountingAllocator allocator;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>  AssemblerOptions <a class="code hl_variable" href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a>;</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>  <a class="code hl_variable" href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a>.record_reloc_info_for_serialization = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>  MacroAssembler masm(&amp;allocator, <a class="code hl_variable" href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a>, <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a46f8496fa0c6e0a89acf3e6b8c660205a8cc8e60acfa3ae6089df773013fd73a2">CodeObjectRequired::kNo</a>,</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>                      <a class="code hl_function" href="namespacev8_1_1internal.html#a8a3ae23daeee374946d2d1749417314b">NewAssemblerBuffer</a>(64));</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>  masm.Mov(x16,</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>           Operand(<span class="keyword">reinterpret_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(&amp;CRASH_HANDLER_FUNCTION_NAME)));</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>  masm.Br(x16);</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(masm.instruction_size(), <span class="keyword">sizeof</span>(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_thunk));</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>  memcpy(&amp;<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;exception_thunk[0], masm.buffer_start(),</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>         masm.instruction_size());</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>}</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span><span class="preprocessor">#endif  </span><span class="comment">// V8_OS_WIN_X64</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span> </div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><a class="code hl_define" href="once_8h.html#ae8d7b17dca3d0e2db0a28995f83f5644">V8_DECLARE_ONCE</a>(load_ntdll_unwinding_functions_once);</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span><span class="keyword">static</span> <span class="keyword">decltype</span>(</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    &amp;::RtlAddGrowableFunctionTable) add_growable_function_table_func = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span><span class="keyword">static</span> <span class="keyword">decltype</span>(</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    &amp;::RtlDeleteGrowableFunctionTable) delete_growable_function_table_func =</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="keywordtype">void</span> LoadNtdllUnwindingFunctionsOnce() {</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>  <span class="comment">// Load functions from the ntdll.dll module.</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  HMODULE ntdll_module =</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>      LoadLibraryEx(<a class="code hl_variable" href="namespacev8_1_1internal.html#a68432e0286fadb63d524e475affa65fb">L</a><span class="stringliteral">&quot;ntdll.dll&quot;</span>, <span class="keyword">nullptr</span>, LOAD_LIBRARY_SEARCH_SYSTEM32);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(ntdll_module);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>  <span class="comment">// This fails on Windows 7.</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>  add_growable_function_table_func =</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>      <span class="keyword">reinterpret_cast&lt;</span>decltype(&amp;::RtlAddGrowableFunctionTable)<span class="keyword">&gt;</span>(</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>          ::GetProcAddress(ntdll_module, <span class="stringliteral">&quot;RtlAddGrowableFunctionTable&quot;</span>));</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(IsWindows8OrGreater(), add_growable_function_table_func);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span> </div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>  delete_growable_function_table_func =</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>      <span class="keyword">reinterpret_cast&lt;</span>decltype(&amp;::RtlDeleteGrowableFunctionTable)<span class="keyword">&gt;</span>(</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>          ::GetProcAddress(ntdll_module, <span class="stringliteral">&quot;RtlDeleteGrowableFunctionTable&quot;</span>));</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(IsWindows8OrGreater(), delete_growable_function_table_func);</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>}</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span><span class="keywordtype">void</span> LoadNtdllUnwindingFunctions() {</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>  <a class="code hl_function" href="namespacev8_1_1base.html#a3bd25eac4abfeaa53389ab881003596d">base::CallOnce</a>(&amp;load_ntdll_unwinding_functions_once,</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                 &amp;LoadNtdllUnwindingFunctionsOnce);</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>}</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="keywordtype">bool</span> AddGrowableFunctionTable(<a class="code hl_typedef" href="win32-headers_8h.html#a2b5e00c0c5a5aa5199ba9f28ec3e8caa">PVOID</a>* DynamicTable,</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                              PRUNTIME_FUNCTION FunctionTable, <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> EntryCount,</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                              <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> MaximumEntryCount, <a class="code hl_typedef" href="win32-headers_8h.html#ab073d5620a97a9d8bf27cd174e2dbd04">ULONG_PTR</a> RangeBase,</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>                              <a class="code hl_typedef" href="win32-headers_8h.html#ab073d5620a97a9d8bf27cd174e2dbd04">ULONG_PTR</a> RangeEnd) {</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(::IsWindows8OrGreater());</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>  LoadNtdllUnwindingFunctions();</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(add_growable_function_table_func);</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>  *DynamicTable = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>  <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> status =</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>      add_growable_function_table_func(DynamicTable, FunctionTable, EntryCount,</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>                                       MaximumEntryCount, RangeBase, RangeEnd);</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>((status == 0 &amp;&amp; *DynamicTable != <span class="keyword">nullptr</span>) ||</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>         status == 0xC000009A);  <span class="comment">// STATUS_INSUFFICIENT_RESOURCES</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>  <span class="keywordflow">return</span> (status == 0);</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>}</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="keywordtype">void</span> DeleteGrowableFunctionTable(<a class="code hl_typedef" href="win32-headers_8h.html#a2b5e00c0c5a5aa5199ba9f28ec3e8caa">PVOID</a> dynamic_table) {</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(::IsWindows8OrGreater());</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span> </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>  LoadNtdllUnwindingFunctions();</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(delete_growable_function_table_func);</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>  delete_growable_function_table_func(dynamic_table);</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>}</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span> </div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="foldopen" id="foldopen00525" data-start="{" data-end="}">
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2409db5c20b55125a1f38d2eecf2341b">  525</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2409db5c20b55125a1f38d2eecf2341b">RegisterNonABICompliantCodeRange</a>(<span class="keywordtype">void</span>* <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>, <span class="keywordtype">size_t</span> size_in_bytes) {</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2af86e498cb6c3f31bc898c6b40d287e">CanRegisterUnwindInfoForNonABICompliantCodeRange</a>());</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>  <span class="comment">// When the --win64-unwinding-info flag is set, we call</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>  <span class="comment">// RtlAddGrowableFunctionTable to register unwinding info for the whole code</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>  <span class="comment">// range of an isolate or Wasm module. This enables the Windows OS stack</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>  <span class="comment">// unwinder to work correctly with V8-generated code, enabling stack walking</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>  <span class="comment">// in Windows debuggers and performance tools. However, the</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>  <span class="comment">// RtlAddGrowableFunctionTable API is only supported on Windows 8 and above.</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>  <span class="comment">// On Windows 7, or when --win64-unwinding-info is not set, we may still need</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>  <span class="comment">// to call RtlAddFunctionTable to register a custom exception handler passed</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>  <span class="comment">// by the embedder (like Crashpad).</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a19d8cf495349114ec091b4b54088ed4c">RegisterUnwindInfoForExceptionHandlingOnly</a>()) {</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="preprocessor">#if defined(V8_OS_WIN_X64)</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="comment">// Windows ARM64 starts since 1709 Windows build, no need to have exception</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    <span class="comment">// handling only unwind info for compatibility.</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">unhandled_exception_callback_g</a>) {</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>      ExceptionHandlerRecord* <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a> = <span class="keyword">new</span> (<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>) ExceptionHandlerRecord();</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>      InitUnwindingRecord(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>, size_in_bytes);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(::RtlAddFunctionTable(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function,</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                                  kDefaultRuntimeFunctionCount,</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                                  <span class="keyword">reinterpret_cast&lt;</span>DWORD64<span class="keyword">&gt;</span>(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>)));</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>      <span class="comment">// Protect reserved page against modifications.</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>      <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> old_protect;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(VirtualProtect(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>, <span class="keyword">sizeof</span>(ExceptionHandlerRecord),</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>                           PAGE_EXECUTE_READ, &amp;old_protect));</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    }</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="preprocessor">#endif  </span><span class="comment">// V8_OS_WIN_X64</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    CodeRangeUnwindingRecord* <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a> = <span class="keyword">new</span> (<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>) CodeRangeUnwindingRecord();</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    InitUnwindingRecord(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>, size_in_bytes);</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span> </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(AddGrowableFunctionTable(</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        &amp;<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;dynamic_table, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function,</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function_count, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function_count,</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="keyword">reinterpret_cast&lt;</span>DWORD64<span class="keyword">&gt;</span>(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>),</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <span class="keyword">reinterpret_cast&lt;</span>DWORD64<span class="keyword">&gt;</span>(<span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>) +</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>                                  size_in_bytes)));</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span> </div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="comment">// Protect reserved page against modifications.</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> old_protect;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(VirtualProtect(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>, <span class="keyword">sizeof</span>(CodeRangeUnwindingRecord),</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>                         PAGE_EXECUTE_READ, &amp;old_protect));</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>  }</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>}</div>
</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span> </div>
<div class="foldopen" id="foldopen00575" data-start="{" data-end="}">
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a70f996f40a6b9c963c47bb920970d841">  575</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a70f996f40a6b9c963c47bb920970d841">UnregisterNonABICompliantCodeRange</a>(<span class="keywordtype">void</span>* <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>) {</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2af86e498cb6c3f31bc898c6b40d287e">CanRegisterUnwindInfoForNonABICompliantCodeRange</a>());</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a19d8cf495349114ec091b4b54088ed4c">RegisterUnwindInfoForExceptionHandlingOnly</a>()) {</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="preprocessor">#if defined(V8_OS_WIN_X64)</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="comment">// Windows ARM64 starts since 1709 Windows build, no need to have exception</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    <span class="comment">// handling only unwind info for compatibility.</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">unhandled_exception_callback_g</a>) {</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>      ExceptionHandlerRecord* <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a> =</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>          <span class="keyword">reinterpret_cast&lt;</span>ExceptionHandlerRecord*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(::RtlDeleteFunctionTable(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;runtime_function));</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span> </div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>      <span class="comment">// Unprotect reserved page.</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>      <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> old_protect;</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(VirtualProtect(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>, <span class="keyword">sizeof</span>(ExceptionHandlerRecord),</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>                           PAGE_READWRITE, &amp;old_protect));</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    }</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span><span class="preprocessor">#endif  </span><span class="comment">// V8_OS_WIN_X64</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    CodeRangeUnwindingRecord* <a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a> =</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        <span class="keyword">reinterpret_cast&lt;</span>CodeRangeUnwindingRecord*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>);</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;dynamic_table) {</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>      DeleteGrowableFunctionTable(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a>-&gt;dynamic_table);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    }</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="comment">// Unprotect reserved page.</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <a class="code hl_typedef" href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a> old_protect;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(VirtualProtect(<a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>, <span class="keyword">sizeof</span>(CodeRangeUnwindingRecord),</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                         PAGE_READWRITE, &amp;old_protect));</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>  }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>}</div>
</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span> </div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span><span class="preprocessor">#if defined(V8_OS_WIN_X64)</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span><span class="keywordtype">void</span> XdataEncoder::onPushRbp() {</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>  current_frame_code_offset_ =</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>      <a class="code hl_variable" href="experimental-compiler_8cc.html#a8e8cd7fd670ff4e69667e7883b8523e5">assembler_</a>.pc_offset() - kPushRbpInstructionLength;</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>}</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="keywordtype">void</span> XdataEncoder::onMovRbpRsp() {</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  <span class="keywordflow">if</span> (current_frame_code_offset_ &gt;= 0 &amp;&amp;</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>      current_frame_code_offset_ == <a class="code hl_variable" href="experimental-compiler_8cc.html#a8e8cd7fd670ff4e69667e7883b8523e5">assembler_</a>.pc_offset() - kRbpPrefixLength) {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    fp_offsets_.push_back(current_frame_code_offset_);</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>}</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="preprocessor">#elif defined(V8_OS_WIN_ARM64)</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="keywordtype">void</span> XdataEncoder::onSaveFpLr() {</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>  current_frame_code_offset_ = <a class="code hl_variable" href="experimental-compiler_8cc.html#a8e8cd7fd670ff4e69667e7883b8523e5">assembler_</a>.pc_offset() - 4;</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>  fp_offsets_.push_back(current_frame_code_offset_);</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>  fp_adjustments_.push_back(current_frame_adjustment_);</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  current_frame_adjustment_ = FrameOffsets();</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>}</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span><span class="keywordtype">void</span> XdataEncoder::onFramePointerAdjustment(<span class="keywordtype">int</span> fp_to_saved_caller_fp,</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>                                            <span class="keywordtype">int</span> fp_to_caller_sp) {</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>  current_frame_adjustment_.fp_to_saved_caller_fp = fp_to_saved_caller_fp;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>  current_frame_adjustment_.fp_to_caller_sp = fp_to_caller_sp;</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>}</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="preprocessor">#endif  </span><span class="comment">// V8_OS_WIN_X64</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>}  <span class="comment">// namespace win64_unwindinfo</span></div>
</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>}  <span class="comment">// namespace internal</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>}  <span class="comment">// namespace v8</span></div>
<div class="ttc" id="aassembler-arm64-inl_8h_html"><div class="ttname"><a href="assembler-arm64-inl_8h.html">assembler-arm64-inl.h</a></div></div>
<div class="ttc" id="aassembler-x64_8h_html"><div class="ttname"><a href="assembler-x64_8h.html">assembler-x64.h</a></div></div>
<div class="ttc" id="adebug-coverage_8cc_html_a37722a150250e2a5a98e5e0d11e53449"><div class="ttname"><a href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a></div><div class="ttdeci">int start</div><div class="ttdef"><b>Definition</b> <a href="debug-coverage_8cc_source.html#l00595">debug-coverage.cc:595</a></div></div>
<div class="ttc" id="aexecution_2arguments_8h_html_a6ecc8298355f5ad7b603cd7638f35882"><div class="ttname"><a href="execution_2arguments_8h.html#a6ecc8298355f5ad7b603cd7638f35882">RUNTIME_FUNCTION</a></div><div class="ttdeci">#define RUNTIME_FUNCTION(Name)</div><div class="ttdef"><b>Definition</b> <a href="execution_2arguments_8h_source.html#l00161">arguments.h:161</a></div></div>
<div class="ttc" id="aexperimental-compiler_8cc_html_a8e8cd7fd670ff4e69667e7883b8523e5"><div class="ttname"><a href="experimental-compiler_8cc.html#a8e8cd7fd670ff4e69667e7883b8523e5">assembler_</a></div><div class="ttdeci">BytecodeAssembler &amp; assembler_</div><div class="ttdef"><b>Definition</b> <a href="experimental-compiler_8cc_source.html#l00538">experimental-compiler.cc:538</a></div></div>
<div class="ttc" id="aflag-definitions_8h_html_aea315e922a204d2310a710fc8416122a"><div class="ttname"><a href="flag-definitions_8h.html#aea315e922a204d2310a710fc8416122a">X</a></div><div class="ttdeci">too high values may cause the compiler to set high thresholds for inlining to as much as possible avoid inlined allocation of objects that cannot escape trace load stores from virtual maglev objects use TurboFan fast string builder analyze liveness of environment slots and zap dead values trace TurboFan load elimination emit data about basic block usage in builtins to this enable builtin reordering when run mksnapshot flag for emit warnings when applying builtin profile data verify register allocation in TurboFan randomly schedule instructions to stress dependency tracking enable store store elimination in TurboFan rewrite far to near simulate GC compiler thread race related to allow float parameters to be passed in simulator mode JS Wasm Run additional turbo_optimize_inlined_js_wasm_wrappers enable experimental feedback collection in generic lowering enable Turboshaft s WasmLoadElimination run instruction selection on Turboshaft IR directly enable Turboshaft s loop unrolling enable an additional Turboshaft phase that performs optimizations based on type information build the Turboshaft graph from Maglev trace emitted Turboshaft instructions profile guided optimization for empty feedback vector invocation count for maglev for functions which according to profile_guided_optimization are likely to deoptimize before reaching this invocation count Immediately re optimize code after some lazy deopts Enables the lazy new space shrinking strategy max size of a semi the new space consists of two semi spaces young and full garbage collection phases are not overlapping Collect garbage after keeps maps alive for&lt; n &gt; old space garbage collections print one detailed trace line in allocation gc speed Starts incremental marking with kUserVisible priority threshold for starting incremental marking immediately in percent of available minor GC task trigger in percent of the current heap limit use a separate phase for stack scanning in scavenge max worker number of concurrent for NumberOfWorkerThreads start background threads that allocate memory concurrent_array_buffer_sweeping use parallel threads to clear weak refs in the atomic pause trace progress of the incremental marking trace object counts and memory usage report a tick only when allocated zone memory changes by this amount TracingFlags::gc_stats TracingFlags::gc_stats track native contexts that are expected to be garbage collected verify heap pointers before and after GC use memory reducer for small heaps External memory limits are computed as part of global limits in v8 Heap specifies heap growing factor Perform compaction on full GCs based on V8 s default heuristics Perform compaction on every full GC Perform code space compaction when finalizing a full GC with stack Stress GC compaction to flush out Stress GC compaction by selecting random percent of pages as evacuation candidates Overrides stress_compaction flush of bytecode when it has not been executed recently Flush code when tab goes into the background Use per context worklist for marking force incremental marking for small heaps and run it more often force marking at random points between and X(inclusive) percent &quot; &quot;of the regular marking start limit&quot;) DEFINE_INT(stress_scavenge</div></div>
<div class="ttc" id="ainstruction-selector-ia32_8cc_html_a97bd6c077f3c7769f575b82988b9b668"><div class="ttname"><a href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a></div><div class="ttdeci">int32_t offset</div><div class="ttdef"><b>Definition</b> <a href="instruction-selector-ia32_8cc_source.html#l00072">instruction-selector-ia32.cc:72</a></div></div>
<div class="ttc" id="ajs-temporal-objects_8cc_html_a5d1eaa4d00d65b745d493b4b8ae43b00"><div class="ttname"><a href="js-temporal-objects_8cc.html#a5d1eaa4d00d65b745d493b4b8ae43b00">options</a></div><div class="ttdeci">DirectHandle&lt; JSReceiver &gt; options</div><div class="ttdef"><b>Definition</b> <a href="js-temporal-objects_8cc_source.html#l00207">js-temporal-objects.cc:207</a></div></div>
<div class="ttc" id="ajs-temporal-objects_8cc_html_aeafbb073d4154826b9a3e64490d9d59c"><div class="ttname"><a href="js-temporal-objects_8cc.html#aeafbb073d4154826b9a3e64490d9d59c">record</a></div><div class="ttdeci">DurationRecord record</div><div class="ttdef"><b>Definition</b> <a href="js-temporal-objects_8cc_source.html#l00107">js-temporal-objects.cc:107</a></div></div>
<div class="ttc" id="amacro-assembler-arm64-inl_8h_html"><div class="ttname"><a href="macro-assembler-arm64-inl_8h.html">macro-assembler-arm64-inl.h</a></div></div>
<div class="ttc" id="amacro-assembler_8h_html"><div class="ttname"><a href="macro-assembler_8h.html">macro-assembler.h</a></div></div>
<div class="ttc" id="anamespacev8_1_1base_html_a3bd25eac4abfeaa53389ab881003596d"><div class="ttname"><a href="namespacev8_1_1base.html#a3bd25eac4abfeaa53389ab881003596d">v8::base::CallOnce</a></div><div class="ttdeci">void CallOnce(OnceType *once, std::function&lt; void()&gt; init_func)</div><div class="ttdef"><b>Definition</b> <a href="once_8h_source.html#l00090">once.h:90</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a19d8cf495349114ec091b4b54088ed4c"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a19d8cf495349114ec091b4b54088ed4c">v8::internal::win64_unwindinfo::RegisterUnwindInfoForExceptionHandlingOnly</a></div><div class="ttdeci">bool RegisterUnwindInfoForExceptionHandlingOnly()</div><div class="ttdef"><b>Definition</b> <a href="#l00034">unwinding-info-win64.cc:34</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a20ff65fbee22333032da4f6012ef52cb"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a20ff65fbee22333032da4f6012ef52cb">v8::internal::win64_unwindinfo::CanEmitUnwindInfoForBuiltins</a></div><div class="ttdeci">bool CanEmitUnwindInfoForBuiltins()</div><div class="ttdef"><b>Definition</b> <a href="#l00028">unwinding-info-win64.cc:28</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a2409db5c20b55125a1f38d2eecf2341b"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2409db5c20b55125a1f38d2eecf2341b">v8::internal::win64_unwindinfo::RegisterNonABICompliantCodeRange</a></div><div class="ttdeci">void RegisterNonABICompliantCodeRange(void *start, size_t size_in_bytes)</div><div class="ttdef"><b>Definition</b> <a href="#l00525">unwinding-info-win64.cc:525</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a2af86e498cb6c3f31bc898c6b40d287e"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a2af86e498cb6c3f31bc898c6b40d287e">v8::internal::win64_unwindinfo::CanRegisterUnwindInfoForNonABICompliantCodeRange</a></div><div class="ttdeci">bool CanRegisterUnwindInfoForNonABICompliantCodeRange()</div><div class="ttdef"><b>Definition</b> <a href="#l00030">unwinding-info-win64.cc:30</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a68c11bd830a29b78d65bb7640618a8e7"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a68c11bd830a29b78d65bb7640618a8e7">v8::internal::win64_unwindinfo::EstablisherFrame</a></div><div class="ttdeci">ULONG64 EstablisherFrame</div><div class="ttdef"><b>Definition</b> <a href="#l00055">unwinding-info-win64.cc:55</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a70f996f40a6b9c963c47bb920970d841"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a70f996f40a6b9c963c47bb920970d841">v8::internal::win64_unwindinfo::UnregisterNonABICompliantCodeRange</a></div><div class="ttdeci">void UnregisterNonABICompliantCodeRange(void *start)</div><div class="ttdef"><b>Definition</b> <a href="#l00575">unwinding-info-win64.cc:575</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_a9c0cfa0e96d271af790a648ae27504e5"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#a9c0cfa0e96d271af790a648ae27504e5">v8::internal::win64_unwindinfo::unhandled_exception_callback_g</a></div><div class="ttdeci">v8::UnhandledExceptionCallback unhandled_exception_callback_g</div><div class="ttdef"><b>Definition</b> <a href="#l00043">unwinding-info-win64.cc:43</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_aa2ca6571def5942b93adc7a1ed72b01d"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#aa2ca6571def5942b93adc7a1ed72b01d">v8::internal::win64_unwindinfo::__declspec</a></div><div class="ttdeci">__declspec(dllexport) int CRASH_HANDLER_FUNCTION_NAME(PEXCEPTION_RECORD ExceptionRecord</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_af1ba02f12123d100eb843667da94fafa"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#af1ba02f12123d100eb843667da94fafa">v8::internal::win64_unwindinfo::DispatcherContext</a></div><div class="ttdeci">ULONG64 PCONTEXT PDISPATCHER_CONTEXT DispatcherContext</div><div class="ttdef"><b>Definition</b> <a href="#l00056">unwinding-info-win64.cc:56</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1win64__unwindinfo_html_af6d561e04a5719c9f5f9a78858451cfa"><div class="ttname"><a href="namespacev8_1_1internal_1_1win64__unwindinfo.html#af6d561e04a5719c9f5f9a78858451cfa">v8::internal::win64_unwindinfo::SetUnhandledExceptionCallback</a></div><div class="ttdeci">void SetUnhandledExceptionCallback(v8::UnhandledExceptionCallback unhandled_exception_callback)</div><div class="ttdef"><b>Definition</b> <a href="#l00045">unwinding-info-win64.cc:45</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html"><div class="ttname"><a href="namespacev8_1_1internal.html">v8::internal</a></div><div class="ttdef"><b>Definition</b> <a href="api-arguments-inl_8h_source.html#l00018">api-arguments-inl.h:18</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a46f8496fa0c6e0a89acf3e6b8c660205a8cc8e60acfa3ae6089df773013fd73a2"><div class="ttname"><a href="namespacev8_1_1internal.html#a46f8496fa0c6e0a89acf3e6b8c660205a8cc8e60acfa3ae6089df773013fd73a2">v8::internal::CodeObjectRequired::kNo</a></div><div class="ttdeci">@ kNo</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a5031451934208565c827c86d9eb86c5a"><div class="ttname"><a href="namespacev8_1_1internal.html#a5031451934208565c827c86d9eb86c5a">v8::internal::internal</a></div><div class="ttdeci">internal</div><div class="ttdef"><b>Definition</b> <a href="wasm-objects-inl_8h_source.html#l00457">wasm-objects-inl.h:457</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a68432e0286fadb63d524e475affa65fb"><div class="ttname"><a href="namespacev8_1_1internal.html#a68432e0286fadb63d524e475affa65fb">v8::internal::L</a></div><div class="ttdeci">constexpr int L</div><div class="ttdef"><b>Definition</b> <a href="constants-arm_8h_source.html#l00174">constants-arm.h:174</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a8a3ae23daeee374946d2d1749417314b"><div class="ttname"><a href="namespacev8_1_1internal.html#a8a3ae23daeee374946d2d1749417314b">v8::internal::NewAssemblerBuffer</a></div><div class="ttdeci">std::unique_ptr&lt; AssemblerBuffer &gt; NewAssemblerBuffer(int size)</div><div class="ttdef"><b>Definition</b> <a href="codegen_2assembler_8cc_source.html#l00167">assembler.cc:167</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_aa9db791c05a0359859a321dcfec42e37"><div class="ttname"><a href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8::internal::v8_flags</a></div><div class="ttdeci">V8_EXPORT_PRIVATE FlagValues v8_flags</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_ac915558733f2fceaec1860dd81c6df7f"><div class="ttname"><a href="namespacev8_1_1internal.html#ac915558733f2fceaec1860dd81c6df7f">v8::internal::kInstrSize</a></div><div class="ttdeci">constexpr uint8_t kInstrSize</div><div class="ttdef"><b>Definition</b> <a href="constants-arm_8h_source.html#l00448">constants-arm.h:448</a></div></div>
<div class="ttc" id="anamespacev8_html"><div class="ttname"><a href="namespacev8.html">v8</a></div><div class="ttdef"><b>Definition</b> <a href="api-arguments-inl_8h_source.html#l00017">api-arguments-inl.h:17</a></div></div>
<div class="ttc" id="aonce_8h_html_ae8d7b17dca3d0e2db0a28995f83f5644"><div class="ttname"><a href="once_8h.html#ae8d7b17dca3d0e2db0a28995f83f5644">V8_DECLARE_ONCE</a></div><div class="ttdeci">#define V8_DECLARE_ONCE(NAME)</div><div class="ttdef"><b>Definition</b> <a href="once_8h_source.html#l00072">once.h:72</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a16b382527f19b805fc8f856668f2270b"><div class="ttname"><a href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a></div><div class="ttdeci">#define DCHECK_LE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00490">logging.h:490</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a3e1cfef60e774a81f30eaddf26a3a274"><div class="ttname"><a href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a></div><div class="ttdeci">#define CHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00124">logging.h:124</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a7b9f9517fedacc2a1a56c2bbb9d03688"><div class="ttname"><a href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a></div><div class="ttdeci">#define DCHECK_NOT_NULL(val)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00492">logging.h:492</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a96a75539aa82216cdde2250a11126ea0"><div class="ttname"><a href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a></div><div class="ttdeci">#define DCHECK_IMPLIES(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00493">logging.h:493</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_aabec5c3b7a8628298a25f044dcf89c25"><div class="ttname"><a href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a></div><div class="ttdeci">#define DCHECK_GE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00488">logging.h:488</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_ae17f8119c108cf3070bad3449c7e0006"><div class="ttname"><a href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a></div><div class="ttdeci">#define DCHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00482">logging.h:482</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_af1a711c8d5520dff78858ddefd2ad668"><div class="ttname"><a href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a></div><div class="ttdeci">#define DCHECK_LT(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00489">logging.h:489</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_af9c313d74155f7f201955a939e24c71f"><div class="ttname"><a href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a></div><div class="ttdeci">#define DCHECK_EQ(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00485">logging.h:485</a></div></div>
<div class="ttc" id="asrc_2base_2macros_8h_html_a280b0798f270f4b3f361c9ab64832956"><div class="ttname"><a href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a></div><div class="ttdeci">#define USE(...)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2macros_8h_source.html#l00281">macros.h:281</a></div></div>
<div class="ttc" id="asrc_2utils_2allocation_8h_html"><div class="ttname"><a href="src_2utils_2allocation_8h.html">allocation.h</a></div></div>
<div class="ttc" id="aunwinding-info-win64_8h_html"><div class="ttname"><a href="unwinding-info-win64_8h.html">unwinding-info-win64.h</a></div></div>
<div class="ttc" id="awin32-headers_8h_html_a2b5e00c0c5a5aa5199ba9f28ec3e8caa"><div class="ttname"><a href="win32-headers_8h.html#a2b5e00c0c5a5aa5199ba9f28ec3e8caa">PVOID</a></div><div class="ttdeci">void * PVOID</div><div class="ttdef"><b>Definition</b> <a href="win32-headers_8h_source.html#l00055">win32-headers.h:55</a></div></div>
<div class="ttc" id="awin32-headers_8h_html_ab073d5620a97a9d8bf27cd174e2dbd04"><div class="ttname"><a href="win32-headers_8h.html#ab073d5620a97a9d8bf27cd174e2dbd04">ULONG_PTR</a></div><div class="ttdeci">__w64 unsigned long ULONG_PTR</div><div class="ttdef"><b>Definition</b> <a href="win32-headers_8h_source.html#l00063">win32-headers.h:63</a></div></div>
<div class="ttc" id="awin32-headers_8h_html_ad342ac907eb044443153a22f964bf0af"><div class="ttname"><a href="win32-headers_8h.html#ad342ac907eb044443153a22f964bf0af">DWORD</a></div><div class="ttdeci">unsigned long DWORD</div><div class="ttdef"><b>Definition</b> <a href="win32-headers_8h_source.html#l00052">win32-headers.h:52</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_941f38c4e38886800e591b0dff3cead0.html">diagnostics</a></li><li class="navelem"><a class="el" href="unwinding-info-win64_8cc.html">unwinding-info-win64.cc</a></li>
    <li class="footer">Generated on Thu Apr 3 2025 09:54:35 for v8 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
