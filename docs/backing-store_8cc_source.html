<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>v8: src/objects/backing-store.cc Source File</title>
<link rel="icon" href="v8.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="v8.png"/></td>
  <td id="projectalign">
   <div id="projectname">v8
   </div>
   <div id="projectbrief">V8 is Googleâ€™s open source high-performance JavaScript and WebAssembly engine, written in C++. It is used in Chrome and in Node.js, among others. It implements ECMAScript and WebAssembly, and runs on Windows, macOS, and Linux systems that use x64, IA-32, or ARM processors. V8 can be embedded into any C++ application.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('backing-store_8cc_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">backing-store.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="backing-store_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright 2019 the V8 project authors. All rights reserved.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// found in the LICENSE file.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &quot;<a class="code" href="backing-store_8h.html">src/objects/backing-store.h</a>&quot;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &quot;<a class="code" href="bits_8h.html">src/base/bits.h</a>&quot;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &quot;<a class="code" href="execution_2isolate_8h.html">src/execution/isolate.h</a>&quot;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="global-handles_8h.html">src/handles/global-handles.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="counters_8h.html">src/logging/counters.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="sandbox_8h.html">src/sandbox/sandbox.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#if V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="trap-handler_8h.html">src/trap-handler/trap-handler.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-constants_8h.html">src/wasm/wasm-constants.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-engine_8h.html">src/wasm/wasm-engine.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-limits_8h.html">src/wasm/wasm-limits.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-module_8h.html">src/wasm/wasm-module.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-objects-inl_8h.html">src/wasm/wasm-objects-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#endif  </span><span class="comment">// V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="foldopen" id="foldopen00025" data-start="" data-end="">
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">   25</a></span><span class="preprocessor">#define TRACE_BS(...)                                      \</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">  do {                                                     \</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">    if (v8_flags.trace_backing_store) PrintF(__VA_ARGS__); \</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">  } while (false)</span></div>
</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span> </div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacev8_1_1internal.html">v8::internal</a> {</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span> </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#if V8_ENABLE_WEBASSEMBLY &amp;&amp; V8_TARGET_ARCH_64_BIT</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> kFullGuardSize32 = uint64_t{8} * <a class="code hl_variable" href="namespacev8_1_1internal.html#a24ba7f85e96394b19164ecd7df3988c5">GB</a>;</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>std::atomic&lt;uint32_t&gt; next_backing_store_id_{1};</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="comment">// Allocation results are reported to UMA</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="comment">//</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="comment">// See wasm_memory_allocation_result in counters-definitions.h</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="keyword">enum class</span> AllocationStatus {</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>  <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a8225e2541286b06a2e14350fda180c30a8c632159fa131f09d04f94e3cbcd8782">kSuccess</a>,  <span class="comment">// Succeeded on the first try</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>  kSuccessAfterRetry,  <span class="comment">// Succeeded after garbage collection</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>  kAddressSpaceLimitReachedFailure,  <span class="comment">// Failed because Wasm is at its address</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>                                     <span class="comment">// space limit</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>  kOtherFailure  <span class="comment">// Failed for an unknown reason</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>};</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="keywordtype">size_t</span> GetReservationSize(<span class="keywordtype">bool</span> has_guard_regions, <span class="keywordtype">size_t</span> byte_capacity,</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                          <span class="keywordtype">bool</span> is_wasm_memory64) {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="preprocessor">#if V8_TARGET_ARCH_64_BIT &amp;&amp; V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(is_wasm_memory64 &amp;&amp; has_guard_regions,</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>                 <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_memory64_trap_handling);</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>  <span class="keywordflow">if</span> (has_guard_regions &amp;&amp; !is_wasm_memory64) {</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keyword">static_assert</span>(kFullGuardSize32 &gt;= <span class="keywordtype">size_t</span>{4} * <a class="code hl_variable" href="namespacev8_1_1internal.html#a24ba7f85e96394b19164ecd7df3988c5">GB</a>);</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(byte_capacity, <span class="keywordtype">size_t</span>{4} * <a class="code hl_variable" href="namespacev8_1_1internal.html#a24ba7f85e96394b19164ecd7df3988c5">GB</a>);</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="keywordflow">return</span> kFullGuardSize32;</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>  }</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!has_guard_regions);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="keywordflow">return</span> byte_capacity;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>}</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>base::AddressRegion GetReservedRegion(<span class="keywordtype">bool</span> has_guard_regions,</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>                                      <span class="keywordtype">bool</span> is_wasm_memory64, <span class="keywordtype">void</span>* buffer_start,</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>                                      <span class="keywordtype">size_t</span> byte_capacity) {</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>  <span class="keywordflow">return</span> base::AddressRegion(</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>      <span class="keyword">reinterpret_cast&lt;</span><a class="code hl_variable" href="namespacev8_1_1internal.html#a92ab64d42404e439be3d6a7556e32380">Address</a><span class="keyword">&gt;</span>(buffer_start),</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>      GetReservationSize(has_guard_regions, byte_capacity, is_wasm_memory64));</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>}</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="keywordtype">void</span> RecordStatus(Isolate* isolate, AllocationStatus status) {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>  isolate-&gt;counters()-&gt;wasm_memory_allocation_result()-&gt;AddSample(</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>      <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(status));</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>}</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment">// The backing store for a Wasm shared memory remembers all the isolates</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="comment">// with which it has been shared.</span></div>
<div class="foldopen" id="foldopen00088" data-start="{" data-end="};">
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">   88</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">SharedWasmMemoryData</a> {</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1SharedWasmMemoryData.html#ab49ae4d731aa01e82f5ae2bbbec48038">   89</a></span>  std::vector&lt;Isolate*&gt; <a class="code hl_variable" href="structv8_1_1internal_1_1SharedWasmMemoryData.html#ab49ae4d731aa01e82f5ae2bbbec48038">isolates_</a>;</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>};</div>
</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="foldopen" id="foldopen00092" data-start="{" data-end="}">
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#ad1bb1b7221bf47066c3d8ca2ba27b901">   92</a></span><a class="code hl_function" href="classv8_1_1BackingStore.html#a8e13babbe51f481542889b3a6c3fc968">BackingStore::BackingStore</a>(<span class="keywordtype">void</span>* buffer_start, <span class="keywordtype">size_t</span> byte_length,</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                           <span class="keywordtype">size_t</span> max_byte_length, <span class="keywordtype">size_t</span> byte_capacity,</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                           <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a> shared, <a class="code hl_enumeration" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348">ResizableFlag</a> resizable,</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                           <span class="keywordtype">bool</span> is_wasm_memory, <span class="keywordtype">bool</span> is_wasm_memory64,</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>                           <span class="keywordtype">bool</span> has_guard_regions, <span class="keywordtype">bool</span> custom_deleter,</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                           <span class="keywordtype">bool</span> empty_deleter)</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    : buffer_start_(buffer_start),</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>      byte_length_(byte_length),</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>      max_byte_length_(max_byte_length),</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>      byte_capacity_(byte_capacity),</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>      id_(next_backing_store_id_.fetch_add(1)),</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>      is_shared_(shared == <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a>::<a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160a767e1337acb2aa20d7ce4e903a75ca16">kShared</a>),</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>      is_resizable_by_js_(resizable == <a class="code hl_enumeration" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348">ResizableFlag</a>::<a class="code hl_enumvalue" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348a791e8c43bffb7c8241a98ff4a7f315f0">kResizable</a>),</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>      is_wasm_memory_(is_wasm_memory),</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>      is_wasm_memory64_(is_wasm_memory64),</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>      holds_shared_ptr_to_allocator_(false),</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>      has_guard_regions_(has_guard_regions),</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>      globally_registered_(false),</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>      custom_deleter_(custom_deleter),</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>      empty_deleter_(empty_deleter) {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>  <span class="comment">// TODO(v8:11111): RAB / GSAB - Wasm integration.</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>, !<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">is_resizable_by_js_</a>);</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">is_resizable_by_js_</a>, !<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a245da518bf4670c536abae69e40c638b">custom_deleter_</a>);</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(!<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a6549ac91d2a87c9ec3e5d569d1f27cd9">is_wasm_memory</a> &amp;&amp; !<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">is_resizable_by_js_</a>,</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                 <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a> == <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a326b5343db3393753cef809bc3656add">max_byte_length_</a>);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a326b5343db3393753cef809bc3656add">max_byte_length_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>);</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a326b5343db3393753cef809bc3656add">max_byte_length_</a>);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>  <span class="comment">// TODO(1445003): Demote to a DCHECK once we found the issue.</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>  <span class="comment">// Wasm memory should never be empty (== zero capacity). Otherwise</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>  <span class="comment">// {JSArrayBuffer::Attach} would replace it by the {EmptyBackingStore} and we</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>  <span class="comment">// loose information.</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>  <span class="comment">// This is particularly important for shared Wasm memory.</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2c0c4cea27d0690467662bb05131b2af">CHECK_IMPLIES</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a> != 0);</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>}</div>
</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="foldopen" id="foldopen00127" data-start="{" data-end="}">
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#ae14402f37d1a3e964898188f8d5ea345">  127</a></span><a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ae14402f37d1a3e964898188f8d5ea345">BackingStore::~BackingStore</a>() {</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>  <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#abf55b73f22c44d0a3bdbca7f39abedf9">GlobalBackingStoreRegistry::Unregister</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>  <span class="keyword">struct </span>ClearSharedAllocator {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <a class="code hl_class" href="classv8_1_1internal_1_1BackingStore.html">BackingStore</a>* <span class="keyword">const</span> bs;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    ~ClearSharedAllocator() {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>      <span class="keywordflow">if</span> (!bs-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a8e516176c6f5ee34f8b1b819a8b49150">holds_shared_ptr_to_allocator_</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>      bs-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a605935636f567c55035fd08e9a3a0e71">v8_api_array_buffer_allocator_shared</a></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>          .std::shared_ptr&lt;v8::ArrayBuffer::Allocator&gt;::~shared_ptr();</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    }</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>  } clear_shared_allocator{<span class="keyword">this</span>};</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a> == <span class="keyword">nullptr</span>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>  <span class="keyword">auto</span> FreeResizableMemory = [<span class="keyword">this</span>] {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a245da518bf4670c536abae69e40c638b">custom_deleter_</a>);</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">is_resizable_by_js_</a> || <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <span class="keyword">auto</span> region = GetReservedRegion(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#ae42eba483b66dcbcf4c425c502225285">has_guard_regions_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a77999b4f8865ee7173d4dad4f2566304">is_wasm_memory64_</a>,</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                                    <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <a class="code hl_class" href="classv8_1_1PageAllocator.html">PageAllocator</a>* page_allocator = <a class="code hl_function" href="namespacev8_1_1internal.html#a68cd7a6d75e39d01877e03931678b516">GetArrayBufferPageAllocator</a>();</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="keywordflow">if</span> (!region.is_empty()) {</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      <a class="code hl_function" href="namespacev8_1_1internal.html#af33be30dc6995646ac5a541bdf0ede03">FreePages</a>(page_allocator, <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(region.begin()),</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                region.size());</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    }</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>  };</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span><span class="preprocessor">#if V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>) {</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">// TODO(v8:11111): RAB / GSAB - Wasm integration.</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">is_resizable_by_js_</a>);</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="keywordtype">size_t</span> reservation_size = GetReservationSize(</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#ae42eba483b66dcbcf4c425c502225285">has_guard_regions_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a77999b4f8865ee7173d4dad4f2566304">is_wasm_memory64_</a>);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="stringliteral">&quot;BSw:free  bs=%p mem=%p (length=%zu, capacity=%zu, reservation=%zu)\n&quot;</span>,</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keyword">this</span>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>, reservation_size);</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a0337cb660f09b5bcc2d144679c0178f8">is_shared_</a>) {</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>      <span class="comment">// Deallocate the list of attached memory objects.</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>      <a class="code hl_struct" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">SharedWasmMemoryData</a>* shared_data = <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a88544c8b06fedbb7c3cd0dc4d0904634">get_shared_wasm_memory_data</a>();</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>      <span class="keyword">delete</span> shared_data;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    }</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// Wasm memories are always allocated through the page allocator.</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    FreeResizableMemory();</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>  }</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="preprocessor">#endif  </span><span class="comment">// V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">is_resizable_by_js_</a>) {</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    FreeResizableMemory();</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>  }</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a245da518bf4670c536abae69e40c638b">custom_deleter_</a>) {</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BS:custom deleter bs=%p mem=%p (length=%zu, capacity=%zu)\n&quot;</span>,</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>             <span class="keyword">this</span>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a35e64d445c5f7885b2e36234dc3d6b8c">deleter</a>.<a class="code hl_variable" href="structv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_1_1DeleterInfo.html#a6853a256bd2344dff0976a8c60c8ea28">callback</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>,</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>                                         <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a35e64d445c5f7885b2e36234dc3d6b8c">deleter</a>.<a class="code hl_variable" href="structv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_1_1DeleterInfo.html#a2c9bfc1cb445a3fa8f272675154ea341">data</a>);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>  }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  <span class="comment">// JSArrayBuffer backing store. Deallocate through the embedder&#39;s allocator.</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>  <span class="keyword">auto</span> allocator = <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a70a1187cdc0344aa3472ff714a0d4364">get_v8_api_array_buffer_allocator</a>();</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>  <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BS:free   bs=%p mem=%p (length=%zu, capacity=%zu)\n&quot;</span>, <span class="keyword">this</span>,</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>           <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>);</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>  allocator-&gt;Free(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>);</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>}</div>
</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="comment">// Allocate a backing store using the array buffer allocator from the embedder.</span></div>
<div class="foldopen" id="foldopen00196" data-start="{" data-end="}">
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a452e0fa56230d27400718e003b3d5638">  196</a></span>std::unique_ptr&lt;BackingStore&gt; <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a452e0fa56230d27400718e003b3d5638">BackingStore::Allocate</a>(</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">size_t</span> byte_length, <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a> shared,</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a6d3f691695696e478ebb4a18ab857bfa">InitializedFlag</a> initialized) {</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>  <span class="keywordtype">void</span>* <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>  <span class="keyword">auto</span> allocator = isolate-&gt;array_buffer_allocator();</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a9154b181227e4b02e465befe50219158">CHECK_NOT_NULL</a>(allocator);</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a> != 0) {</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="keyword">auto</span> counters = isolate-&gt;counters();</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="keywordtype">int</span> mb_length = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a> / <a class="code hl_variable" href="namespacev8_1_1internal.html#af46551c5713d2a3a1be4dca973e521e0">MB</a>);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keywordflow">if</span> (mb_length &gt; 0) {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>      counters-&gt;array_buffer_big_allocations()-&gt;AddSample(mb_length);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    }</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="keywordflow">if</span> (shared == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160a767e1337acb2aa20d7ce4e903a75ca16">SharedFlag::kShared</a>) {</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>      counters-&gt;shared_array_allocations()-&gt;AddSample(mb_length);</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    }</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keyword">auto</span> allocate_buffer = [allocator, initialized](<span class="keywordtype">size_t</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>) {</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>      <span class="keywordflow">if</span> (initialized == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a6d3f691695696e478ebb4a18ab857bfaa518b13885544b3431069d8b44387de9c">InitializedFlag::kUninitialized</a>) {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        <span class="keywordflow">return</span> allocator-&gt;AllocateUninitialized(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>);</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>      }</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>      <span class="keywordflow">return</span> allocator-&gt;Allocate(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>);</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    };</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a> = isolate-&gt;heap()-&gt;AllocateExternalBackingStore(</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        allocate_buffer, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>      <span class="comment">// Allocation failed.</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>      counters-&gt;array_buffer_new_size_failures()-&gt;AddSample(mb_length);</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>      <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    }</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="preprocessor">#ifdef V8_ENABLE_SANDBOX</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="comment">// Check to catch use of a non-sandbox-compatible ArrayBufferAllocator.</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a7b0fb5d6be902959a80a9a33cc4e73fe">CHECK_WITH_MSG</a>(Sandbox::current()-&gt;Contains(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>),</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                   <span class="stringliteral">&quot;When the V8 Sandbox is enabled, ArrayBuffer backing stores &quot;</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                   <span class="stringliteral">&quot;must be allocated inside the sandbox address space. Please &quot;</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>                   <span class="stringliteral">&quot;use an appropriate ArrayBuffer::Allocator to allocate &quot;</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>                   <span class="stringliteral">&quot;these buffers, or disable the sandbox.&quot;</span>);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>  }</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <span class="keyword">new</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ad1bb1b7221bf47066c3d8ca2ba27b901">BackingStore</a>(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>,                  <span class="comment">// start</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>,                   <span class="comment">// length</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>,                   <span class="comment">// max length</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>,                   <span class="comment">// capacity</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>                                 shared,                        <span class="comment">// shared</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>                                 <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348af444d0c6959a4f4e0553ccd4f9f35908">ResizableFlag::kNotResizable</a>,  <span class="comment">// resizable</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>                                 <span class="keyword">false</span>,   <span class="comment">// is_wasm_memory</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                                 <span class="keyword">false</span>,   <span class="comment">// is_wasm_memory64</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>                                 <span class="keyword">false</span>,   <span class="comment">// has_guard_regions</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>                                 <span class="keyword">false</span>,   <span class="comment">// custom_deleter</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>                                 <span class="keyword">false</span>);  <span class="comment">// empty_deleter</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>  <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BS:alloc  bs=%p mem=%p (length=%zu)\n&quot;</span>, <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>,</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>           <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;buffer_start(), <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>  <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;SetAllocatorFromIsolate(isolate);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>  <span class="keywordflow">return</span> std::unique_ptr&lt;BackingStore&gt;(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>}</div>
</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="foldopen" id="foldopen00254" data-start="{" data-end="}">
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a7739254c12bdc22180aadbd4145f2846">  254</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a7739254c12bdc22180aadbd4145f2846">BackingStore::SetAllocatorFromIsolate</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate) {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>  <span class="keywordflow">if</span> (<span class="keyword">auto</span> allocator_shared = isolate-&gt;array_buffer_allocator_shared()) {</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a8e516176c6f5ee34f8b1b819a8b49150">holds_shared_ptr_to_allocator_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keyword">new</span> (&amp;<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a605935636f567c55035fd08e9a3a0e71">v8_api_array_buffer_allocator_shared</a>)</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        std::shared_ptr&lt;v8::ArrayBuffer::Allocator&gt;(</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            std::move(allocator_shared));</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#adc88bc06374b235a42ac1f1bbcb81622">v8_api_array_buffer_allocator</a> =</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        isolate-&gt;array_buffer_allocator();</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  }</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>}</div>
</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="foldopen" id="foldopen00266" data-start="{" data-end="}">
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#ac8fb972e6675e4ecbe2d0c6be58bc3ed">  266</a></span>std::unique_ptr&lt;BackingStore&gt; <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ac8fb972e6675e4ecbe2d0c6be58bc3ed">BackingStore::TryAllocateAndPartiallyCommitMemory</a>(</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">size_t</span> byte_length, <span class="keywordtype">size_t</span> max_byte_length,</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="keywordtype">size_t</span> page_size, <span class="keywordtype">size_t</span> initial_pages, <span class="keywordtype">size_t</span> maximum_pages,</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6">WasmMemoryFlag</a> wasm_memory, <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a> shared) {</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>  <span class="comment">// Enforce engine limitation on the maximum number of pages.</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="keywordflow">if</span> (maximum_pages &gt; std::numeric_limits&lt;size_t&gt;::max() / page_size) {</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>  }</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>  <span class="comment">// Cannot reserve 0 pages on some OSes.</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>  <span class="keywordflow">if</span> (maximum_pages == 0) maximum_pages = 1;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BSw:try   %zu pages, %zu max\n&quot;</span>, initial_pages, maximum_pages);</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="preprocessor">#if V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>  <span class="keywordtype">bool</span> is_wasm_memory64 = wasm_memory == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a076ed6b69b93a14d0f539af6c5bf4913">WasmMemoryFlag::kWasmMemory64</a>;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>  <span class="keywordtype">bool</span> guards = <a class="code hl_function" href="namespacev8_1_1internal_1_1trap__handler.html#a47f4fc1ba5bf67b48a471d0527c99291">trap_handler::IsTrapHandlerEnabled</a>() &amp;&amp;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>                (wasm_memory == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a047ebee131a760d19529704fdfc1d412">WasmMemoryFlag::kWasmMemory32</a> ||</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>                 (is_wasm_memory64 &amp;&amp; <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_memory64_trap_handling));</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aca32614b4d2aea7dd9abdeb222bf02f3">CHECK_EQ</a>(<a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a55cd2e71581cb7d0f1e9dbf5113d3516">WasmMemoryFlag::kNotWasm</a>, wasm_memory);</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>  <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> is_wasm_memory64 = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>  <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> guards = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="preprocessor">#endif  </span><span class="comment">// V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>  <span class="comment">// For accounting purposes, whether a GC was necessary.</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>  <span class="keywordtype">bool</span> did_retry = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>  <span class="comment">// A helper to try running a function up to 3 times, executing a GC</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>  <span class="comment">// if the first and second attempts failed.</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>  <span class="keyword">auto</span> gc_retry = [&amp;](<span class="keyword">const</span> std::function&lt;<a class="code hl_variable" href="namespacev8_1_1internal.html#a4e2118a7c0d730210e0cb87b511cba70">bool</a>()&gt;&amp; <a class="code hl_variable" href="liftoff-compiler_8cc.html#ac96b98a543c504abf4ffd7eaa447e94a">fn</a>) {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; 3; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="liftoff-compiler_8cc.html#ac96b98a543c504abf4ffd7eaa447e94a">fn</a>()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>      <span class="comment">// Collect garbage and retry.</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>      did_retry = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>      <span class="keywordflow">if</span> (isolate != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>        isolate-&gt;heap()-&gt;MemoryPressureNotification(</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <a class="code hl_enumvalue" href="namespacev8.html#ae0e9a25bf51e518585f555806e7dc7b9a5a20548c220f372fc701cae6de94040b">MemoryPressureLevel::kCritical</a>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>      }</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    }</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>  };</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span> </div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>  <span class="keywordtype">size_t</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab76e4ee584f63c9a2be17a036fa29102">byte_capacity</a> = maximum_pages * page_size;</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>  <span class="keywordtype">size_t</span> reservation_size =</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>      GetReservationSize(guards, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab76e4ee584f63c9a2be17a036fa29102">byte_capacity</a>, is_wasm_memory64);</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>  <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>  <span class="comment">// Allocate pages (inaccessible by default).</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>  <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>  <span class="keywordtype">void</span>* allocation_base = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>  <a class="code hl_class" href="classv8_1_1PageAllocator.html">PageAllocator</a>* page_allocator = <a class="code hl_function" href="namespacev8_1_1internal.html#a68cd7a6d75e39d01877e03931678b516">GetArrayBufferPageAllocator</a>();</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>  <span class="keyword">auto</span> allocate_pages = [&amp;] {</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    allocation_base = <a class="code hl_function" href="namespacev8_1_1internal.html#a35340b7fc4ef1a114d8ff1272f99be7a">AllocatePages</a>(page_allocator, <span class="keyword">nullptr</span>, reservation_size,</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>                                    page_size, <a class="code hl_enumvalue" href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415a501acdacad072f7d6e5737159141301d">PageAllocator::kNoAccess</a>);</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <span class="keywordflow">return</span> allocation_base != <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>  };</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>  <span class="keywordflow">if</span> (!gc_retry(allocate_pages)) {</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="comment">// Page allocator could not reserve enough pages.</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="keywordflow">if</span> (isolate != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>      RecordStatus(isolate, AllocationStatus::kOtherFailure);</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>    }</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BSw:try   failed to allocate pages\n&quot;</span>);</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>  }</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>  uint8_t* <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a> = <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(allocation_base);</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>  <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  <span class="comment">// Commit the initial pages (allow read/write).</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>  <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>  <span class="keywordtype">size_t</span> committed_byte_length = initial_pages * page_size;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>  <span class="keyword">auto</span> commit_memory = [&amp;] {</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    <span class="keywordflow">return</span> committed_byte_length == 0 ||</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>           <a class="code hl_function" href="namespacev8_1_1internal.html#a0b20b06fc0f215d9b9eac890977a53e7">SetPermissions</a>(page_allocator, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>, committed_byte_length,</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>                          <a class="code hl_enumvalue" href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415abf9beddb1231fa2c23ab417197ea9f8a">PageAllocator::kReadWrite</a>);</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  };</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>  <span class="keywordflow">if</span> (!gc_retry(commit_memory)) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BSw:try   failed to set permissions (%p, %zu)\n&quot;</span>, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>,</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>             committed_byte_length);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <a class="code hl_function" href="namespacev8_1_1internal.html#af33be30dc6995646ac5a541bdf0ede03">FreePages</a>(page_allocator, allocation_base, reservation_size);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="comment">// SetPermissions put us over the process memory limit.</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <span class="comment">// We return an empty result so that the caller can throw an exception.</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>  }</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>  <span class="keywordflow">if</span> (isolate != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    RecordStatus(isolate, did_retry ? AllocationStatus::kSuccessAfterRetry</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>                                    : AllocationStatus::kSuccess);</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>  }</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a6549ac91d2a87c9ec3e5d569d1f27cd9">is_wasm_memory</a> = wasm_memory != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a55cd2e71581cb7d0f1e9dbf5113d3516">WasmMemoryFlag::kNotWasm</a>;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348">ResizableFlag</a> resizable =</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>      <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a6549ac91d2a87c9ec3e5d569d1f27cd9">is_wasm_memory</a> ? <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348af444d0c6959a4f4e0553ccd4f9f35908">ResizableFlag::kNotResizable</a> : <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348a791e8c43bffb7c8241a98ff4a7f315f0">ResizableFlag::kResizable</a>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <span class="keyword">new</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ad1bb1b7221bf47066c3d8ca2ba27b901">BackingStore</a>(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>,      <span class="comment">// start</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>,       <span class="comment">// length</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a64bbbcd6c2a9fba5824432ac58428b95">max_byte_length</a>,   <span class="comment">// max_byte_length</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab76e4ee584f63c9a2be17a036fa29102">byte_capacity</a>,     <span class="comment">// capacity</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>                                 shared,            <span class="comment">// shared</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>                                 resizable,         <span class="comment">// resizable</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>                                 <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a6549ac91d2a87c9ec3e5d569d1f27cd9">is_wasm_memory</a>,    <span class="comment">// is_wasm_memory</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>                                 is_wasm_memory64,  <span class="comment">// is_wasm_memory64</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                                 guards,            <span class="comment">// has_guard_regions</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                                 <span class="keyword">false</span>,             <span class="comment">// custom_deleter</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>                                 <span class="keyword">false</span>);            <span class="comment">// empty_deleter</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>  <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>      <span class="stringliteral">&quot;BSw:alloc bs=%p mem=%p (length=%zu, capacity=%zu, reservation=%zu)\n&quot;</span>,</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>      <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>, <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;buffer_start(), <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">byte_length</a>, <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ab76e4ee584f63c9a2be17a036fa29102">byte_capacity</a>,</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>      reservation_size);</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>  <span class="keywordflow">return</span> std::unique_ptr&lt;BackingStore&gt;(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>}</div>
</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span><span class="preprocessor">#if V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="comment">// Allocate a backing store for a Wasm memory. Always use the page allocator</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="comment">// and add guard regions.</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>std::unique_ptr&lt;BackingStore&gt; BackingStore::AllocateWasmMemory(</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">size_t</span> initial_pages, <span class="keywordtype">size_t</span> maximum_pages,</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6">WasmMemoryFlag</a> wasm_memory, <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a> shared) {</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>  <span class="comment">// Wasm pages must be a multiple of the allocation page size.</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(0, <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a> % <a class="code hl_function" href="namespacev8_1_1internal.html#a9f5507dc03f0b35f38b119fc3285586a">AllocatePageSize</a>());</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(initial_pages, maximum_pages);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(maximum_pages, wasm_memory == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a047ebee131a760d19529704fdfc1d412">WasmMemoryFlag::kWasmMemory32</a></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                               ? <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#af9eea7ef6c36992fe92707061703fb43">wasm::kV8MaxWasmMemory32Pages</a></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                               : <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#a58280911560a19ed11d754bee507198e">wasm::kV8MaxWasmMemory64Pages</a>);</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(wasm_memory == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a047ebee131a760d19529704fdfc1d412">WasmMemoryFlag::kWasmMemory32</a> ||</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>         wasm_memory == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a076ed6b69b93a14d0f539af6c5bf4913">WasmMemoryFlag::kWasmMemory64</a>);</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>  <span class="keyword">auto</span> TryAllocate = [<a class="code hl_variable" href="graph-builder_8cc.html#a9990dda08de44f6aee0aaf44c50da7d9">isolate</a>, initial_pages, wasm_memory,</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                      <a class="code hl_variable" href="js-call-reducer_8cc.html#a9fa9548665fda8f7a8cfad92f3c8cedd">shared</a>](<span class="keywordtype">size_t</span> maximum_pages) {</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <span class="keyword">auto</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ac8fb972e6675e4ecbe2d0c6be58bc3ed">TryAllocateAndPartiallyCommitMemory</a>(</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>        isolate, initial_pages * <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>,</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        maximum_pages * <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>, <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>, initial_pages,</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>        maximum_pages, wasm_memory, shared);</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> &amp;&amp; shared == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160a767e1337acb2aa20d7ce4e903a75ca16">SharedFlag::kShared</a>) {</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>      <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;type_specific_data_.shared_wasm_memory_data =</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>          <span class="keyword">new</span> <a class="code hl_struct" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">SharedWasmMemoryData</a>();</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    }</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>;</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>  };</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>  <span class="keyword">auto</span> backing_store = TryAllocate(maximum_pages);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>  <span class="keywordflow">if</span> (!backing_store &amp;&amp; maximum_pages - initial_pages &gt;= 4) {</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <span class="comment">// Retry with smaller maximum pages at each retry.</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <span class="keyword">auto</span> delta = (maximum_pages - initial_pages) / 4;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="keywordtype">size_t</span> sizes[] = {maximum_pages - delta, maximum_pages - 2 * delta,</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>                      maximum_pages - 3 * delta, initial_pages};</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> reduced_maximum_pages : sizes) {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>      backing_store = TryAllocate(reduced_maximum_pages);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>      <span class="keywordflow">if</span> (backing_store) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    }</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>  }</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>  <span class="keywordflow">return</span> backing_store;</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>}</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>std::unique_ptr&lt;BackingStore&gt; BackingStore::CopyWasmMemory(</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    Isolate* isolate, <span class="keywordtype">size_t</span> new_pages, <span class="keywordtype">size_t</span> max_pages,</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6">WasmMemoryFlag</a> wasm_memory) {</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>  <span class="comment">// Note that we could allocate uninitialized to save initialization cost here,</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>  <span class="comment">// but since Wasm memories are allocated by the page allocator, the zeroing</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>  <span class="comment">// cost is already built-in.</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>  <span class="keyword">auto</span> new_backing_store = BackingStore::AllocateWasmMemory(</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>      isolate, new_pages, max_pages, wasm_memory,</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a402d443b520a53485151c9d2285ce62d">is_shared</a>() ? <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160a767e1337acb2aa20d7ce4e903a75ca16">SharedFlag::kShared</a> : <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160af80e42734f3024456dd90ae366cecf3e">SharedFlag::kNotShared</a>);</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>  <span class="keywordflow">if</span> (!new_backing_store ||</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>      new_backing_store-&gt;has_guard_regions() != <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#ae42eba483b66dcbcf4c425c502225285">has_guard_regions_</a>) {</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>  }</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span> </div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a> &gt; 0) {</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="comment">// If the allocation was successful, then the new buffer must be at least</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="comment">// as big as the old one.</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(new_pages * <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>);</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    memcpy(new_backing_store-&gt;buffer_start(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>  }</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>  <span class="keywordflow">return</span> new_backing_store;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>}</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="comment">// Try to grow the size of a wasm memory in place, without realloc + copy.</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>std::optional&lt;size_t&gt; BackingStore::GrowWasmMemoryInPlace(Isolate* isolate,</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>                                                          <span class="keywordtype">size_t</span> delta_pages,</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>                                                          <span class="keywordtype">size_t</span> max_pages) {</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>  <span class="comment">// This function grows wasm memory by</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>  <span class="comment">// * changing the permissions of additional {delta_pages} pages to kReadWrite;</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>  <span class="comment">// * increment {byte_length_};</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>  <span class="comment">// As this code is executed concurrently, the following steps are executed:</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>  <span class="comment">// 1) Read the current value of {byte_length_};</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>  <span class="comment">// 2) Change the permission of all pages from {buffer_start_} to</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>  <span class="comment">//    {byte_length_} + {delta_pages} * {page_size} to kReadWrite;</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>  <span class="comment">//    * This operation may be executed racefully. The OS takes care of</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>  <span class="comment">//      synchronization.</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>  <span class="comment">// 3) Try to update {byte_length_} with a compare_exchange;</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>  <span class="comment">// 4) Repeat 1) to 3) until the compare_exchange in 3) succeeds;</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>  <span class="comment">// The result of this function is the {byte_length_} before growing in pages.</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>  <span class="comment">// The result of this function appears like the result of an RMW-update on</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>  <span class="comment">// {byte_length_}, i.e. two concurrent calls to this function will result in</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>  <span class="comment">// different return values if {delta_pages} != 0.</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>  <span class="comment">//</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>  <span class="comment">// Invariants:</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>  <span class="comment">// * Permissions are always set incrementally, i.e. for any page {b} with</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>  <span class="comment">//   kReadWrite permission, all pages between the first page {a} and page {b}</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>  <span class="comment">//   also have kReadWrite permission.</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>  <span class="comment">// * {byte_length_} is always lower or equal than the amount of memory with</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  <span class="comment">//   permissions set to kReadWrite;</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>  <span class="comment">//     * This is guaranteed by incrementing {byte_length_} with a</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>  <span class="comment">//       compare_exchange after changing the permissions.</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>  <span class="comment">//     * This invariant is the reason why we cannot use a fetch_add.</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>);</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>  max_pages = std::min(max_pages, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a> / <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>);</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span> </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>  <span class="comment">// Do a compare-exchange loop, because we also need to adjust page</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>  <span class="comment">// permissions. Note that multiple racing grows both try to set page</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>  <span class="comment">// permissions for the entire range (to be RW), so the operating system</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>  <span class="comment">// should deal with that raciness. We know we succeeded when we can</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>  <span class="comment">// compare/swap the old length with the new length.</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>  <span class="keywordtype">size_t</span> old_length = <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>  <span class="keywordflow">if</span> (delta_pages == 0)</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keywordflow">return</span> {old_length / <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>};  <span class="comment">// degenerate grow.</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>  <span class="keywordflow">if</span> (delta_pages &gt; max_pages) <span class="keywordflow">return</span> {};       <span class="comment">// would never work.</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>  <span class="keywordtype">size_t</span> <a class="code hl_variable" href="regexp-bytecode-peephole_8cc.html#ae6409a32d85daa404e52072329e0a5ad">new_length</a> = 0;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    <span class="keywordtype">size_t</span> current_pages = old_length / <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span> </div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <span class="comment">// Check if we have exceed the supplied maximum.</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    <span class="keywordflow">if</span> (current_pages &gt; (max_pages - delta_pages)) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <a class="code hl_variable" href="regexp-bytecode-peephole_8cc.html#ae6409a32d85daa404e52072329e0a5ad">new_length</a> = (current_pages + delta_pages) * <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="comment">// Try to adjust the permissions on the memory.</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacev8_1_1internal.html#a0b20b06fc0f215d9b9eac890977a53e7">i::SetPermissions</a>(<a class="code hl_function" href="namespacev8_1_1internal.html#a1b38d6a01927e639b91b6a039899ac1a">GetPlatformPageAllocator</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>,</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>                           <a class="code hl_variable" href="regexp-bytecode-peephole_8cc.html#ae6409a32d85daa404e52072329e0a5ad">new_length</a>, <a class="code hl_enumvalue" href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415abf9beddb1231fa2c23ab417197ea9f8a">PageAllocator::kReadWrite</a>)) {</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>      <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    }</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>.compare_exchange_weak(old_length, <a class="code hl_variable" href="regexp-bytecode-peephole_8cc.html#ae6409a32d85daa404e52072329e0a5ad">new_length</a>,</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>                                           std::memory_order_acq_rel)) {</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>      <span class="comment">// Successfully updated both the length and permissions.</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    }</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>  }</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>  <span class="keywordflow">return</span> {old_length / <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">wasm::kWasmPageSize</a>};</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>}</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span> </div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span><span class="keywordtype">void</span> BackingStore::AttachSharedWasmMemoryObject(</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    Isolate* isolate, DirectHandle&lt;WasmMemoryObject&gt; memory_object) {</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>);</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a0337cb660f09b5bcc2d144679c0178f8">is_shared_</a>);</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>  <span class="comment">// We need to take the global registry lock for this operation.</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>  <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a74b7e940331c6b2f36b98a0b7cd92ea8">GlobalBackingStoreRegistry::AddSharedWasmMemoryObject</a>(isolate, <span class="keyword">this</span>,</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>                                                        memory_object);</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>}</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span> </div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="keywordtype">void</span> BackingStore::BroadcastSharedWasmMemoryGrow(Isolate* isolate)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>  <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#ad6a1f4fe7b1bdd589e65614f2b0c9069">GlobalBackingStoreRegistry::BroadcastSharedWasmMemoryGrow</a>(isolate, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>}</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="keywordtype">void</span> BackingStore::RemoveSharedWasmMemoryObjects(Isolate* isolate) {</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>  <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a3215d7f1cef79cff5fd4f3322ce085d9">GlobalBackingStoreRegistry::Purge</a>(isolate);</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>}</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span> </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="keywordtype">void</span> BackingStore::UpdateSharedWasmMemoryObjects(Isolate* isolate) {</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>  <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#af68be2d45b01f8cf2848c5ff3e1e7a0f">GlobalBackingStoreRegistry::UpdateSharedWasmMemoryObjects</a>(isolate);</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>}</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span><span class="preprocessor">#endif  </span><span class="comment">// V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span><span class="comment">// Commit already reserved memory (for RAB backing stores (not shared)).</span></div>
<div class="foldopen" id="foldopen00540" data-start="{" data-end="}">
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#ae5929dedd03eb03ff23ae46e2ef0d318">  540</a></span><a class="code hl_enumeration" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7">BackingStore::ResizeOrGrowResult</a> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ae5929dedd03eb03ff23ae46e2ef0d318">BackingStore::ResizeInPlace</a>(</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">size_t</span> new_byte_length) {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>  <span class="keywordtype">size_t</span> page_size = <a class="code hl_function" href="namespacev8_1_1internal.html#a9f5507dc03f0b35f38b119fc3285586a">AllocatePageSize</a>();</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>  <span class="keywordtype">size_t</span> new_committed_pages;</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>  <span class="keywordtype">bool</span> round_return_value =</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>      <a class="code hl_function" href="namespacev8_1_1internal.html#a6a1f3d6b7cd6594565b3bd1b98293248">RoundUpToPageSize</a>(new_byte_length, page_size,</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>                        <a class="code hl_variable" href="classv8_1_1internal_1_1JSArrayBuffer.html#aaa9641b33f3b26b38930cbb552f8770c">JSArrayBuffer::kMaxByteLength</a>, &amp;new_committed_pages);</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(round_return_value);</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>  <span class="keywordtype">size_t</span> new_committed_length = new_committed_pages * page_size;</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(new_byte_length, new_committed_length);</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a402d443b520a53485151c9d2285ce62d">is_shared</a>());</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span> </div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>  <span class="keywordflow">if</span> (new_byte_length &lt; <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>) {</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <span class="comment">// Zero the memory so that in case the buffer is grown later, we have</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="comment">// zeroed the contents already. This is especially needed for the portion of</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="comment">// the memory we&#39;re not going to decommit below (since it belongs to a</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="comment">// committed page). In addition, we don&#39;t rely on all platforms always</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">// zeroing decommitted-then-recommitted memory, but zero the memory</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="comment">// explicitly here.</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    memset(<span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>) + new_byte_length, 0,</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>           <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a> - new_byte_length);</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="comment">// Check if we can un-commit some pages.</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="keywordtype">size_t</span> old_committed_pages;</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    round_return_value =</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        <a class="code hl_function" href="namespacev8_1_1internal.html#a6a1f3d6b7cd6594565b3bd1b98293248">RoundUpToPageSize</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>, page_size,</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>                          <a class="code hl_variable" href="classv8_1_1internal_1_1JSArrayBuffer.html#aaa9641b33f3b26b38930cbb552f8770c">JSArrayBuffer::kMaxByteLength</a>, &amp;old_committed_pages);</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(round_return_value);</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(new_committed_pages, old_committed_pages);</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    <span class="keywordflow">if</span> (new_committed_pages &lt; old_committed_pages) {</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>      <span class="keywordtype">size_t</span> old_committed_length = old_committed_pages * page_size;</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>      <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacev8_1_1internal.html#a0b20b06fc0f215d9b9eac890977a53e7">i::SetPermissions</a>(</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>              <a class="code hl_function" href="namespacev8_1_1internal.html#a1b38d6a01927e639b91b6a039899ac1a">GetPlatformPageAllocator</a>(),</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>              <span class="keyword">reinterpret_cast&lt;</span>uint8_t*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>) + new_committed_length,</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>              old_committed_length - new_committed_length,</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>              <a class="code hl_enumvalue" href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415a501acdacad072f7d6e5737159141301d">PageAllocator::kNoAccess</a>)) {</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7a2facbfb720d8f652c576c26ddd253982">kFailure</a>;</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>      }</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    }</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">// Changing the byte length wouldn&#39;t strictly speaking be needed, since</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="comment">// the JSArrayBuffer already stores the updated length. This is to keep</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="comment">// the BackingStore and JSArrayBuffer in sync.</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a> = new_byte_length;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f">kSuccess</a>;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>  }</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>  <span class="keywordflow">if</span> (new_byte_length == <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>) {</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    <span class="comment">// i::SetPermissions with size 0 fails on some platforms, so special</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <span class="comment">// handling for the case byte_length_ == new_byte_length == 0 is required.</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f">kSuccess</a>;</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>  }</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>  <span class="comment">// Try to adjust the permissions on the memory.</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacev8_1_1internal.html#a0b20b06fc0f215d9b9eac890977a53e7">i::SetPermissions</a>(<a class="code hl_function" href="namespacev8_1_1internal.html#a1b38d6a01927e639b91b6a039899ac1a">GetPlatformPageAllocator</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>,</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                         new_committed_length, <a class="code hl_enumvalue" href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415abf9beddb1231fa2c23ab417197ea9f8a">PageAllocator::kReadWrite</a>)) {</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7a2facbfb720d8f652c576c26ddd253982">kFailure</a>;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>  }</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a> = new_byte_length;</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f">kSuccess</a>;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>}</div>
</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span><span class="comment">// Commit already reserved memory (for GSAB backing stores (shared)).</span></div>
<div class="foldopen" id="foldopen00605" data-start="{" data-end="}">
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a114a717a1c979e511051ba890321585f">  605</a></span><a class="code hl_enumeration" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7">BackingStore::ResizeOrGrowResult</a> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a114a717a1c979e511051ba890321585f">BackingStore::GrowInPlace</a>(</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">size_t</span> new_byte_length) {</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>  <span class="keywordtype">size_t</span> page_size = <a class="code hl_function" href="namespacev8_1_1internal.html#a9f5507dc03f0b35f38b119fc3285586a">AllocatePageSize</a>();</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>  <span class="keywordtype">size_t</span> new_committed_pages;</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>  <span class="keywordtype">bool</span> round_return_value =</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>      <a class="code hl_function" href="namespacev8_1_1internal.html#a6a1f3d6b7cd6594565b3bd1b98293248">RoundUpToPageSize</a>(new_byte_length, page_size,</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                        <a class="code hl_variable" href="classv8_1_1internal_1_1JSArrayBuffer.html#aaa9641b33f3b26b38930cbb552f8770c">JSArrayBuffer::kMaxByteLength</a>, &amp;new_committed_pages);</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(round_return_value);</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span> </div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>  <span class="keywordtype">size_t</span> new_committed_length = new_committed_pages * page_size;</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(new_byte_length, new_committed_length);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a402d443b520a53485151c9d2285ce62d">is_shared</a>());</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>  <span class="comment">// See comment in GrowWasmMemoryInPlace.</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  <span class="comment">// GrowableSharedArrayBuffer.prototype.grow can be called from several</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>  <span class="comment">// threads. If two threads try to grow() in a racy way, the spec allows the</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>  <span class="comment">// larger grow to throw also if the smaller grow succeeds first. The</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>  <span class="comment">// implementation below doesn&#39;t throw in that case - instead, it retries and</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>  <span class="comment">// succeeds. If the larger grow finishes first though, the smaller grow must</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>  <span class="comment">// throw.</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>  <span class="keywordtype">size_t</span> old_byte_length = <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>.load(std::memory_order_seq_cst);</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="keywordflow">if</span> (new_byte_length &lt; old_byte_length) {</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>      <span class="comment">// The caller checks for the new_byte_length &lt; old_byte_length_ case. This</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>      <span class="comment">// can only happen if another thread grew the memory after that.</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7a1e2d07bb7bd779234bcf3eb8e81143d1">kRace</a>;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <span class="keywordflow">if</span> (new_byte_length == old_byte_length) {</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>      <span class="comment">// i::SetPermissions with size 0 fails on some platforms, so special</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>      <span class="comment">// handling for the case old_byte_length == new_byte_length == 0 is</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>      <span class="comment">// required.</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f">kSuccess</a>;</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    }</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    <span class="comment">// Try to adjust the permissions on the memory.</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacev8_1_1internal.html#a0b20b06fc0f215d9b9eac890977a53e7">i::SetPermissions</a>(<a class="code hl_function" href="namespacev8_1_1internal.html#a1b38d6a01927e639b91b6a039899ac1a">GetPlatformPageAllocator</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>,</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>                           new_committed_length, <a class="code hl_enumvalue" href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415abf9beddb1231fa2c23ab417197ea9f8a">PageAllocator::kReadWrite</a>)) {</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7a2facbfb720d8f652c576c26ddd253982">kFailure</a>;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    }</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    <span class="comment">// compare_exchange_weak updates old_byte_length.</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>.compare_exchange_weak(old_byte_length, new_byte_length,</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>                                           std::memory_order_seq_cst)) {</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>      <span class="comment">// Successfully updated both the length and permissions.</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    }</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>  }</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f">kSuccess</a>;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>}</div>
</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="foldopen" id="foldopen00654" data-start="{" data-end="}">
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a2067951c5d4377b698d7799bc63af02a">  654</a></span>std::unique_ptr&lt;BackingStore&gt; <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a2067951c5d4377b698d7799bc63af02a">BackingStore::WrapAllocation</a>(</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="keywordtype">void</span>* allocation_base, <span class="keywordtype">size_t</span> allocation_length,</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <a class="code hl_typedef" href="classv8_1_1BackingStore.html#a3e91bbf335d64c4cd15279bc3b4fe5fb">v8::BackingStore::DeleterCallback</a> deleter, <span class="keywordtype">void</span>* deleter_data,</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a> shared) {</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>  <span class="keywordtype">bool</span> is_empty_deleter = (deleter == <a class="code hl_function" href="classv8_1_1BackingStore.html#ae19ce3cfb723f9559f02b54e8a5ab6a0">v8::BackingStore::EmptyDeleter</a>);</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <span class="keyword">new</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ad1bb1b7221bf47066c3d8ca2ba27b901">BackingStore</a>(allocation_base,               <span class="comment">// start</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                                 allocation_length,             <span class="comment">// length</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>                                 allocation_length,             <span class="comment">// max length</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>                                 allocation_length,             <span class="comment">// capacity</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>                                 shared,                        <span class="comment">// shared</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>                                 <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348af444d0c6959a4f4e0553ccd4f9f35908">ResizableFlag::kNotResizable</a>,  <span class="comment">// resizable</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>                                 <span class="keyword">false</span>,              <span class="comment">// is_wasm_memory</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>                                 <span class="keyword">false</span>,              <span class="comment">// is_wasm_memory64</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                                 <span class="keyword">false</span>,              <span class="comment">// has_guard_regions</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                                 <span class="keyword">true</span>,               <span class="comment">// custom_deleter</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>                                 is_empty_deleter);  <span class="comment">// empty_deleter</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>  <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;type_specific_data_.deleter = {deleter, deleter_data};</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>  <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BS:wrap   bs=%p mem=%p (length=%zu)\n&quot;</span>, <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>,</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>           <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;buffer_start(), <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;byte_length());</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>  <span class="keywordflow">return</span> std::unique_ptr&lt;BackingStore&gt;(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>}</div>
</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span> </div>
<div class="foldopen" id="foldopen00676" data-start="{" data-end="}">
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a6e20cd7042a45d5a989c784030fed72c">  676</a></span>std::unique_ptr&lt;BackingStore&gt; <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a6e20cd7042a45d5a989c784030fed72c">BackingStore::EmptyBackingStore</a>(</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">SharedFlag</a> shared) {</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <span class="keyword">new</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#ad1bb1b7221bf47066c3d8ca2ba27b901">BackingStore</a>(<span class="keyword">nullptr</span>,                       <span class="comment">// start</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>                                 0,                             <span class="comment">// length</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>                                 0,                             <span class="comment">// max length</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>                                 0,                             <span class="comment">// capacity</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                                 shared,                        <span class="comment">// shared</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>                                 <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348af444d0c6959a4f4e0553ccd4f9f35908">ResizableFlag::kNotResizable</a>,  <span class="comment">// resizable</span></div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>                                 <span class="keyword">false</span>,   <span class="comment">// is_wasm_memory</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                                 <span class="keyword">false</span>,   <span class="comment">// is_wasm_memory64</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                                 <span class="keyword">false</span>,   <span class="comment">// has_guard_regions</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                                 <span class="keyword">false</span>,   <span class="comment">// custom_deleter</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>                                 <span class="keyword">false</span>);  <span class="comment">// empty_deleter</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span> </div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>  <span class="keywordflow">return</span> std::unique_ptr&lt;BackingStore&gt;(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>}</div>
</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span> </div>
<div class="foldopen" id="foldopen00693" data-start="{" data-end="}">
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a0150f25ceb72d61ed3b2c6ca47a1ed99">  693</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a0150f25ceb72d61ed3b2c6ca47a1ed99">BackingStore::Reallocate</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">size_t</span> new_byte_length) {</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a84e380810d47e8192b6a76c541d198b0">CanReallocate</a>());</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>  <span class="keyword">auto</span> allocator = <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a70a1187cdc0344aa3472ff714a0d4364">get_v8_api_array_buffer_allocator</a>();</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aca32614b4d2aea7dd9abdeb222bf02f3">CHECK_EQ</a>(isolate-&gt;array_buffer_allocator(), allocator);</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#aca32614b4d2aea7dd9abdeb222bf02f3">CHECK_EQ</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a>);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>  <a class="code hl_define" href="v8config_8h.html#ab7cd68756ed2a5deadd67f4175f4bc61">START_ALLOW_USE_DEPRECATED</a>()</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>  <span class="keywordtype">void</span>* new_start =</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>      allocator-&gt;Reallocate(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a>, new_byte_length);</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>  <a class="code hl_define" href="v8config_8h.html#a41c02a3573ba53271a80787e85f5b105">END_ALLOW_USE_DEPRECATED</a>()</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>  <span class="keywordflow">if</span> (!new_start) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">buffer_start_</a> = new_start;</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">byte_capacity_</a> = new_byte_length;</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">byte_length_</a> = new_byte_length;</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a326b5343db3393753cef809bc3656add">max_byte_length_</a> = new_byte_length;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>}</div>
</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span> </div>
<div class="foldopen" id="foldopen00710" data-start="{" data-end="}">
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a70a1187cdc0344aa3472ff714a0d4364">  710</a></span><a class="code hl_class" href="classv8_1_1ArrayBuffer_1_1Allocator.html">v8::ArrayBuffer::Allocator</a>* <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a70a1187cdc0344aa3472ff714a0d4364">BackingStore::get_v8_api_array_buffer_allocator</a>() {</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(!<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a>);</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>  <span class="keyword">auto</span> array_buffer_allocator =</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a8e516176c6f5ee34f8b1b819a8b49150">holds_shared_ptr_to_allocator_</a></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>          ? <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a605935636f567c55035fd08e9a3a0e71">v8_api_array_buffer_allocator_shared</a>.get()</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>          : <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#adc88bc06374b235a42ac1f1bbcb81622">v8_api_array_buffer_allocator</a>;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a9154b181227e4b02e465befe50219158">CHECK_NOT_NULL</a>(array_buffer_allocator);</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>  <span class="keywordflow">return</span> array_buffer_allocator;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>}</div>
</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="foldopen" id="foldopen00720" data-start="{" data-end="}">
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1BackingStore.html#a88544c8b06fedbb7c3cd0dc4d0904634">  720</a></span><a class="code hl_struct" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">SharedWasmMemoryData</a>* <a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a88544c8b06fedbb7c3cd0dc4d0904634">BackingStore::get_shared_wasm_memory_data</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">is_wasm_memory_</a> &amp;&amp; <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#a0337cb660f09b5bcc2d144679c0178f8">is_shared_</a>);</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>  <span class="keyword">auto</span> shared_wasm_memory_data = <a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">type_specific_data_</a>.<a class="code hl_variable" href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#ac24f8e676b135f4d2ade39723eb07a4e">shared_wasm_memory_data</a>;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(shared_wasm_memory_data);</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>  <span class="keywordflow">return</span> shared_wasm_memory_data;</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>}</div>
</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="comment">// Implementation details of GlobalBackingStoreRegistry.</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span><span class="keyword">struct </span>GlobalBackingStoreRegistryImpl {</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  GlobalBackingStoreRegistryImpl() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno"><a class="line" href="backing-store_8cc.html#aa014421904d6bb32c4478d3224ce3767">  731</a></span>  base::SpinningMutex <a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno"><a class="line" href="backing-store_8cc.html#a854ca92d8610d7bc525e7d20fa0736b1">  732</a></span>  std::unordered_map&lt;const void*, std::weak_ptr&lt;BackingStore&gt;&gt; <a class="code hl_variable" href="compilation-dependencies_8cc.html#a2bde9a41de3f273ded28b9e63dcc05ca">map_</a>;</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>};</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span><a class="code hl_define" href="lazy-instance_8h.html#a219abfaf8244b8fa42f0c18aca72c58f">DEFINE_LAZY_LEAKY_OBJECT_GETTER</a>(GlobalBackingStoreRegistryImpl,</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                                GetGlobalBackingStoreRegistryImpl)</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="foldopen" id="foldopen00739" data-start="{" data-end="}">
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a4808c1337ee5b6d6eb9353f638961208">  739</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a4808c1337ee5b6d6eb9353f638961208">GlobalBackingStoreRegistry::Register</a>(</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>    std::shared_ptr&lt;BackingStore&gt; backing_store) {</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>  <span class="keywordflow">if</span> (!backing_store || !backing_store-&gt;buffer_start()) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>  <span class="comment">// Only wasm memory backing stores need to be registered globally.</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(backing_store-&gt;is_wasm_memory());</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>  GlobalBackingStoreRegistryImpl* impl = GetGlobalBackingStoreRegistryImpl();</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>  <a class="code hl_class" href="classv8_1_1base_1_1LockGuard.html">base::SpinningMutexGuard</a> scope_lock(&amp;impl-&gt;mutex_);</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>  <span class="keywordflow">if</span> (backing_store-&gt;globally_registered_) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>  <a class="code hl_define" href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a>(<span class="stringliteral">&quot;BS:reg    bs=%p mem=%p (length=%zu, capacity=%zu)\n&quot;</span>,</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>           backing_store.get(), backing_store-&gt;buffer_start(),</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>           backing_store-&gt;byte_length(), backing_store-&gt;byte_capacity());</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>  std::weak_ptr&lt;BackingStore&gt; weak = backing_store;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>  <span class="keyword">auto</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = impl-&gt;map_.insert({backing_store-&gt;buffer_start(), weak});</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.second);</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>  backing_store-&gt;globally_registered_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>}</div>
</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="foldopen" id="foldopen00757" data-start="{" data-end="}">
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#abf55b73f22c44d0a3bdbca7f39abedf9">  757</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#abf55b73f22c44d0a3bdbca7f39abedf9">GlobalBackingStoreRegistry::Unregister</a>(<a class="code hl_class" href="classv8_1_1internal_1_1BackingStore.html">BackingStore</a>* backing_store) {</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>  <span class="keywordflow">if</span> (!backing_store-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#ac5598433c8588eb08520ce79c4d676f2">globally_registered_</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span> </div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(backing_store-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a6549ac91d2a87c9ec3e5d569d1f27cd9">is_wasm_memory</a>());</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(backing_store-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>());</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span> </div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>  GlobalBackingStoreRegistryImpl* impl = GetGlobalBackingStoreRegistryImpl();</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>  <a class="code hl_class" href="classv8_1_1base_1_1LockGuard.html">base::SpinningMutexGuard</a> scope_lock(&amp;impl-&gt;mutex_);</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = impl-&gt;map_.find(backing_store-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">buffer_start</a>());</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> != impl-&gt;map_.end()) {</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>-&gt;second.lock());</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    impl-&gt;map_.erase(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>  }</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>  backing_store-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1BackingStore.html#ac5598433c8588eb08520ce79c4d676f2">globally_registered_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>}</div>
</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="foldopen" id="foldopen00774" data-start="{" data-end="}">
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a3215d7f1cef79cff5fd4f3322ce085d9">  774</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a3215d7f1cef79cff5fd4f3322ce085d9">GlobalBackingStoreRegistry::Purge</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate) {</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>  <span class="comment">// We need to keep a reference to all backing stores that are inspected</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>  <span class="comment">// in the purging loop below. Otherwise, we might get a deadlock</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>  <span class="comment">// if the temporary backing store reference created in the loop is</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>  <span class="comment">// the last reference. In that case the destructor of the backing store</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>  <span class="comment">// may try to take the &amp;impl-&gt;mutex_ in order to unregister itself.</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>  std::vector&lt;std::shared_ptr&lt;BackingStore&gt;&gt; prevent_destruction_under_lock;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>  GlobalBackingStoreRegistryImpl* impl = GetGlobalBackingStoreRegistryImpl();</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>  <a class="code hl_class" href="classv8_1_1base_1_1LockGuard.html">base::SpinningMutexGuard</a> scope_lock(&amp;impl-&gt;mutex_);</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>  <span class="comment">// Purge all entries in the map that refer to the given isolate.</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; entry : impl-&gt;map_) {</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>    <span class="keyword">auto</span> backing_store = entry.second.lock();</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    prevent_destruction_under_lock.emplace_back(backing_store);</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    <span class="keywordflow">if</span> (!backing_store) <span class="keywordflow">continue</span>;  <span class="comment">// skip entries where weak ptr is null</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(backing_store-&gt;is_wasm_memory());</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keywordflow">if</span> (!backing_store-&gt;is_shared()) <span class="keywordflow">continue</span>;       <span class="comment">// skip non-shared memory</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">SharedWasmMemoryData</a>* shared_data =</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        backing_store-&gt;get_shared_wasm_memory_data();</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="comment">// Remove this isolate from the isolates list.</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    std::vector&lt;Isolate*&gt;&amp; isolates = shared_data-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1SharedWasmMemoryData.html#ab49ae4d731aa01e82f5ae2bbbec48038">isolates_</a>;</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>    <span class="keyword">auto</span> isolates_it = std::find(isolates.begin(), isolates.end(), isolate);</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    <span class="keywordflow">if</span> (isolates_it != isolates.end()) {</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>      *isolates_it = isolates.back();</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>      isolates.pop_back();</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    }</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(isolates.end(),</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>              std::find(isolates.begin(), isolates.end(), isolate));</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>  }</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>}</div>
</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span><span class="preprocessor">#if V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a74b7e940331c6b2f36b98a0b7cd92ea8">GlobalBackingStoreRegistry::AddSharedWasmMemoryObject</a>(</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <a class="code hl_class" href="classv8_1_1internal_1_1BackingStore.html">BackingStore</a>* backing_store,</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    <a class="code hl_class" href="classv8_1_1internal_1_1DirectHandle.html">DirectHandle&lt;WasmMemoryObject&gt;</a> memory_object) {</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>  <span class="comment">// Add to the weak array list of shared memory objects in the isolate.</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>  isolate-&gt;AddSharedWasmMemory(memory_object);</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span> </div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>  <span class="comment">// Add the isolate to the list of isolates sharing this backing store.</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>  GlobalBackingStoreRegistryImpl* impl = GetGlobalBackingStoreRegistryImpl();</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>  <a class="code hl_class" href="classv8_1_1base_1_1LockGuard.html">base::SpinningMutexGuard</a> scope_lock(&amp;impl-&gt;mutex_);</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>  <a class="code hl_struct" href="structv8_1_1internal_1_1SharedWasmMemoryData.html">SharedWasmMemoryData</a>* shared_data =</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>      backing_store-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1BackingStore.html#a88544c8b06fedbb7c3cd0dc4d0904634">get_shared_wasm_memory_data</a>();</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>  <span class="keyword">auto</span>&amp; isolates = shared_data-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1SharedWasmMemoryData.html#ab49ae4d731aa01e82f5ae2bbbec48038">isolates_</a>;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>  <span class="keywordtype">int</span> free_entry = -1;</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; isolates.<a class="code hl_class" href="classsize.html">size</a>(); <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    <span class="keywordflow">if</span> (isolates[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>] == isolate) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    <span class="keywordflow">if</span> (isolates[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>] == <span class="keyword">nullptr</span>) free_entry = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>);</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>  }</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>  <span class="keywordflow">if</span> (free_entry &gt;= 0)</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    isolates[free_entry] = <a class="code hl_variable" href="graph-builder_8cc.html#a9990dda08de44f6aee0aaf44c50da7d9">isolate</a>;</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>  <span class="keywordflow">else</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    isolates.push_back(isolate);</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>}</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#ad6a1f4fe7b1bdd589e65614f2b0c9069">GlobalBackingStoreRegistry::BroadcastSharedWasmMemoryGrow</a>(</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>    Isolate* isolate, <span class="keyword">const</span> BackingStore* backing_store) {</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>  {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    GlobalBackingStoreRegistryImpl* impl = GetGlobalBackingStoreRegistryImpl();</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>    <span class="comment">// The global lock protects the list of isolates per backing store.</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> scope_lock(&amp;impl-&gt;mutex_);</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>    SharedWasmMemoryData* shared_data =</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>        backing_store-&gt;get_shared_wasm_memory_data();</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>    <span class="keywordflow">for</span> (Isolate* other : shared_data-&gt;isolates_) {</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>      <span class="keywordflow">if</span> (other == isolate) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>      other-&gt;stack_guard()-&gt;RequestGrowSharedMemory();</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    }</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>  }</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>  <span class="comment">// Update memory objects in this isolate.</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>  <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#af68be2d45b01f8cf2848c5ff3e1e7a0f">UpdateSharedWasmMemoryObjects</a>(isolate);</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>}</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#af68be2d45b01f8cf2848c5ff3e1e7a0f">GlobalBackingStoreRegistry::UpdateSharedWasmMemoryObjects</a>(</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>    Isolate* isolate) {</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>  HandleScope scope(isolate);</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>  DirectHandle&lt;WeakArrayList&gt; shared_wasm_memories =</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>      isolate-&gt;factory()-&gt;shared_wasm_memories();</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span> </div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0, e = shared_wasm_memories-&gt;<a class="code hl_class" href="classlength.html">length</a>(); <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; e; ++<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>) {</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    <a class="code hl_variable" href="namespacev8_1_1internal.html#a57f5ecf71b9a2757b0555b2be4c640b8">Tagged&lt;HeapObject&gt;</a> obj;</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>    <span class="keywordflow">if</span> (!shared_wasm_memories-&gt;Get(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>).GetHeapObject(&amp;obj)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>    DirectHandle&lt;WasmMemoryObject&gt; memory_object(<a class="code hl_function" href="namespacev8_1_1internal.html#aff82af2c2f7b200915e30bcfedca6f85">Cast&lt;WasmMemoryObject&gt;</a>(obj),</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>                                                 isolate);</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    DirectHandle&lt;JSArrayBuffer&gt; old_buffer(memory_object-&gt;array_buffer(),</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>                                           isolate);</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>    std::shared_ptr&lt;BackingStore&gt; backing_store = old_buffer-&gt;GetBackingStore();</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <span class="comment">// Wasm memory always has a BackingStore.</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a9154b181227e4b02e465befe50219158">CHECK_NOT_NULL</a>(backing_store);</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(backing_store-&gt;is_wasm_memory());</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(backing_store-&gt;is_shared());</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span> </div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <span class="comment">// Keep a raw pointer to the backing store for a CHECK later one. Make it</span></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    <span class="comment">// {void*} so we do not accidentally try to use it for anything else.</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>    <span class="keywordtype">void</span>* expected_backing_store = backing_store.get();</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span> </div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    DirectHandle&lt;JSArrayBuffer&gt; new_buffer =</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        isolate-&gt;factory()-&gt;NewJSSharedArrayBuffer(std::move(backing_store));</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#aca32614b4d2aea7dd9abdeb222bf02f3">CHECK_EQ</a>(expected_backing_store, new_buffer-&gt;GetBackingStore().get());</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>    memory_object-&gt;SetNewBuffer(*new_buffer);</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>  }</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>}</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span><span class="preprocessor">#endif  </span><span class="comment">// V8_ENABLE_WEBASSEMBLY</span></div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span> </div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>}  <span class="comment">// namespace v8::internal</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span> </div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="preprocessor">#undef TRACE_BS</span></div>
<div class="ttc" id="abacking-store_8cc_html_ac29cdbbff328cee7720dae0970227ac5"><div class="ttname"><a href="backing-store_8cc.html#ac29cdbbff328cee7720dae0970227ac5">TRACE_BS</a></div><div class="ttdeci">#define TRACE_BS(...)</div><div class="ttdef"><b>Definition</b> <a href="#l00025">backing-store.cc:25</a></div></div>
<div class="ttc" id="abacking-store_8h_html"><div class="ttname"><a href="backing-store_8h.html">backing-store.h</a></div></div>
<div class="ttc" id="abits_8h_html"><div class="ttname"><a href="bits_8h.html">bits.h</a></div></div>
<div class="ttc" id="aclasslength_html"><div class="ttname"><a href="classlength.html">length</a></div></div>
<div class="ttc" id="aclasssize_html"><div class="ttname"><a href="classsize.html">size</a></div></div>
<div class="ttc" id="aclassv8_1_1ArrayBuffer_1_1Allocator_html"><div class="ttname"><a href="classv8_1_1ArrayBuffer_1_1Allocator.html">v8::ArrayBuffer::Allocator</a></div><div class="ttdef"><b>Definition</b> <a href="v8-array-buffer_8h_source.html#l00153">v8-array-buffer.h:153</a></div></div>
<div class="ttc" id="aclassv8_1_1BackingStore_html_a3e91bbf335d64c4cd15279bc3b4fe5fb"><div class="ttname"><a href="classv8_1_1BackingStore.html#a3e91bbf335d64c4cd15279bc3b4fe5fb">v8::BackingStore::DeleterCallback</a></div><div class="ttdeci">void(*)(void *data, size_t length, void *deleter_data) DeleterCallback</div><div class="ttdef"><b>Definition</b> <a href="v8-array-buffer_8h_source.html#l00104">v8-array-buffer.h:104</a></div></div>
<div class="ttc" id="aclassv8_1_1BackingStore_html_a8e13babbe51f481542889b3a6c3fc968"><div class="ttname"><a href="classv8_1_1BackingStore.html#a8e13babbe51f481542889b3a6c3fc968">v8::BackingStore::BackingStore</a></div><div class="ttdeci">BackingStore()</div></div>
<div class="ttc" id="aclassv8_1_1BackingStore_html_ae19ce3cfb723f9559f02b54e8a5ab6a0"><div class="ttname"><a href="classv8_1_1BackingStore.html#ae19ce3cfb723f9559f02b54e8a5ab6a0">v8::BackingStore::EmptyDeleter</a></div><div class="ttdeci">static void EmptyDeleter(void *data, size_t length, void *deleter_data)</div><div class="ttdef"><b>Definition</b> <a href="api_8cc_source.html#l04249">api.cc:4249</a></div></div>
<div class="ttc" id="aclassv8_1_1PageAllocator_html"><div class="ttname"><a href="classv8_1_1PageAllocator.html">v8::PageAllocator</a></div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00455">v8-platform.h:455</a></div></div>
<div class="ttc" id="aclassv8_1_1PageAllocator_html_a88f74b164fe97e053259f67a95758415a501acdacad072f7d6e5737159141301d"><div class="ttname"><a href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415a501acdacad072f7d6e5737159141301d">v8::PageAllocator::kNoAccess</a></div><div class="ttdeci">@ kNoAccess</div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00487">v8-platform.h:487</a></div></div>
<div class="ttc" id="aclassv8_1_1PageAllocator_html_a88f74b164fe97e053259f67a95758415abf9beddb1231fa2c23ab417197ea9f8a"><div class="ttname"><a href="classv8_1_1PageAllocator.html#a88f74b164fe97e053259f67a95758415abf9beddb1231fa2c23ab417197ea9f8a">v8::PageAllocator::kReadWrite</a></div><div class="ttdeci">@ kReadWrite</div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00489">v8-platform.h:489</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1LockGuard_html"><div class="ttname"><a href="classv8_1_1base_1_1LockGuard.html">v8::base::LockGuard</a></div><div class="ttdef"><b>Definition</b> <a href="mutex_8h_source.html#l00534">mutex.h:534</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html">v8::internal::BackingStore</a></div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00044">backing-store.h:44</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a01034df6de5b1cd00a95fd7eccc09a87"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a01034df6de5b1cd00a95fd7eccc09a87">v8::internal::BackingStore::buffer_start</a></div><div class="ttdeci">void * buffer_start() const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00086">backing-store.h:86</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a0150f25ceb72d61ed3b2c6ca47a1ed99"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a0150f25ceb72d61ed3b2c6ca47a1ed99">v8::internal::BackingStore::Reallocate</a></div><div class="ttdeci">bool Reallocate(Isolate *isolate, size_t new_byte_length)</div><div class="ttdef"><b>Definition</b> <a href="#l00693">backing-store.cc:693</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a0337cb660f09b5bcc2d144679c0178f8"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a0337cb660f09b5bcc2d144679c0178f8">v8::internal::BackingStore::is_shared_</a></div><div class="ttdeci">const bool is_shared_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00223">backing-store.h:223</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a114a717a1c979e511051ba890321585f"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a114a717a1c979e511051ba890321585f">v8::internal::BackingStore::GrowInPlace</a></div><div class="ttdeci">ResizeOrGrowResult GrowInPlace(Isolate *isolate, size_t new_byte_length)</div><div class="ttdef"><b>Definition</b> <a href="#l00605">backing-store.cc:605</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a2067951c5d4377b698d7799bc63af02a"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a2067951c5d4377b698d7799bc63af02a">v8::internal::BackingStore::WrapAllocation</a></div><div class="ttdeci">static std::unique_ptr&lt; BackingStore &gt; WrapAllocation(void *allocation_base, size_t allocation_length, v8::BackingStore::DeleterCallback deleter, void *deleter_data, SharedFlag shared)</div><div class="ttdef"><b>Definition</b> <a href="#l00654">backing-store.cc:654</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a245da518bf4670c536abae69e40c638b"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a245da518bf4670c536abae69e40c638b">v8::internal::BackingStore::custom_deleter_</a></div><div class="ttdeci">const bool custom_deleter_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00231">backing-store.h:231</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a326b5343db3393753cef809bc3656add"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a326b5343db3393753cef809bc3656add">v8::internal::BackingStore::max_byte_length_</a></div><div class="ttdeci">size_t max_byte_length_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00188">backing-store.h:188</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a38fea92df41ebe4ecc690393f09628a8"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a38fea92df41ebe4ecc690393f09628a8">v8::internal::BackingStore::byte_capacity_</a></div><div class="ttdeci">size_t byte_capacity_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00190">backing-store.h:190</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a402d443b520a53485151c9d2285ce62d"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a402d443b520a53485151c9d2285ce62d">v8::internal::BackingStore::is_shared</a></div><div class="ttdeci">bool is_shared() const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00095">backing-store.h:95</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a452e0fa56230d27400718e003b3d5638"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a452e0fa56230d27400718e003b3d5638">v8::internal::BackingStore::Allocate</a></div><div class="ttdeci">static std::unique_ptr&lt; BackingStore &gt; Allocate(Isolate *isolate, size_t byte_length, SharedFlag shared, InitializedFlag initialized)</div><div class="ttdef"><b>Definition</b> <a href="#l00196">backing-store.cc:196</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a64bbbcd6c2a9fba5824432ac58428b95"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a64bbbcd6c2a9fba5824432ac58428b95">v8::internal::BackingStore::max_byte_length</a></div><div class="ttdeci">size_t max_byte_length() const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00093">backing-store.h:93</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a6549ac91d2a87c9ec3e5d569d1f27cd9"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a6549ac91d2a87c9ec3e5d569d1f27cd9">v8::internal::BackingStore::is_wasm_memory</a></div><div class="ttdeci">bool is_wasm_memory() const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00097">backing-store.h:97</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a656398a063c731969b4d6036914ee16a"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a656398a063c731969b4d6036914ee16a">v8::internal::BackingStore::is_resizable_by_js_</a></div><div class="ttdeci">const bool is_resizable_by_js_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00225">backing-store.h:225</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a6e20cd7042a45d5a989c784030fed72c"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a6e20cd7042a45d5a989c784030fed72c">v8::internal::BackingStore::EmptyBackingStore</a></div><div class="ttdeci">static std::unique_ptr&lt; BackingStore &gt; EmptyBackingStore(SharedFlag shared)</div><div class="ttdef"><b>Definition</b> <a href="#l00676">backing-store.cc:676</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a70a1187cdc0344aa3472ff714a0d4364"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a70a1187cdc0344aa3472ff714a0d4364">v8::internal::BackingStore::get_v8_api_array_buffer_allocator</a></div><div class="ttdeci">v8::ArrayBuffer::Allocator * get_v8_api_array_buffer_allocator()</div><div class="ttdef"><b>Definition</b> <a href="#l00710">backing-store.cc:710</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a7739254c12bdc22180aadbd4145f2846"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a7739254c12bdc22180aadbd4145f2846">v8::internal::BackingStore::SetAllocatorFromIsolate</a></div><div class="ttdeci">void SetAllocatorFromIsolate(Isolate *isolate)</div><div class="ttdef"><b>Definition</b> <a href="#l00254">backing-store.cc:254</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a77999b4f8865ee7173d4dad4f2566304"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a77999b4f8865ee7173d4dad4f2566304">v8::internal::BackingStore::is_wasm_memory64_</a></div><div class="ttdeci">const bool is_wasm_memory64_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00227">backing-store.h:227</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a78a522363c3d04a38e1420392ff73151"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a78a522363c3d04a38e1420392ff73151">v8::internal::BackingStore::buffer_start_</a></div><div class="ttdeci">void * buffer_start_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00185">backing-store.h:185</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a810fccd58059bbb33821cf4158001269"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a810fccd58059bbb33821cf4158001269">v8::internal::BackingStore::byte_length_</a></div><div class="ttdeci">std::atomic&lt; size_t &gt; byte_length_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00186">backing-store.h:186</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a84e380810d47e8192b6a76c541d198b0"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a84e380810d47e8192b6a76c541d198b0">v8::internal::BackingStore::CanReallocate</a></div><div class="ttdeci">bool CanReallocate() const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00110">backing-store.h:110</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a88544c8b06fedbb7c3cd0dc4d0904634"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a88544c8b06fedbb7c3cd0dc4d0904634">v8::internal::BackingStore::get_shared_wasm_memory_data</a></div><div class="ttdeci">SharedWasmMemoryData * get_shared_wasm_memory_data() const</div><div class="ttdef"><b>Definition</b> <a href="#l00720">backing-store.cc:720</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_a8e516176c6f5ee34f8b1b819a8b49150"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#a8e516176c6f5ee34f8b1b819a8b49150">v8::internal::BackingStore::holds_shared_ptr_to_allocator_</a></div><div class="ttdeci">bool holds_shared_ptr_to_allocator_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00228">backing-store.h:228</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_aa814260885b6e31f53df9394bbc9bae9"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#aa814260885b6e31f53df9394bbc9bae9">v8::internal::BackingStore::is_wasm_memory_</a></div><div class="ttdeci">const bool is_wasm_memory_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00226">backing-store.h:226</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_aab34dd77381c9e228375bfae8fae28d7"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7">v8::internal::BackingStore::ResizeOrGrowResult</a></div><div class="ttdeci">ResizeOrGrowResult</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00105">backing-store.h:105</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_aab34dd77381c9e228375bfae8fae28d7a1e2d07bb7bd779234bcf3eb8e81143d1"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7a1e2d07bb7bd779234bcf3eb8e81143d1">v8::internal::BackingStore::kRace</a></div><div class="ttdeci">@ kRace</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00105">backing-store.h:105</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_aab34dd77381c9e228375bfae8fae28d7a2facbfb720d8f652c576c26ddd253982"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7a2facbfb720d8f652c576c26ddd253982">v8::internal::BackingStore::kFailure</a></div><div class="ttdeci">@ kFailure</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00105">backing-store.h:105</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#aab34dd77381c9e228375bfae8fae28d7aa25ddfe5f11c17157e161edd9afd933f">v8::internal::BackingStore::kSuccess</a></div><div class="ttdeci">@ kSuccess</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00105">backing-store.h:105</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ab5f060a468e2d0b8ad17bcad0a9f3d26"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ab5f060a468e2d0b8ad17bcad0a9f3d26">v8::internal::BackingStore::byte_length</a></div><div class="ttdeci">size_t byte_length(std::memory_order memory_order=std::memory_order_relaxed) const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00089">backing-store.h:89</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ab76e4ee584f63c9a2be17a036fa29102"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ab76e4ee584f63c9a2be17a036fa29102">v8::internal::BackingStore::byte_capacity</a></div><div class="ttdeci">size_t byte_capacity() const</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00094">backing-store.h:94</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ac5598433c8588eb08520ce79c4d676f2"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ac5598433c8588eb08520ce79c4d676f2">v8::internal::BackingStore::globally_registered_</a></div><div class="ttdeci">bool globally_registered_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00230">backing-store.h:230</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ac8fb972e6675e4ecbe2d0c6be58bc3ed"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ac8fb972e6675e4ecbe2d0c6be58bc3ed">v8::internal::BackingStore::TryAllocateAndPartiallyCommitMemory</a></div><div class="ttdeci">static std::unique_ptr&lt; BackingStore &gt; TryAllocateAndPartiallyCommitMemory(Isolate *isolate, size_t byte_length, size_t max_byte_length, size_t page_size, size_t initial_pages, size_t maximum_pages, WasmMemoryFlag wasm_memory, SharedFlag shared)</div><div class="ttdef"><b>Definition</b> <a href="#l00266">backing-store.cc:266</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_acd3c96ccd4af9d865c4ce060d82282b2"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#acd3c96ccd4af9d865c4ce060d82282b2">v8::internal::BackingStore::type_specific_data_</a></div><div class="ttdeci">union v8::internal::BackingStore::TypeSpecificData type_specific_data_</div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ad1bb1b7221bf47066c3d8ca2ba27b901"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ad1bb1b7221bf47066c3d8ca2ba27b901">v8::internal::BackingStore::BackingStore</a></div><div class="ttdeci">BackingStore(void *buffer_start, size_t byte_length, size_t max_byte_length, size_t byte_capacity, SharedFlag shared, ResizableFlag resizable, bool is_wasm_memory, bool is_wasm_memory64, bool has_guard_regions, bool custom_deleter, bool empty_deleter)</div><div class="ttdef"><b>Definition</b> <a href="#l00092">backing-store.cc:92</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ae14402f37d1a3e964898188f8d5ea345"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ae14402f37d1a3e964898188f8d5ea345">v8::internal::BackingStore::~BackingStore</a></div><div class="ttdeci">~BackingStore()</div><div class="ttdef"><b>Definition</b> <a href="#l00127">backing-store.cc:127</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ae42eba483b66dcbcf4c425c502225285"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ae42eba483b66dcbcf4c425c502225285">v8::internal::BackingStore::has_guard_regions_</a></div><div class="ttdeci">const bool has_guard_regions_</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00229">backing-store.h:229</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1BackingStore_html_ae5929dedd03eb03ff23ae46e2ef0d318"><div class="ttname"><a href="classv8_1_1internal_1_1BackingStore.html#ae5929dedd03eb03ff23ae46e2ef0d318">v8::internal::BackingStore::ResizeInPlace</a></div><div class="ttdeci">ResizeOrGrowResult ResizeInPlace(Isolate *isolate, size_t new_byte_length)</div><div class="ttdef"><b>Definition</b> <a href="#l00540">backing-store.cc:540</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1DirectHandle_html"><div class="ttname"><a href="classv8_1_1internal_1_1DirectHandle.html">v8::internal::DirectHandle</a></div><div class="ttdef"><b>Definition</b> <a href="handles_8h_source.html#l00643">handles.h:652</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalBackingStoreRegistry_html_a3215d7f1cef79cff5fd4f3322ce085d9"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a3215d7f1cef79cff5fd4f3322ce085d9">v8::internal::GlobalBackingStoreRegistry::Purge</a></div><div class="ttdeci">static void Purge(Isolate *isolate)</div><div class="ttdef"><b>Definition</b> <a href="#l00774">backing-store.cc:774</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalBackingStoreRegistry_html_a4808c1337ee5b6d6eb9353f638961208"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a4808c1337ee5b6d6eb9353f638961208">v8::internal::GlobalBackingStoreRegistry::Register</a></div><div class="ttdeci">static void Register(std::shared_ptr&lt; BackingStore &gt; backing_store)</div><div class="ttdef"><b>Definition</b> <a href="#l00739">backing-store.cc:739</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalBackingStoreRegistry_html_a74b7e940331c6b2f36b98a0b7cd92ea8"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#a74b7e940331c6b2f36b98a0b7cd92ea8">v8::internal::GlobalBackingStoreRegistry::AddSharedWasmMemoryObject</a></div><div class="ttdeci">static void AddSharedWasmMemoryObject(Isolate *isolate, BackingStore *backing_store, DirectHandle&lt; WasmMemoryObject &gt; memory_object)</div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalBackingStoreRegistry_html_abf55b73f22c44d0a3bdbca7f39abedf9"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#abf55b73f22c44d0a3bdbca7f39abedf9">v8::internal::GlobalBackingStoreRegistry::Unregister</a></div><div class="ttdeci">static void Unregister(BackingStore *backing_store)</div><div class="ttdef"><b>Definition</b> <a href="#l00757">backing-store.cc:757</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalBackingStoreRegistry_html_ad6a1f4fe7b1bdd589e65614f2b0c9069"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#ad6a1f4fe7b1bdd589e65614f2b0c9069">v8::internal::GlobalBackingStoreRegistry::BroadcastSharedWasmMemoryGrow</a></div><div class="ttdeci">static void BroadcastSharedWasmMemoryGrow(Isolate *isolate, const BackingStore *backing_store)</div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalBackingStoreRegistry_html_af68be2d45b01f8cf2848c5ff3e1e7a0f"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalBackingStoreRegistry.html#af68be2d45b01f8cf2848c5ff3e1e7a0f">v8::internal::GlobalBackingStoreRegistry::UpdateSharedWasmMemoryObjects</a></div><div class="ttdeci">static void UpdateSharedWasmMemoryObjects(Isolate *isolate)</div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html">v8::internal::Isolate</a></div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l00575">isolate.h:575</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1JSArrayBuffer_html_aaa9641b33f3b26b38930cbb552f8770c"><div class="ttname"><a href="classv8_1_1internal_1_1JSArrayBuffer.html#aaa9641b33f3b26b38930cbb552f8770c">v8::internal::JSArrayBuffer::kMaxByteLength</a></div><div class="ttdeci">static constexpr size_t kMaxByteLength</div><div class="ttdef"><b>Definition</b> <a href="js-array-buffer_8h_source.html#l00038">js-array-buffer.h:38</a></div></div>
<div class="ttc" id="acode-memory-access_8cc_html_a4cce83e2a3313f207c5d77da0b1e0198"><div class="ttname"><a href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a></div><div class="ttdeci">base::SpinningMutex &amp; mutex_</div><div class="ttdef"><b>Definition</b> <a href="code-memory-access_8cc_source.html#l00623">code-memory-access.cc:623</a></div></div>
<div class="ttc" id="acompilation-dependencies_8cc_html_a2bde9a41de3f273ded28b9e63dcc05ca"><div class="ttname"><a href="compilation-dependencies_8cc.html#a2bde9a41de3f273ded28b9e63dcc05ca">map_</a></div><div class="ttdeci">const MapRef map_</div><div class="ttdef"><b>Definition</b> <a href="compilation-dependencies_8cc_source.html#l00311">compilation-dependencies.cc:311</a></div></div>
<div class="ttc" id="acounters_8h_html"><div class="ttname"><a href="counters_8h.html">counters.h</a></div></div>
<div class="ttc" id="aexecution_2isolate_8h_html"><div class="ttname"><a href="execution_2isolate_8h.html">isolate.h</a></div></div>
<div class="ttc" id="aglobal-handles_8h_html"><div class="ttname"><a href="global-handles_8h.html">global-handles.h</a></div></div>
<div class="ttc" id="agraph-builder_8cc_html_a9990dda08de44f6aee0aaf44c50da7d9"><div class="ttname"><a href="graph-builder_8cc.html#a9990dda08de44f6aee0aaf44c50da7d9">isolate</a></div><div class="ttdeci">Isolate * isolate</div><div class="ttdef"><b>Definition</b> <a href="graph-builder_8cc_source.html#l00058">graph-builder.cc:58</a></div></div>
<div class="ttc" id="ajs-call-reducer_8cc_html_a9fa9548665fda8f7a8cfad92f3c8cedd"><div class="ttname"><a href="js-call-reducer_8cc.html#a9fa9548665fda8f7a8cfad92f3c8cedd">shared</a></div><div class="ttdeci">SharedFunctionInfoRef shared</div><div class="ttdef"><b>Definition</b> <a href="js-call-reducer_8cc_source.html#l01495">js-call-reducer.cc:1495</a></div></div>
<div class="ttc" id="ajump-threading_8cc_html_a41f8c58d2c01bf65b8ee199c3f87fc80"><div class="ttname"><a href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a></div><div class="ttdeci">ZoneVector&lt; RpoNumber &gt; &amp; result</div><div class="ttdef"><b>Definition</b> <a href="jump-threading_8cc_source.html#l00021">jump-threading.cc:21</a></div></div>
<div class="ttc" id="alazy-instance_8h_html_a219abfaf8244b8fa42f0c18aca72c58f"><div class="ttname"><a href="lazy-instance_8h.html#a219abfaf8244b8fa42f0c18aca72c58f">DEFINE_LAZY_LEAKY_OBJECT_GETTER</a></div><div class="ttdeci">#define DEFINE_LAZY_LEAKY_OBJECT_GETTER(T, FunctionName,...)</div><div class="ttdef"><b>Definition</b> <a href="lazy-instance_8h_source.html#l00249">lazy-instance.h:249</a></div></div>
<div class="ttc" id="aliftoff-compiler_8cc_html_ac96b98a543c504abf4ffd7eaa447e94a"><div class="ttname"><a href="liftoff-compiler_8cc.html#ac96b98a543c504abf4ffd7eaa447e94a">fn</a></div><div class="ttdeci">EmitFn fn</div><div class="ttdef"><b>Definition</b> <a href="liftoff-compiler_8cc_source.html#l02031">liftoff-compiler.cc:2031</a></div></div>
<div class="ttc" id="anamespacev8_1_1base_html_a3279492e34e391eefba807ff6a59576e"><div class="ttname"><a href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">v8::base::SpinningMutexGuard</a></div><div class="ttdeci">LockGuard&lt; SpinningMutex &gt; SpinningMutexGuard</div><div class="ttdef"><b>Definition</b> <a href="mutex_8h_source.html#l00562">mutex.h:562</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1trap__handler_html_a47f4fc1ba5bf67b48a471d0527c99291"><div class="ttname"><a href="namespacev8_1_1internal_1_1trap__handler.html#a47f4fc1ba5bf67b48a471d0527c99291">v8::internal::trap_handler::IsTrapHandlerEnabled</a></div><div class="ttdeci">bool IsTrapHandlerEnabled()</div><div class="ttdef"><b>Definition</b> <a href="trap-handler_8h_source.html#l00143">trap-handler.h:143</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a58280911560a19ed11d754bee507198e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a58280911560a19ed11d754bee507198e">v8::internal::wasm::kV8MaxWasmMemory64Pages</a></div><div class="ttdeci">constexpr size_t kV8MaxWasmMemory64Pages</div><div class="ttdef"><b>Definition</b> <a href="wasm-limits_8h_source.html#l00046">wasm-limits.h:46</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ac29e28cd9a3b18c7e07a3406d5d6ff1a"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ac29e28cd9a3b18c7e07a3406d5d6ff1a">v8::internal::wasm::kWasmPageSize</a></div><div class="ttdeci">constexpr size_t kWasmPageSize</div><div class="ttdef"><b>Definition</b> <a href="wasm-constants_8h_source.html#l00162">wasm-constants.h:162</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_af9eea7ef6c36992fe92707061703fb43"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#af9eea7ef6c36992fe92707061703fb43">v8::internal::wasm::kV8MaxWasmMemory32Pages</a></div><div class="ttdeci">constexpr size_t kV8MaxWasmMemory32Pages</div><div class="ttdef"><b>Definition</b> <a href="wasm-limits_8h_source.html#l00043">wasm-limits.h:43</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html"><div class="ttname"><a href="namespacev8_1_1internal.html">v8::internal</a></div><div class="ttdef"><b>Definition</b> <a href="api-arguments-inl_8h_source.html#l00018">api-arguments-inl.h:18</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a0b20b06fc0f215d9b9eac890977a53e7"><div class="ttname"><a href="namespacev8_1_1internal.html#a0b20b06fc0f215d9b9eac890977a53e7">v8::internal::SetPermissions</a></div><div class="ttdeci">bool SetPermissions(v8::PageAllocator *page_allocator, void *address, size_t size, PageAllocator::Permission access)</div><div class="ttdef"><b>Definition</b> <a href="utils_2allocation_8cc_source.html#l00198">allocation.cc:198</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a1b38d6a01927e639b91b6a039899ac1a"><div class="ttname"><a href="namespacev8_1_1internal.html#a1b38d6a01927e639b91b6a039899ac1a">v8::internal::GetPlatformPageAllocator</a></div><div class="ttdeci">v8::PageAllocator * GetPlatformPageAllocator()</div><div class="ttdef"><b>Definition</b> <a href="utils_2allocation_8cc_source.html#l00066">allocation.cc:66</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a24ba7f85e96394b19164ecd7df3988c5"><div class="ttname"><a href="namespacev8_1_1internal.html#a24ba7f85e96394b19164ecd7df3988c5">v8::internal::GB</a></div><div class="ttdeci">constexpr int GB</div><div class="ttdef"><b>Definition</b> <a href="v8-internal_8h_source.html#l00057">v8-internal.h:57</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a35340b7fc4ef1a114d8ff1272f99be7a"><div class="ttname"><a href="namespacev8_1_1internal.html#a35340b7fc4ef1a114d8ff1272f99be7a">v8::internal::AllocatePages</a></div><div class="ttdeci">void * AllocatePages(v8::PageAllocator *page_allocator, void *hint, size_t size, size_t alignment, PageAllocator::Permission access)</div><div class="ttdef"><b>Definition</b> <a href="utils_2allocation_8cc_source.html#l00164">allocation.cc:164</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a4e2118a7c0d730210e0cb87b511cba70"><div class="ttname"><a href="namespacev8_1_1internal.html#a4e2118a7c0d730210e0cb87b511cba70">v8::internal::bool</a></div><div class="ttdeci">bool</div><div class="ttdef"><b>Definition</b> <a href="js-function-inl_8h_source.html#l00452">js-function-inl.h:452</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a57f5ecf71b9a2757b0555b2be4c640b8"><div class="ttname"><a href="namespacev8_1_1internal.html#a57f5ecf71b9a2757b0555b2be4c640b8">v8::internal::Tagged&lt; HeapObject &gt;</a></div><div class="ttdeci">kInterpreterTrampolineOffset Tagged&lt; HeapObject &gt;</div><div class="ttdef"><b>Definition</b> <a href="shared-function-info-inl_8h_source.html#l00116">shared-function-info-inl.h:116</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a5ccd81f4720c063fbbb03699603034c6"><div class="ttname"><a href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6">v8::internal::WasmMemoryFlag</a></div><div class="ttdeci">WasmMemoryFlag</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00022">backing-store.h:22</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a5ccd81f4720c063fbbb03699603034c6a047ebee131a760d19529704fdfc1d412"><div class="ttname"><a href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a047ebee131a760d19529704fdfc1d412">v8::internal::WasmMemoryFlag::kWasmMemory32</a></div><div class="ttdeci">@ kWasmMemory32</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a5ccd81f4720c063fbbb03699603034c6a076ed6b69b93a14d0f539af6c5bf4913"><div class="ttname"><a href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a076ed6b69b93a14d0f539af6c5bf4913">v8::internal::WasmMemoryFlag::kWasmMemory64</a></div><div class="ttdeci">@ kWasmMemory64</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a5ccd81f4720c063fbbb03699603034c6a55cd2e71581cb7d0f1e9dbf5113d3516"><div class="ttname"><a href="namespacev8_1_1internal.html#a5ccd81f4720c063fbbb03699603034c6a55cd2e71581cb7d0f1e9dbf5113d3516">v8::internal::WasmMemoryFlag::kNotWasm</a></div><div class="ttdeci">@ kNotWasm</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a680ace1d3e86dae2df93867132a3c160"><div class="ttname"><a href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160">v8::internal::SharedFlag</a></div><div class="ttdeci">SharedFlag</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00025">backing-store.h:25</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a680ace1d3e86dae2df93867132a3c160a767e1337acb2aa20d7ce4e903a75ca16"><div class="ttname"><a href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160a767e1337acb2aa20d7ce4e903a75ca16">v8::internal::SharedFlag::kShared</a></div><div class="ttdeci">@ kShared</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a680ace1d3e86dae2df93867132a3c160af80e42734f3024456dd90ae366cecf3e"><div class="ttname"><a href="namespacev8_1_1internal.html#a680ace1d3e86dae2df93867132a3c160af80e42734f3024456dd90ae366cecf3e">v8::internal::SharedFlag::kNotShared</a></div><div class="ttdeci">@ kNotShared</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a68cd7a6d75e39d01877e03931678b516"><div class="ttname"><a href="namespacev8_1_1internal.html#a68cd7a6d75e39d01877e03931678b516">v8::internal::GetArrayBufferPageAllocator</a></div><div class="ttdeci">v8::PageAllocator * GetArrayBufferPageAllocator()</div><div class="ttdef"><b>Definition</b> <a href="src_2utils_2allocation_8h_source.html#l00125">allocation.h:125</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a6a1f3d6b7cd6594565b3bd1b98293248"><div class="ttname"><a href="namespacev8_1_1internal.html#a6a1f3d6b7cd6594565b3bd1b98293248">v8::internal::RoundUpToPageSize</a></div><div class="ttdeci">bool RoundUpToPageSize(size_t byte_length, size_t page_size, size_t max_allowed_byte_length, size_t *pages)</div><div class="ttdef"><b>Definition</b> <a href="utils_2utils_8h_source.html#l00841">utils.h:841</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a6d3f691695696e478ebb4a18ab857bfa"><div class="ttname"><a href="namespacev8_1_1internal.html#a6d3f691695696e478ebb4a18ab857bfa">v8::internal::InitializedFlag</a></div><div class="ttdeci">InitializedFlag</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00031">backing-store.h:31</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a6d3f691695696e478ebb4a18ab857bfaa518b13885544b3431069d8b44387de9c"><div class="ttname"><a href="namespacev8_1_1internal.html#a6d3f691695696e478ebb4a18ab857bfaa518b13885544b3431069d8b44387de9c">v8::internal::InitializedFlag::kUninitialized</a></div><div class="ttdeci">@ kUninitialized</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a8225e2541286b06a2e14350fda180c30a8c632159fa131f09d04f94e3cbcd8782"><div class="ttname"><a href="namespacev8_1_1internal.html#a8225e2541286b06a2e14350fda180c30a8c632159fa131f09d04f94e3cbcd8782">v8::internal::ExceptionStatus::kSuccess</a></div><div class="ttdeci">@ kSuccess</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a92ab64d42404e439be3d6a7556e32380"><div class="ttname"><a href="namespacev8_1_1internal.html#a92ab64d42404e439be3d6a7556e32380">v8::internal::Address</a></div><div class="ttdeci">Address</div><div class="ttdef"><b>Definition</b> <a href="api-callbacks-inl_8h_source.html#l00034">api-callbacks-inl.h:34</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a9f5507dc03f0b35f38b119fc3285586a"><div class="ttname"><a href="namespacev8_1_1internal.html#a9f5507dc03f0b35f38b119fc3285586a">v8::internal::AllocatePageSize</a></div><div class="ttdeci">size_t AllocatePageSize()</div><div class="ttdef"><b>Definition</b> <a href="utils_2allocation_8cc_source.html#l00154">allocation.cc:154</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_aa9db791c05a0359859a321dcfec42e37"><div class="ttname"><a href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8::internal::v8_flags</a></div><div class="ttdeci">V8_EXPORT_PRIVATE FlagValues v8_flags</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_ab10416aabce855093f2c91151df24348"><div class="ttname"><a href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348">v8::internal::ResizableFlag</a></div><div class="ttdeci">ResizableFlag</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00028">backing-store.h:28</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_ab10416aabce855093f2c91151df24348a791e8c43bffb7c8241a98ff4a7f315f0"><div class="ttname"><a href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348a791e8c43bffb7c8241a98ff4a7f315f0">v8::internal::ResizableFlag::kResizable</a></div><div class="ttdeci">@ kResizable</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_ab10416aabce855093f2c91151df24348af444d0c6959a4f4e0553ccd4f9f35908"><div class="ttname"><a href="namespacev8_1_1internal.html#ab10416aabce855093f2c91151df24348af444d0c6959a4f4e0553ccd4f9f35908">v8::internal::ResizableFlag::kNotResizable</a></div><div class="ttdeci">@ kNotResizable</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_af33be30dc6995646ac5a541bdf0ede03"><div class="ttname"><a href="namespacev8_1_1internal.html#af33be30dc6995646ac5a541bdf0ede03">v8::internal::FreePages</a></div><div class="ttdeci">void FreePages(v8::PageAllocator *page_allocator, void *address, const size_t size)</div><div class="ttdef"><b>Definition</b> <a href="utils_2allocation_8cc_source.html#l00181">allocation.cc:181</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_af46551c5713d2a3a1be4dca973e521e0"><div class="ttname"><a href="namespacev8_1_1internal.html#af46551c5713d2a3a1be4dca973e521e0">v8::internal::MB</a></div><div class="ttdeci">too high values may cause the compiler to set high thresholds for inlining to as much as possible avoid inlined allocation of objects that cannot escape trace load stores from virtual maglev objects use TurboFan fast string builder analyze liveness of environment slots and zap dead values trace TurboFan load elimination emit data about basic block usage in builtins to this enable builtin reordering when run mksnapshot flag for emit warnings when applying builtin profile data verify register allocation in TurboFan randomly schedule instructions to stress dependency tracking enable store store elimination in TurboFan rewrite far to near simulate GC compiler thread race related to allow float parameters to be passed in simulator mode JS Wasm Run additional turbo_optimize_inlined_js_wasm_wrappers enable experimental feedback collection in generic lowering enable Turboshaft s WasmLoadElimination run instruction selection on Turboshaft IR directly enable Turboshaft s loop unrolling enable an additional Turboshaft phase that performs optimizations based on type information build the Turboshaft graph from Maglev trace emitted Turboshaft instructions profile guided optimization for empty feedback vector invocation count for maglev for functions which according to profile_guided_optimization are likely to deoptimize before reaching this invocation count Immediately re optimize code after some lazy deopts Enables the lazy new space shrinking strategy max size of a semi the new space consists of two semi spaces young and full garbage collection phases are not overlapping Collect garbage after keeps maps alive for&lt; n &gt; old space garbage collections print one detailed trace line in allocation gc speed Starts incremental marking with kUserVisible priority threshold for starting incremental marking immediately in percent of available minor GC task trigger in percent of the current heap limit use a separate phase for stack scanning in scavenge max worker number of concurrent for NumberOfWorkerThreads start background threads that allocate memory concurrent_array_buffer_sweeping use parallel threads to clear weak refs in the atomic pause trace progress of the incremental marking trace object counts and memory usage * MB</div><div class="ttdef"><b>Definition</b> <a href="flags_8cc_source.html#l02095">flags.cc:2095</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_aff82af2c2f7b200915e30bcfedca6f85"><div class="ttname"><a href="namespacev8_1_1internal.html#aff82af2c2f7b200915e30bcfedca6f85">v8::internal::Cast</a></div><div class="ttdeci">Tagged&lt; To &gt; Cast(Tagged&lt; From &gt; value, const v8::SourceLocation &amp;loc=INIT_SOURCE_LOCATION_IN_DEBUG)</div><div class="ttdef"><b>Definition</b> <a href="casting_8h_source.html#l00148">casting.h:148</a></div></div>
<div class="ttc" id="anamespacev8_html_ae0e9a25bf51e518585f555806e7dc7b9a5a20548c220f372fc701cae6de94040b"><div class="ttname"><a href="namespacev8.html#ae0e9a25bf51e518585f555806e7dc7b9a5a20548c220f372fc701cae6de94040b">v8::MemoryPressureLevel::kCritical</a></div><div class="ttdeci">@ kCritical</div></div>
<div class="ttc" id="aregexp-bytecode-peephole_8cc_html_ae6409a32d85daa404e52072329e0a5ad"><div class="ttname"><a href="regexp-bytecode-peephole_8cc.html#ae6409a32d85daa404e52072329e0a5ad">new_length</a></div><div class="ttdeci">int new_length</div><div class="ttdef"><b>Definition</b> <a href="regexp-bytecode-peephole_8cc_source.html#l00028">regexp-bytecode-peephole.cc:28</a></div></div>
<div class="ttc" id="asandbox_8h_html"><div class="ttname"><a href="sandbox_8h.html">sandbox.h</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a16b382527f19b805fc8f856668f2270b"><div class="ttname"><a href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a></div><div class="ttdeci">#define DCHECK_LE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00490">logging.h:490</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a2c0c4cea27d0690467662bb05131b2af"><div class="ttname"><a href="src_2base_2logging_8h.html#a2c0c4cea27d0690467662bb05131b2af">CHECK_IMPLIES</a></div><div class="ttdeci">#define CHECK_IMPLIES(lhs, rhs)</div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a3e1cfef60e774a81f30eaddf26a3a274"><div class="ttname"><a href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a></div><div class="ttdeci">#define CHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00124">logging.h:124</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a7b0fb5d6be902959a80a9a33cc4e73fe"><div class="ttname"><a href="src_2base_2logging_8h.html#a7b0fb5d6be902959a80a9a33cc4e73fe">CHECK_WITH_MSG</a></div><div class="ttdeci">#define CHECK_WITH_MSG(condition, message)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00118">logging.h:118</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a7b9f9517fedacc2a1a56c2bbb9d03688"><div class="ttname"><a href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a></div><div class="ttdeci">#define DCHECK_NOT_NULL(val)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00492">logging.h:492</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a9154b181227e4b02e465befe50219158"><div class="ttname"><a href="src_2base_2logging_8h.html#a9154b181227e4b02e465befe50219158">CHECK_NOT_NULL</a></div><div class="ttdeci">#define CHECK_NOT_NULL(val)</div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a96a75539aa82216cdde2250a11126ea0"><div class="ttname"><a href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a></div><div class="ttdeci">#define DCHECK_IMPLIES(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00493">logging.h:493</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_aabec5c3b7a8628298a25f044dcf89c25"><div class="ttname"><a href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a></div><div class="ttdeci">#define DCHECK_GE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00488">logging.h:488</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_aca32614b4d2aea7dd9abdeb222bf02f3"><div class="ttname"><a href="src_2base_2logging_8h.html#aca32614b4d2aea7dd9abdeb222bf02f3">CHECK_EQ</a></div><div class="ttdeci">#define CHECK_EQ(lhs, rhs)</div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_ae17f8119c108cf3070bad3449c7e0006"><div class="ttname"><a href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a></div><div class="ttdeci">#define DCHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00482">logging.h:482</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_af9c313d74155f7f201955a939e24c71f"><div class="ttname"><a href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a></div><div class="ttdeci">#define DCHECK_EQ(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00485">logging.h:485</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_1_1DeleterInfo_html_a2c9bfc1cb445a3fa8f272675154ea341"><div class="ttname"><a href="structv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_1_1DeleterInfo.html#a2c9bfc1cb445a3fa8f272675154ea341">v8::internal::BackingStore::TypeSpecificData::DeleterInfo::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00219">backing-store.h:219</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_1_1DeleterInfo_html_a6853a256bd2344dff0976a8c60c8ea28"><div class="ttname"><a href="structv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_1_1DeleterInfo.html#a6853a256bd2344dff0976a8c60c8ea28">v8::internal::BackingStore::TypeSpecificData::DeleterInfo::callback</a></div><div class="ttdeci">v8::BackingStore::DeleterCallback callback</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00218">backing-store.h:218</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1SharedWasmMemoryData_html"><div class="ttname"><a href="structv8_1_1internal_1_1SharedWasmMemoryData.html">v8::internal::SharedWasmMemoryData</a></div><div class="ttdef"><b>Definition</b> <a href="#l00088">backing-store.cc:88</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1SharedWasmMemoryData_html_ab49ae4d731aa01e82f5ae2bbbec48038"><div class="ttname"><a href="structv8_1_1internal_1_1SharedWasmMemoryData.html#ab49ae4d731aa01e82f5ae2bbbec48038">v8::internal::SharedWasmMemoryData::isolates_</a></div><div class="ttdeci">std::vector&lt; Isolate * &gt; isolates_</div><div class="ttdef"><b>Definition</b> <a href="#l00089">backing-store.cc:89</a></div></div>
<div class="ttc" id="atrap-handler_8h_html"><div class="ttname"><a href="trap-handler_8h.html">trap-handler.h</a></div></div>
<div class="ttc" id="aunionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_html_a35e64d445c5f7885b2e36234dc3d6b8c"><div class="ttname"><a href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a35e64d445c5f7885b2e36234dc3d6b8c">v8::internal::BackingStore::TypeSpecificData::deleter</a></div><div class="ttdeci">struct v8::internal::BackingStore::TypeSpecificData::DeleterInfo deleter</div></div>
<div class="ttc" id="aunionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_html_a605935636f567c55035fd08e9a3a0e71"><div class="ttname"><a href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#a605935636f567c55035fd08e9a3a0e71">v8::internal::BackingStore::TypeSpecificData::v8_api_array_buffer_allocator_shared</a></div><div class="ttdeci">std::shared_ptr&lt; v8::ArrayBuffer::Allocator &gt; v8_api_array_buffer_allocator_shared</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00209">backing-store.h:209</a></div></div>
<div class="ttc" id="aunionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_html_ac24f8e676b135f4d2ade39723eb07a4e"><div class="ttname"><a href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#ac24f8e676b135f4d2ade39723eb07a4e">v8::internal::BackingStore::TypeSpecificData::shared_wasm_memory_data</a></div><div class="ttdeci">SharedWasmMemoryData * shared_wasm_memory_data</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00213">backing-store.h:213</a></div></div>
<div class="ttc" id="aunionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData_html_adc88bc06374b235a42ac1f1bbcb81622"><div class="ttname"><a href="unionv8_1_1internal_1_1BackingStore_1_1TypeSpecificData.html#adc88bc06374b235a42ac1f1bbcb81622">v8::internal::BackingStore::TypeSpecificData::v8_api_array_buffer_allocator</a></div><div class="ttdeci">v8::ArrayBuffer::Allocator * v8_api_array_buffer_allocator</div><div class="ttdef"><b>Definition</b> <a href="backing-store_8h_source.html#l00203">backing-store.h:203</a></div></div>
<div class="ttc" id="av8config_8h_html_a41c02a3573ba53271a80787e85f5b105"><div class="ttname"><a href="v8config_8h.html#a41c02a3573ba53271a80787e85f5b105">END_ALLOW_USE_DEPRECATED</a></div><div class="ttdeci">#define END_ALLOW_USE_DEPRECATED()</div><div class="ttdef"><b>Definition</b> <a href="v8config_8h_source.html#l00623">v8config.h:623</a></div></div>
<div class="ttc" id="av8config_8h_html_ab7cd68756ed2a5deadd67f4175f4bc61"><div class="ttname"><a href="v8config_8h.html#ab7cd68756ed2a5deadd67f4175f4bc61">START_ALLOW_USE_DEPRECATED</a></div><div class="ttdeci">#define START_ALLOW_USE_DEPRECATED()</div><div class="ttdef"><b>Definition</b> <a href="v8config_8h_source.html#l00622">v8config.h:622</a></div></div>
<div class="ttc" id="awasm-constants_8h_html"><div class="ttname"><a href="wasm-constants_8h.html">wasm-constants.h</a></div></div>
<div class="ttc" id="awasm-engine_8h_html"><div class="ttname"><a href="wasm-engine_8h.html">wasm-engine.h</a></div></div>
<div class="ttc" id="awasm-limits_8h_html"><div class="ttname"><a href="wasm-limits_8h.html">wasm-limits.h</a></div></div>
<div class="ttc" id="awasm-module_8h_html"><div class="ttname"><a href="wasm-module_8h.html">wasm-module.h</a></div></div>
<div class="ttc" id="awasm-objects-inl_8h_html"><div class="ttname"><a href="wasm-objects-inl_8h.html">wasm-objects-inl.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a7fa5847c07dc92c5227f8a150238560.html">objects</a></li><li class="navelem"><a class="el" href="backing-store_8cc.html">backing-store.cc</a></li>
    <li class="footer">Generated on Thu Apr 3 2025 09:55:31 for v8 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
