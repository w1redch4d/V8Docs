<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>v8: src/wasm/module-compiler.cc Source File</title>
<link rel="icon" href="v8.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="v8.png"/></td>
  <td id="projectalign">
   <div id="projectname">v8
   </div>
   <div id="projectbrief">V8 is Googleâ€™s open source high-performance JavaScript and WebAssembly engine, written in C++. It is used in Chrome and in Node.js, among others. It implements ECMAScript and WebAssembly, and runs on Windows, macOS, and Linux systems that use x64, IA-32, or ARM processors. V8 can be embedded into any C++ application.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('module-compiler_8cc_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">module-compiler.cc</div></div>
</div><!--header-->
<div class="contents">
<a href="module-compiler_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// Copyright 2017 the V8 project authors. All rights reserved.</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// found in the LICENSE file.</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &quot;<a class="code" href="module-compiler_8h.html">src/wasm/module-compiler.h</a>&quot;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;queue&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="api-inl_8h.html">src/api/api-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="enum-set_8h.html">src/base/enum-set.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="mutex_8h.html">src/base/platform/mutex.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &quot;<a class="code" href="semaphore_8h.html">src/base/platform/semaphore.h</a>&quot;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="time_8h.html">src/base/platform/time.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="compiler_8h.html">src/codegen/compiler.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-compiler_8h.html">src/compiler/wasm-compiler.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">src/debug/debug.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="global-handles-inl_8h.html">src/handles/global-handles-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="counters-scopes_8h.html">src/logging/counters-scopes.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="metrics_8h.html">src/logging/metrics.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="tracing_2trace-event_8h.html">src/tracing/trace-event.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="code-space-access_8h.html">src/wasm/code-space-access.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="compilation-environment-inl_8h.html">src/wasm/compilation-environment-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="jump-table-assembler_8h.html">src/wasm/jump-table-assembler.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="module-decoder_8h.html">src/wasm/module-decoder.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="pgo_8h.html">src/wasm/pgo.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="std-object-sizes_8h.html">src/wasm/std-object-sizes.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="streaming-decoder_8h.html">src/wasm/streaming-decoder.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-code-manager_8h.html">src/wasm/wasm-code-manager.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-code-pointer-table-inl_8h.html">src/wasm/wasm-code-pointer-table-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-engine_8h.html">src/wasm/wasm-engine.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-feature-flags_8h.html">src/wasm/wasm-feature-flags.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-import-wrapper-cache_8h.html">src/wasm/wasm-import-wrapper-cache.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-js_8h.html">src/wasm/wasm-js.h</a>&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-limits_8h.html">src/wasm/wasm-limits.h</a>&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-objects-inl_8h.html">src/wasm/wasm-objects-inl.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-result_8h.html">src/wasm/wasm-result.h</a>&quot;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="wasm-serialization_8h.html">src/wasm/wasm-serialization.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span> </div>
<div class="foldopen" id="foldopen00042" data-start="" data-end="">
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">   42</a></span><span class="preprocessor">#define TRACE_COMPILE(...)                                 \</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">  do {                                                     \</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">    if (v8_flags.trace_wasm_compiler) PrintF(__VA_ARGS__); \</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">  } while (false)</span></div>
</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span> </div>
<div class="foldopen" id="foldopen00047" data-start="" data-end="">
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">   47</a></span><span class="preprocessor">#define TRACE_STREAMING(...)                                \</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="preprocessor">  do {                                                      \</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="preprocessor">    if (v8_flags.trace_wasm_streaming) PrintF(__VA_ARGS__); \</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="preprocessor">  } while (false)</span></div>
</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="foldopen" id="foldopen00052" data-start="" data-end="">
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ad2bae691c0e698bc9c20b394f89ffb3c">   52</a></span><span class="preprocessor">#define TRACE_LAZY(...)                                            \</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="preprocessor">  do {                                                             \</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="preprocessor">    if (v8_flags.trace_wasm_lazy_compilation) PrintF(__VA_ARGS__); \</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">  } while (false)</span></div>
</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespacev8_1_1internal_1_1wasm.html">v8::internal::wasm</a> {</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="keyword">enum class</span> CompileStrategy : uint8_t {</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>  <span class="comment">// Compiles functions on first use. In this case, execution will block until</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>  <span class="comment">// the function&#39;s baseline is reached and top tier compilation starts in</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>  <span class="comment">// background (if applicable).</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>  <span class="comment">// Lazy compilation can help to reduce startup time and code size at the risk</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>  <span class="comment">// of blocking execution.</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>  <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1ae3c54a7917f0c719b11db86b1dd59b0f">kLazy</a>,</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>  <span class="comment">// Compiles baseline ahead of execution and starts top tier compilation in</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>  <span class="comment">// background (if applicable).</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>  <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a1f85c8fbccc9bb4fcda482bf840bc3e2">kEager</a>,</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>  <span class="comment">// Triggers baseline compilation on first use (just like {kLazy}) with the</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>  <span class="comment">// difference that top tier compilation is started eagerly.</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>  <span class="comment">// This strategy can help to reduce startup time at the risk of blocking</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>  <span class="comment">// execution, but only in its early phase (until top tier compilation</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>  <span class="comment">// finishes).</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>  <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a1fede85ba930eef5832cf35bc93cb2cb">kLazyBaselineEagerTopTier</a>,</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>  <span class="comment">// Marker for default strategy.</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>  <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a6867faeaa475fda467e48267db2bb8a8">kDefault</a> = <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a1f85c8fbccc9bb4fcda482bf840bc3e2">kEager</a>,</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>};</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span><span class="keyword">class </span>CompilationStateImpl;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="keyword">class </span>CompilationUnitBuilder;</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="keyword">class </span><a class="code hl_define" href="v8config_8h.html#ae5350bf5d731891583a34f9c8c52b532">V8_NODISCARD</a> BackgroundCompileScope {</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>  <span class="keyword">explicit</span> BackgroundCompileScope(std::weak_ptr&lt;NativeModule&gt; native_module)</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(native_module.lock()) {}</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>  NativeModule* native_module()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>);</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>.get();</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>  }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>  <span class="keyword">inline</span> CompilationStateImpl* compilation_state() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>  <span class="keywordtype">bool</span> cancelled() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>  <span class="comment">// Keep the native module alive while in this scope.</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">   99</a></span>  std::shared_ptr&lt;NativeModule&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>};</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="keyword">enum</span> CompilationTier { <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a014ea81f0b1504833e290d4a98601282a65ffc7d8b4dceb3661bbcf4c6c12118d">kBaseline</a> = 0, kTopTier = 1, kNumTiers = kTopTier + 1 };</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="comment">// A set of work-stealing queues (vectors of units). Each background compile</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span><span class="comment">// task owns one of the queues and steals from all others once its own queue</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span><span class="comment">// runs empty.</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="keyword">class </span>CompilationUnitQueues {</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>  <span class="comment">// Public API for QueueImpl.</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>  <span class="keyword">struct </span>Queue {</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="keywordtype">bool</span> ShouldPublish(<span class="keywordtype">int</span> num_processed_units) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>  };</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>  <span class="keyword">explicit</span> CompilationUnitQueues(<span class="keywordtype">int</span> num_declared_functions)</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#abd7f88aeabcd878dedeb96d85dc7c4cc">num_declared_functions_</a>(num_declared_functions) {</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="comment">// Add one first queue, to add units to.</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.emplace_back(std::make_unique&lt;QueueImpl&gt;(0));</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="preprocessor">#if !defined(__cpp_lib_atomic_value_initialization) || \</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="preprocessor">    __cpp_lib_atomic_value_initialization &lt; 201911L</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; atomic_counter : num_units_) {</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>      std::atomic_init(&amp;atomic_counter, <span class="keywordtype">size_t</span>{0});</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    }</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a41fb1d2eb2e61c5b16160348b3d536a1">top_tier_compiled_</a> =</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        std::make_unique&lt;std::atomic&lt;bool&gt;[]&gt;(num_declared_functions);</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span><span class="preprocessor">#if !defined(__cpp_lib_atomic_value_initialization) || \</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="preprocessor">    __cpp_lib_atomic_value_initialization &lt; 201911L</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; num_declared_functions; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>      std::atomic_init(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a41fb1d2eb2e61c5b16160348b3d536a1">top_tier_compiled_</a>.get()[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>], <span class="keyword">false</span>);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>  }</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>  Queue* GetQueueForTask(<span class="keywordtype">int</span> task_id) {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="keywordtype">int</span> required_queues = task_id + 1;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    {</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>      base::SharedMutexGuard&lt;base::kShared&gt; queues_guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>};</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>      <span class="keywordflow">if</span> (<a class="code hl_define" href="v8config_8h.html#a4f489f1b838163ab33f251c9e470d938">V8_LIKELY</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size()) &gt;= required_queues)) {</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>[task_id].get();</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>      }</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="comment">// Otherwise increase the number of queues.</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    base::SharedMutexGuard&lt;base::kExclusive&gt; queues_guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>};</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="keywordtype">int</span> num_queues = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size());</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="keywordflow">while</span> (num_queues &lt; required_queues) {</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>      <span class="keywordtype">int</span> steal_from = num_queues + 1;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.emplace_back(std::make_unique&lt;QueueImpl&gt;(steal_from));</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>      ++num_queues;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    }</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">// Update the {publish_limit}s of all queues.</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">// We want background threads to publish regularly (to avoid contention when</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="comment">// they are all publishing at the end). On the other side, each publishing</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// has some overhead (part of it for synchronizing between threads), so it</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// should not happen *too* often. Thus aim for 4-8 publishes per thread, but</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">// distribute it such that publishing is likely to happen at different</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">// times.</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="keywordtype">int</span> units_per_thread = <a class="code hl_variable" href="module-compiler_8cc.html#abd7f88aeabcd878dedeb96d85dc7c4cc">num_declared_functions_</a> / num_queues;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="keywordtype">int</span> min = std::max(10, units_per_thread / 8);</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keywordtype">int</span> queue_id = 0;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; queue : queues_) {</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>      <span class="comment">// Set a limit between {min} and {2*min}, but not smaller than {10}.</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>      <span class="keywordtype">int</span> limit = min + (min * queue_id / num_queues);</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>      queue-&gt;publish_limit.store(limit, std::memory_order_relaxed);</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>      ++queue_id;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>[task_id].get();</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>  }</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>  std::optional&lt;WasmCompilationUnit&gt; GetNextUnit(Queue* queue,</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                                                 CompilationTier tier) {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(tier, CompilationTier::kNumTiers);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = GetNextUnitOfTier(queue, tier)) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>      [[maybe_unused]] <span class="keywordtype">size_t</span> old_units_count =</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].fetch_sub(1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(1, old_units_count);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    }</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>  }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>  <span class="keywordtype">void</span> AddUnits(base::Vector&lt;WasmCompilationUnit&gt; baseline_units,</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                base::Vector&lt;WasmCompilationUnit&gt; top_tier_units,</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module) {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(0, baseline_units.size() + top_tier_units.size());</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="comment">// Add to the individual queues in a round-robin fashion. No special care is</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">// taken to balance them; they will be balanced by work stealing.</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    QueueImpl* queue;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    {</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>      <span class="keywordtype">int</span> queue_to_add = <a class="code hl_variable" href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">next_queue_to_add</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>      base::SharedMutexGuard&lt;base::kShared&gt; queues_guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>};</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>      <span class="keywordflow">while</span> (!<a class="code hl_variable" href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">next_queue_to_add</a>.compare_exchange_weak(</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>          queue_to_add, next_task_id(queue_to_add, <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size()),</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>          std::memory_order_relaxed)) {</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        <span class="comment">// Retry with updated {queue_to_add}.</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>      }</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>      queue = <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>[queue_to_add].get();</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    }</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span> </div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;queue-&gt;mutex);</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    std::optional&lt;base::SpinningMutexGuard&gt; big_units_guard;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> pair :</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>         {std::make_pair(CompilationTier::kBaseline, baseline_units),</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>          std::make_pair(CompilationTier::kTopTier, top_tier_units)}) {</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>      <span class="keywordtype">int</span> tier = pair.first;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>      base::Vector&lt;WasmCompilationUnit&gt; <a class="code hl_variable" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a> = pair.second;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a>.empty()) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].fetch_add(<a class="code hl_variable" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a>.size(), std::memory_order_relaxed);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>      <span class="keywordflow">for</span> (WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> : <a class="code hl_variable" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a>) {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a> = <span class="keyword">module</span>-&gt;functions[unit.func_index()].code.length();</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a> &lt;= kBigUnitsLimit) {</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>          queue-&gt;units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].push_back(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>          <span class="keywordflow">if</span> (!big_units_guard) {</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>            big_units_guard.emplace(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.mutex);</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>          }</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.has_units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].store(<span class="keyword">true</span>,</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                                                 std::memory_order_relaxed);</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].emplace(<a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a>, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>);</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        }</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>      }</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    }</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>  }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>  <span class="keywordtype">void</span> AddTopTierPriorityUnit(WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>) {</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    base::SharedMutexGuard&lt;base::kShared&gt; queues_guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>};</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="comment">// Add to the individual queues in a round-robin fashion. No special care is</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="comment">// taken to balance them; they will be balanced by work stealing.</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="comment">// Priorities should only be seen as a hint here; without balancing, we</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="comment">// might pop a unit with lower priority from one queue while other queues</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="comment">// still hold higher-priority units.</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <span class="comment">// Since updating priorities in a std::priority_queue is difficult, we just</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="comment">// add new units with higher priorities, and use the</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="comment">// {CompilationUnitQueues::top_tier_compiled_} array to discard units for</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment">// functions which are already being compiled.</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="keywordtype">int</span> queue_to_add = <a class="code hl_variable" href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">next_queue_to_add</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="keywordflow">while</span> (!<a class="code hl_variable" href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">next_queue_to_add</a>.compare_exchange_weak(</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        queue_to_add, next_task_id(queue_to_add, <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size()),</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        std::memory_order_relaxed)) {</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>      <span class="comment">// Retry with updated {queue_to_add}.</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    }</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    {</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>      <span class="keyword">auto</span>* queue = <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>[queue_to_add].get();</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>      <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;queue-&gt;mutex);</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>      queue-&gt;top_tier_priority_units.emplace(<a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>);</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">num_priority_units_</a>.fetch_add(1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[CompilationTier::kTopTier].fetch_add(</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>          1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    }</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>  }</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>  <span class="comment">// Get the current number of units in the queue for |tier|. This is only a</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>  <span class="comment">// momentary snapshot, it&#39;s not guaranteed that {GetNextUnit} returns a unit</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>  <span class="comment">// if this method returns non-zero.</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>  <span class="keywordtype">size_t</span> GetSizeForTier(CompilationTier tier)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(tier, CompilationTier::kNumTiers);</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>  }</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>  <span class="keywordtype">void</span> AllowAnotherTopTierJob(uint32_t func_index) {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a41fb1d2eb2e61c5b16160348b3d536a1">top_tier_compiled_</a>[func_index].store(<span class="keyword">false</span>, std::memory_order_relaxed);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>  }</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>  <span class="keywordtype">size_t</span> EstimateCurrentMemoryConsumption() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>  <span class="comment">// Functions bigger than {kBigUnitsLimit} will be compiled first, in ascending</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>  <span class="comment">// order of their function body size.</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a593b02d411833c56828ed981177b30c7">  276</a></span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a593b02d411833c56828ed981177b30c7">kBigUnitsLimit</a> = 4096;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>  <span class="keyword">struct </span>BigUnit {</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    BigUnit(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a>, WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>)</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        : <a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a>{<a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a>}, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>) {}</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span> </div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">  282</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a>;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a26d02ade41dc3c4e4b7a2e0d3876dddd">  283</a></span>    WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal.html#a812835f99758ef0970dfe7872beb4e8f">operator&lt;</a>(<span class="keyword">const</span> BigUnit&amp; other)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a> &lt; other.func_size;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    }</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>  };</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>  <span class="keyword">struct </span>TopTierPriorityUnit {</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    TopTierPriorityUnit(<span class="keywordtype">int</span> priority, WasmCompilationUnit unit)</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>        : <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>), <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>) {}</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">  294</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal.html#a812835f99758ef0970dfe7872beb4e8f">operator&lt;</a>(<span class="keyword">const</span> TopTierPriorityUnit&amp; other)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a> &lt; other.priority;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>  };</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>  <span class="keyword">struct </span>BigUnitsQueue {</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    BigUnitsQueue() {</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span><span class="preprocessor">#if !defined(__cpp_lib_atomic_value_initialization) || \</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span><span class="preprocessor">    __cpp_lib_atomic_value_initialization &lt; 201911L</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; atomic : has_units) std::atomic_init(&amp;atomic, <span class="keyword">false</span>);</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    }</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#af6befd6f98ada7aaa0bb9f802cf519a9">  310</a></span>    <span class="keyword">mutable</span> base::SpinningMutex <a class="code hl_variable" href="module-compiler_8cc.html#af6befd6f98ada7aaa0bb9f802cf519a9">mutex</a>;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="comment">// Can be read concurrently to check whether any elements are in the queue.</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#aa60eff3769722cba29beed1ffacef4f8">  313</a></span>    std::atomic&lt;bool&gt; <a class="code hl_variable" href="module-compiler_8cc.html#aa60eff3769722cba29beed1ffacef4f8">has_units</a>[CompilationTier::kNumTiers];</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="comment">// Protected by {mutex}:</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">  316</a></span>    std::priority_queue&lt;BigUnit&gt; <a class="code hl_variable" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a>[CompilationTier::kNumTiers];</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>  };</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>  <span class="keyword">struct </span>QueueImpl : <span class="keyword">public</span> Queue {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="keyword">explicit</span> QueueImpl(<span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#ac4872e36e3e8f96addfd5055ed3c4e2d">next_steal_task_id</a>)</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        : <a class="code hl_variable" href="module-compiler_8cc.html#ac4872e36e3e8f96addfd5055ed3c4e2d">next_steal_task_id</a>(<a class="code hl_variable" href="module-compiler_8cc.html#ac4872e36e3e8f96addfd5055ed3c4e2d">next_steal_task_id</a>) {}</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="comment">// Number of units after which the task processing this queue should publish</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="comment">// compilation results. Updated (reduced, using relaxed ordering) when new</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="comment">// queues are allocated. If there is only one thread running, we can delay</span></div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="comment">// publishing arbitrarily.</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#afcf5c4fbc12b5850864b5c388f4c98cc">  327</a></span>    std::atomic&lt;int&gt; <a class="code hl_variable" href="module-compiler_8cc.html#afcf5c4fbc12b5850864b5c388f4c98cc">publish_limit</a>{<a class="code hl_variable" href="namespacev8_1_1internal.html#ad03e50e4d15ee0da6a722254f350e7eb">kMaxInt</a>};</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    base::SpinningMutex <a class="code hl_variable" href="module-compiler_8cc.html#af6befd6f98ada7aaa0bb9f802cf519a9">mutex</a>;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span> </div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="comment">// All fields below are protected by {mutex}.</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    std::vector&lt;WasmCompilationUnit&gt; <a class="code hl_variable" href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a>[CompilationTier::kNumTiers];</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a39362646122bdc4765ab29ccfe930bcf">  333</a></span>    std::priority_queue&lt;TopTierPriorityUnit&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a39362646122bdc4765ab29ccfe930bcf">top_tier_priority_units</a>;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ac4872e36e3e8f96addfd5055ed3c4e2d">  334</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#ac4872e36e3e8f96addfd5055ed3c4e2d">next_steal_task_id</a>;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>  };</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span> </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>  <span class="keywordtype">int</span> next_task_id(<span class="keywordtype">int</span> task_id, <span class="keywordtype">size_t</span> num_queues)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <span class="keywordtype">int</span> next = task_id + 1;</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    <span class="keywordflow">return</span> next == <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(num_queues) ? 0 : next;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>  }</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>  std::optional&lt;WasmCompilationUnit&gt; GetNextUnitOfTier(Queue* public_queue,</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                                                       <span class="keywordtype">int</span> tier) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    QueueImpl* queue = <span class="keyword">static_cast&lt;</span>QueueImpl*<span class="keyword">&gt;</span>(public_queue);</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <span class="comment">// First check whether there is a priority unit. Execute that first.</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="keywordflow">if</span> (tier == CompilationTier::kTopTier) {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = GetTopTierPriorityUnit(queue)) {</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>      }</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="comment">// Then check whether there is a big unit of that tier.</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = GetBigUnitOfTier(tier)) <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="comment">// Finally check whether our own queue has a unit of the wanted tier. If</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="comment">// so, return it, otherwise get the task id to steal from.</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <span class="keywordtype">int</span> steal_task_id;</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>      <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> mutex_guard(&amp;queue-&gt;mutex);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>      <span class="keywordflow">if</span> (!queue-&gt;units[tier].empty()) {</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        <span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = queue-&gt;units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].back();</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        queue-&gt;units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].pop_back();</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>      }</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>      steal_task_id = queue-&gt;next_steal_task_id;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    }</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span> </div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    <span class="comment">// Try to steal from all other queues. If this succeeds, return one of the</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <span class="comment">// stolen units.</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    {</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>      base::SharedMutexGuard&lt;base::kShared&gt; guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>};</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> steal_trials = 0; steal_trials &lt; <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size();</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>           ++steal_trials, ++steal_task_id) {</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        <span class="keywordflow">if</span> (steal_task_id &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size())) {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>          steal_task_id = 0;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        }</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = StealUnitsAndGetFirst(queue, steal_task_id, tier)) {</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        }</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>      }</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    }</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span> </div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="comment">// If we reach here, we didn&#39;t find any unit of the requested tier.</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>  }</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span> </div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>  std::optional&lt;WasmCompilationUnit&gt; GetBigUnitOfTier(<span class="keywordtype">int</span> tier) {</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// Fast path without locking.</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.has_units[tier].load(std::memory_order_relaxed)) {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>      <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    }</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.mutex);</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[tier].empty()) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].top().unit;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].pop();</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[tier].empty()) {</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.has_units[<a class="code hl_variable" href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">tier</a>].store(<span class="keyword">false</span>, std::memory_order_relaxed);</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    }</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>  }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>  std::optional&lt;WasmCompilationUnit&gt; GetTopTierPriorityUnit(QueueImpl* queue) {</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="comment">// Fast path without locking.</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">num_priority_units_</a>.load(std::memory_order_relaxed) == 0) {</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>      <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    }</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <span class="keywordtype">int</span> steal_task_id;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    {</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>      <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> mutex_guard(&amp;queue-&gt;mutex);</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>      <span class="keywordflow">while</span> (!queue-&gt;top_tier_priority_units.empty()) {</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = queue-&gt;top_tier_priority_units.top().unit;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        queue-&gt;top_tier_priority_units.pop();</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">num_priority_units_</a>.fetch_sub(1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        <span class="keywordflow">if</span> (!top_tier_compiled_[<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.func_index()].exchange(</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>                <span class="keyword">true</span>, std::memory_order_relaxed)) {</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        }</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[CompilationTier::kTopTier].fetch_sub(</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>            1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>      }</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>      steal_task_id = queue-&gt;next_steal_task_id;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    }</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span> </div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="comment">// Try to steal from all other queues. If this succeeds, return one of the</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    <span class="comment">// stolen units.</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    {</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>      base::SharedMutexGuard&lt;base::kShared&gt; guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>};</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> steal_trials = 0; steal_trials &lt; <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size();</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>           ++steal_trials, ++steal_task_id) {</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        <span class="keywordflow">if</span> (steal_task_id &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size())) {</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>          steal_task_id = 0;</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>        }</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        <span class="keywordflow">if</span> (<span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = StealTopTierPriorityUnit(queue, steal_task_id)) {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>          <span class="keywordflow">return</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        }</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>      }</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    }</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>  }</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>  <span class="comment">// Steal units of {wanted_tier} from {steal_from_task_id} to {queue}. Return</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>  <span class="comment">// first stolen unit (rest put in queue of {task_id}), or {nullopt} if</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>  <span class="comment">// {steal_from_task_id} had no units of {wanted_tier}.</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>  <span class="comment">// Hold a shared lock on {queues_mutex_} when calling this method.</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>  std::optional&lt;WasmCompilationUnit&gt; StealUnitsAndGetFirst(</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>      QueueImpl* queue, <span class="keywordtype">int</span> steal_from_task_id, <span class="keywordtype">int</span> wanted_tier) {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    <span class="keyword">auto</span>* steal_queue = <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>[steal_from_task_id].get();</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="comment">// Cannot steal from own queue.</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordflow">if</span> (steal_queue == queue) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    std::vector&lt;WasmCompilationUnit&gt; stolen;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    std::optional&lt;WasmCompilationUnit&gt; returned_unit;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    {</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>      <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;steal_queue-&gt;mutex);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>      <span class="keyword">auto</span>* steal_from_vector = &amp;steal_queue-&gt;units[wanted_tier];</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>      <span class="keywordflow">if</span> (steal_from_vector-&gt;empty()) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>      <span class="keywordtype">size_t</span> remaining = steal_from_vector-&gt;size() / 2;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>      <span class="keyword">auto</span> steal_begin = steal_from_vector-&gt;begin() + remaining;</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>      returned_unit = *steal_begin;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>      stolen.assign(steal_begin + 1, steal_from_vector-&gt;end());</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>      steal_from_vector-&gt;erase(steal_begin, steal_from_vector-&gt;end());</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    }</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;queue-&gt;mutex);</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    <span class="keyword">auto</span>* target_queue = &amp;queue-&gt;units[wanted_tier];</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    target_queue-&gt;insert(target_queue-&gt;end(), stolen.begin(), stolen.end());</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    queue-&gt;next_steal_task_id = steal_from_task_id + 1;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="keywordflow">return</span> returned_unit;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>  }</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span> </div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>  <span class="comment">// Steal one priority unit from {steal_from_task_id} to {task_id}. Return</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>  <span class="comment">// stolen unit, or {nullopt} if {steal_from_task_id} had no priority units.</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>  <span class="comment">// Hold a shared lock on {queues_mutex_} when calling this method.</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>  std::optional&lt;WasmCompilationUnit&gt; StealTopTierPriorityUnit(</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>      QueueImpl* queue, <span class="keywordtype">int</span> steal_from_task_id) {</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <span class="keyword">auto</span>* steal_queue = <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>[steal_from_task_id].get();</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <span class="comment">// Cannot steal from own queue.</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <span class="keywordflow">if</span> (steal_queue == queue) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    std::optional&lt;WasmCompilationUnit&gt; returned_unit;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    {</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>      <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;steal_queue-&gt;mutex);</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>      <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>        <span class="keywordflow">if</span> (steal_queue-&gt;top_tier_priority_units.empty()) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>        <span class="keyword">auto</span> <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = steal_queue-&gt;top_tier_priority_units.top().unit;</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>        steal_queue-&gt;top_tier_priority_units.pop();</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">num_priority_units_</a>.fetch_sub(1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>        <span class="keywordflow">if</span> (!top_tier_compiled_[<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.func_index()].exchange(</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                <span class="keyword">true</span>, std::memory_order_relaxed)) {</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>          returned_unit = <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>          <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        }</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[CompilationTier::kTopTier].fetch_sub(</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>            1, std::memory_order_relaxed);</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>      }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    }</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <a class="code hl_typedef" href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">base::SpinningMutexGuard</a> guard(&amp;queue-&gt;mutex);</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    queue-&gt;next_steal_task_id = steal_from_task_id + 1;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="keywordflow">return</span> returned_unit;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>  }</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>  <span class="comment">// {queues_mutex_} protectes {queues_};</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">  506</a></span>  <span class="keyword">mutable</span> base::SharedMutex <a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">  507</a></span>  std::vector&lt;std::unique_ptr&lt;QueueImpl&gt;&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>;</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#abd7f88aeabcd878dedeb96d85dc7c4cc">  509</a></span>  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#abd7f88aeabcd878dedeb96d85dc7c4cc">num_declared_functions_</a>;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">  511</a></span>  BigUnitsQueue <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>;</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span> </div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">  513</a></span>  std::atomic&lt;size_t&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a>[CompilationTier::kNumTiers];</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">  514</a></span>  std::atomic&lt;size_t&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">num_priority_units_</a>{0};</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a41fb1d2eb2e61c5b16160348b3d536a1">  515</a></span>  std::unique_ptr&lt;std::atomic&lt;bool&gt;[]&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a41fb1d2eb2e61c5b16160348b3d536a1">top_tier_compiled_</a>;</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">  516</a></span>  std::atomic&lt;int&gt; <a class="code hl_variable" href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">next_queue_to_add</a>{0};</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>};</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span> </div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="keywordtype">size_t</span> CompilationUnitQueues::EstimateCurrentMemoryConsumption()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>  <a class="code hl_define" href="std-object-sizes_8h.html#a56caa02a4280c4f0c82adab429400770">UPDATE_WHEN_CLASS_CHANGES</a>(CompilationUnitQueues, 200);</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>  <a class="code hl_define" href="std-object-sizes_8h.html#a56caa02a4280c4f0c82adab429400770">UPDATE_WHEN_CLASS_CHANGES</a>(QueueImpl, 96);</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>  <a class="code hl_define" href="std-object-sizes_8h.html#a56caa02a4280c4f0c82adab429400770">UPDATE_WHEN_CLASS_CHANGES</a>(BigUnitsQueue, 72);</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>  <span class="comment">// Not including sizeof(CompilationUnitQueues) because that&#39;s included in</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>  <span class="comment">// sizeof(CompilationStateImpl).</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>  <span class="keywordtype">size_t</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = 0;</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>  {</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    base::SharedMutexGuard&lt;base::kShared&gt; lock(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a>);</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#aa122591443234c1d0b597dadc9d55c5e">ContentSize</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>) + <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>.size() * <span class="keyword">sizeof</span>(QueueImpl);</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; q : <a class="code hl_variable" href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a>) {</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>      base::SpinningMutexGuard guard(&amp;q-&gt;mutex);</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>      <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#aa122591443234c1d0b597dadc9d55c5e">ContentSize</a>(*q-&gt;units);</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>      <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += q-&gt;top_tier_priority_units.size() * <span class="keyword">sizeof</span>(TopTierPriorityUnit);</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    }</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>  }</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>  {</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    base::SpinningMutexGuard lock(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.mutex);</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[0].size() * <span class="keyword">sizeof</span>(BigUnit);</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <a class="code hl_variable" href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a>.units[1].size() * <span class="keyword">sizeof</span>(BigUnit);</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>  }</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>  <span class="comment">// For {top_tier_compiled_}.</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>  <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <span class="keyword">sizeof</span>(std::atomic&lt;bool&gt;) * <a class="code hl_variable" href="module-compiler_8cc.html#abd7f88aeabcd878dedeb96d85dc7c4cc">num_declared_functions_</a>;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>;</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>}</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="keywordtype">bool</span> CompilationUnitQueues::Queue::ShouldPublish(</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="keywordtype">int</span> num_processed_units)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>  <span class="keyword">auto</span>* queue = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>QueueImpl*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>  <span class="keywordflow">return</span> num_processed_units &gt;=</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>         queue-&gt;publish_limit.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>}</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">// The {CompilationStateImpl} keeps track of the compilation state of the</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment">// owning NativeModule, i.e. which functions are left to be compiled.</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="comment">// It contains a task manager to allow parallel and asynchronous background</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="comment">// compilation of functions.</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="comment">// Its public interface {CompilationState} lives in compilation-environment.h.</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="keyword">class </span>CompilationStateImpl {</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>  CompilationStateImpl(<span class="keyword">const</span> std::shared_ptr&lt;NativeModule&gt;&amp; native_module,</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>                       std::shared_ptr&lt;Counters&gt; async_counters,</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>                       DynamicTiering dynamic_tiering,</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>                       WasmDetectedFeatures detected_features);</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>  ~CompilationStateImpl() {</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>-&gt;IsValid()) {</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>-&gt;CancelAndDetach();</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    }</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>-&gt;IsValid()) {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>-&gt;CancelAndDetach();</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    }</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>  }</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span> </div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>  <span class="comment">// Call right after the constructor, after the {compilation_state_} field in</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>  <span class="comment">// the {NativeModule} has been initialized.</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>  <span class="keywordtype">void</span> InitCompileJob();</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span> </div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>  <span class="comment">// {kCancelUnconditionally}: Cancel all compilation.</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>  <span class="comment">// {kCancelInitialCompilation}: Cancel all compilation if initial (baseline)</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>  <span class="comment">// compilation is not finished yet.</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>  <span class="keyword">enum</span> CancellationPolicy { kCancelUnconditionally, kCancelInitialCompilation };</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>  <span class="keywordtype">void</span> CancelCompilation(CancellationPolicy);</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>  <span class="keywordtype">bool</span> cancelled() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span> </div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>  <span class="comment">// Apply a compilation hint to the initial compilation progress, updating all</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>  <span class="comment">// internal fields accordingly.</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>  <span class="keywordtype">void</span> ApplyCompilationHintToInitialProgress(<span class="keyword">const</span> WasmCompilationHint&amp; hint,</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                                             <span class="keywordtype">size_t</span> hint_idx);</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>  <span class="comment">// Use PGO information to choose a better initial compilation progress</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>  <span class="comment">// (tiering decisions).</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>  <span class="keywordtype">void</span> ApplyPgoInfoToInitialProgress(ProfileInformation* pgo_info);</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>  <span class="comment">// Apply PGO information to a fully initialized compilation state. Also</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>  <span class="comment">// trigger compilation as needed.</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>  <span class="keywordtype">void</span> ApplyPgoInfoLate(ProfileInformation* pgo_info);</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>  <span class="comment">// Initialize compilation progress. Set compilation tiers to expect for</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>  <span class="comment">// baseline and top tier compilation. Must be set before</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>  <span class="comment">// {CommitCompilationUnits} is invoked which triggers background compilation.</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>  <span class="keywordtype">void</span> InitializeCompilationProgress(ProfileInformation* pgo_info);</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>  <span class="keywordtype">void</span> InitializeCompilationProgressAfterDeserialization(</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>      base::Vector&lt;const int&gt; lazy_functions,</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>      base::Vector&lt;const int&gt; eager_functions);</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>  <span class="comment">// Initializes compilation units based on the information encoded in the</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>  <span class="comment">// {compilation_progress_}.</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>  <span class="keywordtype">void</span> InitializeCompilationUnits(</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>      std::unique_ptr&lt;CompilationUnitBuilder&gt; builder);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>  <span class="comment">// Adds compilation units for another function to the</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>  <span class="comment">// {CompilationUnitBuilder}. This function is the streaming compilation</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>  <span class="comment">// equivalent to {InitializeCompilationUnits}.</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>  <span class="keywordtype">void</span> AddCompilationUnit(CompilationUnitBuilder* builder, <span class="keywordtype">int</span> func_index);</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span> </div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>  <span class="comment">// Add the callback to be called on compilation events. Needs to be</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>  <span class="comment">// set before {CommitCompilationUnits} is run to ensure that it receives all</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>  <span class="comment">// events. The callback object must support being deleted from any thread.</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>  <span class="keywordtype">void</span> AddCallback(std::unique_ptr&lt;CompilationEventCallback&gt; <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>);</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>  <span class="comment">// Inserts new functions to compile and kicks off compilation.</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>  <span class="keywordtype">void</span> CommitCompilationUnits(base::Vector&lt;WasmCompilationUnit&gt; baseline_units,</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>                              base::Vector&lt;WasmCompilationUnit&gt; top_tier_units);</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>  <span class="keywordtype">void</span> CommitTopTierCompilationUnit(WasmCompilationUnit);</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>  <span class="keywordtype">void</span> AddTopTierPriorityCompilationUnit(WasmCompilationUnit, <span class="keywordtype">size_t</span>);</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>  CompilationUnitQueues::Queue* GetQueueForCompileTask(<span class="keywordtype">int</span> task_id);</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>  std::optional&lt;WasmCompilationUnit&gt; GetNextCompilationUnit(</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>      CompilationUnitQueues::Queue*, CompilationTier tier);</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>  <span class="keywordtype">void</span> OnFinishedUnits(base::Vector&lt;WasmCode*&gt;);</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span> </div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>  <span class="keywordtype">void</span> OnCompilationStopped(WasmDetectedFeatures detected);</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>  <span class="keywordtype">void</span> SchedulePublishCompilationResults(</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>      std::vector&lt;UnpublishedWasmCode&gt; unpublished_code, CompilationTier tier);</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span> </div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>  WasmDetectedFeatures detected_features()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>  }</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span> </div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>  <span class="comment">// Update the set of detected features; returns all features that were not</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>  <span class="comment">// detected before.</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>  <a class="code hl_define" href="v8config_8h.html#a63258e4bf5dc9fb8c78f881c8405d83b">V8_WARN_UNUSED_RESULT</a> WasmDetectedFeatures</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>      UpdateDetectedFeatures(WasmDetectedFeatures);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>  <span class="keywordtype">size_t</span> NumOutstandingCompilations(CompilationTier tier) <span class="keyword">const</span>;</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span> </div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>  <span class="keywordtype">void</span> SetError();</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>  <span class="keywordtype">void</span> WaitForCompilationEvent(CompilationEvent event);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span> </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>  <span class="keywordtype">void</span> TierUpAllFunctions();</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span> </div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>  <span class="keywordtype">void</span> AllowAnotherTopTierJob(uint32_t func_index) {</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.AllowAnotherTopTierJob(func_index);</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="comment">// Reset the stored priority; otherwise triggers might be ignored if the</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="comment">// priority is not bumped to the next power of two.</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    TypeFeedbackStorage* feedback = &amp;<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module()-&gt;type_feedback;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    feedback-&gt;feedback_for_function[func_index].tierup_priority = 0;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>  }</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>  <span class="keywordtype">void</span> AllowAnotherTopTierJobForAllFunctions() {</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module();</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    uint32_t fn_start = <span class="keyword">module</span>-&gt;num_imported_functions;</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    uint32_t fn_end = fn_start + module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a5a60fa14372f7bc06d7d6f51d23b0bee">num_declared_functions</a>;</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    std::unordered_map&lt;uint32_t, FunctionTypeFeedback&gt;&amp; feedback_map =</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>        <span class="keyword">module</span>-&gt;type_feedback.feedback_for_function;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>    <span class="keywordflow">for</span> (uint32_t <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = fn_start; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; fn_end; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.AllowAnotherTopTierJob(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>);</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>      <span class="comment">// Reset the stored priority; otherwise triggers might be ignored if the</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>      <span class="comment">// priority is not bumped to the next power of two.</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>      <span class="keywordflow">if</span> (<span class="keyword">auto</span> it = feedback_map.find(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>); it != feedback_map.end()) {</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>        it-&gt;second.tierup_priority = 0;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>      }</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    }</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>  }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>  <span class="keywordtype">bool</span> failed()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a476aa4c8510e0cbb39a63ccd26795727">compile_failed_</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>  }</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span> </div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>  <span class="keywordtype">bool</span> baseline_compilation_finished()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> == 0;</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>  }</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span> </div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">DynamicTiering</a> dynamic_tiering()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a>; }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span> </div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>  Counters* counters()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>.get(); }</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>  <span class="keywordtype">void</span> SetWireBytesStorage(</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>      std::shared_ptr&lt;WireBytesStorage&gt; wire_bytes_storage) {</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>    base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>);</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a6fcf7dd1613d67775b21911e2df9c991">wire_bytes_storage_</a> = std::move(wire_bytes_storage);</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>  }</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>  std::shared_ptr&lt;WireBytesStorage&gt; GetWireBytesStorage()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a6fcf7dd1613d67775b21911e2df9c991">wire_bytes_storage_</a>);</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a6fcf7dd1613d67775b21911e2df9c991">wire_bytes_storage_</a>;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>  }</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>  <span class="keywordtype">void</span> set_compilation_id(<span class="keywordtype">int</span> compilation_id) {</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<a class="code hl_variable" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#ae042bdad58afd5e550614c9d31238ed3">kInvalidCompilationID</a>);</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <a class="code hl_variable" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a> = compilation_id;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>  }</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>  <span class="keywordtype">size_t</span> EstimateCurrentMemoryConsumption() <span class="keyword">const</span>;</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>  <span class="comment">// Called from the delayed task to trigger caching if the timeout</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>  <span class="comment">// (--wasm-caching-timeout-ms) has passed since the last top-tier compilation.</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>  <span class="comment">// This either triggers caching or re-schedules the task if more code has</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>  <span class="comment">// been compiled to the top tier in the meantime.</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>  <span class="keywordtype">void</span> TriggerCachingAfterTimeout();</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span> </div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>  std::vector&lt;WasmCode*&gt; PublishCode(base::Vector&lt;UnpublishedWasmCode&gt; codes);</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>  <span class="keywordtype">void</span> AddCompilationUnitInternal(CompilationUnitBuilder* builder,</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                                  <span class="keywordtype">int</span> function_index,</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                                  uint8_t function_progress);</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span> </div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>  <span class="comment">// Trigger callbacks according to the internal counters below</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>  <span class="comment">// (outstanding_...).</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>  <span class="comment">// Hold the {callbacks_mutex_} when calling this method.</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>  <span class="keywordtype">void</span> TriggerOutstandingCallbacks();</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>  <span class="comment">// Trigger an exact set of callbacks. Hold the {callbacks_mutex_} when calling</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>  <span class="comment">// this method.</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>  <span class="keywordtype">void</span> TriggerCallbacks(base::EnumSet&lt;CompilationEvent&gt;);</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>  <span class="keywordtype">void</span> PublishCompilationResults(</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>      std::vector&lt;UnpublishedWasmCode&gt; unpublished_code);</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span> </div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>  NativeModule* <span class="keyword">const</span> <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">  736</a></span>  std::weak_ptr&lt;NativeModule&gt; <span class="keyword">const</span> <a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>;</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">  737</a></span>  <span class="keyword">const</span> std::shared_ptr&lt;Counters&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>  <span class="comment">// Compilation error, atomically updated. This flag can be updated and read</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>  <span class="comment">// using relaxed semantics.</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a476aa4c8510e0cbb39a63ccd26795727">  741</a></span>  std::atomic&lt;bool&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a476aa4c8510e0cbb39a63ccd26795727">compile_failed_</a>{<span class="keyword">false</span>};</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span> </div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>  <span class="comment">// True if compilation was cancelled and worker threads should return. This</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>  <span class="comment">// flag can be updated and read using relaxed semantics.</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a8be0288f8228634650c4bea900954c65">  745</a></span>  std::atomic&lt;bool&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a8be0288f8228634650c4bea900954c65">compile_cancelled_</a>{<span class="keyword">false</span>};</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">  747</a></span>  CompilationUnitQueues <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>;</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span> </div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>  <span class="comment">// Cache the dynamic tiering configuration to be consistent for the whole</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>  <span class="comment">// compilation.</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">  751</a></span>  <span class="keyword">const</span> DynamicTiering <a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a>;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>  <span class="comment">// This mutex protects all information of this {CompilationStateImpl} which is</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>  <span class="comment">// being accessed concurrently.</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#aa014421904d6bb32c4478d3224ce3767">  755</a></span>  <span class="keyword">mutable</span> base::SpinningMutex <a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>  <span class="comment">// The compile job handles, initialized right after construction of</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>  <span class="comment">// {CompilationStateImpl}.</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">  759</a></span>  std::unique_ptr&lt;JobHandle&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">  760</a></span>  std::unique_ptr&lt;JobHandle&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>;</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>  <span class="comment">// The compilation id to identify trace events linked to this compilation.</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ae042bdad58afd5e550614c9d31238ed3">  763</a></span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#ae042bdad58afd5e550614c9d31238ed3">kInvalidCompilationID</a> = -1;</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">  764</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a> = <a class="code hl_variable" href="module-compiler_8cc.html#ae042bdad58afd5e550614c9d31238ed3">kInvalidCompilationID</a>;</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>  <span class="comment">// Features detected to be used in this module. Features can be detected</span></div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>  <span class="comment">// as a module is being compiled.</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">  768</a></span>  std::atomic&lt;WasmDetectedFeatures&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a>;</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>  <span class="comment">// Protected by {mutex_}:</span></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>  <span class="comment">// Abstraction over the storage of the wire bytes. Held in a shared_ptr so</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>  <span class="comment">// that background compilation jobs can keep the storage alive while</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>  <span class="comment">// compiling.</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a6fcf7dd1613d67775b21911e2df9c991">  776</a></span>  std::shared_ptr&lt;WireBytesStorage&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a6fcf7dd1613d67775b21911e2df9c991">wire_bytes_storage_</a>;</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>  <span class="comment">// End of fields protected by {mutex_}.</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span> </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>  <span class="comment">// This mutex protects the callbacks vector, and the counters used to</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>  <span class="comment">// determine which callbacks to call. The counters plus the callbacks</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>  <span class="comment">// themselves need to be synchronized to ensure correct order of events.</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">  784</a></span>  <span class="keyword">mutable</span> base::SpinningMutex <a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>;</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>  <span class="comment">// Protected by {callbacks_mutex_}:</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span> </div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>  <span class="comment">// Callbacks to be called on compilation events.</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">  790</a></span>  std::vector&lt;std::unique_ptr&lt;CompilationEventCallback&gt;&gt; <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>;</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span> </div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>  <span class="comment">// Events that already happened.</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">  793</a></span>  base::EnumSet&lt;CompilationEvent&gt; <a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>;</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span> </div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">  795</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> = 0;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>  <span class="comment">// The amount of generated top tier code since the last</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>  <span class="comment">// {kFinishedCompilationChunk} event.</span></div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">  798</a></span>  <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a> = 0;</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">  799</a></span>  std::vector&lt;uint8_t&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>;</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span> </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>  <span class="comment">// The timestamp of the last top-tier compilation.</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>  <span class="comment">// This field is updated on every publishing of top-tier code, and is reset</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>  <span class="comment">// once caching is triggered. Hence it also informs whether a caching task is</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>  <span class="comment">// currently being scheduled (whenever this is set).</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">  805</a></span>  base::TimeTicks <a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a>;</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span> </div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>  <span class="comment">// End of fields protected by {callbacks_mutex_}.</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span> </div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>  <span class="keyword">struct </span>PublishState {</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>    <span class="comment">// {mutex_} protects {publish_queue_} and {publisher_running_}.</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>    base::SpinningMutex <a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>;</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#af2d8a33fed48845da59999a542b2b9f3">  813</a></span>    std::vector&lt;UnpublishedWasmCode&gt; <a class="code hl_variable" href="module-compiler_8cc.html#af2d8a33fed48845da59999a542b2b9f3">publish_queue_</a>;</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ab7047c1a4737b951ed82b3ac41f9bd15">  814</a></span>    <span class="keywordtype">bool</span> <a class="code hl_variable" href="module-compiler_8cc.html#ab7047c1a4737b951ed82b3ac41f9bd15">publisher_running_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>  };</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a49d5b294402367d1e82540d38ed1229d">  816</a></span>  PublishState <a class="code hl_variable" href="module-compiler_8cc.html#a49d5b294402367d1e82540d38ed1229d">publish_state_</a>[CompilationTier::kNumTiers];</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span> </div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>  <span class="comment">// Encoding of fields in the {compilation_progress_} vector.</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>  <span class="keyword">using </span>RequiredBaselineTierField = base::BitField8&lt;ExecutionTier, 0, 2&gt;;</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>  <span class="keyword">using </span>RequiredTopTierField = base::BitField8&lt;ExecutionTier, 2, 2&gt;;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>  <span class="keyword">using </span>ReachedTierField = base::BitField8&lt;ExecutionTier, 4, 2&gt;;</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>};</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span> </div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>CompilationStateImpl* Impl(CompilationState* compilation_state) {</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>  <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span>CompilationStateImpl*<span class="keyword">&gt;</span>(compilation_state);</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>}</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span><span class="keyword">const</span> CompilationStateImpl* Impl(<span class="keyword">const</span> CompilationState* compilation_state) {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>  <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>CompilationStateImpl*<span class="keyword">&gt;</span>(compilation_state);</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>}</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>CompilationStateImpl* BackgroundCompileScope::compilation_state()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>);</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>  <span class="keywordflow">return</span> Impl(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;compilation_state());</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>}</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span><span class="keywordtype">size_t</span> CompilationStateImpl::EstimateCurrentMemoryConsumption()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>  <a class="code hl_define" href="std-object-sizes_8h.html#a56caa02a4280c4f0c82adab429400770">UPDATE_WHEN_CLASS_CHANGES</a>(CompilationStateImpl, 456);</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>  <span class="keywordtype">size_t</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <span class="keyword">sizeof</span>(CompilationStateImpl);</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span> </div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>  {</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    base::SpinningMutexGuard guard{&amp;<a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>};</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>    <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.EstimateCurrentMemoryConsumption();</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>  }</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>  <span class="comment">// To read the size of {callbacks_} and {compilation_progress_}, we&#39;d</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>  <span class="comment">// need to acquire the {callbacks_mutex_}, which can cause deadlocks</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>  <span class="comment">// when that mutex is already held elsewhere and another thread calls</span></div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>  <span class="comment">// into this function. So we rely on heuristics and informed guesses</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>  <span class="comment">// instead: {compilation_progress_} contains an entry for every declared</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>  <span class="comment">// function in the module...</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>  <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += <span class="keyword">sizeof</span>(uint8_t) * <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module()-&gt;num_declared_functions;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>  <span class="comment">// ...and there are typically no more than a handful of {callbacks_}.</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>  <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> kAssumedNumberOfCallbacks = 4;</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>  <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> size_of_vector =</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>      kAssumedNumberOfCallbacks *</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>      <span class="keyword">sizeof</span>(std::unique_ptr&lt;CompilationEventCallback&gt;);</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>  <span class="comment">// Concrete subclasses of CompilationEventCallback will be bigger, but we</span></div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>  <span class="comment">// can&#39;t know that here.</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>  <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> size_of_payload =</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>      kAssumedNumberOfCallbacks * <span class="keyword">sizeof</span>(CompilationEventCallback);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>  <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> += size_of_vector + size_of_payload;</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span> </div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.trace_wasm_offheap_memory) {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <a class="code hl_function" href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">PrintF</a>(<span class="stringliteral">&quot;CompilationStateImpl: %zu\n&quot;</span>, <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>  }</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>}</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span> </div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span><span class="keywordtype">bool</span> BackgroundCompileScope::cancelled()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a> == <span class="keyword">nullptr</span> ||</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>         Impl(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;compilation_state())-&gt;cancelled();</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>}</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span><span class="comment">// PIMPL implementation of {CompilationState}.</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> </div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a65d1dbc0c9fdd995fd0eb1fbbf8f1947">  879</a></span>CompilationState::~CompilationState() { Impl(<span class="keyword">this</span>)-&gt;~CompilationStateImpl(); }</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#ab81cbf88e8bd750d5d7e198464e923f3">  881</a></span><span class="keywordtype">void</span> CompilationState::InitCompileJob() { Impl(<span class="keyword">this</span>)-&gt;InitCompileJob(); }</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span> </div>
<div class="foldopen" id="foldopen00883" data-start="{" data-end="}">
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a94616121bb815ddab13b79d737542e29">  883</a></span><span class="keywordtype">void</span> CompilationState::CancelCompilation() {</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>  Impl(<span class="keyword">this</span>)-&gt;CancelCompilation(CompilationStateImpl::kCancelUnconditionally);</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>}</div>
</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span> </div>
<div class="foldopen" id="foldopen00887" data-start="{" data-end="}">
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a0fccff8ad60688e7fbd9b4c853e90439">  887</a></span><span class="keywordtype">void</span> CompilationState::CancelInitialCompilation() {</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>  Impl(<span class="keyword">this</span>)-&gt;CancelCompilation(</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>      CompilationStateImpl::kCancelInitialCompilation);</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>}</div>
</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span> </div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#aa615c60c7e1fc45f22289c32bf136cc3">  892</a></span><span class="keywordtype">void</span> CompilationState::SetError() { Impl(<span class="keyword">this</span>)-&gt;SetError(); }</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="foldopen" id="foldopen00894" data-start="{" data-end="}">
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a82cff25a5e68e95bd42f7c5c45058171">  894</a></span><span class="keywordtype">void</span> CompilationState::SetWireBytesStorage(</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>    std::shared_ptr&lt;WireBytesStorage&gt; wire_bytes_storage) {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>  Impl(<span class="keyword">this</span>)-&gt;SetWireBytesStorage(std::move(wire_bytes_storage));</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>}</div>
</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span> </div>
<div class="foldopen" id="foldopen00899" data-start="{" data-end="}">
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#ac94f5604f1684b2f28391cef5a2dffb7">  899</a></span>std::shared_ptr&lt;WireBytesStorage&gt; CompilationState::GetWireBytesStorage()<span class="keyword"></span></div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span><span class="keyword">    const </span>{</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;GetWireBytesStorage();</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>}</div>
</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span> </div>
<div class="foldopen" id="foldopen00904" data-start="{" data-end="}">
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a7ed524741d5660c9c342c654df2ac37e">  904</a></span><span class="keywordtype">void</span> CompilationState::AddCallback(</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>    std::unique_ptr&lt;CompilationEventCallback&gt; <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>) {</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;AddCallback(std::move(<a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>));</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>}</div>
</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="foldopen" id="foldopen00909" data-start="{" data-end="}">
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a80ea8bcbfde72f2c012a2002b8dacedf">  909</a></span><span class="keywordtype">void</span> CompilationState::TierUpAllFunctions() {</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>  Impl(<span class="keyword">this</span>)-&gt;TierUpAllFunctions();</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>}</div>
</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span> </div>
<div class="foldopen" id="foldopen00913" data-start="{" data-end="}">
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#aceda8f4173dae2b1acfdff2cf0bd9128">  913</a></span><span class="keywordtype">void</span> CompilationState::AllowAnotherTopTierJob(uint32_t func_index) {</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>  Impl(<span class="keyword">this</span>)-&gt;AllowAnotherTopTierJob(func_index);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>}</div>
</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span> </div>
<div class="foldopen" id="foldopen00917" data-start="{" data-end="}">
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a9c56f9d64da89e21922aaf94fab9c734">  917</a></span><span class="keywordtype">void</span> CompilationState::AllowAnotherTopTierJobForAllFunctions() {</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>  Impl(<span class="keyword">this</span>)-&gt;AllowAnotherTopTierJobForAllFunctions();</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>}</div>
</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="foldopen" id="foldopen00921" data-start="{" data-end="}">
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a9ebb11cd7d9fb9633666bdebbd038a5f">  921</a></span><span class="keywordtype">void</span> CompilationState::InitializeAfterDeserialization(</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const int&gt;</a> lazy_functions,</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const int&gt;</a> eager_functions) {</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>  Impl(<span class="keyword">this</span>)-&gt;InitializeCompilationProgressAfterDeserialization(</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>      lazy_functions, eager_functions);</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>}</div>
</div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span> </div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a2badfff8eee4ca33ffd54ab30ae5b1bf">  928</a></span><span class="keywordtype">bool</span> CompilationState::failed()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;failed(); }</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span> </div>
<div class="foldopen" id="foldopen00930" data-start="{" data-end="}">
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a74e1f8aaf59a147b239151b5b913362f">  930</a></span><span class="keywordtype">bool</span> CompilationState::baseline_compilation_finished()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;baseline_compilation_finished();</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>}</div>
</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="foldopen" id="foldopen00934" data-start="{" data-end="}">
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#aaae5bb20ea313ddf1ccf1393ca5ade67">  934</a></span><span class="keywordtype">void</span> CompilationState::set_compilation_id(<span class="keywordtype">int</span> compilation_id) {</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>  Impl(<span class="keyword">this</span>)-&gt;set_compilation_id(compilation_id);</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>}</div>
</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span> </div>
<div class="foldopen" id="foldopen00938" data-start="{" data-end="}">
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a9e0115c333551438ffda8396cabb3060">  938</a></span><a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">DynamicTiering</a> CompilationState::dynamic_tiering()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;dynamic_tiering();</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>}</div>
</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span> </div>
<div class="foldopen" id="foldopen00942" data-start="{" data-end="}">
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#ac43a967338375f3962c4b31151e5d713">  942</a></span><span class="keywordtype">size_t</span> CompilationState::EstimateCurrentMemoryConsumption()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;EstimateCurrentMemoryConsumption();</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>}</div>
</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span> </div>
<div class="foldopen" id="foldopen00946" data-start="{" data-end="}">
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#ad47276201a3451517914237634bef777">  946</a></span>std::vector&lt;WasmCode*&gt; CompilationState::PublishCode(</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;UnpublishedWasmCode&gt;</a> unpublished_code) {</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;PublishCode(unpublished_code);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>}</div>
</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span> </div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span><span class="comment">// static</span></div>
<div class="foldopen" id="foldopen00952" data-start="{" data-end="}">
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#aebd99e1827252230ee8d9f13ff472d25">  952</a></span>std::unique_ptr&lt;CompilationState&gt; CompilationState::New(</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>    <span class="keyword">const</span> std::shared_ptr&lt;NativeModule&gt;&amp; native_module,</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    std::shared_ptr&lt;Counters&gt; async_counters, <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">DynamicTiering</a> dynamic_tiering,</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features) {</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>  <span class="keywordflow">return</span> std::unique_ptr&lt;CompilationState&gt;(</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>      <span class="keyword">reinterpret_cast&lt;</span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html">CompilationState</a>*<span class="keyword">&gt;</span>(<span class="keyword">new</span> CompilationStateImpl(</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>          std::move(native_module), std::move(async_counters), dynamic_tiering,</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>          detected_features)));</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>}</div>
</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span> </div>
<div class="foldopen" id="foldopen00962" data-start="{" data-end="}">
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#afda3d9cadd9a4eb735ff81fb8b5d0ea4">  962</a></span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> CompilationState::detected_features()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;detected_features();</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>}</div>
</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="foldopen" id="foldopen00966" data-start="{" data-end="}">
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a3763475c99a36d50427d6c2b3f4e1d07">  966</a></span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> CompilationState::UpdateDetectedFeatures(</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features) {</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>  <span class="keywordflow">return</span> Impl(<span class="keyword">this</span>)-&gt;UpdateDetectedFeatures(detected_features);</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>}</div>
</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span> </div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span><span class="comment">// End of PIMPL implementation of {CompilationState}.</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span> </div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span><a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> ApplyHintToExecutionTier(<a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a014ea81f0b1504833e290d4a98601282">WasmCompilationHintTier</a> hint,</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>                                       <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> default_tier) {</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>  <span class="keywordflow">switch</span> (hint) {</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <span class="keywordflow">case</span> WasmCompilationHintTier::kDefault:</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>      <span class="keywordflow">return</span> default_tier;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    <span class="keywordflow">case</span> WasmCompilationHintTier::kBaseline:</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>      <span class="keywordflow">return</span> ExecutionTier::kLiftoff;</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>    <span class="keywordflow">case</span> WasmCompilationHintTier::kOptimized:</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>      <span class="keywordflow">return</span> ExecutionTier::kTurbofan;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>  }</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>}</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span> </div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span><span class="keyword">const</span> WasmCompilationHint* GetCompilationHint(<span class="keyword">const</span> WasmModule* module,</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>                                              uint32_t func_index) {</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(module-&gt;num_imported_functions, func_index);</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>  uint32_t hint_index = declared_function_index(module, func_index);</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>  <span class="keyword">const</span> std::vector&lt;WasmCompilationHint&gt;&amp; compilation_hints =</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>      <span class="keyword">module</span>-&gt;compilation_hints;</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>  <span class="keywordflow">if</span> (hint_index &lt; compilation_hints.size()) {</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    <span class="keywordflow">return</span> &amp;compilation_hints[hint_index];</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>  }</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>}</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span> </div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>CompileStrategy GetCompileStrategy(<span class="keyword">const</span> WasmModule* module,</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>                                   WasmEnabledFeatures enabled_features,</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>                                   uint32_t func_index, <span class="keywordtype">bool</span> lazy_module) {</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>  <span class="keywordflow">if</span> (lazy_module) <span class="keywordflow">return</span> CompileStrategy::kLazy;</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>  <span class="keywordflow">if</span> (!enabled_features.has_compilation_hints()) {</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>    <span class="keywordflow">return</span> CompileStrategy::kDefault;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>  }</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>  <span class="keyword">auto</span>* hint = GetCompilationHint(module, func_index);</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>  <span class="keywordflow">if</span> (hint == <span class="keyword">nullptr</span>) <span class="keywordflow">return</span> CompileStrategy::kDefault;</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>  <span class="keywordflow">switch</span> (hint-&gt;strategy) {</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kLazy:</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>      <span class="keywordflow">return</span> CompileStrategy::kLazy;</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kEager:</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>      <span class="keywordflow">return</span> CompileStrategy::kEager;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kLazyBaselineEagerTopTier:</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>      <span class="keywordflow">return</span> CompileStrategy::kLazyBaselineEagerTopTier;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kDefault:</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>      <span class="keywordflow">return</span> CompileStrategy::kDefault;</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>  }</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>}</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span> </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span><span class="keyword">struct </span>ExecutionTierPair {</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a9be7c0e07f9f182d632a3efe8586aa85"> 1023</a></span>  ExecutionTier <a class="code hl_variable" href="module-compiler_8cc.html#a9be7c0e07f9f182d632a3efe8586aa85">baseline_tier</a>;</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#aedff3ff1cb0c614ca85fec25ca73bd48"> 1024</a></span>  ExecutionTier <a class="code hl_variable" href="module-compiler_8cc.html#aedff3ff1cb0c614ca85fec25ca73bd48">top_tier</a>;</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>};</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span> </div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span><span class="comment">// Pass the debug state as a separate parameter to avoid data races: the debug</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span><span class="comment">// state may change between its use here and its use at the call site. To have</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span><span class="comment">// a consistent view on the debug state, the caller reads the debug state once</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span><span class="comment">// and then passes it to this function.</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>ExecutionTierPair GetDefaultTiersPerModule(NativeModule* native_module,</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>                                           DynamicTiering dynamic_tiering,</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>                                           DebugState is_in_debug_state,</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>                                           <span class="keywordtype">bool</span> lazy_module) {</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module = native_module-&gt;module();</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>  <span class="keywordflow">if</span> (lazy_module) {</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    <span class="keywordflow">return</span> {ExecutionTier::kNone, ExecutionTier::kNone};</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>  }</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a70bbfcab50b20ba5da8696e0373a8af4">is_asmjs_module</a>(module)) {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!is_in_debug_state);</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    <span class="keywordflow">return</span> {ExecutionTier::kTurbofan, ExecutionTier::kTurbofan};</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>  }</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>  <span class="keywordflow">if</span> (is_in_debug_state) {</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    <span class="keywordflow">return</span> {ExecutionTier::kLiftoff, ExecutionTier::kLiftoff};</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>  }</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> <a class="code hl_variable" href="module-compiler_8cc.html#a9be7c0e07f9f182d632a3efe8586aa85">baseline_tier</a> =</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>      <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.liftoff ? ExecutionTier::kLiftoff : ExecutionTier::kTurbofan;</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>  <span class="keywordtype">bool</span> eager_tier_up = !dynamic_tiering &amp;&amp; <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_tier_up;</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> <a class="code hl_variable" href="module-compiler_8cc.html#aedff3ff1cb0c614ca85fec25ca73bd48">top_tier</a> =</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>      eager_tier_up ? ExecutionTier::kTurbofan : <a class="code hl_variable" href="module-compiler_8cc.html#a9be7c0e07f9f182d632a3efe8586aa85">baseline_tier</a>;</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>  <span class="keywordflow">return</span> {<a class="code hl_variable" href="module-compiler_8cc.html#a9be7c0e07f9f182d632a3efe8586aa85">baseline_tier</a>, <a class="code hl_variable" href="module-compiler_8cc.html#aedff3ff1cb0c614ca85fec25ca73bd48">top_tier</a>};</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>}</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span> </div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>ExecutionTierPair GetLazyCompilationTiers(NativeModule* native_module,</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>                                          uint32_t func_index,</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>                                          DebugState is_in_debug_state) {</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">DynamicTiering</a> dynamic_tiering =</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>      Impl(native_module-&gt;compilation_state())-&gt;dynamic_tiering();</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>  <span class="comment">// For lazy compilation, get the tiers we would use if lazy compilation is</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>  <span class="comment">// disabled.</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>  <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> kNotLazy = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>  ExecutionTierPair tiers = GetDefaultTiersPerModule(</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>      native_module, dynamic_tiering, is_in_debug_state, kNotLazy);</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>  <span class="comment">// If we are in debug mode, we ignore compilation hints.</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>  <span class="keywordflow">if</span> (is_in_debug_state) <span class="keywordflow">return</span> tiers;</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>  <span class="comment">// Check if compilation hints override default tiering behaviour.</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>  <span class="keywordflow">if</span> (native_module-&gt;enabled_features().has_compilation_hints()) {</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <span class="keywordflow">if</span> (<span class="keyword">auto</span>* hint = GetCompilationHint(native_module-&gt;module(), func_index)) {</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>      tiers.baseline_tier =</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>          ApplyHintToExecutionTier(hint-&gt;baseline_tier, tiers.baseline_tier);</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>      tiers.top_tier = ApplyHintToExecutionTier(hint-&gt;top_tier, tiers.top_tier);</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    }</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>  }</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="v8config_8h.html#a67bd29db07c711b0fb11ff1c324ebb60">V8_UNLIKELY</a>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_tier_up_filter &gt;= 0 &amp;&amp;</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>                  func_index !=</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>                      <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_tier_up_filter))) {</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    tiers.top_tier = tiers.baseline_tier;</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>  }</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span> </div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>  <span class="comment">// Correct top tier if necessary.</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>  <span class="keyword">static_assert</span>(ExecutionTier::kLiftoff &lt; ExecutionTier::kTurbofan,</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>                <span class="stringliteral">&quot;Assume an order on execution tiers&quot;</span>);</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>  <span class="keywordflow">if</span> (tiers.baseline_tier &gt; tiers.top_tier) {</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    tiers.top_tier = tiers.baseline_tier;</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>  }</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>  <span class="keywordflow">return</span> tiers;</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>}</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span> </div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span><span class="comment">// The {CompilationUnitBuilder} builds compilation units and stores them in an</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="comment">// internal buffer. The buffer is moved into the working queue of the</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span><span class="comment">// {CompilationStateImpl} when {Commit} is called.</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span><span class="keyword">class </span>CompilationUnitBuilder {</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>  <span class="keyword">explicit</span> CompilationUnitBuilder(NativeModule* native_module)</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(native_module) {}</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>  <span class="keywordtype">void</span> AddBaselineUnit(<span class="keywordtype">int</span> func_index, ExecutionTier tier) {</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379">baseline_units_</a>.emplace_back(func_index, tier, kNotForDebugging);</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>  }</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span> </div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>  <span class="keywordtype">void</span> AddTopTierUnit(<span class="keywordtype">int</span> func_index, ExecutionTier tier) {</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <a class="code hl_variable" href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142">tiering_units_</a>.emplace_back(func_index, tier, kNotForDebugging);</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>  }</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span> </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>  <span class="keywordtype">void</span> Commit() {</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379">baseline_units_</a>.empty() &amp;&amp; <a class="code hl_variable" href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142">tiering_units_</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    compilation_state()-&gt;CommitCompilationUnits(base::VectorOf(<a class="code hl_variable" href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379">baseline_units_</a>),</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>                                                base::VectorOf(<a class="code hl_variable" href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142">tiering_units_</a>));</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>    Clear();</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>  }</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span> </div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>  <span class="keywordtype">void</span> Clear() {</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379">baseline_units_</a>.clear();</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>    <a class="code hl_variable" href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142">tiering_units_</a>.clear();</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>  }</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span> </div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module() { <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module(); }</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>  CompilationStateImpl* compilation_state()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="keywordflow">return</span> Impl(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;compilation_state());</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>  }</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span> </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>  NativeModule* <span class="keyword">const</span> <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379"> 1127</a></span>  std::vector&lt;WasmCompilationUnit&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379">baseline_units_</a>;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142"> 1128</a></span>  std::vector&lt;WasmCompilationUnit&gt; <a class="code hl_variable" href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142">tiering_units_</a>;</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>};</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span> </div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span><a class="code hl_typedef" href="namespacev8_1_1internal_1_1wasm.html#a4a0161ce7e2c0b500e243be3a2c329ea">DecodeResult</a> ValidateSingleFunction(<a class="code hl_variable" href="asm-types_8cc.html#a3ec7489f692d014c845cc17e64456793">Zone</a>* zone, <span class="keyword">const</span> WasmModule* module,</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>                                    <span class="keywordtype">int</span> func_index,</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>                                    base::Vector&lt;const uint8_t&gt; code,</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>                                    WasmEnabledFeatures enabled_features,</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>                                    WasmDetectedFeatures* detected_features) {</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>  <span class="comment">// Sometimes functions get validated unpredictably in the background, for</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>  <span class="comment">// debugging or when inlining one function into another. We check here if that</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>  <span class="comment">// is the case, and exit early if so.</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>  <span class="keywordflow">if</span> (module-&gt;function_was_validated(func_index)) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#af265e8d13c88f8408dc6b23e691652c5">WasmFunction</a>* func = &amp;<span class="keyword">module</span>-&gt;functions[func_index];</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="namespacev8_1_1internal.html#adee95482032a93e07f59341fed5c909f">is_shared</a> = <span class="keyword">module</span>-&gt;type(func-&gt;sig_index).is_shared;</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>  FunctionBody body{func-&gt;sig, func-&gt;code.offset(), code.begin(), code.end(),</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>                    <a class="code hl_variable" href="namespacev8_1_1internal.html#adee95482032a93e07f59341fed5c909f">is_shared</a>};</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>  <a class="code hl_typedef" href="namespacev8_1_1internal_1_1wasm.html#a4a0161ce7e2c0b500e243be3a2c329ea">DecodeResult</a> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab650db3bf6479d5dfe0cb087f6880f73">ValidateFunctionBody</a>(zone, enabled_features, module,</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>                                             detected_features, body);</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.ok()) <span class="keyword">module</span>-&gt;set_function_validated(func_index);</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>;</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>}</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span> </div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span><span class="keyword">enum</span> OnlyLazyFunctions : <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>  kAllFunctions = <span class="keyword">false</span>,</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>  kOnlyLazyFunctions = <span class="keyword">true</span>,</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>};</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span> </div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="keywordtype">bool</span> IsLazyModule(<span class="keyword">const</span> WasmModule* module) {</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation ||</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>         (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.asm_wasm_lazy_compilation &amp;&amp; <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a70bbfcab50b20ba5da8696e0373a8af4">is_asmjs_module</a>(module));</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>}</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span> </div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span><span class="keyword">class </span>CompileLazyTimingScope {</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>  CompileLazyTimingScope(Counters* counters, NativeModule* native_module)</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#aba33ee421effa5ecbb3fadcbf73dc7e1">counters_</a>(counters), <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(native_module) {</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a1117b728b07a51697a39f72749a6d74b">timer_</a>.Start();</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>  }</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span> </div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>  ~CompileLazyTimingScope() {</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>    base::TimeDelta elapsed = <a class="code hl_variable" href="module-compiler_8cc.html#a1117b728b07a51697a39f72749a6d74b">timer_</a>.Elapsed();</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;AddLazyCompilationTimeSample(elapsed.InMicroseconds());</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>    <a class="code hl_variable" href="module-compiler_8cc.html#aba33ee421effa5ecbb3fadcbf73dc7e1">counters_</a>-&gt;wasm_lazy_compile_time()-&gt;AddTimedSample(elapsed);</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>  }</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#aba33ee421effa5ecbb3fadcbf73dc7e1"> 1174</a></span>  Counters* <a class="code hl_variable" href="module-compiler_8cc.html#aba33ee421effa5ecbb3fadcbf73dc7e1">counters_</a>;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>  NativeModule* <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a1117b728b07a51697a39f72749a6d74b"> 1176</a></span>  base::ElapsedTimer <a class="code hl_variable" href="module-compiler_8cc.html#a1117b728b07a51697a39f72749a6d74b">timer_</a>;</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>};</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span> </div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span> </div>
<div class="foldopen" id="foldopen01181" data-start="{" data-end="}">
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#afa7a500801a38cc98469c31192f78468"> 1181</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#afa7a500801a38cc98469c31192f78468">CompileLazy</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate,</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>                 <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data,</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>                 <span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>  <a class="code hl_class" href="classv8_1_1internal_1_1PerThreadAssertScopeEmpty.html">DisallowGarbageCollection</a> no_gc;</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module = trusted_instance_data-&gt;native_module();</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>  <a class="code hl_class" href="classv8_1_1internal_1_1Counters.html">Counters</a>* counters = isolate-&gt;counters();</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span> </div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>  <span class="comment">// Put the timer scope around everything, including the {CodeSpaceWriteScope}</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>  <span class="comment">// and its destruction, to measure complete overhead (apart from the runtime</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>  <span class="comment">// function itself, which has constant overhead).</span></div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>  std::optional&lt;CompileLazyTimingScope&gt; lazy_compile_time_scope;</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>  <span class="keywordflow">if</span> (base::TimeTicks::IsHighResolution()) {</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    lazy_compile_time_scope.emplace(counters, native_module);</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>  }</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span> </div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a9a49a036ab412a6c462feba4042ef5e8">lazy_compile_frozen</a>());</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span> </div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad2bae691c0e698bc9c20b394f89ffb3c">TRACE_LAZY</a>(<span class="stringliteral">&quot;Compiling wasm-function#%d.\n&quot;</span>, func_index);</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>  CompilationStateImpl* compilation_state =</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>      Impl(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a07182fe52910a2cd8573302ceb5e624a">compilation_state</a>());</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a25f59e94501ad0ce6680be236623cc3c">DebugState</a> is_in_debug_state = native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a95dc87711f2fbd647080305bf39e447f">IsInDebugState</a>();</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>  ExecutionTierPair tiers =</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>      GetLazyCompilationTiers(native_module, func_index, is_in_debug_state);</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span> </div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#af886dc3d493824b7a1ae1e1f5ae02e42">num_imported_functions</a>(), func_index);</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(func_index, native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a4210dcf60ee0c22b95de93af93f17f86">num_functions</a>());</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCompilationUnit.html">WasmCompilationUnit</a> baseline_unit{</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>      func_index, tiers.baseline_tier,</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>      is_in_debug_state ? <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a11df36d2f23b22c6772f3a5f08731b5ba43d94925083957d680eef3a3987e0de0">kForDebugging</a> : <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a11df36d2f23b22c6772f3a5f08731b5ba1874820c42ab45140e0e50e44f8e96d5">kNotForDebugging</a>};</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>  <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1CompilationEnv.html">CompilationEnv</a> env = CompilationEnv::ForModule(native_module);</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features;</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>  <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmCompilationResult.html">WasmCompilationResult</a> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = baseline_unit.ExecuteCompilation(</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>      &amp;env, compilation_state-&gt;GetWireBytesStorage().get(), counters,</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>      &amp;detected_features);</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>  compilation_state-&gt;OnCompilationStopped(detected_features);</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span> </div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>  <span class="comment">// During lazy compilation, we can only get compilation errors when</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>  <span class="comment">// {--wasm-lazy-validation} is enabled. Otherwise, the module was fully</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>  <span class="comment">// verified before starting its execution.</span></div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2c0c4cea27d0690467662bb05131b2af">CHECK_IMPLIES</a>(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.failed(), <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation);</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.failed()) {</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>  }</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span> </div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCodeRefScope.html">WasmCodeRefScope</a> code_ref_scope;</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCode.html">WasmCode</a>* code =</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>      native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a91db58c0a3ed6efdba8d82e23a659fa7">PublishCode</a>(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#abc4f3edf1e0fcd8adc53f38952345aed">AddCompiledCode</a>(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>));</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(func_index, code-&gt;index());</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span> </div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="v8config_8h.html#a67bd29db07c711b0fb11ff1c324ebb60">V8_UNLIKELY</a>(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a7394f35597a2e806ed37a5131279919d">log_code</a>())) {</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a2b1c94eee0072e6f73f9262078571a4f">LogCode</a>(base::VectorOf(&amp;code, 1));</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="comment">// Log the code immediately in the current isolate.</span></div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>    <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a80a2af861380fd22a236025164b81737">LogOutstandingCodesForIsolate</a>(isolate);</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>  }</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>  counters-&gt;wasm_lazily_compiled_functions()-&gt;Increment();</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a443a4c6a0f2bedcc6e0ac7f03ece629e">module</a>();</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lazy_module = IsLazyModule(module);</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>  <span class="keywordflow">if</span> (GetCompileStrategy(module, native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#ac8900d676fd063b88a6876f464dd8a07">enabled_features</a>(), func_index,</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>                         lazy_module) == CompileStrategy::kLazy &amp;&amp;</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>      tiers.baseline_tier &lt; tiers.top_tier) {</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCompilationUnit.html">WasmCompilationUnit</a> tiering_unit{func_index, tiers.top_tier,</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>                                     <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a11df36d2f23b22c6772f3a5f08731b5ba1874820c42ab45140e0e50e44f8e96d5">kNotForDebugging</a>};</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>    compilation_state-&gt;CommitTopTierCompilationUnit(tiering_unit);</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>  }</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>}</div>
</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span> </div>
<div class="foldopen" id="foldopen01251" data-start="{" data-end="}">
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a8f515217a2a720fd696212a68a5cd87a"> 1251</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a8f515217a2a720fd696212a68a5cd87a">ThrowLazyCompilationError</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate,</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>                               <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module,</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>                               <span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a443a4c6a0f2bedcc6e0ac7f03ece629e">module</a>();</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span> </div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>  CompilationStateImpl* compilation_state =</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>      Impl(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a07182fe52910a2cd8573302ceb5e624a">compilation_state</a>());</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html">WasmFunction</a>* func = &amp;<span class="keyword">module</span>-&gt;functions[func_index];</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>  <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> code =</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>      compilation_state-&gt;GetWireBytesStorage()-&gt;GetCode(func-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html#aec97739a140bf8da830c55636434adcf">code</a>);</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span> </div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>  <span class="keyword">auto</span> enabled_features = native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#ac8900d676fd063b88a6876f464dd8a07">enabled_features</a>();</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>  <span class="comment">// This path is unlikely, so the overhead for creating an extra Zone is</span></div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>  <span class="comment">// not important.</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>  <a class="code hl_class" href="classv8_1_1internal_1_1Zone.html">Zone</a> validation_zone{<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a33108f98a3342746166d6242b9c7b072">allocator</a>(), <a class="code hl_define" href="zone_8h.html#a6b1fd0a126df3f1b788cee19d9cce66e">ZONE_NAME</a>};</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> unused_detected_features;</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">DecodeResult</a> decode_result =</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>      ValidateSingleFunction(&amp;validation_zone, module, func_index, code,</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>                             enabled_features, &amp;unused_detected_features);</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span> </div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(decode_result.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1Result.html#aff1e1589e6852f41ed5a060d5e4517f9">failed</a>());</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html">wasm::ErrorThrower</a> thrower(isolate, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>  thrower.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html#a2d32c2f4fadecb8c1434fa2998171e23">CompileFailed</a>(<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#afca7dc31d6cfc38c235556c27dec960b">GetWasmErrorWithName</a>(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a5a7bb5fd0dd2615fbbb6b608df1fdd68">wire_bytes</a>(),</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>                                             func_index, module,</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>                                             std::move(decode_result).error()));</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>}</div>
</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span> </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span><span class="comment">// The main purpose of this class is to copy the feedback vectors that live in</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span><span class="comment">// `FixedArray`s on the JavaScript heap to a C++ datastructure on the `module`</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span><span class="comment">// that is accessible to the background compilation threads.</span></div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span><span class="comment">// While we are at it, we also do some light processing here, e.g., mapping the</span></div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span><span class="comment">// feedback to functions, identified by their function index, and filtering out</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span><span class="comment">// feedback for calls to imported functions (which we currently don&#39;t inline).</span></div>
<div class="foldopen" id="foldopen01284" data-start="{" data-end="};">
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html"> 1284</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html">TransitiveTypeFeedbackProcessor</a> {</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen01286" data-start="{" data-end="}">
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a4947e196aa46dccc9b331ec8c6eae7bd"> 1286</a></span>  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a4947e196aa46dccc9b331ec8c6eae7bd">Process</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate,</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>                      <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data,</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>                      <span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html">TransitiveTypeFeedbackProcessor</a>{<a class="code hl_variable" href="graph-builder_8cc.html#a9990dda08de44f6aee0aaf44c50da7d9">isolate</a>, trusted_instance_data, func_index}</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        .<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a719d9a5ae78f1fa03211a6a7e4e240db">ProcessQueue</a>();</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>  }</div>
</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span> </div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span> <span class="keyword">private</span>:</div>
<div class="foldopen" id="foldopen01294" data-start="{" data-end="}">
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a381518a62cb3d6130a6eb99d495c0bd5"> 1294</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a381518a62cb3d6130a6eb99d495c0bd5">TransitiveTypeFeedbackProcessor</a>(</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>      <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data,</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>      <span class="keywordtype">int</span> func_index)</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>      : <a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>(isolate),</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        instance_data_(trusted_instance_data),</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>        <a class="code hl_variable" href="wasm-inlining-into-js_8cc.html#af0a4546fb3d729452321b14ff6c9c7ae">module_</a>(trusted_instance_data-&gt;module()),</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        mutex_guard(&amp;<a class="code hl_variable" href="wasm-inlining-into-js_8cc.html#af0a4546fb3d729452321b14ff6c9c7ae">module_</a>-&gt;type_feedback.<a class="code hl_variable" href="module-compiler_8cc.html#af6befd6f98ada7aaa0bb9f802cf519a9">mutex</a>),</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>        feedback_for_function_(<a class="code hl_variable" href="wasm-inlining-into-js_8cc.html#af0a4546fb3d729452321b14ff6c9c7ae">module_</a>-&gt;type_feedback.feedback_for_function) {</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>    queue_.insert(func_index);</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>  }</div>
</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#ae8e82bee771b314c3d1a1c4034244776"> 1305</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#ae8e82bee771b314c3d1a1c4034244776">~TransitiveTypeFeedbackProcessor</a>() { <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(queue_.empty()); }</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span> </div>
<div class="foldopen" id="foldopen01307" data-start="{" data-end="}">
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a719d9a5ae78f1fa03211a6a7e4e240db"> 1307</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a719d9a5ae78f1fa03211a6a7e4e240db">ProcessQueue</a>() {</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>    <span class="keywordflow">while</span> (!queue_.empty()) {</div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>      <span class="keyword">auto</span> next = queue_.cbegin();</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>      ProcessFunction(*next);</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>      queue_.erase(next);</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>    }</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>  }</div>
</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span> </div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>  <span class="keywordtype">void</span> ProcessFunction(<span class="keywordtype">int</span> func_index);</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span> </div>
<div class="foldopen" id="foldopen01317" data-start="{" data-end="}">
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a9b2c124bd62fdb1a3bb32f7dfce3dd65"> 1317</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a9b2c124bd62fdb1a3bb32f7dfce3dd65">EnqueueCallees</a>(<span class="keyword">const</span> std::vector&lt;CallSiteFeedback&gt;&amp; feedback) {</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; feedback.<a class="code hl_class" href="classsize.html">size</a>(); <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>      <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html">CallSiteFeedback</a>&amp; csf = feedback[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>];</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; csf.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a6d80e8276ad897f0d1bb2157b33aaf0d">num_cases</a>(); j++) {</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>        <span class="keywordtype">int</span> func = csf.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#aa53156b01a8f7b14b7fb11da2e2c150c">function_index</a>(j);</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>        <span class="comment">// Don&#39;t spend time on calls that have never been executed.</span></div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>        <span class="keywordflow">if</span> (csf.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a7a74f41aeae304037366748ed360538a">call_count</a>(j) == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>        <span class="comment">// Don&#39;t recompute feedback that has already been processed.</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>        <span class="keyword">auto</span> existing = feedback_for_function_.find(func);</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        <span class="keywordflow">if</span> (existing != feedback_for_function_.end() &amp;&amp;</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>            !existing-&gt;second.feedback_vector.empty()) {</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>          <span class="keywordflow">if</span> (!existing-&gt;second.needs_reprocessing_after_deopt) {</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>          }</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>          <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_deopt);</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>          existing-&gt;second.needs_reprocessing_after_deopt = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>        }</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>        queue_.insert(func);</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>      }</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>    }</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>  }</div>
</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span> </div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a3f876a92081673138a39d2fcb31a8065"> 1339</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1PerThreadAssertScopeEmpty.html">DisallowGarbageCollection</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a3f876a92081673138a39d2fcb31a8065">no_gc_scope_</a>;</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a53de8c5be24369460263267dc7785ac8"> 1340</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* <span class="keyword">const</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a53de8c5be24369460263267dc7785ac8">isolate_</a>;</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a14ad0c368dcdb3b57a95a18ae4b3e245"> 1341</a></span>  <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a14ad0c368dcdb3b57a95a18ae4b3e245">instance_data_</a>;</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#ab274acbc08982b7464834a65ce4d898c"> 1342</a></span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* <span class="keyword">const</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#ab274acbc08982b7464834a65ce4d898c">module_</a>;</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>  <span class="comment">// TODO(jkummerow): Check if it makes a difference to apply any updates</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>  <span class="comment">// as a single batch at the end.</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a475d63f384ad03f4ce9c1b216f3cbb69"> 1345</a></span>  <a class="code hl_class" href="classv8_1_1base_1_1SharedMutexGuard.html">base::SharedMutexGuard&lt;base::kExclusive&gt;</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a475d63f384ad03f4ce9c1b216f3cbb69">mutex_guard</a>;</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a35a64452e0fd990b109dab7ebae86f8b"> 1346</a></span>  std::unordered_map&lt;uint32_t, FunctionTypeFeedback&gt;&amp; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a35a64452e0fd990b109dab7ebae86f8b">feedback_for_function_</a>;</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a2eda69ab016a1f105368d8d2df5073f1"> 1347</a></span>  std::set&lt;int&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a2eda69ab016a1f105368d8d2df5073f1">queue_</a>;</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>};</div>
</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span> </div>
<div class="foldopen" id="foldopen01350" data-start="{" data-end="}">
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#ad817bffa6a445b9979513a6933576055"> 1350</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ad817bffa6a445b9979513a6933576055">IsCrossInstanceCall</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Object&gt;</a> obj, <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* <span class="keyword">const</span> isolate) {</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>  <span class="keywordflow">return</span> obj == <a class="code hl_class" href="classv8_1_1internal_1_1ReadOnlyRoots.html">ReadOnlyRoots</a>{isolate}.wasm_cross_instance_call_symbol();</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>}</div>
</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span> </div>
<div class="foldopen" id="foldopen01354" data-start="{" data-end="};">
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html"> 1354</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html">FeedbackMaker</a> {</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen01356" data-start="{" data-end="}">
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5e77f5f48f3444fbf75a8a66ee8690f1"> 1356</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5e77f5f48f3444fbf75a8a66ee8690f1">FeedbackMaker</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* <span class="keyword">const</span> isolate,</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>                <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data,</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>                <span class="keywordtype">int</span> func_index, <span class="keywordtype">int</span> num_calls)</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>      : <a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>(isolate),</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>        instance_data_(trusted_instance_data),</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        num_imported_functions_(static_cast&lt;int&gt;(</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>            trusted_instance_data-&gt;module()-&gt;num_imported_functions)),</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>        <a class="code hl_variable" href="liftoff-compiler_8cc.html#ac4910f82010f186c641d38b0d1616003">func_index_</a>(func_index) {</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.reserve(num_calls);</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>  }</div>
</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span> </div>
<div class="foldopen" id="foldopen01367" data-start="{" data-end="}">
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1228df35a1034986937d698a12ec48d5"> 1367</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1228df35a1034986937d698a12ec48d5">AddCallRefCandidate</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmFuncRef&gt;</a> funcref, <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>) {</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmInternalFunction&gt;</a> internal_function =</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>        Cast&lt;WasmFuncRef&gt;(funcref)-&gt;internal(<a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>);</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    <span class="comment">// Discard cross-instance calls, as we can only inline same-instance code.</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>    <span class="keywordflow">if</span> (internal_function-&gt;implicit_arg() != instance_data_) {</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>      has_non_inlineable_targets_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>    }</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>    <span class="comment">// Discard imports for now.</span></div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>    <span class="keywordflow">if</span> (internal_function-&gt;function_index() &lt; num_imported_functions_) {</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>      has_non_inlineable_targets_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    }</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>    AddCall(internal_function-&gt;function_index(), <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>  }</div>
</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span> </div>
<div class="foldopen" id="foldopen01383" data-start="{" data-end="}">
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a21cb7646a6fd34c811c71f4651fcb9d2"> 1383</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a21cb7646a6fd34c811c71f4651fcb9d2">AddCallIndirectCandidate</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Object&gt;</a> target_truncated_obj,</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>                                <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>) {</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    <span class="comment">// Discard cross-instance calls, as we can only inline same-instance code.</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ad817bffa6a445b9979513a6933576055">IsCrossInstanceCall</a>(target_truncated_obj, <a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>)) {</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>      has_non_inlineable_targets_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>    }</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Smi&gt;</a> target_truncated_smi = Cast&lt;Smi&gt;(target_truncated_obj);</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span> </div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>    <span class="comment">// We need to map a truncated call target back to a function index.</span></div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>    <span class="comment">// Generally there may be multiple jump tables if code spaces are far apart</span></div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>    <span class="comment">// (to ensure that direct calls can always use a near call to the closest</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    <span class="comment">// jump table).</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>    <span class="comment">// However, here we are always handling call targets that are originally</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>    <span class="comment">// from the `WasmDispatchTable`, whose entries are always targets pointing</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>    <span class="comment">// into the main jump table, so we only need to check against that.</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span> </div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>    <a class="code hl_class" href="classv8_1_1internal_1_1WasmCodePointer.html">WasmCodePointer</a> <a class="code hl_function" href="namespacev8_1_1internal.html#ab9df0bf289155b5ae1d6da682adf1d6f">handle</a> =</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        <a class="code hl_class" href="classv8_1_1internal_1_1WasmCodePointer.html">WasmCodePointer</a>{<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(target_truncated_smi.value())};</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>    Address entry = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a0a36931b3d2bbcdfcbb253b229838952">GetProcessWideWasmCodePointerTable</a>()</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>                        -&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmCodePointerTable.html#a65882a1f49bd2c6a667cd3054f3dc2e2">GetEntrypointWithoutSignatureCheck</a>(<a class="code hl_function" href="namespacev8_1_1internal.html#ab9df0bf289155b5ae1d6da682adf1d6f">handle</a>);</div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCode.html">wasm::WasmCode</a>* code =</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>        wasm::GetWasmCodeManager()-&gt;LookupCode(<span class="keyword">nullptr</span>, entry);</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>    <span class="keywordflow">if</span> (!code || code-&gt;native_module() != instance_data_-&gt;native_module() ||</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>        code-&gt;IsAnonymous()) {</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>      <span class="comment">// Was not in the main table (e.g., because it&#39;s an imported function).</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>      has_non_inlineable_targets_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>    }</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(code-&gt;kind(), WasmCode::Kind::kWasmFunction);</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>    uint32_t func_idx = code-&gt;index();</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>    AddCall(func_idx, <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>  }</div>
</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span> </div>
<div class="foldopen" id="foldopen01417" data-start="{" data-end="}">
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a0cdc61b56b654326fae1c9dd7b0e5f73"> 1417</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a0cdc61b56b654326fae1c9dd7b0e5f73">AddCall</a>(<span class="keywordtype">int</span> target, <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>) {</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>    <span class="comment">// If we add too many calls, treat it as megamorphic.</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>    <span class="keywordflow">if</span> (<span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(cache_usage_) == targets_cache_.size() ||</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>        is_megamorphic_) {</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>      is_megamorphic_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    }</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>    <span class="comment">// Keep the cache sorted (using insertion-sort), highest count first.</span></div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>    <span class="keywordtype">int</span> insertion_index = 0;</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>    <span class="keywordflow">while</span> (insertion_index &lt; cache_usage_ &amp;&amp;</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>           counts_cache_[insertion_index] &gt;= <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>) {</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>      insertion_index++;</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>    }</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> shifted_index = cache_usage_ - 1; shifted_index &gt;= insertion_index;</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>         shifted_index--) {</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>      targets_cache_[shifted_index + 1] = targets_cache_[shifted_index];</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>      counts_cache_[shifted_index + 1] = counts_cache_[shifted_index];</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    }</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>    targets_cache_[insertion_index] = <a class="code hl_variable" href="js-call-reducer_8cc.html#a160b46cc89e1d0807731be8c2d2257c0">target</a>;</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    counts_cache_[insertion_index] = <a class="code hl_variable" href="debug-coverage_8cc.html#a86988a65e0d3ece7990c032c159786d6">count</a>;</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>    cache_usage_++;</div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>  }</div>
</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span> </div>
<div class="foldopen" id="foldopen01440" data-start="{" data-end="}">
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a35024221f0a5d84611039a0670393b88"> 1440</a></span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a35024221f0a5d84611039a0670393b88">HasTargetCached</a>(<span class="keywordtype">int</span> target) {</div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>    <span class="keyword">auto</span> <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a> = targets_cache_.begin() + cache_usage_;</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(<a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>, targets_cache_.end());</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>    <span class="keywordflow">return</span> std::find(targets_cache_.begin(), <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>, target) != <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>;</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>  }</div>
</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span> </div>
<div class="foldopen" id="foldopen01446" data-start="{" data-end="}">
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a2213da6f4221efbea81330fd8638df66"> 1446</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a2213da6f4221efbea81330fd8638df66">FinalizeCall</a>() {</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>    <span class="keywordflow">if</span> (is_megamorphic_) {</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.trace_wasm_inlining) {</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>        <a class="code hl_function" href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">PrintF</a>(<span class="stringliteral">&quot;[function %d: call #%zu: megamorphic]\n&quot;</span>, <a class="code hl_variable" href="liftoff-compiler_8cc.html#ac4910f82010f186c641d38b0d1616003">func_index_</a>,</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>               <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.size());</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>      }</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>      <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.push_back(CallSiteFeedback::CreateMegamorphic());</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cache_usage_ == 0) {</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>      <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.emplace_back();</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cache_usage_ == 1) {</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.trace_wasm_inlining) {</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>        <a class="code hl_function" href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">PrintF</a>(<span class="stringliteral">&quot;[function %d: call #%zu inlineable (monomorphic)]\n&quot;</span>,</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>               <a class="code hl_variable" href="liftoff-compiler_8cc.html#ac4910f82010f186c641d38b0d1616003">func_index_</a>, <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.size());</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>      }</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>      <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.emplace_back(targets_cache_[0], counts_cache_[0]);</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.trace_wasm_inlining) {</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>        <a class="code hl_function" href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">PrintF</a>(<span class="stringliteral">&quot;[function %d: call #%zu inlineable (polymorphic %d)]\n&quot;</span>,</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>               <a class="code hl_variable" href="liftoff-compiler_8cc.html#ac4910f82010f186c641d38b0d1616003">func_index_</a>, <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.size(), cache_usage_);</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>      }</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(cache_usage_, <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#aa7549c056d2ab9e5a9cf2558f1478051">kMaxPolymorphism</a>);</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>      <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html">CallSiteFeedback::PolymorphicCase</a>* polymorphic =</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>          <span class="keyword">new</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html">CallSiteFeedback::PolymorphicCase</a>[cache_usage_];</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; cache_usage_; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>        polymorphic[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>].<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html#a1dbb576c2c349f34231cd2504d72d952">function_index</a> = targets_cache_[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>];</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>        polymorphic[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>].<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html#a335adc6abf34fc2ab937f4849c46006d">absolute_call_frequency</a> = counts_cache_[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>];</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>      }</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>      <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.emplace_back(polymorphic, cache_usage_);</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>    }</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>    <a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>.back().set_has_non_inlineable_targets(has_non_inlineable_targets_);</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>    <span class="comment">// TODO(mliedtke): Have a better representation that merges these properties</span></div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>    <span class="comment">// into one object.</span></div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>    has_non_inlineable_targets_ = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>    is_megamorphic_ = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>    cache_usage_ = 0;</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>  }</div>
</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span> </div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a421bfdaf8fe8b4f0e852affdc3da0352"> 1483</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a421bfdaf8fe8b4f0e852affdc3da0352">set_has_non_inlineable_targets</a>() { has_non_inlineable_targets_ = <span class="keyword">true</span>; }</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a66eb2e349511d93e32a382a683834e17"> 1484</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a66eb2e349511d93e32a382a683834e17">set_megamorphic</a>() { is_megamorphic_ = <span class="keyword">true</span>; }</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span> </div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>  <span class="comment">// {GetResult} can only be called on a r-value reference to make it more</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>  <span class="comment">// obvious at call sites that {this} should not be used after this operation.</span></div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ac1fedc3038162cdb2114c5d24663afdc"> 1488</a></span>  std::vector&lt;CallSiteFeedback&gt;&amp;&amp; <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ac1fedc3038162cdb2114c5d24663afdc">GetResult</a>() &amp;&amp; { <span class="keywordflow">return</span> std::move(<a class="code hl_variable" href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a>); }</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5494dd4e759c71ec8dfab525fb7cb4e1"> 1491</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* <span class="keyword">const</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5494dd4e759c71ec8dfab525fb7cb4e1">isolate_</a>;</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1de5839ed3afdbc96278501fce06c95a"> 1492</a></span>  <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1de5839ed3afdbc96278501fce06c95a">instance_data_</a>;</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5824f218ec16cec709f6c8edfb415ecc"> 1493</a></span>  std::vector&lt;CallSiteFeedback&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5824f218ec16cec709f6c8edfb415ecc">result_</a>;</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#af5d6075341ff19ff2ae481c9df75665a"> 1494</a></span>  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#af5d6075341ff19ff2ae481c9df75665a">num_imported_functions_</a>;</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ab949e31f99ea4d685c9ad55c495d3743"> 1495</a></span>  <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ab949e31f99ea4d685c9ad55c495d3743">func_index_</a>;</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a74a8471ae23a09befac111d1fa94f064"> 1496</a></span>  <span class="keywordtype">int</span> cache_usage_{0};</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#adbcf8884373c5ab48d1fe9e7b6cdbb6a"> 1497</a></span>  std::array&lt;int, kMaxPolymorphism&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#adbcf8884373c5ab48d1fe9e7b6cdbb6a">targets_cache_</a>;</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#aea42c4ef1afb972bf2797399683207e7"> 1498</a></span>  std::array&lt;int, kMaxPolymorphism&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#aea42c4ef1afb972bf2797399683207e7">counts_cache_</a>;</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ad0b6271abe0b371fb05b9cfc3ede0f5a"> 1499</a></span>  <span class="keywordtype">bool</span> has_non_inlineable_targets_ = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>  <span class="comment">// If we add more call targets than kMaxPolymorphism while processing the</span></div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>  <span class="comment">// feedback, treat it as megamorphic.</span></div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ac5e0bf69ca78dec84766bcb99337a1dc"> 1502</a></span>  <span class="keywordtype">bool</span> is_megamorphic_ = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>};</div>
</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span> </div>
<div class="foldopen" id="foldopen01505" data-start="{" data-end="}">
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a6bef0d91ba2db74dbf60c794343fec99"> 1505</a></span><span class="keywordtype">void</span> TransitiveTypeFeedbackProcessor::ProcessFunction(<span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>  <span class="keywordtype">int</span> which_vector = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(<a class="code hl_variable" href="wasm-inlining-into-js_8cc.html#af0a4546fb3d729452321b14ff6c9c7ae">module_</a>, func_index);</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span>  <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Object&gt;</a> maybe_feedback =</div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>      instance_data_-&gt;feedback_vectors()-&gt;get(which_vector);</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>  <span class="keywordflow">if</span> (!IsFixedArray(maybe_feedback)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>  <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;FixedArray&gt;</a> feedback = Cast&lt;FixedArray&gt;(maybe_feedback);</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>  <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;uint32_t&gt;</a> call_targets =</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>      <a class="code hl_variable" href="wasm-inlining-into-js_8cc.html#af0a4546fb3d729452321b14ff6c9c7ae">module_</a>-&gt;type_feedback.feedback_for_function[func_index]</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>          .call_targets.as_vector();</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span> </div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>  <span class="comment">// For each entry in {call_targets}, there are two {Object} slots in the</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>  <span class="comment">// {feedback} vector:</span></div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>  <span class="comment">// +--------------------------+-----------------------------+----------------+</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>  <span class="comment">// |        Call Type         |      Feedback: Entry 1      |    Entry 2     |</span></div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>  <span class="comment">// +-------------------------+------------------------------+----------------+</span></div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>  <span class="comment">// | direct                   | Smi(count)                  | Smi(0), unused |</span></div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>  <span class="comment">// +--------------------------+-----------------------------+----------------+</span></div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>  <span class="comment">// | ref, uninitialized       | Smi(0)                      | Smi(0)         |</span></div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>  <span class="comment">// | ref, monomorphic         | WasmFuncRef(target)         | Smi(count&gt;0)   |</span></div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>  <span class="comment">// | ref, polymorphic         | FixedArray                  | Undefined      |</span></div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>  <span class="comment">// | ref, megamorphic         | MegamorphicSymbol           | Undefined      |</span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span>  <span class="comment">// +--------------------------+-----------------------------+----------------+</span></div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>  <span class="comment">// | indirect, uninitialized  | Smi(0)                      | Smi(0)         |</span></div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>  <span class="comment">// | indirect, monomorphic    | Smi(truncated_target)       | Smi(count&gt;0)   |</span></div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>  <span class="comment">// | indirect, wrong instance | WasmCrossInstanceCallSymbol | Smi(count&gt;0)   |</span></div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>  <span class="comment">// | indirect, polymorphic    | FixedArray                  | Undefined      |</span></div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>  <span class="comment">// | indirect, megamorphic    | MegamorphicSymbol           | Undefined      |</span></div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>  <span class="comment">// +--------------------------+-----------------------------+----------------+</span></div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>  <span class="comment">// The FixedArray entries for the polymorphic cases look like the monomorphic</span></div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>  <span class="comment">// entries in the feedback vector itself, i.e., they can a (truncated) target,</span></div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>  <span class="comment">// or the wrong instance sentinel (for cross-instance call_indirect).</span></div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>  <span class="comment">// See {UpdateCallRefOrIndirectIC} in {wasm.tq} for how this is written.</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>  <span class="comment">// Since this is combining untrusted data ({feedback} vector on the JS heap)</span></div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>  <span class="comment">// with trusted data ({call_targets}), make sure to avoid an OOB access.</span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>  <span class="keywordtype">int</span> checked_feedback_length = feedback-&gt;<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a1eb4ed5d322a219428bdb9f9a2cb6708">length</a>();</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>  <a class="code hl_define" href="check_8h.html#a6e67d209c0a0c9c55b7b563275f63bdd">SBXCHECK_EQ</a>(checked_feedback_length, call_targets.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a8f91dff816409fb9bceaa94c6caeec32">size</a>() * 2);</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html">FeedbackMaker</a> fm(<a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>, instance_data_, func_index,</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>                   checked_feedback_length / 2);</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; checked_feedback_length; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> += 2) {</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>    uint32_t sentinel_or_target = call_targets[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> / 2];</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Object&gt;</a> first_slot = feedback-&gt;get(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>);</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Object&gt;</a> second_slot = feedback-&gt;get(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> + 1);</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span> </div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>    <span class="keywordflow">if</span> (sentinel_or_target != FunctionTypeFeedback::kCallRef &amp;&amp;</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>        sentinel_or_target != FunctionTypeFeedback::kCallIndirect) {</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>      <span class="comment">// Direct call counts.</span></div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>      <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a> = Smi::ToInt(first_slot);</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(Smi::ToInt(second_slot), 0);</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>      <span class="comment">// TODO(dlehmann): Currently, TurboFan assumes that we add feedback even</span></div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>      <span class="comment">// if the call count is zero. Once TurboFan is gone, revisit if we can</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>      <span class="comment">// avoid this (similar to how we do for call_ref/call_indirect today).</span></div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>      fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a0cdc61b56b654326fae1c9dd7b0e5f73">AddCall</a>(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(sentinel_or_target), <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacev8_1_1internal.html#a511c3dd03bb4fc2b91ed9ef5535e202e">IsSmi</a>(second_slot) &amp;&amp; Smi::ToInt(second_slot) == 0) {</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>      <span class="comment">// Uninitialized call_ref or call_indirect.</span></div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(Smi::ToInt(first_slot), 0);</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.trace_wasm_inlining) {</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>        <a class="code hl_function" href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">PrintF</a>(<span class="stringliteral">&quot;[function %d: call #%d: uninitialized]\n&quot;</span>, func_index, <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> / 2);</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>      }</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsWasmFuncRef(first_slot)) {</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>      <span class="comment">// Monomorphic call_ref.</span></div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(sentinel_or_target, FunctionTypeFeedback::kCallRef);</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>      <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a> = Smi::ToInt(second_slot);</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span>      fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1228df35a1034986937d698a12ec48d5">AddCallRefCandidate</a>(Cast&lt;WasmFuncRef&gt;(first_slot), <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacev8_1_1internal.html#a511c3dd03bb4fc2b91ed9ef5535e202e">IsSmi</a>(first_slot) || <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ad817bffa6a445b9979513a6933576055">IsCrossInstanceCall</a>(first_slot, <a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>)) {</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>      <span class="comment">// Monomorphic call_indirect.</span></div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(sentinel_or_target, FunctionTypeFeedback::kCallIndirect);</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>      <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a> = Smi::ToInt(second_slot);</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>      fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a21cb7646a6fd34c811c71f4651fcb9d2">AddCallIndirectCandidate</a>(first_slot, <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsFixedArray(first_slot)) {</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>      <span class="comment">// Polymorphic call_ref or call_indirect.</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>      <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;FixedArray&gt;</a> polymorphic = Cast&lt;FixedArray&gt;(first_slot);</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(IsUndefined(second_slot));</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>      <span class="keywordtype">int</span> checked_polymorphic_length = polymorphic-&gt;length();</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>      <a class="code hl_define" href="check_8h.html#a0331d7a4dc5d6372d25e946af1f96588">SBXCHECK_LE</a>(checked_polymorphic_length, 2 * <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#aa7549c056d2ab9e5a9cf2558f1478051">kMaxPolymorphism</a>);</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>      <span class="keywordflow">if</span> (sentinel_or_target == FunctionTypeFeedback::kCallRef) {</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; checked_polymorphic_length; j += 2) {</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>          <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmFuncRef&gt;</a> target = Cast&lt;WasmFuncRef&gt;(polymorphic-&gt;get(j));</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>          <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a> = Smi::ToInt(polymorphic-&gt;get(j + 1));</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>          fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1228df35a1034986937d698a12ec48d5">AddCallRefCandidate</a>(target, <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>        }</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>        <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(sentinel_or_target, FunctionTypeFeedback::kCallIndirect);</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; checked_polymorphic_length; j += 2) {</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>          <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;Object&gt;</a> target = polymorphic-&gt;get(j);</div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>          <span class="keywordtype">int</span> <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a> = Smi::ToInt(polymorphic-&gt;get(j + 1));</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>          fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a21cb7646a6fd34c811c71f4651fcb9d2">AddCallIndirectCandidate</a>(target, <a class="code hl_struct" href="structv8_1_1internal_1_1count.html">count</a>);</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>        }</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>      }</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (first_slot == <a class="code hl_class" href="classv8_1_1internal_1_1ReadOnlyRoots.html">ReadOnlyRoots</a>{<a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>}.megamorphic_symbol()) {</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(IsUndefined(second_slot));</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>      fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a66eb2e349511d93e32a382a683834e17">set_megamorphic</a>();</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>    }</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span> </div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_deopt &amp;&amp;</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>        first_slot != <a class="code hl_class" href="classv8_1_1internal_1_1ReadOnlyRoots.html">ReadOnlyRoots</a>{isolate_}.megamorphic_symbol()) {</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>      <span class="comment">// If we already had feedback for this call, also add the already existing</span></div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>      <span class="comment">// feedback to prevent deopt loops where two different instantiations</span></div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>      <span class="comment">// (which have their own on-heap feedback vector) to &quot;flip-flop&quot; between</span></div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>      <span class="comment">// their inlining decisions potentially causing deopt loops.</span></div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>      <span class="keyword">const</span> std::vector&lt;CallSiteFeedback&gt;&amp; existing =</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>          feedback_for_function_[func_index].feedback_vector;</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>      <span class="keywordtype">size_t</span> feedback_index = <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> / 2;</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>      <span class="keywordflow">if</span> (feedback_index &lt; existing.size()) {</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>        <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html">CallSiteFeedback</a>&amp; old_feedback = existing[feedback_index];</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>        <span class="keywordflow">if</span> (old_feedback.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a8c5e0d187ba12d271429ec0d6b1f93fe">has_non_inlineable_targets</a>()) {</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>          fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a421bfdaf8fe8b4f0e852affdc3da0352">set_has_non_inlineable_targets</a>();</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>        }</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>        <span class="keywordflow">if</span> (old_feedback.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a6088a3693fde5bfe38d4c287cb3ef006">is_megamorphic</a>()) {</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>          fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a66eb2e349511d93e32a382a683834e17">set_megamorphic</a>();</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>        }</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; old_feedback.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a6d80e8276ad897f0d1bb2157b33aaf0d">num_cases</a>(); ++j) {</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>          <span class="keywordtype">int</span> old_target_function_index = old_feedback.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#aa53156b01a8f7b14b7fb11da2e2c150c">function_index</a>(j);</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>          <span class="comment">// If the new feedback already contains the target, we do not touch</span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>          <span class="comment">// the call count.</span></div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>          <span class="keywordflow">if</span> (!fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a35024221f0a5d84611039a0670393b88">HasTargetCached</a>(old_target_function_index)) {</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>            fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a0cdc61b56b654326fae1c9dd7b0e5f73">AddCall</a>(old_target_function_index, old_feedback.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a7a74f41aeae304037366748ed360538a">call_count</a>(j));</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>            <span class="comment">// There shouldn&#39;t be any imported functions in there as they can&#39;t</span></div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>            <span class="comment">// be inlined. If this DCHECK is invalidated,</span></div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>            <span class="comment">// has_non_inlineable_targets_ would need to be updated here to</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>            <span class="comment">// reflect that.</span></div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>            <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(old_target_function_index),</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>                      instance_data_-&gt;module()-&gt;num_imported_functions);</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>          }</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>        }</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>      }</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>    }</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span> </div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>    fm.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a2213da6f4221efbea81330fd8638df66">FinalizeCall</a>();</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>  }</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span>  std::vector&lt;CallSiteFeedback&gt; <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = std::move(fm).GetResult();</div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span>  EnqueueCallees(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>  feedback_for_function_[func_index].feedback_vector = std::move(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>);</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>}</div>
</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span> </div>
<div class="foldopen" id="foldopen01641" data-start="{" data-end="}">
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a5d346308124847f8fc36bfd05b5079a3"> 1641</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a5d346308124847f8fc36bfd05b5079a3">TriggerTierUp</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate,</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>                   <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data,</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>                   <span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module = trusted_instance_data-&gt;native_module();</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>  CompilationStateImpl* compilation_state =</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>      Impl(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a07182fe52910a2cd8573302ceb5e624a">compilation_state</a>());</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCompilationUnit.html">WasmCompilationUnit</a> tiering_unit{func_index, ExecutionTier::kTurbofan,</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>                                   <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a11df36d2f23b22c6772f3a5f08731b5ba1874820c42ab45140e0e50e44f8e96d5">kNotForDebugging</a>};</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span> </div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a443a4c6a0f2bedcc6e0ac7f03ece629e">module</a>();</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>  {</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>    <a class="code hl_class" href="classv8_1_1base_1_1SharedMutexGuard.html">base::SharedMutexGuard&lt;base::kExclusive&gt;</a> mutex_guard(</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>        &amp;module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#aceb39daaf893b7024baceccf7571a97d">type_feedback</a>.<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1TypeFeedbackStorage.html#a850d35d90f98dbdc412f91a397c77424">mutex</a>);</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>    <span class="keywordtype">int</span> array_index = wasm::declared_function_index(module, func_index);</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>    trusted_instance_data-&gt;tiering_budget_array()[array_index].store(</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>        <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_tiering_budget, std::memory_order_relaxed);</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>    <span class="keywordtype">int</span>&amp; stored_priority =</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>        <span class="keyword">module</span>-&gt;type_feedback.feedback_for_function[func_index].tierup_priority;</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>    <span class="keywordflow">if</span> (stored_priority &lt; <a class="code hl_variable" href="namespacev8_1_1internal.html#ad03e50e4d15ee0da6a722254f350e7eb">kMaxInt</a>) ++stored_priority;</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a> = stored_priority;</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>  }</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>  <span class="comment">// Only create a compilation unit if this is the first time we detect this</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>  <span class="comment">// function as hot (priority == 1), or if the priority increased</span></div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>  <span class="comment">// significantly. The latter is assumed to be the case if the priority</span></div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>  <span class="comment">// increased at least to four, and is a power of two.</span></div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a> == 2 || !base::bits::IsPowerOfTwo(<a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>)) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span> </div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>  <span class="comment">// Before adding the tier-up unit or increasing priority, process type</span></div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>  <span class="comment">// feedback for best code generation.</span></div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_inlining) {</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    <span class="comment">// TODO(jkummerow): we could have collisions here if different instances</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>    <span class="comment">// of the same module have collected different feedback. If that ever</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>    <span class="comment">// becomes a problem, figure out a solution.</span></div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>    TransitiveTypeFeedbackProcessor::Process(isolate, trusted_instance_data,</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>                                             func_index);</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>  }</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span> </div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>  compilation_state-&gt;AddTopTierPriorityCompilationUnit(tiering_unit, <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>);</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>}</div>
</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span> </div>
<div class="foldopen" id="foldopen01682" data-start="{" data-end="}">
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a19827f93e7ddd7bfc05feb71b9a55407"> 1682</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a19827f93e7ddd7bfc05feb71b9a55407">TierUpNowForTesting</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate,</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>                         <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data,</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>                         <span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module = trusted_instance_data-&gt;native_module();</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_inlining) {</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>    TransitiveTypeFeedbackProcessor::Process(isolate, trusted_instance_data,</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>                                             func_index);</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>  }</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>  wasm::GetWasmEngine()-&gt;CompileFunction(isolate-&gt;counters(), native_module,</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span>                                         func_index,</div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>                                         wasm::ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(!native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a07182fe52910a2cd8573302ceb5e624a">compilation_state</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a2badfff8eee4ca33ffd54ab30ae5b1bf">failed</a>());</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>}</div>
</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span> </div>
<div class="foldopen" id="foldopen01696" data-start="{" data-end="}">
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a5fb16976eb8924e08ec6616b1527f636"> 1696</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a5fb16976eb8924e08ec6616b1527f636">TierUpAllForTesting</a>(</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <a class="code hl_class" href="classv8_1_1internal_1_1Tagged.html">Tagged&lt;WasmTrustedInstanceData&gt;</a> trusted_instance_data) {</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module = trusted_instance_data-&gt;native_module();</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* mod = native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a443a4c6a0f2bedcc6e0ac7f03ece629e">module</a>();</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCodeRefScope.html">WasmCodeRefScope</a> code_ref_scope;</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span> </div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>  uint32_t <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a> = mod-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a81b4b2b056e744758f875acafe4c909a">num_imported_functions</a>;</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>  uint32_t <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a> = <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a> + mod-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a5a60fa14372f7bc06d7d6f51d23b0bee">num_declared_functions</a>;</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>  <span class="keywordflow">for</span> (uint32_t func_index = <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>; func_index &lt; <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>; func_index++) {</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>    <span class="keywordflow">if</span> (!native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a74d82ac97a7bb02ac5781d209ffe2bc5">HasCodeWithTier</a>(func_index, ExecutionTier::kTurbofan)) {</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a19827f93e7ddd7bfc05feb71b9a55407">TierUpNowForTesting</a>(isolate, trusted_instance_data, func_index);</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>    }</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>  }</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>}</div>
</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span> </div>
<div class="foldopen" id="foldopen01711" data-start="{" data-end="}">
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a60a035009507dcad49f342b8e4676bfc"> 1711</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a60a035009507dcad49f342b8e4676bfc">InitializeCompilationForTesting</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module) {</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>  Impl(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a07182fe52910a2cd8573302ceb5e624a">compilation_state</a>())</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>      -&gt;InitializeCompilationProgress(<span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>}</div>
</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span> </div>
<div class="foldopen" id="foldopen01716" data-start="{" data-end="}">
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#ae7a6dc8061ff4f4860d0efa2cca75d9d"> 1716</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ae7a6dc8061ff4f4860d0efa2cca75d9d">PublishDetectedFeatures</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features,</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>                             <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <span class="keywordtype">bool</span> is_initial_compilation) {</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>  <span class="keyword">using </span>Feature = <a class="code hl_enumeration" href="classv8_1_1Isolate.html#aed6909379c3f2820cb3084710b73385d">v8::Isolate::UseCounterFeature</a>;</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> std::pair&lt;WasmDetectedFeature, Feature&gt; kUseCounters[] = {</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>      {WasmDetectedFeature::shared_memory, Feature::kWasmSharedMemory},</div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>      {WasmDetectedFeature::reftypes, Feature::kWasmRefTypes},</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>      {WasmDetectedFeature::simd, Feature::kWasmSimdOpcodes},</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>      {WasmDetectedFeature::threads, Feature::kWasmThreadOpcodes},</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>      {WasmDetectedFeature::legacy_eh, Feature::kWasmExceptionHandling},</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>      {WasmDetectedFeature::memory64, Feature::kWasmMemory64},</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>      {WasmDetectedFeature::multi_memory, Feature::kWasmMultiMemory},</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>      {WasmDetectedFeature::gc, Feature::kWasmGC},</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>      {WasmDetectedFeature::imported_strings, Feature::kWasmImportedStrings},</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>      {WasmDetectedFeature::imported_strings_utf8,</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>       Feature::kWasmImportedStringsUtf8},</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>      {WasmDetectedFeature::return_call, Feature::kWasmReturnCall},</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span>      {WasmDetectedFeature::extended_const, Feature::kWasmExtendedConst},</div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>      {WasmDetectedFeature::relaxed_simd, Feature::kWasmRelaxedSimd},</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>      {WasmDetectedFeature::type_reflection, Feature::kWasmTypeReflection},</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>      {WasmDetectedFeature::exnref, Feature::kWasmExnRef},</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>      {WasmDetectedFeature::typed_funcref, Feature::kWasmTypedFuncRef},</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>      {WasmDetectedFeature::jspi, Feature::kWasmJavaScriptPromiseIntegration},</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>  };</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span> </div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>  <span class="comment">// Check that every staging or shipping feature has a use counter as that is</span></div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>  <span class="comment">// the main point of tracking used features.</span></div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>  <span class="keyword">auto</span> check_use_counter = [](<a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#adfc648b4e5d05b43110df728650e4e4e">WasmDetectedFeature</a> feat) <span class="keyword">constexpr</span> -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>    <span class="comment">// Some features intentionally do not have a use counter.</span></div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>    <span class="keyword">constexpr</span> <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#adfc648b4e5d05b43110df728650e4e4e">WasmDetectedFeature</a> kIntentionallyNoUseCounter[] = {</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>        WasmDetectedFeature::stringref,    <span class="comment">// Deprecated / unlikely to ship.</span></div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>        WasmDetectedFeature::js_inlining,  <span class="comment">// Not a user-visible feature.</span></div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>    };</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> no_use_counter_feature : kIntentionallyNoUseCounter) {</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>      <span class="keywordflow">if</span> (feat == no_use_counter_feature) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>    }</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> [feature, use_counter] : kUseCounters) {</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>      <span class="keywordflow">if</span> (feat == feature) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>    }</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>  };</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span><span class="preprocessor">#define CHECK_USE_COUNTER(feat, ...) \</span></div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span><span class="preprocessor">  static_assert(check_use_counter(WasmDetectedFeature::feat));</span></div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>  <a class="code hl_define" href="wasm-feature-flags_8h.html#a7cdfb27e220029d969e05e0c5dafbe5e">FOREACH_WASM_STAGING_FEATURE_FLAG</a>(<a class="code hl_define" href="module-compiler_8cc.html#aff4abc3a4fa9f8a9d5100a8532691198">CHECK_USE_COUNTER</a>)</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>  <a class="code hl_define" href="wasm-feature-flags_8h.html#ade45dbfc8a894dfb754e489442d41c4a">FOREACH_WASM_SHIPPED_FEATURE_FLAG</a>(<a class="code hl_define" href="module-compiler_8cc.html#aff4abc3a4fa9f8a9d5100a8532691198">CHECK_USE_COUNTER</a>)</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>  <a class="code hl_define" href="wasm-features_8h.html#af51d8ba1d0c550a316bafe40d335ff01">FOREACH_WASM_NON_FLAG_FEATURE</a>(<a class="code hl_define" href="module-compiler_8cc.html#aff4abc3a4fa9f8a9d5100a8532691198">CHECK_USE_COUNTER</a>)</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span><span class="preprocessor">#undef CHECK_USE_COUNTER</span></div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span> </div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> kMaxFeatures = <a class="code hl_define" href="src_2base_2macros_8h.html#ac55fdd6aa61539c49b1b1f5d38a0ed73">arraysize</a>(kUseCounters) + 1;</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>  <a class="code hl_class" href="classv8_1_1base_1_1SmallVector.html">base::SmallVector&lt;Feature, kMaxFeatures&gt;</a> use_counter_features;</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>  <span class="keywordflow">if</span> (is_initial_compilation) {</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    <span class="comment">// Always set the WasmModuleCompilation feature as a baseline for the other</span></div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>    <span class="comment">// features. Note that we also track instantiation, but the number of</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>    <span class="comment">// compilations and instantiations are pretty unrelated.</span></div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>    use_counter_features.<a class="code hl_function" href="classv8_1_1base_1_1SmallVector.html#ad8177749a526ab128a35c4ec8b0cddf7">push_back</a>(Feature::kWasmModuleCompilation);</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>  }</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span> </div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> [wasm_feature, feature] : kUseCounters) {</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>    <span class="keywordflow">if</span> (!detected_features.<a class="code hl_function" href="classv8_1_1base_1_1EnumSet.html#ae4b456a7bb23f2a76c4526748fcc911a">contains</a>(wasm_feature)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    use_counter_features.<a class="code hl_function" href="classv8_1_1base_1_1SmallVector.html#ad8177749a526ab128a35c4ec8b0cddf7">push_back</a>(feature);</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>  }</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>  <span class="keywordflow">if</span> (use_counter_features.<a class="code hl_function" href="classv8_1_1base_1_1SmallVector.html#ac89f2f50c3d6d75b9d2a62c97cd79408">empty</a>()) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span> </div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>  isolate-&gt;CountUsage(base::VectorOf(use_counter_features));</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span> </div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>  <span class="comment">// Help differential fuzzers avoid detecting known/intentional platform-</span></div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span>  <span class="comment">// specific differences.</span></div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.correctness_fuzzer_suppressions) {</div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span>    <span class="keywordflow">if</span> (detected_features.has_relaxed_simd()) {</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>      <a class="code hl_function" href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">PrintF</a>(<span class="stringliteral">&quot;Warning: This run cannot be compared across architectures.\n&quot;</span>);</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>    }</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>  }</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>}</div>
</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span> </div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span> </div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span><span class="keywordtype">bool</span> IsI16Array(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">wasm::ValueType</a> type, <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module) {</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>  <span class="keywordflow">if</span> (!type.is_object_reference() || !type.has_index()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>  ModuleTypeIndex reftype = type.ref_index();</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>  <span class="keywordflow">if</span> (!module-&gt;<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a4d7f2eb3c584f9a7b9d79754dd29a315">has_array</a>(reftype)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>  <span class="keywordflow">return</span> <span class="keyword">module</span>-&gt;canonical_type_id(reftype) ==</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>         TypeCanonicalizer::kPredefinedArrayI16Index;</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>}</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span> </div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span><span class="keywordtype">bool</span> IsI8Array(wasm::ValueType type, <span class="keyword">const</span> WasmModule* module,</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>               <span class="keywordtype">bool</span> allow_nullable) {</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>  <span class="keywordflow">if</span> (!type.is_object_reference() || !type.has_index()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>  <span class="keywordflow">if</span> (!allow_nullable &amp;&amp; type.is_nullable()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>  ModuleTypeIndex reftype = type.ref_index();</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>  <span class="keywordflow">if</span> (!module-&gt;has_array(reftype)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>  <span class="keywordflow">return</span> <span class="keyword">module</span>-&gt;canonical_type_id(reftype) ==</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>         TypeCanonicalizer::kPredefinedArrayI8Index;</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>}</div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span> </div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span><span class="comment">// Returns the start offset of a given import, for use in error messages.</span></div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span><span class="comment">// The module_name payload is preceded by an i32v giving its length. That i32v</span></div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span><span class="comment">// is preceded by another i32v, which is either a type index (specifying the</span></div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span><span class="comment">// type of the previous import) or the imports count (in case of the first</span></div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span><span class="comment">// import). So we scan backwards as long as we find non-last LEB bytes there.</span></div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>uint32_t ImportStartOffset(base::Vector&lt;const uint8_t&gt; wire_bytes,</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>                           uint32_t module_name_start) {</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(0, module_name_start);</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>  uint32_t <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> = module_name_start - 1;  <span class="comment">// Last byte of the string length.</span></div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(wire_bytes[<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>] &amp; 0x80, 0);</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>  <span class="keywordflow">while</span> (<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> &gt; 0 &amp;&amp; (wire_bytes[<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> - 1] &amp; 0x80) != 0) {</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>    <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>--;</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>  }</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>;</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>}</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span> </div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span> </div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span><span class="comment">// Validates the signatures of recognized compile-time imports, and stores</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span><span class="comment">// them on the {module}&#39;s {well_known_imports} list.</span></div>
<div class="foldopen" id="foldopen01829" data-start="{" data-end="}">
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a97644489c4ab86ae3156930153cd1b5e"> 1829</a></span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmError.html">WasmError</a> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a97644489c4ab86ae3156930153cd1b5e">ValidateAndSetBuiltinImports</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module,</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>                                       <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> wire_bytes,</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>                                       <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html">CompileTimeImports</a>&amp; imports,</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>                                       <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a>* detected) {</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a7871ace0ad8518a7de0c52ac35e43eb2">origin</a>, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>);</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>  <span class="keywordflow">if</span> (imports.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#a7bddfd43d06279d0cc613b668aa7e052">empty</a>()) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span> </div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kRefExtern = ValueType::Ref(HeapType::kExtern);</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kExternRef = <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#aed8b0c264ada0ac0e941efbc9bf943a1">kWasmExternRef</a>;</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> = <a class="code hl_variable" href="namespacev8_1_1internal_1_1wasm.html#abe108c96012d3726499466455f359115">kWasmI32</a>;</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span> </div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>  <span class="comment">// Shorthands: &quot;r&quot; = nullable &quot;externref&quot;, &quot;e&quot; = non-nullable &quot;ref extern&quot;.</span></div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kReps_e_i[] = {kRefExtern, <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>};</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kReps_e_rr[] = {kRefExtern, kExternRef,</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>                                             kExternRef};</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kReps_e_rii[] = {kRefExtern, kExternRef, <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>,</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>                                              <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>};</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kReps_i_ri[] = {<a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>, kExternRef, <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>};</div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValueType.html">ValueType</a> kReps_i_rr[] = {<a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>, kExternRef, kExternRef};</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span> </div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_e_i(1, 1, kReps_e_i);</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_e_r(1, 1, kReps_e_rr);</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_e_rr(1, 2, kReps_e_rr);</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_e_rii(1, 3, kReps_e_rii);</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span> </div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_i_r(1, 1, kReps_i_ri);</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_i_ri(1, 2, kReps_i_ri);</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a> kSig_i_rr(1, 2, kReps_i_rr);</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span> </div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>  std::vector&lt;WellKnownImport&gt; statuses;</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>  statuses.reserve(module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a81b4b2b056e744758f875acafe4c909a">num_imported_functions</a>);</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a4f710e1d1dd945669cbebae2b51835e5">import_table</a>.size(); <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmImport.html">WasmImport</a>&amp; <span class="keyword">import</span> = module-&gt;import_table[i];</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span> </div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>    <span class="comment">// When magic string imports are requested, check that imports with the</span></div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>    <span class="comment">// string constant module name are globals of the right type.</span></div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>    <span class="keywordflow">if</span> (imports.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#a3a42250749ca938e52a5116f2e5720eb">has_string_constants</a>(wire_bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a2a7f93a33a4938bd73b628789f214d3d">SubVector</a>(</div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>            <span class="keyword">import</span>.module_name.offset(), <span class="keyword">import</span>.module_name.end_offset()))) {</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>      <span class="keywordflow">if</span> (<span class="keyword">import</span>.kind != <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#acb10c8534fdb3edc15e3f45d7ee6d547a6f3a1cfcc3386739303f7d10b0075ac5">kExternalGlobal</a> ||</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>          !module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#ac6101242a2a805d0e982fff4ddcc4677">globals</a>[<span class="keyword">import</span>.index].type.is_reference_to(</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>              HeapType::kExtern) ||</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>          module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#ac6101242a2a805d0e982fff4ddcc4677">globals</a>[<span class="keyword">import</span>.index].mutability != <span class="keyword">false</span>) {</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>        <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1TruncatedUserString.html">TruncatedUserString&lt;&gt;</a> <a class="code hl_variable" href="api_8cc.html#a0b79990e09c5971befdb526ccfb8deed">name</a>(</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>            wire_bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#adc40a57a246645ccf947f03f5c8dee62">data</a>() + <span class="keyword">import</span>.field_name.offset(),</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>            <span class="keyword">import</span>.field_name.length());</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span>        <span class="keywordflow">return</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmError.html">WasmError</a>(</div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>            ImportStartOffset(wire_bytes, <span class="keyword">import</span>.module_name.offset()),</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>            <span class="stringliteral">&quot;String constant import #%zu \&quot;%.*s\&quot; must be an immutable global &quot;</span></div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>            <span class="stringliteral">&quot;subtyping externref&quot;</span>,</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span>            <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>, name.<a class="code hl_class" href="classlength.html">length</a>(), name.start());</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>      }</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>    }</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span> </div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>    <span class="comment">// Check compile-time imported functions.</span></div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>    <span class="keywordflow">if</span> (<span class="keyword">import</span>.kind != <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#acb10c8534fdb3edc15e3f45d7ee6d547a841c234519f90eb88be0020af3622a4d">kExternalFunction</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> module_name = wire_bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a2a7f93a33a4938bd73b628789f214d3d">SubVector</a>(</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>        <span class="keyword">import</span>.module_name.offset(), <span class="keyword">import</span>.module_name.end_offset());</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>    <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> kMinInterestingLength = 10;</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>    <span class="keywordflow">if</span> (module_name.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a8f91dff816409fb9bceaa94c6caeec32">size</a>() &lt; kMinInterestingLength ||</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>        module_name.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a2a7f93a33a4938bd73b628789f214d3d">SubVector</a>(0, 5) != base::StaticOneByteVector(<span class="stringliteral">&quot;wasm:&quot;</span>)) {</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>      statuses.push_back(WellKnownImport::kUninstantiated);</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>    }</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> collection = module_name.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#aab9b38b61ae9c6ca2c00f0f3f579e088">SubVectorFrom</a>(5);</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6e">WellKnownImport</a> status = WellKnownImport::kUninstantiated;</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html">WasmFunction</a>&amp; func = <span class="keyword">module</span>-&gt;functions[import.index];</div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span>    <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1Signature.html">FunctionSig</a>* <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a> = func.<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html#ab4f3d0ecf1a3e6eab1bb917b4568d547">sig</a>;</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WireBytesRef.html">WireBytesRef</a> field_name = <span class="keyword">import</span>.field_name;</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> name =</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>        wire_bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a2a7f93a33a4938bd73b628789f214d3d">SubVector</a>(field_name.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WireBytesRef.html#a4f2dffb7efc3721571b5f1604d5d448a">offset</a>(), field_name.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WireBytesRef.html#a1853a6fc4a88a37d2bb8a91b58781daf">end_offset</a>());</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>    <span class="keywordflow">if</span> (collection == base::StaticOneByteVector(<span class="stringliteral">&quot;js-string&quot;</span>) &amp;&amp;</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>        imports.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#aa10cbaf2a25c618bfdda0ed3cf4b76da">contains</a>(CompileTimeImport::kJsString)) {</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span><span class="preprocessor">#define RETURN_ERROR(module_name_string, import_name)                     \</span></div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span><span class="preprocessor">  uint32_t error_offset =                                                 \</span></div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span><span class="preprocessor">      ImportStartOffset(wire_bytes, import.module_name.offset());         \</span></div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span><span class="preprocessor">  return WasmError(error_offset,                                          \</span></div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span><span class="preprocessor">                   &quot;Imported builtin function \&quot;wasm:&quot; module_name_string \</span></div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span><span class="preprocessor">                   &quot;\&quot; \&quot;&quot; import_name &quot;\&quot; has incorrect signature&quot;)</span></div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span> </div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span><span class="preprocessor">#define CHECK_SIG(import_name, kSigName, kEnumName)      \</span></div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span><span class="preprocessor">  if (name == base::StaticOneByteVector(#import_name)) { \</span></div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span><span class="preprocessor">    if (*sig != kSigName) {                              \</span></div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span><span class="preprocessor">      RETURN_ERROR(&quot;js-string&quot;, #import_name);           \</span></div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span><span class="preprocessor">    }                                                    \</span></div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span><span class="preprocessor">    status = WellKnownImport::kEnumName;                 \</span></div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span><span class="preprocessor">    detected-&gt;add_imported_strings();                    \</span></div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span><span class="preprocessor">  } else  </span><span class="comment">// NOLINT(readability/braces)</span></div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span> </div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#a8721885a13fdab545fa508803154d20d">cast</a>, kSig_e_r, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eada036082fdf62d64e75d6c2a78977904">kStringCast</a>)</div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(test, kSig_i_r, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eab0a05b1529f7334a8bf654350c064fd1">kStringTest</a>)</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#a2a94af96b48ededb482be8d77265360c">fromCharCode</a>, kSig_e_i, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea3da24690aec2adcb83a65afb07d2a81f">kStringFromCharCode</a>)</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#a64a83922e1e2fa0a4a08d4e89e716389">fromCodePoint</a>, kSig_e_i, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea9e97c9e6af7667c3fe85b7834c4ae470">kStringFromCodePoint</a>)</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#a4b3721456d8a061caa13e8b30f5d4f74">charCodeAt</a>, kSig_i_ri, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eaae69b44fefda9823ba38a5e442454d7e">kStringCharCodeAt</a>)</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#aa002b1b2006b2e38b143b322a892d9ba">codePointAt</a>, kSig_i_ri, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea880a1d9d17a0fea09c4f88e7e3a5b3c8">kStringCodePointAt</a>)</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(length, kSig_i_r, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eac87da7065fd2c38b65c88900f0136159">kStringLength</a>)</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#aecf167532df97fbf5d2f2fa85eda6397">concat</a>, kSig_e_rr, kStringConcat)</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(substring, kSig_e_rii, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea025e1c9f27557f20869f4e447d8e2650">kStringSubstring</a>)</div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#a1ad2b9239773cbd418818106711ed087">equals</a>, kSig_i_rr, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea4458d686d446ba3cb74e46d8c85ba791">kStringEquals</a>)</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>      <a class="code hl_define" href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a>(<a class="code hl_variable" href="random-module-generation_8cc.html#ac36537f594f783ae9323e25e7f8317b2">compare</a>, kSig_i_rr, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea974aaaa059c6fba0dfb3f7e60ca0edc8">kStringCompare</a>)</div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>      <span class="keywordflow">if</span> (name == base::StaticOneByteVector(<span class="stringliteral">&quot;fromCharCodeArray&quot;</span>)) {</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;parameter_count() != 3 || <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;return_count() != 1 ||</div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>            !IsI16Array(<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(0), module) ||  <span class="comment">// --</span></div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(1) != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> ||               <span class="comment">// --</span></div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(2) != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> ||               <span class="comment">// --</span></div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetReturn() != kRefExtern) {</div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span>          <a class="code hl_define" href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a>(<span class="stringliteral">&quot;js-string&quot;</span>, <span class="stringliteral">&quot;fromCharCodeArray&quot;</span>);</div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>        }</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>        detected-&gt;add_imported_strings();</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>        status = WellKnownImport::kStringFromWtf16Array;</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == base::StaticOneByteVector(<span class="stringliteral">&quot;intoCharCodeArray&quot;</span>)) {</div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;parameter_count() != 3 || <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;return_count() != 1 ||</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(0) != kExternRef ||</div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>            !IsI16Array(<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(1), module) ||  <span class="comment">// --</span></div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(2) != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> ||               <span class="comment">// --</span></div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetReturn() != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>) {</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span>          <a class="code hl_define" href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a>(<span class="stringliteral">&quot;js-string&quot;</span>, <span class="stringliteral">&quot;intoCharCodeArray&quot;</span>);</div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>        }</div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>        status = WellKnownImport::kStringToWtf16Array;</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>        detected-&gt;add_imported_strings();</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>      }</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span><span class="preprocessor">#undef CHECK_SIG</span></div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (collection == base::StaticOneByteVector(<span class="stringliteral">&quot;text-encoder&quot;</span>) &amp;&amp;</div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>               imports.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#aa10cbaf2a25c618bfdda0ed3cf4b76da">contains</a>(CompileTimeImport::kTextEncoder)) {</div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span>      <span class="keywordflow">if</span> (name == base::StaticOneByteVector(<span class="stringliteral">&quot;measureStringAsUTF8&quot;</span>)) {</div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>        <span class="keywordflow">if</span> (*<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a> != kSig_i_r) {</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>          <a class="code hl_define" href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a>(<span class="stringliteral">&quot;text-encoder&quot;</span>, <span class="stringliteral">&quot;measureStringAsUTF8&quot;</span>);</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>        }</div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>        status = WellKnownImport::kStringMeasureUtf8;</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span>        detected-&gt;add_imported_strings_utf8();</div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name ==</div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span>                 base::StaticOneByteVector(<span class="stringliteral">&quot;encodeStringIntoUTF8Array&quot;</span>)) {</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;parameter_count() != 3 || <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;return_count() != 1 ||</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(0) != kExternRef ||              <span class="comment">// --</span></div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>            !IsI8Array(<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(1), module, <span class="keyword">true</span>) ||  <span class="comment">// --</span></div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(2) != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> ||                    <span class="comment">// --</span></div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetReturn() != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a>) {</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>          <a class="code hl_define" href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a>(<span class="stringliteral">&quot;text-encoder&quot;</span>, <span class="stringliteral">&quot;encodeStringIntoUTF8Array&quot;</span>);</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>        }</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span>        status = WellKnownImport::kStringIntoUtf8Array;</div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span>        detected-&gt;add_imported_strings_utf8();</div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name == base::StaticOneByteVector(<span class="stringliteral">&quot;encodeStringToUTF8Array&quot;</span>)) {</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;parameter_count() != 1 || <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;return_count() != 1 ||</div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(0) != kExternRef ||</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>            !IsI8Array(<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetReturn(), module, <span class="keyword">false</span>)) {</div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>          <a class="code hl_define" href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a>(<span class="stringliteral">&quot;text-encoder&quot;</span>, <span class="stringliteral">&quot;encodeStringToUTF8Array&quot;</span>);</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>        }</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>        status = WellKnownImport::kStringToUtf8Array;</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>        detected-&gt;add_imported_strings_utf8();</div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>      }</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (collection == base::StaticOneByteVector(<span class="stringliteral">&quot;text-decoder&quot;</span>) &amp;&amp;</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>               imports.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#aa10cbaf2a25c618bfdda0ed3cf4b76da">contains</a>(CompileTimeImport::kTextDecoder)) {</div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>      <span class="keywordflow">if</span> (name == base::StaticOneByteVector(<span class="stringliteral">&quot;decodeStringFromUTF8Array&quot;</span>)) {</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;parameter_count() != 3 || <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;return_count() != 1 ||</div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span>            !IsI8Array(<a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(0), module, <span class="keyword">true</span>) ||  <span class="comment">// --</span></div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(1) != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> ||                    <span class="comment">// --</span></div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetParam(2) != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">kI32</a> ||                    <span class="comment">// --</span></div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>-&gt;GetReturn() != kRefExtern) {</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>          <a class="code hl_define" href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a>(<span class="stringliteral">&quot;text-decoder&quot;</span>, <span class="stringliteral">&quot;decodeStringFromUTF8Array&quot;</span>);</div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>        }</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>        status = WellKnownImport::kStringFromUtf8Array;</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>        detected-&gt;add_imported_strings_utf8();</div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>      }</div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>    }</div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><span class="preprocessor">#undef RETURN_ERROR</span></div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>    statuses.push_back(status);</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>  }</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>  <span class="comment">// We&#39;re operating on a fresh WasmModule instance here, so we don&#39;t need to</span></div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>  <span class="comment">// check for incompatibilities with previously seen imports.</span></div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a81b4b2b056e744758f875acafe4c909a">num_imported_functions</a>, statuses.size());</div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span>  <span class="comment">// The &quot;Initialize&quot; call is currently only safe when the decoder has allocated</span></div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span>  <span class="comment">// storage, which it allocates when there is an imports section.</span></div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span>  <span class="keywordflow">if</span> (module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a81b4b2b056e744758f875acafe4c909a">num_imported_functions</a> != 0) {</div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span>    <span class="keyword">module</span>-&gt;type_feedback.well_known_imports.Initialize(</div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span>        base::VectorOf(statuses));</div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span>  }</div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span>  <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>}</div>
</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span> </div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span> </div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span><span class="keyword">enum</span> CompilationExecutionResult : int8_t { kNoMoreUnits, kYield };</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span> </div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span><span class="keyword">const</span> <span class="keywordtype">char</span>* GetCompilationEventName(<span class="keyword">const</span> WasmCompilationUnit&amp; <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>,</div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>                                    <span class="keyword">const</span> CompilationEnv&amp; env) {</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span>  ExecutionTier tier = <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.tier();</div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>  <span class="keywordflow">if</span> (tier == ExecutionTier::kLiftoff) {</div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;wasm.BaselineCompilation&quot;</span>;</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>  }</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>  <span class="keywordflow">if</span> (tier == ExecutionTier::kTurbofan) {</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;wasm.TopTierCompilation&quot;</span>;</div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>  }</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.func_index() &lt;</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>      <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(env.module-&gt;num_imported_functions)) {</div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;wasm.WasmToJSWrapperCompilation&quot;</span>;</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>  }</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>  <span class="keywordflow">return</span> <span class="stringliteral">&quot;wasm.OtherCompilation&quot;</span>;</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span>}</div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span> </div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span><span class="keyword">constexpr</span> uint8_t kMainTaskId = 0;</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span> </div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span><span class="comment">// Run by the {BackgroundCompileJob} (on any thread).</span></div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>CompilationExecutionResult ExecuteCompilationUnits(</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>    std::weak_ptr&lt;NativeModule&gt; native_module, Counters* counters,</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>    JobDelegate* delegate, CompilationTier tier) {</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, <span class="stringliteral">&quot;wasm.ExecuteCompilationUnits&quot;</span>);</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span> </div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>  <span class="comment">// Compilation must be disabled in jitless mode.</span></div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless);</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span> </div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>  <span class="comment">// These fields are initialized in a {BackgroundCompileScope} before</span></div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>  <span class="comment">// starting compilation.</span></div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>  std::optional&lt;CompilationEnv&gt; env;</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>  std::shared_ptr&lt;WireBytesStorage&gt; wire_bytes;</div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>  std::shared_ptr&lt;const WasmModule&gt; module;</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>  <span class="comment">// Task 0 is any main thread (there might be multiple from multiple isolates),</span></div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>  <span class="comment">// worker threads start at 1 (thus the &quot;+ 1&quot;).</span></div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>  <span class="keyword">static_assert</span>(kMainTaskId == 0);</div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>  <span class="keywordtype">int</span> task_id = delegate ? (<span class="keywordtype">int</span>{delegate-&gt;GetTaskId()} + 1) : kMainTaskId;</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(0, task_id);</div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>  CompilationUnitQueues::Queue* queue;</div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>  std::optional&lt;WasmCompilationUnit&gt; <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>;</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span> </div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>  WasmDetectedFeatures global_detected_features;</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span> </div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span>  <span class="comment">// Preparation (synchronized): Initialize the fields above and get the first</span></div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>  <span class="comment">// compilation unit.</span></div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>  {</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>    BackgroundCompileScope compile_scope(native_module);</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>    <span class="keywordflow">if</span> (compile_scope.cancelled()) <span class="keywordflow">return</span> kYield;</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>    env.emplace(CompilationEnv::ForModule(compile_scope.native_module()));</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span>    wire_bytes = compile_scope.compilation_state()-&gt;GetWireBytesStorage();</div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span>    <span class="keyword">module</span> = compile_scope.native_module()-&gt;shared_module();</div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>    queue = compile_scope.compilation_state()-&gt;GetQueueForCompileTask(task_id);</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>    <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> =</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>        compile_scope.compilation_state()-&gt;GetNextCompilationUnit(queue, tier);</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>) <span class="keywordflow">return</span> kNoMoreUnits;</div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>  }</div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>  <a class="code hl_define" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a>(<span class="stringliteral">&quot;ExecuteCompilationUnits (task id %d)\n&quot;</span>, task_id);</div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span> </div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>  std::vector&lt;WasmCompilationResult&gt; results_to_publish;</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> current_tier = <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;tier();</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* event_name = GetCompilationEventName(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.value(), env.value());</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>    <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, event_name);</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>    <span class="keywordflow">while</span> (<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;tier() == current_tier) {</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>      <span class="comment">// Track detected features on a per-function basis before collecting them</span></div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>      <span class="comment">// into {global_detected_features}.</span></div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span>      WasmDetectedFeatures per_function_detected_features;</div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>      <span class="comment">// (asynchronous): Execute the compilation.</span></div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>      WasmCompilationResult <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> =</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>          <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;ExecuteCompilation(&amp;env.value(), wire_bytes.get(), counters,</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>                                   &amp;per_function_detected_features);</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>      global_detected_features.Add(per_function_detected_features);</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>      <span class="keywordtype">bool</span> compilation_succeeded = <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.succeeded();</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>      <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> result_tier = <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.result_tier;</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>      <span class="comment">// We don&#39;t eagerly compile import wrappers any more.</span></div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a>(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;func_index(), env-&gt;module-&gt;num_imported_functions);</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>      results_to_publish.emplace_back(std::move(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>));</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span> </div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>      <span class="keywordtype">bool</span> yield = delegate &amp;&amp; delegate-&gt;ShouldYield();</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span> </div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>      <span class="comment">// (synchronized): Publish the compilation result and get the next unit.</span></div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>      BackgroundCompileScope compile_scope(native_module);</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>      <span class="keywordflow">if</span> (compile_scope.cancelled()) <span class="keywordflow">return</span> kYield;</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span> </div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>      <span class="keywordflow">if</span> (!compilation_succeeded) {</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span>        compile_scope.compilation_state()-&gt;SetError();</div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>        <span class="keywordflow">return</span> kNoMoreUnits;</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>      }</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span> </div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>      <span class="keywordflow">if</span> (!<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;for_debugging() &amp;&amp; result_tier != current_tier) {</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>        compile_scope.native_module()-&gt;AddLiftoffBailout();</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>      }</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span> </div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>      <span class="comment">// Yield or get next unit.</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>      <span class="keywordflow">if</span> (yield ||</div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>          !(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = compile_scope.compilation_state()-&gt;GetNextCompilationUnit(</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>                queue, tier))) {</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>        std::vector&lt;UnpublishedWasmCode&gt; unpublished_code =</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>            compile_scope.native_module()-&gt;AddCompiledCode(</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span>                base::VectorOf(results_to_publish));</div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>        results_to_publish.clear();</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>        compile_scope.compilation_state()-&gt;SchedulePublishCompilationResults(</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>            std::move(unpublished_code), tier);</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>        compile_scope.compilation_state()-&gt;OnCompilationStopped(</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>            global_detected_features);</div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>        <span class="keywordflow">return</span> yield ? kYield : kNoMoreUnits;</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>      }</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span> </div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>      <span class="comment">// Publish after finishing a certain amount of units, to avoid</span></div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>      <span class="comment">// contention when all threads publish at the end.</span></div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>      <span class="keywordtype">bool</span> batch_full =</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>          queue-&gt;ShouldPublish(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(results_to_publish.size()));</div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>      <span class="comment">// Also publish each time the compilation tier changes from Liftoff to</span></div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>      <span class="comment">// TurboFan, such that we immediately publish the baseline compilation</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>      <span class="comment">// results to start execution, and do not wait for a batch to fill up.</span></div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>      <span class="keywordtype">bool</span> liftoff_finished = <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;tier() != current_tier &amp;&amp;</div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>                              <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>-&gt;tier() == ExecutionTier::kTurbofan;</div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span>      <span class="keywordflow">if</span> (batch_full || liftoff_finished) {</div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>        std::vector&lt;UnpublishedWasmCode&gt; unpublished_code =</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>            compile_scope.native_module()-&gt;AddCompiledCode(</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>                base::VectorOf(results_to_publish));</div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span>        results_to_publish.clear();</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span>        compile_scope.compilation_state()-&gt;SchedulePublishCompilationResults(</div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>            std::move(unpublished_code), tier);</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span>      }</div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span>    }</div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>  }</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>}</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span> </div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span>std::unique_ptr&lt;CompilationUnitBuilder&gt; InitializeCompilation(</div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>    Isolate* isolate, NativeModule* native_module,</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>    ProfileInformation* pgo_info) {</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>  CompilationStateImpl* compilation_state =</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>      Impl(native_module-&gt;compilation_state());</div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>  <span class="keyword">auto</span> builder = std::make_unique&lt;CompilationUnitBuilder&gt;(native_module);</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>  compilation_state-&gt;InitializeCompilationProgress(pgo_info);</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>  <span class="keywordflow">return</span> builder;</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span>}</div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span> </div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span><span class="keywordtype">bool</span> MayCompriseLazyFunctions(<span class="keyword">const</span> WasmModule* module,</div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>                              WasmEnabledFeatures enabled_features) {</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>  <span class="keywordflow">if</span> (IsLazyModule(module)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>  <span class="keywordflow">if</span> (enabled_features.has_compilation_hints()) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span><span class="preprocessor">#ifdef ENABLE_SLOW_DCHECKS</span></div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a> = <span class="keyword">module</span>-&gt;num_imported_functions;</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a> = <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a> + module-&gt;num_declared_functions;</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> func_index = <a class="code hl_variable" href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a>; func_index &lt; <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>; func_index++) {</div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>    <a class="code hl_define" href="checks_8h.html#a8c8b326bb3d6944234eb74fbd0952061">SLOW_DCHECK</a>(GetCompileStrategy(module, enabled_features, func_index,</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>                                   <span class="keyword">false</span>) != CompileStrategy::kLazy);</div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>  }</div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>}</div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span> </div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span><span class="keyword">class </span>CompilationTimeCallback : <span class="keyword">public</span> CompilationEventCallback {</div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span>  <span class="keyword">enum</span> CompileMode { <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a420e377bba6b25b38450dd44912cd5f6a21ed2c08d58afea3d6b70cec9fbc377b">kSynchronous</a>, <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a87c83cc0cb9799c767aaa72c71567680a9f2b960005d2a3a5f35ac32809d84db7">kAsync</a>, kStreaming };</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>  <span class="keyword">explicit</span> CompilationTimeCallback(</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>      std::shared_ptr&lt;Counters&gt; async_counters,</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span>      std::shared_ptr&lt;metrics::Recorder&gt; metrics_recorder,</div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>      <a class="code hl_class" href="classv8_1_1metrics_1_1Recorder_1_1ContextId.html">v8::metrics::Recorder::ContextId</a> context_id,</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span>      std::weak_ptr&lt;NativeModule&gt; native_module, CompileMode compile_mode)</div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a">start_time_</a>(<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a115c48491bb37004f5ac67eb46ac2c23">base</a>::TimeTicks::Now()),</div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(async_counters)),</div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a59dbfc4b198447bb18669932e0122db0">metrics_recorder_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(metrics_recorder)),</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a22b87d0db8ca143a8a7af20e15065940">context_id_</a>(context_id),</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(native_module)),</div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a>(compile_mode) {}</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span> </div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span>  <span class="keywordtype">void</span> call(CompilationEvent compilation_event)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(base::TimeTicks::IsHighResolution());</div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>    std::shared_ptr&lt;NativeModule&gt; native_module = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>.lock();</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span>    <span class="keywordflow">if</span> (!native_module) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>    <span class="keyword">auto</span> now = base::TimeTicks::Now();</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>    <span class="keyword">auto</span> duration = now - <a class="code hl_variable" href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a">start_time_</a>;</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span>    <span class="keywordflow">if</span> (compilation_event == CompilationEvent::kFinishedBaselineCompilation) {</div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>      <span class="comment">// Reset {start_time_} to measure tier-up time.</span></div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a">start_time_</a> = now;</div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a> != kSynchronous) {</div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span>        TimedHistogram* histogram =</div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>            <a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a> == <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a87c83cc0cb9799c767aaa72c71567680a9f2b960005d2a3a5f35ac32809d84db7">kAsync</a></div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>                ? <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>-&gt;wasm_async_compile_wasm_module_time()</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>                : <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>-&gt;wasm_streaming_compile_wasm_module_time();</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>        histogram-&gt;AddSample(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(duration.InMicroseconds()));</div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>      }</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span> </div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>      <a class="code hl_struct" href="structv8_1_1metrics_1_1WasmModuleCompiled.html">v8::metrics::WasmModuleCompiled</a> <span class="keyword">event</span>{</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span>          (<a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a> != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a420e377bba6b25b38450dd44912cd5f6a21ed2c08d58afea3d6b70cec9fbc377b">kSynchronous</a>),         <span class="comment">// async</span></div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span>          (<a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a> == kStreaming),           <span class="comment">// streamed</span></div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>          <span class="keyword">false</span>,                                   <span class="comment">// cached</span></div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>          <span class="keyword">false</span>,                                   <span class="comment">// deserialized</span></div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>          <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation,          <span class="comment">// lazy</span></div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>          <span class="keyword">true</span>,                                    <span class="comment">// success</span></div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>          native_module-&gt;liftoff_code_size(),      <span class="comment">// code_size_in_bytes</span></div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>          native_module-&gt;liftoff_bailout_count(),  <span class="comment">// liftoff_bailout_count</span></div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span>          duration.InMicroseconds()};              <span class="comment">// wall_clock_duration_in_us</span></div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a59dbfc4b198447bb18669932e0122db0">metrics_recorder_</a>-&gt;DelayMainThreadEvent(event, <a class="code hl_variable" href="module-compiler_8cc.html#a22b87d0db8ca143a8a7af20e15065940">context_id_</a>);</div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span>    }</div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>    <span class="keywordflow">if</span> (compilation_event == CompilationEvent::kFailedCompilation) {</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>      <a class="code hl_struct" href="structv8_1_1metrics_1_1WasmModuleCompiled.html">v8::metrics::WasmModuleCompiled</a> <span class="keyword">event</span>{</div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>          (<a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a> != <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a420e377bba6b25b38450dd44912cd5f6a21ed2c08d58afea3d6b70cec9fbc377b">kSynchronous</a>),         <span class="comment">// async</span></div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>          (<a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a> == kStreaming),           <span class="comment">// streamed</span></div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>          <span class="keyword">false</span>,                                   <span class="comment">// cached</span></div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>          <span class="keyword">false</span>,                                   <span class="comment">// deserialized</span></div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>          <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation,          <span class="comment">// lazy</span></div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>          <span class="keyword">false</span>,                                   <span class="comment">// success</span></div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>          native_module-&gt;liftoff_code_size(),      <span class="comment">// code_size_in_bytes</span></div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>          native_module-&gt;liftoff_bailout_count(),  <span class="comment">// liftoff_bailout_count</span></div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span>          duration.InMicroseconds()};              <span class="comment">// wall_clock_duration_in_us</span></div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a59dbfc4b198447bb18669932e0122db0">metrics_recorder_</a>-&gt;DelayMainThreadEvent(event, <a class="code hl_variable" href="module-compiler_8cc.html#a22b87d0db8ca143a8a7af20e15065940">context_id_</a>);</div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>    }</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>  }</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span> </div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a"> 2225</a></span>  base::TimeTicks <a class="code hl_variable" href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a">start_time_</a>;</div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>  <span class="keyword">const</span> std::shared_ptr&lt;Counters&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>;</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a59dbfc4b198447bb18669932e0122db0"> 2227</a></span>  std::shared_ptr&lt;metrics::Recorder&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a59dbfc4b198447bb18669932e0122db0">metrics_recorder_</a>;</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a22b87d0db8ca143a8a7af20e15065940"> 2228</a></span>  <a class="code hl_class" href="classv8_1_1metrics_1_1Recorder_1_1ContextId.html">v8::metrics::Recorder::ContextId</a> <a class="code hl_variable" href="module-compiler_8cc.html#a22b87d0db8ca143a8a7af20e15065940">context_id_</a>;</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>  std::weak_ptr&lt;NativeModule&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f"> 2230</a></span>  <span class="keyword">const</span> CompileMode <a class="code hl_variable" href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a>;</div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>};</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span> </div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span>WasmError <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(<span class="keyword">const</span> WasmModule* module,</div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span>                            base::Vector&lt;const uint8_t&gt; wire_bytes,</div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>                            WasmEnabledFeatures enabled_features,</div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>                            OnlyLazyFunctions only_lazy_functions,</div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>                            WasmDetectedFeatures* detected_features) {</div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(module-&gt;origin, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>);</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>  <span class="keywordflow">if</span> (only_lazy_functions &amp;&amp;</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>      !MayCompriseLazyFunctions(module, enabled_features)) {</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span>  }</div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span> </div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span>  std::function&lt;<a class="code hl_variable" href="namespacev8_1_1internal_1_1compiler.html#a28d08f40d5dc488600051ba2ef537284">bool</a>(<span class="keywordtype">int</span>)&gt; filter;  <span class="comment">// Initially empty for &quot;all functions&quot;.</span></div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span>  <span class="keywordflow">if</span> (only_lazy_functions) {</div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_lazy_module = IsLazyModule(module);</div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>    filter = [module, enabled_features, is_lazy_module](<span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>      CompileStrategy strategy = GetCompileStrategy(module, enabled_features,</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>                                                    func_index, is_lazy_module);</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>      <span class="keywordflow">return</span> strategy == CompileStrategy::kLazy ||</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span>             strategy == CompileStrategy::kLazyBaselineEagerTopTier;</div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>    };</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span>  }</div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>  <span class="comment">// Call {ValidateFunctions} in the module decoder.</span></div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(module, enabled_features, wire_bytes, filter,</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>                           detected_features);</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>}</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span> </div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span>WasmError <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(<span class="keyword">const</span> NativeModule&amp; native_module,</div>
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"> 2260</span>                            OnlyLazyFunctions only_lazy_functions) {</div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span>  WasmDetectedFeatures detected_features;</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span>  WasmError <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> =</div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(native_module.module(), native_module.wire_bytes(),</div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>                        native_module.enabled_features(), only_lazy_functions,</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>                        &amp;detected_features);</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.has_error()) {</div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span>    <span class="comment">// This function is called before the NativeModule is finished; all detected</span></div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span>    <span class="comment">// features will be published afterwards anyway, so ignore the return value</span></div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>    <span class="comment">// here.</span></div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>    <a class="code hl_define" href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a>(native_module.compilation_state()-&gt;UpdateDetectedFeatures(</div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>        detected_features));</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span>  }</div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>;</div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span>}</div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span> </div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span><span class="keywordtype">void</span> CompileNativeModule(Isolate* isolate,</div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>                         <a class="code hl_class" href="classv8_1_1metrics_1_1Recorder_1_1ContextId.html">v8::metrics::Recorder::ContextId</a> context_id,</div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span>                         ErrorThrower* thrower,</div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span>                         std::shared_ptr&lt;NativeModule&gt; native_module,</div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span>                         ProfileInformation* pgo_info) {</div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.jitless || <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless);</div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module = native_module-&gt;module();</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span> </div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span>  <span class="comment">// The callback captures a shared ptr to the semaphore.</span></div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>  <span class="keyword">auto</span>* compilation_state = Impl(native_module-&gt;compilation_state());</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span>  <span class="keywordflow">if</span> (base::TimeTicks::IsHighResolution()) {</div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span>    compilation_state-&gt;AddCallback(std::make_unique&lt;CompilationTimeCallback&gt;(</div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span>        isolate-&gt;async_counters(), isolate-&gt;metrics_recorder(), context_id,</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>        native_module, CompilationTimeCallback::kSynchronous));</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>  }</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span> </div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span>  <span class="comment">// Initialize the compilation units and kick off background compile tasks.</span></div>
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"> 2293</span>  std::unique_ptr&lt;CompilationUnitBuilder&gt; builder =</div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span>      InitializeCompilation(isolate, native_module.get(), pgo_info);</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>  compilation_state-&gt;InitializeCompilationUnits(std::move(builder));</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span> </div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>  <span class="comment">// Validate wasm modules for lazy compilation if requested. Never validate</span></div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>  <span class="comment">// asm.js modules as these are valid by construction (additionally a CHECK</span></div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span>  <span class="comment">// will catch this during lazy compilation).</span></div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation &amp;&amp; module-&gt;origin == kWasmOrigin) {</div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!thrower-&gt;error());</div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>    <span class="keywordflow">if</span> (WasmError validation_error =</div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>            <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(*native_module, kOnlyLazyFunctions)) {</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>      thrower-&gt;CompileFailed(std::move(validation_error));</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span>    }</div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span>  }</div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span> </div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>  <span class="keywordflow">if</span> (!compilation_state-&gt;failed()) {</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>    compilation_state-&gt;WaitForCompilationEvent(</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span>        CompilationEvent::kFinishedBaselineCompilation);</div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span>  }</div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span> </div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>  <span class="keywordflow">if</span> (compilation_state-&gt;failed()) {</div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(IsLazyModule(module), !<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation);</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span>    WasmError validation_error =</div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span>        <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(*native_module, kAllFunctions);</div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(validation_error.has_error());</div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>    thrower-&gt;CompileFailed(std::move(validation_error));</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span>  }</div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>}</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span> </div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span><span class="keyword">class </span>BackgroundCompileJob final : <span class="keyword">public</span> <a class="code hl_typedef" href="namespacecppgc.html#a06ee5a4d448425d5856ef0ba02629834">JobTask</a> {</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span>  <span class="keyword">explicit</span> BackgroundCompileJob(std::weak_ptr&lt;NativeModule&gt; native_module,</div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span>                                std::shared_ptr&lt;Counters&gt; async_counters,</div>
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"> 2327</span>                                CompilationTier tier)</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(native_module)),</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a4fc5a2545cef793618498b58d311c739">engine_barrier_</a>(<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;GetBarrierForBackgroundCompile()),</div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(async_counters)),</div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a67f54021709e2e21e2d5a7173fd1bdd6">tier_</a>(tier) {}</div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span> </div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>  <span class="keywordtype">void</span> Run(JobDelegate* delegate)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span>    <span class="keyword">auto</span> engine_scope = <a class="code hl_variable" href="module-compiler_8cc.html#a4fc5a2545cef793618498b58d311c739">engine_barrier_</a>-&gt;TryLock();</div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>    <span class="keywordflow">if</span> (!engine_scope) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span>    ExecuteCompilationUnits(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>.get(), delegate,</div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span>                            <a class="code hl_variable" href="module-compiler_8cc.html#a67f54021709e2e21e2d5a7173fd1bdd6">tier_</a>);</div>
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"> 2338</span>  }</div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span> </div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span>  <span class="keywordtype">size_t</span> GetMaxConcurrency(<span class="keywordtype">size_t</span> worker_count)<span class="keyword"> const override </span>{</div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span>    BackgroundCompileScope compile_scope(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>);</div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span>    <span class="keywordflow">if</span> (compile_scope.cancelled()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>    <span class="keywordtype">size_t</span> flag_limit = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>        std::max(1, <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_num_compilation_tasks.value()));</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span>    <span class="comment">// NumOutstandingCompilations() does not reflect the units that running</span></div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span>    <span class="comment">// workers are processing, thus add the current worker count to that number.</span></div>
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"> 2347</span>    <span class="keywordflow">return</span> std::min(flag_limit,</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>                    worker_count + compile_scope.compilation_state()</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span>                                       -&gt;NumOutstandingCompilations(<a class="code hl_variable" href="module-compiler_8cc.html#a67f54021709e2e21e2d5a7173fd1bdd6">tier_</a>));</div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>  }</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span> </div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span>  std::weak_ptr&lt;NativeModule&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a4fc5a2545cef793618498b58d311c739"> 2354</a></span>  std::shared_ptr&lt;OperationsBarrier&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a4fc5a2545cef793618498b58d311c739">engine_barrier_</a>;</div>
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"> 2355</span>  <span class="keyword">const</span> std::shared_ptr&lt;Counters&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>;</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"><a class="line" href="module-compiler_8cc.html#a67f54021709e2e21e2d5a7173fd1bdd6"> 2356</a></span>  <span class="keyword">const</span> CompilationTier <a class="code hl_variable" href="module-compiler_8cc.html#a67f54021709e2e21e2d5a7173fd1bdd6">tier_</a>;</div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span>};</div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span> </div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span>std::shared_ptr&lt;NativeModule&gt; GetOrCompileNewNativeModule(</div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span>    Isolate* isolate, WasmEnabledFeatures enabled_features,</div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>    WasmDetectedFeatures detected_features, CompileTimeImports compile_imports,</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span>    ErrorThrower* thrower, std::shared_ptr&lt;const WasmModule&gt; module,</div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>    base::OwnedVector&lt;const uint8_t&gt; wire_bytes, <span class="keywordtype">int</span> compilation_id,</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span>    <a class="code hl_class" href="classv8_1_1metrics_1_1Recorder_1_1ContextId.html">v8::metrics::Recorder::ContextId</a> context_id, ProfileInformation* pgo_info) {</div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span>  std::shared_ptr&lt;NativeModule&gt; native_module =</div>
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"> 2366</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a26391b903e117ed93787d080f0bc2fe4">MaybeGetNativeModule</a>(</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>          module-&gt;origin, wire_bytes.as_vector(), compile_imports, isolate);</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span>  <span class="keywordflow">if</span> (native_module) <span class="keywordflow">return</span> native_module;</div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span> </div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span>  <span class="comment">// Otherwise compile a new NativeModule.</span></div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span>  std::optional&lt;TimedHistogramScope&gt; wasm_compile_module_time_scope;</div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>  <span class="keywordflow">if</span> (base::TimeTicks::IsHighResolution()) {</div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span>    wasm_compile_module_time_scope.emplace(<a class="code hl_define" href="wasm-module_8h.html#a97da966b01775707b360f5ace2370c0e">SELECT_WASM_COUNTER</a>(</div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>        isolate-&gt;counters(), module-&gt;origin, wasm_compile, module_time));</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span>  }</div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span> </div>
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"> 2377</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> include_liftoff =</div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>      <span class="keyword">module</span>-&gt;origin == kWasmOrigin &amp;&amp; v8_flags.liftoff;</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span>  <span class="keywordtype">size_t</span> code_size_estimate =</div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>      wasm::WasmCodeManager::EstimateNativeModuleCodeSize(</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span>          module.get(), include_liftoff,</div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span>          DynamicTiering{v8_flags.wasm_dynamic_tiering.value()});</div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>  native_module = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ac7a8ec2f950e76dfa9e2ec483c15a372">NewNativeModule</a>(</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span>      isolate, enabled_features, detected_features, std::move(compile_imports),</div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>      module, code_size_estimate);</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span>  native_module-&gt;SetWireBytes(std::move(wire_bytes));</div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span>  native_module-&gt;compilation_state()-&gt;set_compilation_id(compilation_id);</div>
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"> 2388</span> </div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>    <span class="comment">// Compile / validate the new module.</span></div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span>    CompileNativeModule(isolate, context_id, thrower, native_module, pgo_info);</div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span>  }</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span> </div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span>  <span class="keywordflow">if</span> (thrower-&gt;error()) {</div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span>    <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ae049eb40219a3e542bf2811e42ac1bb8">UpdateNativeModuleCache</a>(<span class="keyword">true</span>, std::move(native_module),</div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span>                                             isolate);</div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span>  }</div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span> </div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>  <span class="comment">// Finally, put the new module in the cache; this can return the passed</span></div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span>  <span class="comment">// NativeModule pointer, or another one (for a previously cached module).</span></div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ae049eb40219a3e542bf2811e42ac1bb8">UpdateNativeModuleCache</a>(<span class="keyword">false</span>, native_module,</div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span>                                                  isolate);</div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>}</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span> </div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span> </div>
<div class="foldopen" id="foldopen02408" data-start="{" data-end="}">
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a967972baab540f22d49f12d2fae66b46"> 2408</a></span>std::shared_ptr&lt;NativeModule&gt; <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a967972baab540f22d49f12d2fae66b46">CompileToNativeModule</a>(</div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmEnabledFeatures.html">WasmEnabledFeatures</a> enabled_features,</div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features, <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html">CompileTimeImports</a> compile_imports,</div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html">ErrorThrower</a>* thrower, std::shared_ptr&lt;const WasmModule&gt; module,</div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span>    <a class="code hl_class" href="classv8_1_1base_1_1OwnedVector.html">base::OwnedVector&lt;const uint8_t&gt;</a> wire_bytes, <span class="keywordtype">int</span> compilation_id,</div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span>    <a class="code hl_class" href="classv8_1_1metrics_1_1Recorder_1_1ContextId.html">v8::metrics::Recorder::ContextId</a> context_id, <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ProfileInformation.html">ProfileInformation</a>* pgo_info) {</div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span>  std::shared_ptr&lt;NativeModule&gt; native_module = GetOrCompileNewNativeModule(</div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span>      isolate, enabled_features, detected_features, std::move(compile_imports),</div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span>      thrower, module, std::move(wire_bytes), compilation_id, context_id,</div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>      pgo_info);</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span>  <span class="keywordflow">if</span> (!native_module) <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span> </div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span>  <span class="comment">// Ensure that the code objects are logged before returning.</span></div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>  <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a80a2af861380fd22a236025164b81737">LogOutstandingCodesForIsolate</a>(isolate);</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span> </div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span>  <span class="comment">// Now publish all detected features of this module in the current isolate.</span></div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span>  <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ae7a6dc8061ff4f4860d0efa2cca75d9d">PublishDetectedFeatures</a>(</div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span>      native_module-&gt;compilation_state()-&gt;detected_features(), isolate, <span class="keyword">true</span>);</div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span> </div>
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"> 2427</span>  <span class="keywordflow">return</span> native_module;</div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span>}</div>
</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span> </div>
<div class="foldopen" id="foldopen02430" data-start="{" data-end="}">
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3404727e5cda0afe92bc8c4d08fa0454"> 2430</a></span>AsyncCompileJob::AsyncCompileJob(</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate, <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmEnabledFeatures.html">WasmEnabledFeatures</a> enabled_features,</div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html">CompileTimeImports</a> compile_imports, <a class="code hl_class" href="classv8_1_1base_1_1OwnedVector.html">base::OwnedVector&lt;const uint8_t&gt;</a> bytes,</div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span>    <a class="code hl_class" href="classv8_1_1internal_1_1DirectHandle.html">DirectHandle&lt;Context&gt;</a> <a class="code hl_variable" href="js-call-reducer_8cc.html#a0835767fe473cead88c1afdf3175bce8">context</a>,</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span>    <a class="code hl_class" href="classv8_1_1internal_1_1DirectHandle.html">DirectHandle&lt;NativeContext&gt;</a> incumbent_context, <span class="keyword">const</span> <span class="keywordtype">char</span>* api_method_name,</div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span>    std::shared_ptr&lt;CompilationResultResolver&gt; resolver, <span class="keywordtype">int</span> compilation_id)</div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span>    : <a class="code hl_variable" href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a>(isolate),</div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span>      api_method_name_(api_method_name),</div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span>      <a class="code hl_variable" href="module-decoder_8cc.html#a288adc12dc38d2126f4ebbb0b1595788">enabled_features_</a>(enabled_features),</div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span>      compile_imports_(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(compile_imports)),</div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a>(<a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">DynamicTiering</a>{<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_dynamic_tiering.value()}),</div>
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"> 2441</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a">start_time_</a>(<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a115c48491bb37004f5ac67eb46ac2c23">base</a>::TimeTicks::Now()),</div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span>      bytes_copy_(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(bytes)),</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span>      <a class="code hl_variable" href="module-decoder_8cc.html#a26f77f4247dd0ac0b1f91ae3212af4cc">wire_bytes_</a>(bytes_copy_.as_vector()),</div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span>      <a class="code hl_variable" href="gc-extension_8cc.html#a00fa11a25071aa074f09fb8376ba359f">resolver_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(resolver)),</div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>      <a class="code hl_variable" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a>(compilation_id) {</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<a class="code hl_define" href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a>(<span class="stringliteral">&quot;v8.wasm.detailed&quot;</span>),</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span>               <span class="stringliteral">&quot;wasm.AsyncCompileJob&quot;</span>);</div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_async_compilation);</div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.jitless || <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless);</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>  <a class="code hl_class" href="classv8_1_1Isolate.html">v8::Isolate</a>* v8_isolate = <span class="keyword">reinterpret_cast&lt;</span><a class="code hl_class" href="classv8_1_1Isolate.html">v8::Isolate</a>*<span class="keyword">&gt;</span>(<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0c031fff1a73728be15eea6c0a576e85">isolate</a>);</div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span>  <a class="code hl_class" href="classv8_1_1Platform.html">v8::Platform</a>* platform = <a class="code hl_function" href="classv8_1_1internal_1_1V8.html#a5eb1d47c492fa1e85e7d7c31dd5cf2bb">V8::GetCurrentPlatform</a>();</div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a60c83d8ce32a32ad052ad7a308c64d6c">foreground_task_runner_</a> = platform-&gt;<a class="code hl_function" href="classv8_1_1Platform.html#ad820bea109ed527e917bf042daf82ac0">GetForegroundTaskRunner</a>(v8_isolate);</div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a> =</div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span>      isolate-&gt;global_handles()-&gt;Create(<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#aa6f6ab41891c7f7149927275445fe100">context</a>-&gt;native_context());</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4dff42fd647b975ce6708820a34fffe2">incumbent_context_</a> = isolate-&gt;global_handles()-&gt;Create(*incumbent_context);</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(IsNativeContext(*<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a>));</div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5d62877a0c3d97edb19bcefa2e452c57">context_id_</a> = isolate-&gt;GetOrRegisterRecorderContextId(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a>);</div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>.<a class="code hl_variable" href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a1ab324a8f990e43dc13988c126633619">async</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>}</div>
</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span> </div>
<div class="foldopen" id="foldopen02461" data-start="{" data-end="}">
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0a4a22d3cbec712dad3fe9a6c3846106"> 2461</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0a4a22d3cbec712dad3fe9a6c3846106">AsyncCompileJob::Start</a>() {</div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#add267630191de419bf4467180a938b3b">DoAsync&lt;DecodeModule&gt;</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a267e21e771e72483e74bf9c13c9cd267">counters</a>(),</div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>                        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#ae2a2e88c3939f4c98fbb0fb2d91f26a7">metrics_recorder</a>());  <span class="comment">// --</span></div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span>}</div>
</div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span> </div>
<div class="foldopen" id="foldopen02466" data-start="{" data-end="}">
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1969624508b5f667f28f0bb9ff9dfb1a"> 2466</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1969624508b5f667f28f0bb9ff9dfb1a">AsyncCompileJob::Abort</a>() {</div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span>  <span class="comment">// Removing this job will trigger the destructor, which will cancel all</span></div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span>  <span class="comment">// compilation.</span></div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>  <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a8378f5ecdd236147a0b3c590c12899b8">RemoveCompileJob</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span>}</div>
</div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span> </div>
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"> 2472</span><span class="comment">// {ValidateFunctionsStreamingJobData} holds information that is shared between</span></div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span><span class="comment">// the {AsyncStreamingProcessor} and the {ValidateFunctionsStreamingJob}. It</span></div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span><span class="comment">// lives in the {AsyncStreamingProcessor} and is updated from both classes.</span></div>
<div class="foldopen" id="foldopen02475" data-start="{" data-end="};">
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html"> 2475</a></span><span class="keyword">struct </span><a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html">ValidateFunctionsStreamingJobData</a> {</div>
<div class="foldopen" id="foldopen02476" data-start="{" data-end="};">
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html"> 2476</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a> {</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span>    <span class="comment">// {func_index == -1} represents an &quot;invalid&quot; unit.</span></div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#aee8a6605ef805e75bf5ee61c0f638e7d"> 2478</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#aee8a6605ef805e75bf5ee61c0f638e7d">func_index</a> = -1;</div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#a1aa9923e94571d28a762b1a20f6c753b"> 2479</a></span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#a1aa9923e94571d28a762b1a20f6c753b">code</a>;</div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span> </div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span>    <span class="comment">// Check whether the unit is valid.</span></div>
<div class="foldopen" id="foldopen02482" data-start="{" data-end="}">
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#a77e3afe5124de9bc592adbf75febd316"> 2482</a></span>    <span class="keyword">operator</span> <a class="code hl_variable" href="namespacev8_1_1internal.html#a4e2118a7c0d730210e0cb87b511cba70">bool</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(-1, <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#aee8a6605ef805e75bf5ee61c0f638e7d">func_index</a>);</div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>      <span class="keywordflow">return</span> <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#aee8a6605ef805e75bf5ee61c0f638e7d">func_index</a> &gt;= 0;</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>    }</div>
</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span>  };</div>
</div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span> </div>
<div class="foldopen" id="foldopen02488" data-start="{" data-end="}">
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a30537e9b0e0f4d0160b17f97f2ceed43"> 2488</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a30537e9b0e0f4d0160b17f97f2ceed43">Initialize</a>(<span class="keywordtype">int</span> num_declared_functions) {</div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>);</div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>    <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a> = <a class="code hl_function" href="classv8_1_1base_1_1OwnedVector.html#affe5e36cb00bedefbfee8762910e34d0">base::OwnedVector&lt;Unit&gt;::NewForOverwrite</a>(num_declared_functions);</div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span>    <span class="comment">// Initially {next == end}.</span></div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span>    <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">next_available_unit</a>.store(<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>.begin(), std::memory_order_relaxed);</div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span>    <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">end_of_available_units</a>.store(<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>.begin(), std::memory_order_relaxed);</div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span>  }</div>
</div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span> </div>
<div class="foldopen" id="foldopen02496" data-start="{" data-end="}">
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aea4d7941a772b26e34a901b0e3dad6c9"> 2496</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aea4d7941a772b26e34a901b0e3dad6c9">AddUnit</a>(<span class="keywordtype">int</span> declared_func_index, <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> code,</div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span>               <a class="code hl_class" href="classv8_1_1JobHandle.html">JobHandle</a>* job_handle) {</div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>);</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>    <span class="comment">// Write new unit to {*end}, then increment {end}. There is only one thread</span></div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span>    <span class="comment">// adding new units, so no further synchronization needed.</span></div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a>* ptr = <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">end_of_available_units</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span>    <span class="comment">// Check invariant: {next &lt;= end}.</span></div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">next_available_unit</a>.load(std::memory_order_relaxed), ptr);</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>    *ptr++ = {declared_func_index, code};</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>    <span class="comment">// Use release semantics, so whoever loads this pointer (using acquire</span></div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span>    <span class="comment">// semantics) sees all our previous stores.</span></div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>    <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">end_of_available_units</a>.store(ptr, std::memory_order_release);</div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>    <span class="keywordtype">size_t</span> total_units_added = ptr - <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>.begin();</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>    <span class="comment">// Periodically notify concurrency increase. This has overhead, so avoid</span></div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span>    <span class="comment">// calling it too often. As long as threads are still running they will</span></div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span>    <span class="comment">// continue processing new units anyway, and if background threads validate</span></div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span>    <span class="comment">// faster than we can add units, then only notifying after increasingly long</span></div>
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"> 2513</span>    <span class="comment">// delays is the right thing to do to avoid too many small validation tasks.</span></div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span>    <span class="comment">// We notify on each power of two after 16 units, and every 16k units (just</span></div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>    <span class="comment">// to have *some* upper limit and avoiding to pile up too many units).</span></div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>    <span class="comment">// Additionally, notify after receiving the last unit of the module.</span></div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span>    <span class="keywordflow">if</span> ((total_units_added &gt;= 16 &amp;&amp;</div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span>         <a class="code hl_function" href="namespacev8_1_1base_1_1bits.html#a4d06086712ebcd60838caae1a21fcfa3">base::bits::IsPowerOfTwo</a>(total_units_added)) ||</div>
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"> 2519</span>        (total_units_added % (16 * 1024)) == 0 || ptr == <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>.end()) {</div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span>      job_handle-&gt;<a class="code hl_function" href="classv8_1_1JobHandle.html#a3c6d3e309521026696e24f36438520a5">NotifyConcurrencyIncrease</a>();</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span>    }</div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>  }</div>
</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span> </div>
<div class="foldopen" id="foldopen02524" data-start="{" data-end="}">
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a82498d65506cdd9a96e15cbc43061da0"> 2524</a></span>  <span class="keywordtype">size_t</span> <a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a82498d65506cdd9a96e15cbc43061da0">NumOutstandingUnits</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a>* next = <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">next_available_unit</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a>* <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a> = <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">end_of_available_units</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(next, <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>);</div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a> - next;</div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span>  }</div>
</div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span> </div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>  <span class="comment">// Retrieve one unit to validate; returns an &quot;invalid&quot; unit if nothing is in</span></div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span>  <span class="comment">// the queue.</span></div>
<div class="foldopen" id="foldopen02533" data-start="{" data-end="}">
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aa3640734bcf13379124fb8a689e3865f"> 2533</a></span>  <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a> <a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aa3640734bcf13379124fb8a689e3865f">GetUnit</a>() {</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span>    <span class="comment">// Use an acquire load to synchronize with the store in {AddUnit}. All units</span></div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>    <span class="comment">// before this {end} are fully initialized and ready to execute.</span></div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a>* <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a> = <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">end_of_available_units</a>.load(std::memory_order_acquire);</div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">Unit</a>* next = <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">next_available_unit</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>    <span class="keywordflow">while</span> (next &lt; <a class="code hl_variable" href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a>) {</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">next_available_unit</a>.compare_exchange_weak(</div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>              next, next + 1, std::memory_order_relaxed)) {</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span>        <span class="keywordflow">return</span> *next;</div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span>      }</div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>      <span class="comment">// Otherwise retry with updated {next} pointer.</span></div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>    }</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>    <span class="keywordflow">return</span> {};</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span>  }</div>
</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span> </div>
<div class="foldopen" id="foldopen02548" data-start="{" data-end="}">
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a5552012797ffa8222c56b7b65fcc4c45"> 2548</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a5552012797ffa8222c56b7b65fcc4c45">UpdateDetectedFeatures</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> new_detected_features) {</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> old_features =</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>        <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#ace23482eb9e8803b07a5f797fb9a0985">detected_features</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span>    <span class="keywordflow">while</span> (!<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#ace23482eb9e8803b07a5f797fb9a0985">detected_features</a>.compare_exchange_weak(</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>        old_features, old_features | new_detected_features,</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span>        std::memory_order_relaxed)) {</div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span>      <span class="comment">// Retry with updated {old_features}.</span></div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span>    }</div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span>  }</div>
</div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span> </div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92"> 2558</a></span>  <a class="code hl_class" href="classv8_1_1base_1_1OwnedVector.html">base::OwnedVector&lt;Unit&gt;</a> <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">units</a>;</div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705"> 2559</a></span>  std::atomic&lt;Unit*&gt; <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">next_available_unit</a>;</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc"> 2560</a></span>  std::atomic&lt;Unit*&gt; <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">end_of_available_units</a>;</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a9cfdfc887c8e71d8e6f5e70352b372c2"> 2561</a></span>  std::atomic&lt;bool&gt; <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a9cfdfc887c8e71d8e6f5e70352b372c2">found_error</a>{<span class="keyword">false</span>};</div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"><a class="line" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#ace23482eb9e8803b07a5f797fb9a0985"> 2562</a></span>  std::atomic&lt;WasmDetectedFeatures&gt; <a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#ace23482eb9e8803b07a5f797fb9a0985">detected_features</a>;</div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>};</div>
</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span> </div>
<div class="foldopen" id="foldopen02565" data-start="{" data-end="};">
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html"> 2565</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html">ValidateFunctionsStreamingJob</a> final : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1JobTask.html">JobTask</a> {</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen02567" data-start="{" data-end="}">
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aaa06eba946895bf88516bb729e8c732f"> 2567</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aaa06eba946895bf88516bb729e8c732f">ValidateFunctionsStreamingJob</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module,</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span>                                <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmEnabledFeatures.html">WasmEnabledFeatures</a> enabled_features,</div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span>                                <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html">ValidateFunctionsStreamingJobData</a>* data)</div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span>      : <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac6923ee5bb39b2a4b6475d72e8db7183">module_</a>(module), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a595f738885e4ddc54dfbee0facb094d6">enabled_features_</a>(enabled_features), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">data_</a>(data) {}</div>
</div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span> </div>
<div class="foldopen" id="foldopen02572" data-start="{" data-end="}">
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a5d40c7e666a805a418e6d6d3d7c8d8ee"> 2572</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a5d40c7e666a805a418e6d6d3d7c8d8ee">Run</a>(<a class="code hl_class" href="classv8_1_1JobDelegate.html">JobDelegate</a>* delegate)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>    <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, <span class="stringliteral">&quot;wasm.ValidateFunctionsStreaming&quot;</span>);</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span>    <span class="keyword">using </span>Unit = <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">ValidateFunctionsStreamingJobData::Unit</a>;</div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>    <a class="code hl_class" href="classv8_1_1internal_1_1Zone.html">Zone</a> validation_zone{<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a33108f98a3342746166d6242b9c7b072">allocator</a>(), <a class="code hl_define" href="zone_8h.html#a6b1fd0a126df3f1b788cee19d9cce66e">ZONE_NAME</a>};</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features;</div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>    <span class="keywordflow">while</span> (Unit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a> = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">data_</a>-&gt;<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aa3640734bcf13379124fb8a689e3865f">GetUnit</a>()) {</div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>      validation_zone.Reset();</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span>      <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">DecodeResult</a> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = ValidateSingleFunction(</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span>          &amp;validation_zone, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac6923ee5bb39b2a4b6475d72e8db7183">module_</a>, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.func_index, <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>.<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#abee9ee3ec87853b99da8df1432ce7f4d">code</a>,</div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a595f738885e4ddc54dfbee0facb094d6">enabled_features_</a>, &amp;detected_features);</div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span> </div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.failed()) {</div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">data_</a>-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a9cfdfc887c8e71d8e6f5e70352b372c2">found_error</a>.store(<span class="keyword">true</span>, std::memory_order_relaxed);</div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>      }</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span>      <span class="comment">// After validating one function, check if we should yield.</span></div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>      <span class="keywordflow">if</span> (delegate-&gt;<a class="code hl_function" href="classv8_1_1JobDelegate.html#a7180a73d20fc8a240c742163001d8b3a">ShouldYield</a>()) <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>    }</div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span> </div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">data_</a>-&gt;<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a5552012797ffa8222c56b7b65fcc4c45">UpdateDetectedFeatures</a>(detected_features);</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>  }</div>
</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span> </div>
<div class="foldopen" id="foldopen02594" data-start="{" data-end="}">
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac9bebc6c772148aee5f452ca0aea569a"> 2594</a></span>  <span class="keywordtype">size_t</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac9bebc6c772148aee5f452ca0aea569a">GetMaxConcurrency</a>(<span class="keywordtype">size_t</span> worker_count)<span class="keyword"> const override </span>{</div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span>    <span class="keywordflow">return</span> worker_count + <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">data_</a>-&gt;<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a82498d65506cdd9a96e15cbc43061da0">NumOutstandingUnits</a>();</div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span>  }</div>
</div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span> </div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac6923ee5bb39b2a4b6475d72e8db7183"> 2599</a></span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* <span class="keyword">const</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac6923ee5bb39b2a4b6475d72e8db7183">module_</a>;</div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a595f738885e4ddc54dfbee0facb094d6"> 2600</a></span>  <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmEnabledFeatures.html">WasmEnabledFeatures</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a595f738885e4ddc54dfbee0facb094d6">enabled_features_</a>;</div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310"> 2601</a></span>  <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html">ValidateFunctionsStreamingJobData</a>* <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">data_</a>;</div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>};</div>
</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span> </div>
<div class="foldopen" id="foldopen02604" data-start="{" data-end="};">
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html"> 2604</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html">AsyncStreamingProcessor</a> final : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1StreamingProcessor.html">StreamingProcessor</a> {</div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>  <span class="keyword">explicit</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a9da068ebd21214867da972e51689bee5">AsyncStreamingProcessor</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job);</div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span> </div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aee9a0b6fb579488ab89cc95ea9e6caef">ProcessModuleHeader</a>(<a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> bytes) <span class="keyword">override</span>;</div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span> </div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aac7514bd78200ea2d33761023d266de4">ProcessSection</a>(<a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a42a2fc870f8946e6ffe986e629a5693b">SectionCode</a> section_code,</div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span>                      <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> bytes,</div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span>                      uint32_t <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>) <span class="keyword">override</span>;</div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span> </div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a707cf5b73e892c3ddd7b74cef826c429">ProcessCodeSectionHeader</a>(<span class="keywordtype">int</span> num_functions,</div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span>                                uint32_t functions_mismatch_error_offset,</div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span>                                std::shared_ptr&lt;WireBytesStorage&gt;,</div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span>                                <span class="keywordtype">int</span> code_section_start,</div>
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"> 2618</span>                                <span class="keywordtype">int</span> code_section_length) <span class="keyword">override</span>;</div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span> </div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aa26940dbb1434275daab70cdf12e8326">ProcessFunctionBody</a>(<a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> bytes,</div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span>                           uint32_t <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>) <span class="keyword">override</span>;</div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span> </div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a19842d57ed6e47f88fc3ccb57cd43619">OnFinishedChunk</a>() <span class="keyword">override</span>;</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span> </div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a1299b61f757fe2cfa5ec698e755650e0">OnFinishedStream</a>(<a class="code hl_class" href="classv8_1_1base_1_1OwnedVector.html">base::OwnedVector&lt;const uint8_t&gt;</a> bytes,</div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span>                        <span class="keywordtype">bool</span> after_error) <span class="keyword">override</span>;</div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span> </div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a807224ecf5ba4eaf8434dea9b99a78a8">OnAbort</a>() <span class="keyword">override</span>;</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span> </div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span>  <span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac33024dbe8bff894aec911642a350dc6">Deserialize</a>(<a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> wire_bytes,</div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span>                   <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> module_bytes) <span class="keyword">override</span>;</div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span> </div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ae4c1a9be1a289f121f11888233dc2065">CommitCompilationUnits</a>();</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span> </div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529"> 2636</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html">ModuleDecoder</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>;</div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240"> 2637</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>;</div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3"> 2638</a></span>  std::unique_ptr&lt;CompilationUnitBuilder&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>;</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3"> 2639</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">num_functions_</a> = 0;</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aef24faaab0279a141c00469c1e66b617"> 2640</a></span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aef24faaab0279a141c00469c1e66b617">prefix_cache_hit_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a41aab3efc6dfb1d49db122d8d43176f6"> 2641</a></span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a41aab3efc6dfb1d49db122d8d43176f6">before_code_section_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1"> 2642</a></span>  <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html">ValidateFunctionsStreamingJobData</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">validate_functions_job_data_</a>;</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908"> 2643</a></span>  std::unique_ptr&lt;JobHandle&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>;</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span> </div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span>  <span class="comment">// {prefix_hasher_} computes a running hash of the wire bytes up to code</span></div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span>  <span class="comment">// section size, but excludes the code section itself. Used by the</span></div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span>  <span class="comment">// {NativeModuleCache} to detect potential duplicate modules.</span></div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f"> 2648</a></span>  <a class="code hl_class" href="classv8_1_1base_1_1Hasher.html">base::Hasher</a> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>;</div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span>};</div>
</div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span> </div>
<div class="foldopen" id="foldopen02651" data-start="{" data-end="}">
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5323277e186f3ae7566581ed5e08e518"> 2651</a></span>std::shared_ptr&lt;StreamingDecoder&gt; <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5323277e186f3ae7566581ed5e08e518">AsyncCompileJob::CreateStreamingDecoder</a>() {</div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>);</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a> = <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1StreamingDecoder.html#a64bbde97cda65ad78a00333670c8fb05">StreamingDecoder::CreateAsyncStreamingDecoder</a>(</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span>      std::make_unique&lt;AsyncStreamingProcessor&gt;(<span class="keyword">this</span>));</div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>;</div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>}</div>
</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span> </div>
<div class="foldopen" id="foldopen02658" data-start="{" data-end="}">
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a9b511b12a269d1a9e7e8b50cfdce26a9"> 2658</a></span><a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a9b511b12a269d1a9e7e8b50cfdce26a9">AsyncCompileJob::~AsyncCompileJob</a>() {</div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span>  <span class="comment">// Note: This destructor always runs on the foreground thread of the isolate.</span></div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a32567b0fa26ffcea6e894c54e5bbbc94">background_task_manager_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1CancelableTaskManager.html#a3c90c3d841ccd5255387b37fcfbc03c0">CancelAndWait</a>();</div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span>  <span class="comment">// If initial compilation did not finish yet we can abort it.</span></div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>) {</div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span>    Impl(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state())</div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span>        -&gt;CancelCompilation(CompilationStateImpl::kCancelInitialCompilation);</div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span>  }</div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>  <span class="comment">// Tell the streaming decoder that the AsyncCompileJob is not available</span></div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>  <span class="comment">// anymore.</span></div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>) <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>-&gt;NotifyCompilationDiscarded();</div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#aa84200caacc713311e166e63a9b3759f">CancelPendingForegroundTask</a>();</div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a0567c99c2a3ff016df9e7abb30688075">global_handles</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1GlobalHandles.html#a1a31391c097b88af06b7e0cf673bcf00">Destroy</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a>.location());</div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a0567c99c2a3ff016df9e7abb30688075">global_handles</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1GlobalHandles.html#a1a31391c097b88af06b7e0cf673bcf00">Destroy</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4dff42fd647b975ce6708820a34fffe2">incumbent_context_</a>.location());</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>.is_null()) {</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a0567c99c2a3ff016df9e7abb30688075">global_handles</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1GlobalHandles.html#a1a31391c097b88af06b7e0cf673bcf00">Destroy</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>.location());</div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span>  }</div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>}</div>
</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span> </div>
<div class="foldopen" id="foldopen02677" data-start="{" data-end="}">
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adef95f093ae1dc1da035c1ec5d338c23"> 2677</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adef95f093ae1dc1da035c1ec5d338c23">AsyncCompileJob::CreateNativeModule</a>(</div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>    std::shared_ptr&lt;const WasmModule&gt; module, <span class="keywordtype">size_t</span> code_size_estimate) {</div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span>  <span class="comment">// Embedder usage count for declared shared memories.</span></div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> has_shared_memory =</div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span>      std::any_of(module-&gt;memories.begin(), module-&gt;memories.end(),</div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span>                  [](<span class="keyword">auto</span>&amp; memory) { return memory.is_shared; });</div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span>  <span class="keywordflow">if</span> (has_shared_memory) {</div>
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"> 2684</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a2fbd063d0fbd9a69e5e5adebceefddf1">CountUsage</a>(<a class="code hl_enumvalue" href="classv8_1_1Isolate.html#aed6909379c3f2820cb3084710b73385dad1e675fc33b2507b66ca7fddb849dbbf">v8::Isolate::UseCounterFeature::kWasmSharedMemory</a>);</div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span>  }</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span> </div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span>  <span class="comment">// Create the module object and populate with compiled functions and</span></div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span>  <span class="comment">// information needed at instantiation time.</span></div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span> </div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ac7a8ec2f950e76dfa9e2ec483c15a372">NewNativeModule</a>(</div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">enabled_features_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a>,</div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span>      std::move(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>), std::move(module), code_size_estimate);</div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;SetWireBytes(std::move(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9267b6a79f50110f5e4a79b38d0678d">bytes_copy_</a>));</div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state()-&gt;set_compilation_id(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ac48b6808fbb2e4a304b8bfb011ba8988">compilation_id_</a>);</div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span>}</div>
</div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span> </div>
<div class="foldopen" id="foldopen02697" data-start="{" data-end="}">
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad155f15fbc01d3537cbaf00b74c2f382"> 2697</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad155f15fbc01d3537cbaf00b74c2f382">AsyncCompileJob::GetOrCreateNativeModule</a>(</div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span>    std::shared_ptr&lt;const WasmModule&gt; module, <span class="keywordtype">size_t</span> code_size_estimate) {</div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a26391b903e117ed93787d080f0bc2fe4">MaybeGetNativeModule</a>(</div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>      module-&gt;origin, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span>    <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adef95f093ae1dc1da035c1ec5d338c23">CreateNativeModule</a>(std::move(module), code_size_estimate);</div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>  }</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span>}</div>
</div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span> </div>
<div class="foldopen" id="foldopen02708" data-start="{" data-end="}">
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9af46f338ef59099371aabe35332e84"> 2708</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9af46f338ef59099371aabe35332e84">AsyncCompileJob::PrepareRuntimeObjects</a>() {</div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span>  <span class="comment">// Create heap objects for script and module bytes to be stored in the</span></div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span>  <span class="comment">// module object. Asm.js is not compiled asynchronously.</span></div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>.is_null());</div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span>  <span class="keyword">auto</span> source_url =</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a> ? <a class="code hl_function" href="namespacev8_1_1base.html#ab277246c6caecad159bbc8755cf6bb54">base::VectorOf</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>-&gt;url()) : <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const char&gt;</a>();</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span>  <span class="keyword">auto</span> script =</div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a75db6b0cc6f0a8f29a208579c9cf145d">GetOrCreateScript</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>, source_url);</div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span>  <a class="code hl_class" href="classv8_1_1internal_1_1DirectHandle.html">DirectHandle&lt;WasmModuleObject&gt;</a> module_object =</div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span>      <a class="code hl_function" href="classv8_1_1internal_1_1WasmModuleObject.html#a2d0c6490148366c81d5ea7e05913f3f8">WasmModuleObject::New</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>, script);</div>
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"> 2718</span> </div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a> = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a0567c99c2a3ff016df9e7abb30688075">global_handles</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1GlobalHandles.html#a486c475da54faf1fe78e4752ed20e23c">Create</a>(*module_object);</div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span>}</div>
</div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span> </div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span><span class="comment">// This function assumes that it is executed in a HandleScope, and that a</span></div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span><span class="comment">// context is set on the isolate.</span></div>
<div class="foldopen" id="foldopen02724" data-start="{" data-end="}">
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1"> 2724</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1">AsyncCompileJob::FinishCompile</a>(<span class="keywordtype">bool</span> is_after_cache_hit) {</div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<a class="code hl_define" href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a>(<span class="stringliteral">&quot;v8.wasm.detailed&quot;</span>),</div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span>               <span class="stringliteral">&quot;wasm.FinishAsyncCompile&quot;</span>);</div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>) {</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>-&gt;NotifyNativeModuleCreated(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>);</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span>  }</div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;module();</div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span>  <span class="keyword">auto</span> compilation_state = Impl(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state());</div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span> </div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span>  <span class="comment">// Update the compilation state with feature detected during module decoding</span></div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span>  <span class="comment">// and (potentially) validation. We will publish all features below, in the</span></div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span>  <span class="comment">// current isolate, so ignore the return value here.</span></div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span>  <a class="code hl_define" href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a>(compilation_state-&gt;UpdateDetectedFeatures(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a>));</div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span> </div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span>  <span class="comment">// If experimental PGO via files is enabled, load profile information now that</span></div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span>  <span class="comment">// we have all wire bytes and know that the module is valid.</span></div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span>  <span class="keywordflow">if</span> (<a class="code hl_define" href="v8config_8h.html#a67bd29db07c711b0fb11ff1c324ebb60">V8_UNLIKELY</a>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.experimental_wasm_pgo_from_file)) {</div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span>    std::unique_ptr&lt;ProfileInformation&gt; pgo_info =</div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span>        <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#aca357743e710fa56c5fabec8b006584e">LoadProfileFromFile</a>(module, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;wire_bytes());</div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span>    <span class="keywordflow">if</span> (pgo_info) {</div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span>      compilation_state-&gt;ApplyPgoInfoLate(pgo_info.get());</div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span>    }</div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span>  }</div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span> </div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span>  <span class="keywordtype">bool</span> is_after_deserialization = !<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>.is_null();</div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span>  <span class="keywordflow">if</span> (!is_after_deserialization) {</div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span>    <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9af46f338ef59099371aabe35332e84">PrepareRuntimeObjects</a>();</div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span>  }</div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span> </div>
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"> 2753</span>  <span class="comment">// Measure duration of baseline compilation or deserialization from cache.</span></div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="classv8_1_1base_1_1TimeTicks.html#acdd9f8482c321164c58f46bc65372c9b">base::TimeTicks::IsHighResolution</a>()) {</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span>    <a class="code hl_class" href="classv8_1_1base_1_1TimeDelta.html">base::TimeDelta</a> duration = <a class="code hl_function" href="classv8_1_1base_1_1TimeTicks.html#ab0886bf0e84f1e1fcdc101021c2c0775">base::TimeTicks::Now</a>() - <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab632923d90b8ad7e8d6b3bbb8e985a7f">start_time_</a>;</div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>    <span class="keywordtype">int</span> duration_usecs = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(duration.<a class="code hl_function" href="classv8_1_1base_1_1TimeDelta.html#ad9006b332aa15e66f2ddb8e8ba910892">InMicroseconds</a>());</div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a267e21e771e72483e74bf9c13c9cd267">counters</a>()-&gt;wasm_streaming_finish_wasm_module_time()-&gt;AddSample(</div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span>        duration_usecs);</div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span> </div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span>    <span class="keywordflow">if</span> (is_after_cache_hit || is_after_deserialization) {</div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span>      <a class="code hl_struct" href="structv8_1_1metrics_1_1WasmModuleCompiled.html">v8::metrics::WasmModuleCompiled</a> <span class="keyword">event</span>{</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span>          <span class="keyword">true</span>,                                     <span class="comment">// async</span></div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span>          <span class="keyword">true</span>,                                     <span class="comment">// streamed</span></div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span>          is_after_cache_hit,                       <span class="comment">// cached</span></div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span>          is_after_deserialization,                 <span class="comment">// deserialized</span></div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span>          <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation,           <span class="comment">// lazy</span></div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span>          !compilation_state-&gt;failed(),             <span class="comment">// success</span></div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;turbofan_code_size(),     <span class="comment">// code_size_in_bytes</span></div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;liftoff_bailout_count(),  <span class="comment">// liftoff_bailout_count</span></div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span>          duration.<a class="code hl_function" href="classv8_1_1base_1_1TimeDelta.html#ad9006b332aa15e66f2ddb8e8ba910892">InMicroseconds</a>()};               <span class="comment">// wall_clock_duration_in_us</span></div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#ae2a2e88c3939f4c98fbb0fb2d91f26a7">metrics_recorder</a>()-&gt;DelayMainThreadEvent(event, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5d62877a0c3d97edb19bcefa2e452c57">context_id_</a>);</div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span>    }</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span>  }</div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span> </div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a4af947c29f68bce811026dd9878cd257">context</a>().is_null());</div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span>  <span class="comment">// Finish the wasm script now and make it public to the debugger.</span></div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span>  <a class="code hl_class" href="classv8_1_1internal_1_1DirectHandle.html">DirectHandle&lt;Script&gt;</a> <a class="code hl_variable" href="namespacev8_1_1internal.html#afb7e5cd394b9632dddc2e7807b11b2ab">script</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>-&gt;script(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span>  <span class="keyword">auto</span> sourcemap_symbol =</div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span>      <span class="keyword">module</span>-&gt;debug_symbols[WasmDebugSymbols::Type::SourceMap];</div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span>  <span class="keywordflow">if</span> (script-&gt;type() == Script::Type::kWasm &amp;&amp;</div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span>      sourcemap_symbol.type != <a class="code hl_enumvalue" href="structv8_1_1internal_1_1wasm_1_1WasmDebugSymbols.html#a8532d4e68c0d024103622db816fcf401ab6753b928ffa3762e2c24aca9e607a80">WasmDebugSymbols::Type::None</a> &amp;&amp;</div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span>      !sourcemap_symbol.external_url.is_empty()) {</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html">ModuleWireBytes</a> wire_bytes(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;wire_bytes());</div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span>    <a class="code hl_class" href="classv8_1_1internal_1_1MaybeDirectHandle.html">MaybeDirectHandle&lt;String&gt;</a> src_map_str =</div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#ab7dd326c7e0e0d5d2cba90947b2ef48b">factory</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Factory.html#a770976a9ab8638f5c4a009dc3701a7e1">NewStringFromUtf8</a>(</div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span>            wire_bytes.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#aad25d74a24c1f21b337f94460ecc662c">GetNameOrNull</a>(sourcemap_symbol.external_url),</div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span>            <a class="code hl_enumvalue" href="namespacev8_1_1internal.html#a604d5beeb6fc8639670f737ed201e20aa0aa38c28f349d65a6819e03844b73dff">AllocationType::kOld</a>);</div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span>    script-&gt;set_source_mapping_url(*src_map_str.<a class="code hl_function" href="classv8_1_1internal_1_1MaybeDirectHandle.html#a3ac1ac2ef3cc31fca3efa79567a7d4ad">ToHandleChecked</a>());</div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span>  }</div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span>  {</div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span>    <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<a class="code hl_define" href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a>(<span class="stringliteral">&quot;v8.wasm.detailed&quot;</span>),</div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span>                 <span class="stringliteral">&quot;wasm.Debug.OnAfterCompile&quot;</span>);</div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#ace16c5dc61b180c3b77f9de769bb9de7">debug</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Debug.html#ab727677cfc3df584b90bfdcd5328c727">OnAfterCompile</a>(script);</div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span>  }</div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span> </div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span>  <span class="comment">// Publish the detected features in this isolate, once initial compilation</span></div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span>  <span class="comment">// is done. Validate should have detected all features, unless lazy validation</span></div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span>  <span class="comment">// is enabled.</span></div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span>  <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ae7a6dc8061ff4f4860d0efa2cca75d9d">PublishDetectedFeatures</a>(compilation_state-&gt;detected_features(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>,</div>
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"> 2800</span>                          <span class="keyword">true</span>);</div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span> </div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span>  <span class="comment">// We might need debug code for the module, if the debugger was enabled while</span></div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span>  <span class="comment">// streaming compilation was running. Since handling this while compiling via</span></div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span>  <span class="comment">// streaming is tricky, we just remove all code which may have been generated,</span></div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span>  <span class="comment">// and compile debug code lazily.</span></div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;IsInDebugState()) {</div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCodeRefScope.html">WasmCodeRefScope</a> ref_scope;</div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;RemoveCompiledCode(</div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span>        <a class="code hl_enumvalue" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#addb6002d53e166907484bf3715ff599caeb1f31c38f14cfa2fb295e63efdbdfbd">NativeModule::RemoveFilter::kRemoveNonDebugCode</a>);</div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span>  }</div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span> </div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span>  <span class="comment">// Finally, log all generated code (it does not matter if this happens</span></div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span>  <span class="comment">// repeatedly in case the script is shared).</span></div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;LogWasmCodes(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>-&gt;script());</div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span> </div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a80e0dfd6274908a644fcc877c72607a9">FinishSuccessfully</a>();</div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span>}</div>
</div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span> </div>
<div class="foldopen" id="foldopen02819" data-start="{" data-end="}">
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48"> 2819</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48">AsyncCompileJob::Failed</a>() {</div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span>  <span class="comment">// {job} keeps the {this} pointer alive.</span></div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span>  std::unique_ptr&lt;AsyncCompileJob&gt; job =</div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a8378f5ecdd236147a0b3c590c12899b8">RemoveCompileJob</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span> </div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span>  <span class="comment">// Revalidate the whole module to produce a deterministic error message.</span></div>
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"> 2825</span>  <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> kValidate = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"> 2826</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> unused_detected_features;</div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">ModuleResult</a> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> =</div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a83ed1297167cba9f8c8971bacab69dbf">DecodeWasmModule</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">enabled_features_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(), kValidate,</div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span>                       <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>, &amp;unused_detected_features);</div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html">ErrorThrower</a> thrower(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a04c750e47b50446d0e7b808014cd1adc">api_method_name_</a>);</div>
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"> 2831</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.failed()) {</div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span>    thrower.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html#a2d32c2f4fadecb8c1434fa2998171e23">CompileFailed</a>(std::move(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>).error());</div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span>    <span class="comment">// The only possible reason why {result} might be okay is if the failure</span></div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span>    <span class="comment">// was due to compile-time imports checking.</span></div>
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"> 2836</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(!job-&gt;compile_imports_.empty());</div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmError.html">WasmError</a> error = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a97644489c4ab86ae3156930153cd1b5e">ValidateAndSetBuiltinImports</a>(</div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"> 2838</span>        <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.value().get(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(), job-&gt;compile_imports_,</div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span>        &amp;unused_detected_features);</div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a>(error.has_error());</div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span>    thrower.CompileError(<span class="stringliteral">&quot;%s&quot;</span>, error.message().c_str());</div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span>  }</div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4025ea6ad5b7cac05d76451054ae6829">resolver_</a>-&gt;OnCompilationFailed(thrower.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html#aef25eb132a83562c6c06e62a247b625f">Reify</a>());</div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span>}</div>
</div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span> </div>
<div class="foldopen" id="foldopen02846" data-start="{" data-end="};">
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html"> 2846</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html">AsyncCompileJob::CompilationStateCallback</a></div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span>    : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CompilationEventCallback.html">CompilationEventCallback</a> {</div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78a39f3673bf5ded7f231a9201b16fa0"> 2849</a></span>  <span class="keyword">explicit</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78a39f3673bf5ded7f231a9201b16fa0">CompilationStateCallback</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job) : <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>(job) {}</div>
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"> 2850</span> </div>
<div class="foldopen" id="foldopen02851" data-start="{" data-end="}">
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#af03a6f2a5c03d334ec0a8337e73b1da3"> 2851</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#af03a6f2a5c03d334ec0a8337e73b1da3">call</a>(<a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29">CompilationEvent</a> event)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span>    <span class="comment">// This callback is only being called from a foreground task.</span></div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span>    <span class="keywordflow">switch</span> (event) {</div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a41b18f40e8022b599bc6360f216daba4">CompilationEvent::kFinishedBaselineCompilation</a>:</div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span>        <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!last_event_.has_value());</div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0f21c0af12e028ae3c120b03fbe2c835">DecrementAndCheckFinisherCount</a>()) {</div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span>          <span class="comment">// Install the native module in the cache, or reuse a conflicting one.</span></div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span>          <span class="comment">// If we get a conflicting module, wait until we are back in the</span></div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span>          <span class="comment">// main thread to update {job_-&gt;native_module_} to avoid a data race.</span></div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span>          std::shared_ptr&lt;NativeModule&gt; cached_native_module =</div>
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"> 2861</span>              <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ae049eb40219a3e542bf2811e42ac1bb8">UpdateNativeModuleCache</a>(</div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"> 2862</span>                  <span class="keyword">false</span>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span>          <span class="keywordflow">if</span> (cached_native_module == <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>) {</div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span>            <span class="comment">// There was no cached module.</span></div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span>            cached_native_module = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span>          }</div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">DoSync</a>&lt;<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html">FinishCompilation</a>&gt;(std::move(cached_native_module));</div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span>        }</div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a9ac6b83a7cebbcdae83cb92173c10599">CompilationEvent::kFinishedCompilationChunk</a>:</div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span>        <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a41b18f40e8022b599bc6360f216daba4">CompilationEvent::kFinishedBaselineCompilation</a> == last_event_ ||</div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span>               <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a9ac6b83a7cebbcdae83cb92173c10599">CompilationEvent::kFinishedCompilationChunk</a> == last_event_);</div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"> 2873</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"> 2874</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29af90d51f0b738cedabb652e72ffd7b8ed">CompilationEvent::kFailedCompilation</a>:</div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span>        <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!last_event_.has_value());</div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0f21c0af12e028ae3c120b03fbe2c835">DecrementAndCheckFinisherCount</a>()) {</div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span>          <span class="comment">// Don&#39;t update {job_-&gt;native_module_} to avoid data races with other</span></div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span>          <span class="comment">// compilation threads. Use a copy of the shared pointer instead.</span></div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span>          <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ae049eb40219a3e542bf2811e42ac1bb8">UpdateNativeModuleCache</a>(<span class="keyword">true</span>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>,</div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span>                                                   <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">DoSync</a>&lt;<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html">Fail</a>&gt;();</div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span>        }</div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span>    }</div>
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"> 2885</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span>    last_event_ = event;</div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span>  }</div>
</div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span> </div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749"> 2891</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">job_</a>;</div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span>  <span class="comment">// This will be modified by different threads, but they externally</span></div>
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"> 2894</span>  <span class="comment">// synchronize, so no explicit synchronization (currently) needed here.</span></div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span>  std::optional&lt;CompilationEvent&gt; last_event_;</div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span>};</div>
</div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span> </div>
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"> 2899</span><span class="comment">// A closure to run a compilation step (either as foreground or background</span></div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"> 2900</span><span class="comment">// task) and schedule the next step(s), if any.</span></div>
<div class="foldopen" id="foldopen02901" data-start="{" data-end="};">
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html"> 2901</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html">AsyncCompileJob::CompileStep</a> {</div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a0069e90545f2e9dfecaf6c3bb149e172"> 2903</a></span>  <span class="keyword">virtual</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a0069e90545f2e9dfecaf6c3bb149e172">~CompileStep</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span> </div>
<div class="foldopen" id="foldopen02905" data-start="{" data-end="}">
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#abfcaead40f2f15dbf84cee35a2f02623"> 2905</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#abfcaead40f2f15dbf84cee35a2f02623">Run</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job, <span class="keywordtype">bool</span> on_foreground) {</div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span>    <span class="keywordflow">if</span> (on_foreground) {</div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span>      <a class="code hl_class" href="classv8_1_1internal_1_1HandleScope.html">HandleScope</a> scope(job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span>      <a class="code hl_class" href="classv8_1_1internal_1_1SaveAndSwitchContext.html">SaveAndSwitchContext</a> saved_context(job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, *job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a>);</div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span>      <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#ad5029dd7594af476720c9304999a85bf">RunInForeground</a>(job);</div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span>      <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a97ba94766f9dd48e4c3f3685904eff16">RunInBackground</a>(job);</div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span>    }</div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span>  }</div>
</div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"> 2914</span> </div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#ad5029dd7594af476720c9304999a85bf"> 2915</a></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#ad5029dd7594af476720c9304999a85bf">RunInForeground</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>*) { <a class="code hl_function" href="namespacev8_1_1internal.html#acdec713c25068019f935e35976f5b666">UNREACHABLE</a>(); }</div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a97ba94766f9dd48e4c3f3685904eff16"> 2916</a></span>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a97ba94766f9dd48e4c3f3685904eff16">RunInBackground</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>*) { <a class="code hl_function" href="namespacev8_1_1internal.html#acdec713c25068019f935e35976f5b666">UNREACHABLE</a>(); }</div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span>};</div>
</div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span> </div>
<div class="foldopen" id="foldopen02919" data-start="{" data-end="};">
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html"> 2919</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html">AsyncCompileJob::CompileTask</a> : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1CancelableTask.html">CancelableTask</a> {</div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen02921" data-start="{" data-end="}">
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#ab9b5e4559ae086d12357cb0349cc18b4"> 2921</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#ab9b5e4559ae086d12357cb0349cc18b4">CompileTask</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job, <span class="keywordtype">bool</span> on_foreground)</div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span>      <span class="comment">// We only manage the background tasks with the {CancelableTaskManager} of</span></div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span>      <span class="comment">// the {AsyncCompileJob}. Foreground tasks are managed by the system&#39;s</span></div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span>      <span class="comment">// {CancelableTaskManager}. Background tasks cannot spawn tasks managed by</span></div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span>      <span class="comment">// their own task manager.</span></div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"> 2926</span>      : <a class="code hl_class" href="classv8_1_1internal_1_1CancelableTask.html">CancelableTask</a>(on_foreground ? job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;cancelable_task_manager()</div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span>                                     : &amp;job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a32567b0fa26ffcea6e894c54e5bbbc94">background_task_manager_</a>),</div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>(job),</div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff">on_foreground_</a>(on_foreground) {}</div>
</div>
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"> 2930</span> </div>
<div class="foldopen" id="foldopen02931" data-start="{" data-end="}">
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a3a8517f046dbb29af2bc0f0ec24762e8"> 2931</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a3a8517f046dbb29af2bc0f0ec24762e8">~CompileTask</a>()<span class="keyword"> override </span>{</div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a> != <span class="keyword">nullptr</span> &amp;&amp; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff">on_foreground_</a>) <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a7d63a654af3c6d05fdfb94d9d98152c7">ResetPendingForegroundTask</a>();</div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span>  }</div>
</div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span> </div>
<div class="foldopen" id="foldopen02935" data-start="{" data-end="}">
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#ada0c2b9f7ae434853a08d3a84a017d06"> 2935</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#ada0c2b9f7ae434853a08d3a84a017d06">RunInternal</a>() final {</div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff">on_foreground_</a>) <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a7d63a654af3c6d05fdfb94d9d98152c7">ResetPendingForegroundTask</a>();</div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af3c71b1c92469d246d929fe3f6ea1061">step_</a>-&gt;Run(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff">on_foreground_</a>);</div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span>    <span class="comment">// After execution, reset {job_} such that we don&#39;t try to reset the pending</span></div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span>    <span class="comment">// foreground task when the task is deleted.</span></div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span>  }</div>
</div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span> </div>
<div class="foldopen" id="foldopen02944" data-start="{" data-end="}">
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a204415cbd9628d948c738372bcc6139a"> 2944</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a204415cbd9628d948c738372bcc6139a">Cancel</a>() {</div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>);</div>
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"> 2946</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span>  }</div>
</div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span> </div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>  <span class="comment">// {job_} will be cleared to cancel a pending task.</span></div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7"> 2951</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>;</div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff"> 2952</a></span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff">on_foreground_</a>;</div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span> </div>
<div class="foldopen" id="foldopen02954" data-start="{" data-end="}">
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a7d63a654af3c6d05fdfb94d9d98152c7"> 2954</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a7d63a654af3c6d05fdfb94d9d98152c7">ResetPendingForegroundTask</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<span class="keyword">this</span>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a>);</div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span>  }</div>
</div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span>};</div>
</div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span> </div>
<div class="foldopen" id="foldopen02960" data-start="{" data-end="}">
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab4666e785e9acaa99d4290e9e21f8a9e"> 2960</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab4666e785e9acaa99d4290e9e21f8a9e">AsyncCompileJob::StartForegroundTask</a>() {</div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a>);</div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span> </div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span>  <span class="keyword">auto</span> new_task = std::make_unique&lt;CompileTask&gt;(<span class="keyword">this</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"> 2964</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a> = new_task.get();</div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"> 2965</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a60c83d8ce32a32ad052ad7a308c64d6c">foreground_task_runner_</a>-&gt;PostTask(std::move(new_task));</div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>}</div>
</div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span> </div>
<div class="foldopen" id="foldopen02968" data-start="{" data-end="}">
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad958c48b5e4f28453ed24da4dc46602f"> 2968</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad958c48b5e4f28453ed24da4dc46602f">AsyncCompileJob::ExecuteForegroundTaskImmediately</a>() {</div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a>);</div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"> 2970</span> </div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span>  <span class="keyword">auto</span> new_task = std::make_unique&lt;CompileTask&gt;(<span class="keyword">this</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a> = new_task.get();</div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>  new_task-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1CancelableTask.html#ae1851dd66f2539be51f60f2ad041af0d">Run</a>();</div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span>}</div>
</div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span> </div>
<div class="foldopen" id="foldopen02976" data-start="{" data-end="}">
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#aa84200caacc713311e166e63a9b3759f"> 2976</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#aa84200caacc713311e166e63a9b3759f">AsyncCompileJob::CancelPendingForegroundTask</a>() {</div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a204415cbd9628d948c738372bcc6139a">Cancel</a>();</div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"> 2980</span>}</div>
</div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span> </div>
<div class="foldopen" id="foldopen02982" data-start="{" data-end="}">
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab2345a7e23a4b90636bf3986bb22f54e"> 2982</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab2345a7e23a4b90636bf3986bb22f54e">AsyncCompileJob::StartBackgroundTask</a>() {</div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span>  <span class="keyword">auto</span> task = std::make_unique&lt;CompileTask&gt;(<span class="keyword">this</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span> </div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>  <span class="comment">// If --wasm-num-compilation-tasks=0 is passed, do only spawn foreground</span></div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span>  <span class="comment">// tasks. This is used to make timing deterministic.</span></div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_num_compilation_tasks &gt; 0) {</div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span>    <a class="code hl_function" href="classv8_1_1internal_1_1V8.html#a5eb1d47c492fa1e85e7d7c31dd5cf2bb">V8::GetCurrentPlatform</a>()-&gt;<a class="code hl_function" href="classv8_1_1Platform.html#a061c7d8b981dab5da6a04a8f6f8419b6">PostTaskOnWorkerThread</a>(</div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span>        <a class="code hl_enumvalue" href="namespacev8.html#a680c1a715d1d5df94b21e8b1ee1bf051a495bb545d1c5053ead9743a8b7692209">TaskPriority::kUserBlocking</a>, std::move(task));</div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a60c83d8ce32a32ad052ad7a308c64d6c">foreground_task_runner_</a>-&gt;PostTask(std::move(task));</div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span>  }</div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span>}</div>
</div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span> </div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Step,</div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>          <a class="code hl_enumeration" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af8542ed1d50257c03ea1bd612150af14">AsyncCompileJob::UseExistingForegroundTask</a> use_existing_fg_task,</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span>          <span class="keyword">typename</span>... Args&gt;</div>
<div class="foldopen" id="foldopen02998" data-start="{" data-end="}">
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84"> 2998</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">AsyncCompileJob::DoSync</a>(Args&amp;&amp;... <a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>) {</div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a139187b697c7eb6b4a94d3473d7d555b">NextStep&lt;Step&gt;</a>(std::forward&lt;Args&gt;(<a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>)...);</div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span>  <span class="keywordflow">if</span> (use_existing_fg_task &amp;&amp; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">pending_foreground_task_</a> != <span class="keyword">nullptr</span>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab4666e785e9acaa99d4290e9e21f8a9e">StartForegroundTask</a>();</div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span>}</div>
</div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span> </div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Step, <span class="keyword">typename</span>... Args&gt;</div>
<div class="foldopen" id="foldopen03005" data-start="{" data-end="}">
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#abb47c3e3846b0ae191c5c1c9c2ef0b84"> 3005</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#abb47c3e3846b0ae191c5c1c9c2ef0b84">AsyncCompileJob::DoImmediately</a>(Args&amp;&amp;... <a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>) {</div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a139187b697c7eb6b4a94d3473d7d555b">NextStep&lt;Step&gt;</a>(std::forward&lt;Args&gt;(<a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>)...);</div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad958c48b5e4f28453ed24da4dc46602f">ExecuteForegroundTaskImmediately</a>();</div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span>}</div>
</div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span> </div>
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"> 3010</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Step, <span class="keyword">typename</span>... Args&gt;</div>
<div class="foldopen" id="foldopen03011" data-start="{" data-end="}">
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#add267630191de419bf4467180a938b3b"> 3011</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#add267630191de419bf4467180a938b3b">AsyncCompileJob::DoAsync</a>(Args&amp;&amp;... <a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>) {</div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a139187b697c7eb6b4a94d3473d7d555b">NextStep&lt;Step&gt;</a>(std::forward&lt;Args&gt;(<a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>)...);</div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab2345a7e23a4b90636bf3986bb22f54e">StartBackgroundTask</a>();</div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span>}</div>
</div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span> </div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Step, <span class="keyword">typename</span>... Args&gt;</div>
<div class="foldopen" id="foldopen03017" data-start="{" data-end="}">
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a139187b697c7eb6b4a94d3473d7d555b"> 3017</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a139187b697c7eb6b4a94d3473d7d555b">AsyncCompileJob::NextStep</a>(Args&amp;&amp;... <a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>) {</div>
<div class="line"><a id="l03018" name="l03018"></a><span class="lineno"> 3018</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af3c71b1c92469d246d929fe3f6ea1061">step_</a>.reset(<span class="keyword">new</span> Step(std::forward&lt;Args&gt;(<a class="code hl_variable" href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a>)...));</div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span>}</div>
</div>
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"> 3020</span> </div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span><span class="comment">//==========================================================================</span></div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span><span class="comment">// Step 1: (async) Decode the module.</span></div>
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"> 3023</span><span class="comment">//==========================================================================</span></div>
<div class="foldopen" id="foldopen03024" data-start="{" data-end="};">
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html"> 3024</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html">AsyncCompileJob::DecodeModule</a> : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html">AsyncCompileJob::CompileStep</a> {</div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen03026" data-start="{" data-end="}">
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a441dd7c72c35e06dfb95c4efc6f19d5f"> 3026</a></span>  <span class="keyword">explicit</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a441dd7c72c35e06dfb95c4efc6f19d5f">DecodeModule</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Counters.html">Counters</a>* counters,</div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>                        std::shared_ptr&lt;metrics::Recorder&gt; metrics_recorder)</div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>      : <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#af5503437c181b102ff658c10bc329816">counters_</a>(counters), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a9ed32c7c7b2617e667833307d0e0163d">metrics_recorder_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(metrics_recorder)) {}</div>
</div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span> </div>
<div class="foldopen" id="foldopen03030" data-start="{" data-end="}">
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a2bce50c3ea578bc818214bba82cbb656"> 3030</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a2bce50c3ea578bc818214bba82cbb656">RunInBackground</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">ModuleResult</a> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>;</div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>    {</div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>      <a class="code hl_class" href="classv8_1_1internal_1_1PerThreadAssertScopeEmpty.html">DisallowHandleAllocation</a> no_handle;</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span>      <a class="code hl_class" href="classv8_1_1internal_1_1PerThreadAssertScopeEmpty.html">DisallowGarbageCollection</a> no_gc;</div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span>      <span class="comment">// Decode the module bytes.</span></div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span>      <a class="code hl_define" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a>(<span class="stringliteral">&quot;(1) Decoding module...\n&quot;</span>);</div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span>      <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<a class="code hl_define" href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a>(<span class="stringliteral">&quot;v8.wasm.detailed&quot;</span>),</div>
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"> 3038</span>                   <span class="stringliteral">&quot;wasm.DecodeModule&quot;</span>);</div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span>      <span class="keyword">auto</span> enabled_features = job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">enabled_features_</a>;</div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span>      <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a83ed1297167cba9f8c8971bacab69dbf">DecodeWasmModule</a>(</div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"> 3041</span>          enabled_features, job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(), <span class="keyword">false</span>, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>,</div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#af5503437c181b102ff658c10bc329816">counters_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a9ed32c7c7b2617e667833307d0e0163d">metrics_recorder_</a>, job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a88a441ca477b50b987fc34ae1c949c35">context_id</a>(),</div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span>          <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a690faef021ab529c2506ff4cc19f23d3a9f2b960005d2a3a5f35ac32809d84db7">DecodingMethod::kAsync</a>, &amp;job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a>);</div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span> </div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span>      <span class="comment">// Validate lazy functions here if requested.</span></div>
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"> 3046</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.ok() &amp;&amp; !<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation) {</div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.value().get();</div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"> 3048</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmError.html">WasmError</a> validation_error = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(</div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span>                module, job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(), job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">enabled_features_</a>,</div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span>                kOnlyLazyFunctions, &amp;job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a>)) {</div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>          <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">ModuleResult</a>{std::move(validation_error)};</div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span>        }</div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span>      }</div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.ok()) {</div>
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"> 3055</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.value().get();</div>
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"> 3056</span>        <span class="keywordflow">if</span> (<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmError.html">WasmError</a> error = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a97644489c4ab86ae3156930153cd1b5e">ValidateAndSetBuiltinImports</a>(</div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>                module, job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(), job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>,</div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span>                &amp;job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a>)) {</div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span>          <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">ModuleResult</a>{std::move(error)};</div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span>        }</div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span>      }</div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span>    }</div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.failed()) {</div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span>      <span class="comment">// Decoding failure; reject the promise and clean up.</span></div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span>      job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">DoSync</a>&lt;<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html">Fail</a>&gt;();</div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"> 3066</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>      <span class="comment">// Decode passed.</span></div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span>      std::shared_ptr&lt;WasmModule&gt; module = std::move(<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>).value();</div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span>      <span class="keyword">const</span> <span class="keywordtype">bool</span> include_liftoff = <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.liftoff;</div>
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"> 3070</span>      <span class="keywordtype">size_t</span> code_size_estimate =</div>
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"> 3071</span>          <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmCodeManager.html#ab90b2371ac3c63fcc039e3189203dbb3">wasm::WasmCodeManager::EstimateNativeModuleCodeSize</a>(</div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span>              module.get(), include_liftoff, job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a902952b2ef0c0a8cc6d4afb53b4480ce">dynamic_tiering_</a>);</div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span>      job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">DoSync</a>&lt;<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html">PrepareAndStartCompile</a>&gt;(</div>
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"> 3074</span>          std::move(module), <span class="keyword">true</span> <span class="comment">/* start_compilation */</span>,</div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span>          <span class="keyword">true</span> <span class="comment">/* lazy_functions_are_validated */</span>, code_size_estimate);</div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span>    }</div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span>  }</div>
</div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span> </div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#af5503437c181b102ff658c10bc329816"> 3080</a></span>  <a class="code hl_class" href="classv8_1_1internal_1_1Counters.html">Counters</a>* <span class="keyword">const</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#af5503437c181b102ff658c10bc329816">counters_</a>;</div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a9ed32c7c7b2617e667833307d0e0163d"> 3081</a></span>  std::shared_ptr&lt;metrics::Recorder&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a9ed32c7c7b2617e667833307d0e0163d">metrics_recorder_</a>;</div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span>};</div>
</div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span> </div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span><span class="comment">//==========================================================================</span></div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span><span class="comment">// Step 2 (sync): Create heap-allocated data and start compilation.</span></div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"> 3086</span><span class="comment">//==========================================================================</span></div>
<div class="foldopen" id="foldopen03087" data-start="{" data-end="};">
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html"> 3087</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html">AsyncCompileJob::PrepareAndStartCompile</a> : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html">CompileStep</a> {</div>
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"> 3088</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen03089" data-start="{" data-end="}">
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ac5dccdcb6738c90ba8c230cf7450e8b2"> 3089</a></span>  <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ac5dccdcb6738c90ba8c230cf7450e8b2">PrepareAndStartCompile</a>(std::shared_ptr&lt;const WasmModule&gt; module,</div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span>                         <span class="keywordtype">bool</span> start_compilation,</div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span>                         <span class="keywordtype">bool</span> lazy_functions_are_validated,</div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span>                         <span class="keywordtype">size_t</span> code_size_estimate)</div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>      : <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ae660c8c041906fd2f5aac072b6ab12d8">module_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(module)),</div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a1d33784fa9eaa4136df95aaac7494d79">start_compilation_</a>(start_compilation),</div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aea65721b6185ebe2e1d51762fbb14079">lazy_functions_are_validated_</a>(lazy_functions_are_validated),</div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a0fd85bcabaef22e5f7c3d7bbdbd3458b">code_size_estimate_</a>(code_size_estimate) {}</div>
</div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span> </div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span> <span class="keyword">private</span>:</div>
<div class="foldopen" id="foldopen03099" data-start="{" data-end="}">
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aab1de8b23d4aa589a08ae97f6feb3220"> 3099</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aab1de8b23d4aa589a08ae97f6feb3220">RunInForeground</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"> 3100</span>    <a class="code hl_define" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a>(<span class="stringliteral">&quot;(2) Prepare and start compile...\n&quot;</span>);</div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"> 3101</span> </div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> streaming = job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#a31e859ce9fbc3561f23d5411edd92c4b">length</a>() == 0;</div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span>    <span class="keywordflow">if</span> (streaming) {</div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span>      <span class="comment">// Streaming compilation already checked for cache hits.</span></div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>      job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adef95f093ae1dc1da035c1ec5d338c23">CreateNativeModule</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ae660c8c041906fd2f5aac072b6ab12d8">module_</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a0fd85bcabaef22e5f7c3d7bbdbd3458b">code_size_estimate_</a>);</div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad155f15fbc01d3537cbaf00b74c2f382">GetOrCreateNativeModule</a>(std::move(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ae660c8c041906fd2f5aac072b6ab12d8">module_</a>),</div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span>                                            <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a0fd85bcabaef22e5f7c3d7bbdbd3458b">code_size_estimate_</a>)) {</div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>      job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1">FinishCompile</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aea65721b6185ebe2e1d51762fbb14079">lazy_functions_are_validated_</a>) {</div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>      <span class="comment">// If we are not streaming and did not get a cache hit, we might have hit</span></div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span>      <span class="comment">// the path where the streaming decoder got a prefix cache hit, but the</span></div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span>      <span class="comment">// module then turned out to be invalid, and we are running it through</span></div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span>      <span class="comment">// non-streaming decoding again. In this case, function bodies have not</span></div>
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"> 3115</span>      <span class="comment">// been validated yet (would have happened in the {DecodeModule} phase</span></div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span>      <span class="comment">// if we would not come via the non-streaming path). Thus do this now.</span></div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>      <span class="comment">// Note that we only need to validate lazily compiled functions, others</span></div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span>      <span class="comment">// will be validated during eager compilation.</span></div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a1d33784fa9eaa4136df95aaac7494d79">start_compilation_</a>);</div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>      <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation &amp;&amp;</div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span>          <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">ValidateFunctions</a>(*job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>, kOnlyLazyFunctions)</div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span>              .<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmError.html#a814cbe82c25f67faffa1de4801d10574">has_error</a>()) {</div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span>        job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48">Failed</a>();</div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span>      }</div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span>    }</div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span> </div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span>    <span class="comment">// Make sure all compilation tasks stopped running. Decoding (async step)</span></div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span>    <span class="comment">// is done.</span></div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span>    job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a32567b0fa26ffcea6e894c54e5bbbc94">background_task_manager_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1CancelableTaskManager.html#a3c90c3d841ccd5255387b37fcfbc03c0">CancelAndWait</a>();</div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"> 3131</span> </div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span>    CompilationStateImpl* compilation_state =</div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span>        Impl(job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state());</div>
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"> 3134</span>    compilation_state-&gt;AddCallback(</div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span>        std::make_unique&lt;CompilationStateCallback&gt;(job));</div>
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"> 3136</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classv8_1_1base_1_1TimeTicks.html#acdd9f8482c321164c58f46bc65372c9b">base::TimeTicks::IsHighResolution</a>()) {</div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span>      <span class="keyword">auto</span> compile_mode = job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a> == <span class="keyword">nullptr</span></div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>                              ? CompilationTimeCallback::kAsync</div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span>                              : CompilationTimeCallback::kStreaming;</div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span>      compilation_state-&gt;AddCallback(std::make_unique&lt;CompilationTimeCallback&gt;(</div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span>          job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a27baa7cc0332d0dfeecf77a91df33444">async_counters</a>(), job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#ae2a2e88c3939f4c98fbb0fb2d91f26a7">metrics_recorder</a>(),</div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span>          job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5d62877a0c3d97edb19bcefa2e452c57">context_id_</a>, job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>, compile_mode));</div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span>    }</div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span> </div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a1d33784fa9eaa4136df95aaac7494d79">start_compilation_</a>) {</div>
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"> 3146</span>      <span class="comment">// TODO(13209): Use PGO for async compilation, if available.</span></div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span>      <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ProfileInformation.html">ProfileInformation</a>* kNoProfileInformation = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span>      std::unique_ptr&lt;CompilationUnitBuilder&gt; builder = InitializeCompilation(</div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>          job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0c031fff1a73728be15eea6c0a576e85">isolate</a>(), job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>.get(), kNoProfileInformation);</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span>      compilation_state-&gt;InitializeCompilationUnits(std::move(builder));</div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span>      <span class="comment">// In single-threaded mode there are no worker tasks that will do the</span></div>
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"> 3152</span>      <span class="comment">// compilation. We call {WaitForCompilationEvent} here so that the main</span></div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span>      <span class="comment">// thread participates and finishes the compilation.</span></div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_num_compilation_tasks == 0 || <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>        compilation_state-&gt;WaitForCompilationEvent(</div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span>            <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a41b18f40e8022b599bc6360f216daba4">CompilationEvent::kFinishedBaselineCompilation</a>);</div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span>      }</div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>    }</div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span>  }</div>
</div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span> </div>
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ae660c8c041906fd2f5aac072b6ab12d8"> 3161</a></span>  <span class="keyword">const</span> std::shared_ptr&lt;const WasmModule&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ae660c8c041906fd2f5aac072b6ab12d8">module_</a>;</div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a1d33784fa9eaa4136df95aaac7494d79"> 3162</a></span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a1d33784fa9eaa4136df95aaac7494d79">start_compilation_</a>;</div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aea65721b6185ebe2e1d51762fbb14079"> 3163</a></span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aea65721b6185ebe2e1d51762fbb14079">lazy_functions_are_validated_</a>;</div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a0fd85bcabaef22e5f7c3d7bbdbd3458b"> 3164</a></span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a0fd85bcabaef22e5f7c3d7bbdbd3458b">code_size_estimate_</a>;</div>
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"> 3165</span>};</div>
</div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span> </div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span><span class="comment">//==========================================================================</span></div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span><span class="comment">// Step 3 (sync): Compilation finished.</span></div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span><span class="comment">//==========================================================================</span></div>
<div class="foldopen" id="foldopen03170" data-start="{" data-end="};">
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html"> 3170</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html">AsyncCompileJob::FinishCompilation</a> : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html">CompileStep</a> {</div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span> <span class="keyword">public</span>:</div>
<div class="foldopen" id="foldopen03172" data-start="{" data-end="}">
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#a6f953f4a930cf5da320864312c15586c"> 3172</a></span>  <span class="keyword">explicit</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#a6f953f4a930cf5da320864312c15586c">FinishCompilation</a>(std::shared_ptr&lt;NativeModule&gt; cached_native_module)</div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span>      : <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447">cached_native_module_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(cached_native_module)) {}</div>
</div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span> </div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span> <span class="keyword">private</span>:</div>
<div class="foldopen" id="foldopen03176" data-start="{" data-end="}">
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ae0e81a512dd4e7cbc11da9d17e828a75"> 3176</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ae0e81a512dd4e7cbc11da9d17e828a75">RunInForeground</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span>    <a class="code hl_define" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a>(<span class="stringliteral">&quot;(3) Compilation finished\n&quot;</span>);</div>
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"> 3178</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447">cached_native_module_</a>) {</div>
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"> 3179</span>      job-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447">cached_native_module_</a>;</div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span>    }</div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>    <span class="comment">// Then finalize and publish the generated module.</span></div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>    job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1">FinishCompile</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447">cached_native_module_</a> != <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span>  }</div>
</div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span> </div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447"> 3185</a></span>  std::shared_ptr&lt;NativeModule&gt; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447">cached_native_module_</a>;</div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span>};</div>
</div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span> </div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span><span class="comment">//==========================================================================</span></div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span><span class="comment">// Step 4 (sync): Decoding or compilation failed.</span></div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span><span class="comment">//==========================================================================</span></div>
<div class="foldopen" id="foldopen03191" data-start="{" data-end="};">
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html"> 3191</a></span><span class="keyword">class </span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html">AsyncCompileJob::Fail</a> : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html">CompileStep</a> {</div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span> <span class="keyword">private</span>:</div>
<div class="foldopen" id="foldopen03193" data-start="{" data-end="}">
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html#ac25f2c0a02c26e155b40b1d81740688b"> 3193</a></span>  <span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html#ac25f2c0a02c26e155b40b1d81740688b">RunInForeground</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job)<span class="keyword"> override </span>{</div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span>    <a class="code hl_define" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a>(<span class="stringliteral">&quot;(4) Async compilation failed.\n&quot;</span>);</div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>    <span class="comment">// {job_} is deleted in {Failed}, therefore the {return}.</span></div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>    <span class="keywordflow">return</span> job-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48">Failed</a>();</div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span>  }</div>
</div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span>};</div>
</div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span> </div>
<div class="foldopen" id="foldopen03200" data-start="{" data-end="}">
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a80e0dfd6274908a644fcc877c72607a9"> 3200</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a80e0dfd6274908a644fcc877c72607a9">AsyncCompileJob::FinishSuccessfully</a>() {</div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span>  <a class="code hl_define" href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a>(<span class="stringliteral">&quot;(4) Finish module...\n&quot;</span>);</div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span>  {</div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span>    <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<a class="code hl_define" href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a>(<span class="stringliteral">&quot;v8.wasm.detailed&quot;</span>),</div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>                 <span class="stringliteral">&quot;wasm.OnCompilationSucceeded&quot;</span>);</div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>    <span class="comment">// We have to make sure that an &quot;incumbent context&quot; is available in case</span></div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span>    <span class="comment">// the module&#39;s start function calls out to Blink.</span></div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span>    <a class="code hl_class" href="classv8_1_1Local.html">Local&lt;v8::Context&gt;</a> backup_incumbent_context =</div>
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"> 3208</span>        Utils::ToLocal(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4dff42fd647b975ce6708820a34fffe2">incumbent_context_</a>);</div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span>    <a class="code hl_class" href="classv8_1_1Context_1_1BackupIncumbentScope.html">v8::Context::BackupIncumbentScope</a> incumbent(backup_incumbent_context);</div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4025ea6ad5b7cac05d76451054ae6829">resolver_</a>-&gt;OnCompilationSucceeded(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>);</div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span>  }</div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span>  <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a8378f5ecdd236147a0b3c590c12899b8">RemoveCompileJob</a>(<span class="keyword">this</span>);</div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span>}</div>
</div>
<div class="line"><a id="l03214" name="l03214"></a><span class="lineno"> 3214</span> </div>
<div class="foldopen" id="foldopen03215" data-start="{" data-end="}">
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a9da068ebd21214867da972e51689bee5"> 3215</a></span><a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a9da068ebd21214867da972e51689bee5">AsyncStreamingProcessor::AsyncStreamingProcessor</a>(<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">AsyncCompileJob</a>* job)</div>
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"> 3216</span>    : decoder_(job-&gt;<a class="code hl_variable" href="module-decoder_8cc.html#a288adc12dc38d2126f4ebbb0b1595788">enabled_features_</a>, &amp;job-&gt;<a class="code hl_variable" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a>),</div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span>      job_(job),</div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span>      compilation_unit_builder_(nullptr) {}</div>
</div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span> </div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span><span class="comment">// Process the module header.</span></div>
<div class="foldopen" id="foldopen03221" data-start="{" data-end="}">
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aee9a0b6fb579488ab89cc95ea9e6caef"> 3221</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aee9a0b6fb579488ab89cc95ea9e6caef">AsyncStreamingProcessor::ProcessModuleHeader</a>(</div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> bytes) {</div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;Process module header...\n&quot;</span>);</div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"> 3224</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#adf6bbeca3b9ea708958affa0b8901d9c">DecodeModuleHeader</a>(bytes);</div>
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"> 3225</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a6261e2904d468325a0ce31fc10e95b65">ok</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span>  <span class="comment">// Note: We do not include the magic bytes in the hash; they are constant</span></div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span>  <span class="comment">// anyways.</span></div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>}</div>
</div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span> </div>
<div class="line"><a id="l03231" name="l03231"></a><span class="lineno"> 3231</span><span class="comment">// Process all sections except for the code section.</span></div>
<div class="foldopen" id="foldopen03232" data-start="{" data-end="}">
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aac7514bd78200ea2d33761023d266de4"> 3232</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aac7514bd78200ea2d33761023d266de4">AsyncStreamingProcessor::ProcessSection</a>(<a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a42a2fc870f8946e6ffe986e629a5693b">SectionCode</a> section_code,</div>
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"> 3233</span>                                             <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> bytes,</div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span>                                             uint32_t <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>) {</div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;Process section %d ...\n&quot;</span>, section_code);</div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>) {</div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span>    <span class="comment">// We reached a section after the code section, we do not need the</span></div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span>    <span class="comment">// compilation_unit_builder_ anymore.</span></div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span>    <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ae4c1a9be1a289f121f11888233dc2065">CommitCompilationUnits</a>();</div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>.reset();</div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span>  }</div>
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"> 3242</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a41aab3efc6dfb1d49db122d8d43176f6">before_code_section_</a>) {</div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span>    <span class="comment">// Combine section hashes until code section.</span></div>
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"> 3244</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>.<a class="code hl_function" href="classv8_1_1base_1_1Hasher.html#a2c18a03340bfe2dcb77dd407a4c42168">AddRange</a>(bytes);</div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>  }</div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span>  <span class="keywordflow">if</span> (section_code == <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a42a2fc870f8946e6ffe986e629a5693ba8cfdeb9213a3d517aed3c0ca252a5e6f">SectionCode::kUnknownSectionCode</a>) {</div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>    <span class="keywordtype">size_t</span> bytes_consumed = <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#ae4fc5f48b45481886c6146a470de6498">ModuleDecoder::IdentifyUnknownSection</a>(</div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span>        &amp;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>, bytes, <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>, &amp;section_code);</div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a6261e2904d468325a0ce31fc10e95b65">ok</a>()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span>    <span class="keywordflow">if</span> (section_code == <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a42a2fc870f8946e6ffe986e629a5693ba8cfdeb9213a3d517aed3c0ca252a5e6f">SectionCode::kUnknownSectionCode</a>) {</div>
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"> 3251</span>      <span class="comment">// Skip unknown sections that we do not know how to handle.</span></div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span>      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span>    }</div>
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"> 3254</span>    <span class="comment">// Remove the unknown section tag from the payload bytes.</span></div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span>    <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> += bytes_consumed;</div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span>    bytes = bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a2a7f93a33a4938bd73b628789f214d3d">SubVector</a>(bytes_consumed, bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a8f91dff816409fb9bceaa94c6caeec32">size</a>());</div>
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"> 3257</span>  }</div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a158d159abc6eff4987e7b574305f6efd">DecodeSection</a>(section_code, bytes, <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>);</div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a6261e2904d468325a0ce31fc10e95b65">ok</a>();</div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>}</div>
</div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span> </div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span><span class="comment">// Start the code section.</span></div>
<div class="foldopen" id="foldopen03263" data-start="{" data-end="}">
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a707cf5b73e892c3ddd7b74cef826c429"> 3263</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a707cf5b73e892c3ddd7b74cef826c429">AsyncStreamingProcessor::ProcessCodeSectionHeader</a>(</div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span>    <span class="keywordtype">int</span> num_functions, uint32_t functions_mismatch_error_offset,</div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span>    std::shared_ptr&lt;WireBytesStorage&gt; wire_bytes_storage,</div>
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"> 3266</span>    <span class="keywordtype">int</span> code_section_start, <span class="keywordtype">int</span> code_section_length) {</div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(0, code_section_length);</div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a41aab3efc6dfb1d49db122d8d43176f6">before_code_section_</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;Start the code section with %d functions...\n&quot;</span>,</div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span>                  num_functions);</div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>.<a class="code hl_function" href="classv8_1_1base_1_1Hasher.html#a3a8bff6d95b05559657966cf880d5025">Add</a>(<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code_section_length));</div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#af1e71390300a70d4322bbff2ec9c641e">CheckFunctionsCount</a>(<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(num_functions),</div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span>                                    functions_mismatch_error_offset)) {</div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span>  }</div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"> 3276</span> </div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a80a8197a6d39d2a6cf242bdcf6b01425">StartCodeSection</a>({<span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code_section_start),</div>
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"> 3278</span>                             <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(code_section_length)});</div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span> </div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;GetStreamingCompilationOwnership(</div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span>          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>.<a class="code hl_function" href="classv8_1_1base_1_1Hasher.html#a70be1a634ad5c9c0d93ac9ead95ff163">hash</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>)) {</div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>    <span class="comment">// Known prefix, wait until the end of the stream and check the cache.</span></div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aef24faaab0279a141c00469c1e66b617">prefix_cache_hit_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span>  }</div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span> </div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span>  <span class="comment">// Execute the PrepareAndStartCompile step immediately and not in a separate</span></div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span>  <span class="comment">// task.</span></div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span>  <span class="keywordtype">int</span> num_imported_functions =</div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span>      <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a09b197766daf7d8a7b45b449d393cdcd">module</a>()-&gt;num_imported_functions);</div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"> 3291</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a09b197766daf7d8a7b45b449d393cdcd">module</a>()-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a7871ace0ad8518a7de0c52ac35e43eb2">origin</a>);</div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> include_liftoff = <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.liftoff;</div>
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"> 3293</span>  <span class="keywordtype">size_t</span> code_size_estimate =</div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span>      <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmCodeManager.html#ab90b2371ac3c63fcc039e3189203dbb3">wasm::WasmCodeManager::EstimateNativeModuleCodeSize</a>(</div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span>          num_functions, num_imported_functions, code_section_length,</div>
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"> 3296</span>          include_liftoff, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a902952b2ef0c0a8cc6d4afb53b4480ce">dynamic_tiering_</a>);</div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#abb47c3e3846b0ae191c5c1c9c2ef0b84">DoImmediately</a>&lt;<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html">AsyncCompileJob::PrepareAndStartCompile</a>&gt;(</div>
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"> 3298</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a8acb438d35687ddde33f2711f57fc43e">shared_module</a>(),</div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span>      <span class="comment">// start_compilation: false; triggered when we receive the bodies.</span></div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span>      <span class="keyword">false</span>,</div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span>      <span class="comment">// lazy_functions_are_validated: false (bodies not received yet).</span></div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span>      <span class="keyword">false</span>, code_size_estimate);</div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span> </div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"> 3304</span>  <span class="keyword">auto</span>* compilation_state = Impl(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state());</div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>  compilation_state-&gt;SetWireBytesStorage(std::move(wire_bytes_storage));</div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;module()-&gt;origin, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>);</div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span> </div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span>  <span class="comment">// Set outstanding_finishers_ to 2, because both the AsyncCompileJob and the</span></div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span>  <span class="comment">// AsyncStreamingProcessor have to finish.</span></div>
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"> 3310</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ac2da5dad6fdcf531d99f2ddf886d3898">outstanding_finishers_</a>.store(2);</div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"> 3311</span>  <span class="comment">// TODO(13209): Use PGO for streaming compilation, if available.</span></div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>  <span class="keyword">constexpr</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1ProfileInformation.html">ProfileInformation</a>* kNoProfileInformation = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a> = InitializeCompilation(</div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0c031fff1a73728be15eea6c0a576e85">isolate</a>(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>.get(), kNoProfileInformation);</div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>}</div>
</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span> </div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span><span class="comment">// Process a function body.</span></div>
<div class="foldopen" id="foldopen03319" data-start="{" data-end="}">
<div class="line"><a id="l03319" name="l03319"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aa26940dbb1434275daab70cdf12e8326"> 3319</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aa26940dbb1434275daab70cdf12e8326">AsyncStreamingProcessor::ProcessFunctionBody</a>(</div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> bytes, uint32_t <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>) {</div>
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"> 3321</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;Process function body %d ...\n&quot;</span>, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">num_functions_</a>);</div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span>  uint32_t func_index =</div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a09b197766daf7d8a7b45b449d393cdcd">module</a>()-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a81b4b2b056e744758f875acafe4c909a">num_imported_functions</a> + <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">num_functions_</a>;</div>
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"> 3324</span>  ++<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">num_functions_</a>;</div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"> 3325</span>  <span class="comment">// In case of {prefix_cache_hit} we still need the function body to be</span></div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span>  <span class="comment">// decoded. Otherwise a later cache miss cannot be handled.</span></div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#aefc7fd0a74afba7f3300dde744b3c09d">DecodeFunctionBody</a>(func_index, <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(bytes.<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a1eb4ed5d322a219428bdb9f9a2cb6708">length</a>()),</div>
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"> 3328</span>                              <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>);</div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span> </div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aef24faaab0279a141c00469c1e66b617">prefix_cache_hit_</a>) {</div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span>    <span class="comment">// Don&#39;t compile yet if we might have a cache hit.</span></div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span>  }</div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span> </div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">WasmModule</a>* module = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a09b197766daf7d8a7b45b449d393cdcd">module</a>();</div>
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"> 3336</span>  <span class="keyword">auto</span> enabled_features = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">enabled_features_</a>;</div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a7871ace0ad8518a7de0c52ac35e43eb2">origin</a>, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>);</div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> lazy_module = <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation;</div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span>  CompileStrategy strategy =</div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span>      GetCompileStrategy(module, enabled_features, func_index, lazy_module);</div>
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"> 3341</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2c0c4cea27d0690467662bb05131b2af">CHECK_IMPLIES</a>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless, !<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation);</div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span>  <span class="keywordtype">bool</span> validate_lazily_compiled_function =</div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span>      <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless ||</div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span>      (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation &amp;&amp;</div>
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"> 3345</span>       (strategy == CompileStrategy::kLazy ||</div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span>        strategy == CompileStrategy::kLazyBaselineEagerTopTier));</div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span>  <span class="keywordflow">if</span> (validate_lazily_compiled_function) {</div>
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"> 3348</span>    <span class="comment">// {bytes} is part of a section buffer owned by the streaming decoder. The</span></div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span>    <span class="comment">// streaming decoder is held alive by the {AsyncCompileJob}, so we can just</span></div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span>    <span class="comment">// use the {bytes} vector as long as the {AsyncCompileJob} is still running.</span></div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>) {</div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">validate_functions_job_data_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a30537e9b0e0f4d0160b17f97f2ceed43">Initialize</a>(module-&gt;<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a5a60fa14372f7bc06d7d6f51d23b0bee">num_declared_functions</a>);</div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a> = <a class="code hl_function" href="classv8_1_1internal_1_1V8.html#a5eb1d47c492fa1e85e7d7c31dd5cf2bb">V8::GetCurrentPlatform</a>()-&gt;<a class="code hl_function" href="classv8_1_1Platform.html#ab919eff7610c970ccff4c605617289db">CreateJob</a>(</div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>          <a class="code hl_enumvalue" href="namespacev8.html#a680c1a715d1d5df94b21e8b1ee1bf051a602dfdb2b16ea7a1f4392dc3d5761f7d">TaskPriority::kUserVisible</a>,</div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span>          std::make_unique&lt;ValidateFunctionsStreamingJob&gt;(</div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span>              module, enabled_features, &amp;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">validate_functions_job_data_</a>));</div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span>    }</div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">validate_functions_job_data_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aea4d7941a772b26e34a901b0e3dad6c9">AddUnit</a>(func_index, bytes,</div>
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"> 3359</span>                                         <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>.get());</div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span>  }</div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span> </div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span>  <span class="keyword">auto</span>* compilation_state = Impl(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state());</div>
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"> 3363</span>  compilation_state-&gt;AddCompilationUnit(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>.get(),</div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span>                                        func_index);</div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span>}</div>
</div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span> </div>
<div class="foldopen" id="foldopen03368" data-start="{" data-end="}">
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ae4c1a9be1a289f121f11888233dc2065"> 3368</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ae4c1a9be1a289f121f11888233dc2065">AsyncStreamingProcessor::CommitCompilationUnits</a>() {</div>
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"> 3369</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>);</div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>-&gt;Commit();</div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>}</div>
</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span> </div>
<div class="foldopen" id="foldopen03373" data-start="{" data-end="}">
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a19842d57ed6e47f88fc3ccb57cd43619"> 3373</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a19842d57ed6e47f88fc3ccb57cd43619">AsyncStreamingProcessor::OnFinishedChunk</a>() {</div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;FinishChunk...\n&quot;</span>);</div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">compilation_unit_builder_</a>) <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ae4c1a9be1a289f121f11888233dc2065">CommitCompilationUnits</a>();</div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span>}</div>
</div>
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"> 3377</span> </div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span><span class="comment">// Finish the processing of the stream.</span></div>
<div class="foldopen" id="foldopen03379" data-start="{" data-end="}">
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a1299b61f757fe2cfa5ec698e755650e0"> 3379</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a1299b61f757fe2cfa5ec698e755650e0">AsyncStreamingProcessor::OnFinishedStream</a>(</div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span>    <a class="code hl_class" href="classv8_1_1base_1_1OwnedVector.html">base::OwnedVector&lt;const uint8_t&gt;</a> bytes, <span class="keywordtype">bool</span> after_error) {</div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;Finish stream...\n&quot;</span>);</div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1Result.html">ModuleResult</a> module_result = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">decoder_</a>.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#ab269c7b3c86924c81fcad654b3e3a446">FinishDecoding</a>();</div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span>  <span class="keywordflow">if</span> (module_result.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1Result.html#aff1e1589e6852f41ed5a060d5e4517f9">failed</a>()) after_error = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span> </div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>) {</div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span>    <span class="comment">// Wait for background validation to finish, then check if a validation</span></div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span>    <span class="comment">// error was found.</span></div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span>    <span class="comment">// TODO(13447): Do not block here; register validation as another finisher</span></div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span>    <span class="comment">// instead.</span></div>
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"> 3390</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>-&gt;Join();</div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>.reset();</div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">validate_functions_job_data_</a>.<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a9cfdfc887c8e71d8e6f5e70352b372c2">found_error</a>) after_error = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"> 3393</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a> |=</div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">validate_functions_job_data_</a>.<a class="code hl_variable" href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#ace23482eb9e8803b07a5f797fb9a0985">detected_features</a>.load(</div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span>            std::memory_order_relaxed);</div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span>  }</div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span> </div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a> = <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html">ModuleWireBytes</a>(bytes.<a class="code hl_function" href="classv8_1_1base_1_1OwnedVector.html#af39d85796ffd00480472cde62fb36012">as_vector</a>());</div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9267b6a79f50110f5e4a79b38d0678d">bytes_copy_</a> = std::move(bytes);</div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span> </div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span>  <span class="keywordflow">if</span> (!after_error) {</div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_imports_features;</div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmError.html">WasmError</a> error = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a97644489c4ab86ae3156930153cd1b5e">ValidateAndSetBuiltinImports</a>(</div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span>            module_result.<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1Result.html#a4f23066466cbb5c5f8e7b3962e642479">value</a>().get(), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>(),</div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span>            <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>, &amp;detected_imports_features)) {</div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span>      after_error = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a> |= detected_imports_features;</div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span>    }</div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span>  }</div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span> </div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span>  <span class="comment">// Record event metrics.</span></div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span>  <span class="keyword">auto</span> duration = <a class="code hl_function" href="classv8_1_1base_1_1TimeTicks.html#ab0886bf0e84f1e1fcdc101021c2c0775">base::TimeTicks::Now</a>() - <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab632923d90b8ad7e8d6b3bbb8e985a7f">start_time_</a>;</div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>.<a class="code hl_variable" href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a4cee86a201704ae118af2b1ca9ace654">success</a> = !after_error;</div>
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"> 3415</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>.<a class="code hl_variable" href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a74b4fc4ae92e15fb9f6c73dbff7d9a16">streamed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>.<a class="code hl_variable" href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a0c885c3b1441ebec57f9287097d22c8a">module_size_in_bytes</a> = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#a31e859ce9fbc3561f23d5411edd92c4b">length</a>();</div>
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"> 3417</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>.<a class="code hl_variable" href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a3a12992a55d6b19a482b62b19ca4897f">function_count</a> = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">num_functions_</a>;</div>
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"> 3418</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>.<a class="code hl_variable" href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a6411b52c7ce98217b836614f6c3169e9">wall_clock_duration_in_us</a> = duration.InMicroseconds();</div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#ae2a2e88c3939f4c98fbb0fb2d91f26a7">metrics_recorder</a>()-&gt;DelayMainThreadEvent(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">metrics_event_</a>,</div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span>                                                           <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5d62877a0c3d97edb19bcefa2e452c57">context_id_</a>);</div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span> </div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"> 3422</span>  <span class="keywordflow">if</span> (after_error) {</div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> &amp;&amp; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;wire_bytes().empty()) {</div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span>      <span class="comment">// Clean up the temporary cache entry.</span></div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span>      <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a9df42171758a2a5af30388a2b7e97de8">StreamingCompilationFailed</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>.<a class="code hl_function" href="classv8_1_1base_1_1Hasher.html#a70be1a634ad5c9c0d93ac9ead95ff163">hash</a>(),</div>
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"> 3426</span>                                                  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>);</div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span>    }</div>
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"> 3428</span>    <span class="comment">// Calling {Failed} will invalidate the {AsyncCompileJob} and delete {this}.</span></div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48">Failed</a>();</div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span>  }</div>
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"> 3432</span> </div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span>  std::shared_ptr&lt;WasmModule&gt; module = std::move(module_result).value();</div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span> </div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span>  <span class="comment">// At this point we identified the module as valid (except maybe for function</span></div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span>  <span class="comment">// bodies, if lazy validation is enabled).</span></div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span>  <span class="comment">// This DCHECK could be considered slow, but it only happens once per async</span></div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span>  <span class="comment">// module compilation, and we only re-decode the module structure, without</span></div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span>  <span class="comment">// validating function bodies. Overall this does not add a lot of overhead.</span></div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span>  <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_module_features;</div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a83ed1297167cba9f8c8971bacab69dbf">DecodeWasmModule</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">enabled_features_</a>,</div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span>                          <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9267b6a79f50110f5e4a79b38d0678d">bytes_copy_</a>.<a class="code hl_function" href="classv8_1_1base_1_1OwnedVector.html#af39d85796ffd00480472cde62fb36012">as_vector</a>(),</div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span>                          <span class="comment">/* validate functions */</span> <span class="keyword">false</span>, <a class="code hl_enumvalue" href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">kWasmOrigin</a>,</div>
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"> 3445</span>                          &amp;detected_module_features)</div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span>             .<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1Result.html#a084b2eb633d37457622cd4dc1cd2e506">ok</a>());</div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span>  <span class="comment">// Module decoding should not detect any new features.</span></div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">detected_features_</a>.<a class="code hl_function" href="classv8_1_1base_1_1EnumSet.html#a66b0696fe38f3541c9df3c5dc0e300f1">contains_all</a>(detected_module_features));</div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span> </div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModuleCache.html#ac7e973c109cc4129f87b3cc3c775f10b">NativeModuleCache::PrefixHash</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>()),</div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span>            <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>.<a class="code hl_function" href="classv8_1_1base_1_1Hasher.html#a70be1a634ad5c9c0d93ac9ead95ff163">hash</a>());</div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aef24faaab0279a141c00469c1e66b617">prefix_cache_hit_</a>) {</div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span>    <span class="comment">// Restart as an asynchronous, non-streaming compilation. Most likely</span></div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span>    <span class="comment">// {PrepareAndStartCompile} will get the native module from the cache.</span></div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> include_liftoff = <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.liftoff;</div>
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"> 3457</span>    <span class="keywordtype">size_t</span> code_size_estimate =</div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span>        <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmCodeManager.html#ab90b2371ac3c63fcc039e3189203dbb3">wasm::WasmCodeManager::EstimateNativeModuleCodeSize</a>(</div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"> 3459</span>            module.get(), include_liftoff, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a902952b2ef0c0a8cc6d4afb53b4480ce">dynamic_tiering_</a>);</div>
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"> 3460</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">DoSync</a>&lt;<a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html">AsyncCompileJob::PrepareAndStartCompile</a>&gt;(</div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span>        std::move(module), <span class="keyword">true</span> <span class="comment">/* start_compilation */</span>,</div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span>        <span class="keyword">false</span> <span class="comment">/* lazy_functions_are_validated_ */</span>, code_size_estimate);</div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span>  }</div>
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"> 3465</span> </div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span>  <span class="comment">// We have to open a HandleScope and prepare the Context for</span></div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span>  <span class="comment">// CreateNativeModule, PrepareRuntimeObjects and FinishCompile as this is a</span></div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span>  <span class="comment">// callback from the embedder.</span></div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span>  <a class="code hl_class" href="classv8_1_1internal_1_1HandleScope.html">HandleScope</a> scope(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span>  <a class="code hl_class" href="classv8_1_1internal_1_1SaveAndSwitchContext.html">SaveAndSwitchContext</a> saved_context(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, *<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a>);</div>
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"> 3471</span> </div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span>  <span class="comment">// Record the size of the wire bytes and the number of functions. In</span></div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span>  <span class="comment">// synchronous and asynchronous (non-streaming) compilation, this happens in</span></div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span>  <span class="comment">// {DecodeWasmModule}.</span></div>
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"> 3475</span>  <span class="keyword">auto</span>* module_size_histogram =</div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a267e21e771e72483e74bf9c13c9cd267">counters</a>()-&gt;wasm_wasm_module_size_bytes();</div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span>  module_size_histogram-&gt;AddSample(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a>.<a class="code hl_function" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">module_bytes</a>().<a class="code hl_function" href="classv8_1_1base_1_1Vector.html#a1eb4ed5d322a219428bdb9f9a2cb6708">length</a>());</div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span>  <span class="keyword">auto</span>* num_functions_histogram =</div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a267e21e771e72483e74bf9c13c9cd267">counters</a>()-&gt;wasm_functions_per_wasm_module();</div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span>  num_functions_histogram-&gt;AddSample(<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">num_functions_</a>));</div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span> </div>
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"> 3482</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> has_code_section = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> != <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"> 3483</span>  <span class="keywordtype">bool</span> cache_hit = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"> 3484</span>  <span class="keywordflow">if</span> (!has_code_section) {</div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span>    <span class="comment">// We are processing a WebAssembly module without code section. Create the</span></div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span>    <span class="comment">// native module now (would otherwise happen in {PrepareAndStartCompile} or</span></div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"> 3487</span>    <span class="comment">// {ProcessCodeSectionHeader}).</span></div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span>    <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> kCodeSizeEstimate = 0;</div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span>    cache_hit =</div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span>        <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad155f15fbc01d3537cbaf00b74c2f382">GetOrCreateNativeModule</a>(std::move(module), kCodeSizeEstimate);</div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"> 3492</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;SetWireBytes(std::move(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9267b6a79f50110f5e4a79b38d0678d">bytes_copy_</a>));</div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span>  }</div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span>  <span class="keyword">const</span> <span class="keywordtype">bool</span> needs_finish = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0f21c0af12e028ae3c120b03fbe2c835">DecrementAndCheckFinisherCount</a>();</div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a>(!has_code_section, needs_finish);</div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span>  <span class="keywordflow">if</span> (needs_finish) {</div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> failed = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;compilation_state()-&gt;failed();</div>
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"> 3498</span>    <span class="keywordflow">if</span> (!cache_hit) {</div>
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"> 3499</span>      <span class="keyword">auto</span>* prev_native_module = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>.get();</div>
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"> 3500</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ae049eb40219a3e542bf2811e42ac1bb8">UpdateNativeModuleCache</a>(</div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span>          failed, std::move(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>), <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span>      cache_hit = prev_native_module != <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>.get();</div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span>    }</div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span>    <span class="comment">// We finally call {Failed} or {FinishCompile}, which will invalidate the</span></div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span>    <span class="comment">// {AsyncCompileJob} and delete {this}.</span></div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span>    <span class="keywordflow">if</span> (failed) {</div>
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"> 3507</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48">Failed</a>();</div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1">FinishCompile</a>(cache_hit);</div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span>    }</div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span>  }</div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span>}</div>
</div>
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"> 3513</span> </div>
<div class="foldopen" id="foldopen03514" data-start="{" data-end="}">
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a807224ecf5ba4eaf8434dea9b99a78a8"> 3514</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a807224ecf5ba4eaf8434dea9b99a78a8">AsyncStreamingProcessor::OnAbort</a>() {</div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span>  <a class="code hl_define" href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a>(<span class="stringliteral">&quot;Abort stream...\n&quot;</span>);</div>
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"> 3516</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>) {</div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>-&gt;Cancel();</div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span>    <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">validate_functions_job_handle_</a>.reset();</div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span>  }</div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> &amp;&amp; <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;wire_bytes().empty()) {</div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span>    <span class="comment">// Clean up the temporary cache entry.</span></div>
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"> 3522</span>    <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a9df42171758a2a5af30388a2b7e97de8">StreamingCompilationFailed</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">prefix_hasher_</a>.<a class="code hl_function" href="classv8_1_1base_1_1Hasher.html#a70be1a634ad5c9c0d93ac9ead95ff163">hash</a>(),</div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span>                                                <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>);</div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>  }</div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span>  <span class="comment">// {Abort} invalidates the {AsyncCompileJob}, which in turn deletes {this}.</span></div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1969624508b5f667f28f0bb9ff9dfb1a">Abort</a>();</div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span>}</div>
</div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span> </div>
<div class="foldopen" id="foldopen03529" data-start="{" data-end="}">
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"><a class="line" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac33024dbe8bff894aec911642a350dc6"> 3529</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac33024dbe8bff894aec911642a350dc6">AsyncStreamingProcessor::Deserialize</a>(</div>
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"> 3530</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> module_bytes,</div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span>    <a class="code hl_class" href="classv8_1_1base_1_1Vector.html">base::Vector&lt;const uint8_t&gt;</a> wire_bytes) {</div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, <span class="stringliteral">&quot;wasm.Deserialize&quot;</span>);</div>
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"> 3533</span>  std::optional&lt;TimedHistogramScope&gt; time_scope;</div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="classv8_1_1base_1_1TimeTicks.html#acdd9f8482c321164c58f46bc65372c9b">base::TimeTicks::IsHighResolution</a>()) {</div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>    time_scope.emplace(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0c031fff1a73728be15eea6c0a576e85">isolate</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a267e21e771e72483e74bf9c13c9cd267">counters</a>()-&gt;wasm_deserialization_time(),</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span>                       <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0c031fff1a73728be15eea6c0a576e85">isolate</a>());</div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span>  }</div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span>  <span class="comment">// DeserializeNativeModule and FinishCompile assume that they are executed in</span></div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span>  <span class="comment">// a HandleScope, and that a context is set on the isolate.</span></div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span>  <a class="code hl_class" href="classv8_1_1internal_1_1HandleScope.html">HandleScope</a> scope(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>);</div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span>  <a class="code hl_class" href="classv8_1_1internal_1_1SaveAndSwitchContext.html">SaveAndSwitchContext</a> saved_context(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, *<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">native_context_</a>);</div>
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"> 3542</span> </div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span>  <a class="code hl_class" href="classv8_1_1internal_1_1MaybeDirectHandle.html">MaybeDirectHandle&lt;WasmModuleObject&gt;</a> <a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a5deccc3082c791de6590472f43f92299">DeserializeNativeModule</a>(</div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>, module_bytes, wire_bytes, <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">compile_imports_</a>,</div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span>      <a class="code hl_function" href="namespacev8_1_1base.html#ab277246c6caecad159bbc8755cf6bb54">base::VectorOf</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">stream_</a>-&gt;url()));</div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span> </div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.is_null()) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span> </div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a> =</div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span>      <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">isolate_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1Isolate.html#a0567c99c2a3ff016df9e7abb30688075">global_handles</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1GlobalHandles.html#a486c475da54faf1fe78e4752ed20e23c">Create</a>(*<a class="code hl_variable" href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a>.ToHandleChecked());</div>
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"> 3551</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a> = <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">module_object_</a>-&gt;shared_native_module();</div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">wire_bytes_</a> = <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html">ModuleWireBytes</a>(<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">native_module_</a>-&gt;wire_bytes());</div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span>  <span class="comment">// Calling {FinishCompile} deletes the {AsyncCompileJob} and {this}.</span></div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span>  <a class="code hl_variable" href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">job_</a>-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1">FinishCompile</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span>}</div>
</div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span> </div>
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"> 3558</span>CompilationStateImpl::CompilationStateImpl(</div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>    <span class="keyword">const</span> std::shared_ptr&lt;NativeModule&gt;&amp; native_module,</div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span>    std::shared_ptr&lt;Counters&gt; async_counters, <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">DynamicTiering</a> dynamic_tiering,</div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"> 3561</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">WasmDetectedFeatures</a> detected_features)</div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span>    : <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(native_module.get()),</div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(native_module)),</div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(async_counters)),</div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>(native_module-&gt;num_functions()),</div>
<div class="line"><a id="l03566" name="l03566"></a><span class="lineno"> 3566</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a>(dynamic_tiering),</div>
<div class="line"><a id="l03567" name="l03567"></a><span class="lineno"> 3567</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a>(detected_features) {}</div>
<div class="line"><a id="l03568" name="l03568"></a><span class="lineno"> 3568</span> </div>
<div class="line"><a id="l03569" name="l03569"></a><span class="lineno"> 3569</span><span class="keywordtype">void</span> CompilationStateImpl::InitCompileJob() {</div>
<div class="line"><a id="l03570" name="l03570"></a><span class="lineno"> 3570</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>);</div>
<div class="line"><a id="l03571" name="l03571"></a><span class="lineno"> 3571</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>);</div>
<div class="line"><a id="l03572" name="l03572"></a><span class="lineno"> 3572</span>  <span class="comment">// Create the job, but don&#39;t spawn workers yet. This will happen on</span></div>
<div class="line"><a id="l03573" name="l03573"></a><span class="lineno"> 3573</span>  <span class="comment">// {NotifyConcurrencyIncrease}.</span></div>
<div class="line"><a id="l03574" name="l03574"></a><span class="lineno"> 3574</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a> = V8::GetCurrentPlatform()-&gt;CreateJob(</div>
<div class="line"><a id="l03575" name="l03575"></a><span class="lineno"> 3575</span>      TaskPriority::kUserVisible,</div>
<div class="line"><a id="l03576" name="l03576"></a><span class="lineno"> 3576</span>      std::make_unique&lt;BackgroundCompileJob&gt;(</div>
<div class="line"><a id="l03577" name="l03577"></a><span class="lineno"> 3577</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>, CompilationTier::kBaseline));</div>
<div class="line"><a id="l03578" name="l03578"></a><span class="lineno"> 3578</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a> = V8::GetCurrentPlatform()-&gt;CreateJob(</div>
<div class="line"><a id="l03579" name="l03579"></a><span class="lineno"> 3579</span>      TaskPriority::kUserVisible,</div>
<div class="line"><a id="l03580" name="l03580"></a><span class="lineno"> 3580</span>      std::make_unique&lt;BackgroundCompileJob&gt;(</div>
<div class="line"><a id="l03581" name="l03581"></a><span class="lineno"> 3581</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>, CompilationTier::kTopTier));</div>
<div class="line"><a id="l03582" name="l03582"></a><span class="lineno"> 3582</span>}</div>
<div class="line"><a id="l03583" name="l03583"></a><span class="lineno"> 3583</span> </div>
<div class="line"><a id="l03584" name="l03584"></a><span class="lineno"> 3584</span><span class="keywordtype">void</span> CompilationStateImpl::CancelCompilation(</div>
<div class="line"><a id="l03585" name="l03585"></a><span class="lineno"> 3585</span>    CompilationStateImpl::CancellationPolicy cancellation_policy) {</div>
<div class="line"><a id="l03586" name="l03586"></a><span class="lineno"> 3586</span>  <a class="code hl_class" href="classv8_1_1base_1_1LockGuard.html">base::SpinningMutexGuard</a> callbacks_guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03587" name="l03587"></a><span class="lineno"> 3587</span> </div>
<div class="line"><a id="l03588" name="l03588"></a><span class="lineno"> 3588</span>  <span class="keywordflow">if</span> (cancellation_policy == kCancelInitialCompilation &amp;&amp;</div>
<div class="line"><a id="l03589" name="l03589"></a><span class="lineno"> 3589</span>      <a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>.contains(</div>
<div class="line"><a id="l03590" name="l03590"></a><span class="lineno"> 3590</span>          CompilationEvent::kFinishedBaselineCompilation)) {</div>
<div class="line"><a id="l03591" name="l03591"></a><span class="lineno"> 3591</span>    <span class="comment">// Initial compilation already finished; cannot be cancelled.</span></div>
<div class="line"><a id="l03592" name="l03592"></a><span class="lineno"> 3592</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l03593" name="l03593"></a><span class="lineno"> 3593</span>  }</div>
<div class="line"><a id="l03594" name="l03594"></a><span class="lineno"> 3594</span> </div>
<div class="line"><a id="l03595" name="l03595"></a><span class="lineno"> 3595</span>  <span class="comment">// std::memory_order_relaxed is sufficient because no other state is</span></div>
<div class="line"><a id="l03596" name="l03596"></a><span class="lineno"> 3596</span>  <span class="comment">// synchronized with |compile_cancelled_|.</span></div>
<div class="line"><a id="l03597" name="l03597"></a><span class="lineno"> 3597</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a8be0288f8228634650c4bea900954c65">compile_cancelled_</a>.store(<span class="keyword">true</span>, std::memory_order_relaxed);</div>
<div class="line"><a id="l03598" name="l03598"></a><span class="lineno"> 3598</span> </div>
<div class="line"><a id="l03599" name="l03599"></a><span class="lineno"> 3599</span>  <span class="comment">// No more callbacks after abort.</span></div>
<div class="line"><a id="l03600" name="l03600"></a><span class="lineno"> 3600</span>  <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.clear();</div>
<div class="line"><a id="l03601" name="l03601"></a><span class="lineno"> 3601</span>}</div>
<div class="line"><a id="l03602" name="l03602"></a><span class="lineno"> 3602</span> </div>
<div class="line"><a id="l03603" name="l03603"></a><span class="lineno"> 3603</span><span class="keywordtype">bool</span> CompilationStateImpl::cancelled()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l03604" name="l03604"></a><span class="lineno"> 3604</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a8be0288f8228634650c4bea900954c65">compile_cancelled_</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l03605" name="l03605"></a><span class="lineno"> 3605</span>}</div>
<div class="line"><a id="l03606" name="l03606"></a><span class="lineno"> 3606</span> </div>
<div class="line"><a id="l03607" name="l03607"></a><span class="lineno"> 3607</span><span class="keywordtype">void</span> CompilationStateImpl::ApplyCompilationHintToInitialProgress(</div>
<div class="line"><a id="l03608" name="l03608"></a><span class="lineno"> 3608</span>    <span class="keyword">const</span> WasmCompilationHint&amp; hint, <span class="keywordtype">size_t</span> hint_idx) {</div>
<div class="line"><a id="l03609" name="l03609"></a><span class="lineno"> 3609</span>  <span class="comment">// Get old information.</span></div>
<div class="line"><a id="l03610" name="l03610"></a><span class="lineno"> 3610</span>  uint8_t&amp; progress = <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[hint_idx];</div>
<div class="line"><a id="l03611" name="l03611"></a><span class="lineno"> 3611</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_baseline_tier = RequiredBaselineTierField::decode(progress);</div>
<div class="line"><a id="l03612" name="l03612"></a><span class="lineno"> 3612</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_top_tier = RequiredTopTierField::decode(progress);</div>
<div class="line"><a id="l03613" name="l03613"></a><span class="lineno"> 3613</span> </div>
<div class="line"><a id="l03614" name="l03614"></a><span class="lineno"> 3614</span>  <span class="comment">// Compute new information.</span></div>
<div class="line"><a id="l03615" name="l03615"></a><span class="lineno"> 3615</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> new_baseline_tier =</div>
<div class="line"><a id="l03616" name="l03616"></a><span class="lineno"> 3616</span>      ApplyHintToExecutionTier(hint.baseline_tier, old_baseline_tier);</div>
<div class="line"><a id="l03617" name="l03617"></a><span class="lineno"> 3617</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> new_top_tier =</div>
<div class="line"><a id="l03618" name="l03618"></a><span class="lineno"> 3618</span>      ApplyHintToExecutionTier(hint.top_tier, old_top_tier);</div>
<div class="line"><a id="l03619" name="l03619"></a><span class="lineno"> 3619</span>  <span class="keywordflow">switch</span> (hint.strategy) {</div>
<div class="line"><a id="l03620" name="l03620"></a><span class="lineno"> 3620</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kDefault:</div>
<div class="line"><a id="l03621" name="l03621"></a><span class="lineno"> 3621</span>      <span class="comment">// Be careful not to switch from lazy to non-lazy.</span></div>
<div class="line"><a id="l03622" name="l03622"></a><span class="lineno"> 3622</span>      <span class="keywordflow">if</span> (old_baseline_tier == ExecutionTier::kNone) {</div>
<div class="line"><a id="l03623" name="l03623"></a><span class="lineno"> 3623</span>        new_baseline_tier = ExecutionTier::kNone;</div>
<div class="line"><a id="l03624" name="l03624"></a><span class="lineno"> 3624</span>      }</div>
<div class="line"><a id="l03625" name="l03625"></a><span class="lineno"> 3625</span>      <span class="keywordflow">if</span> (old_top_tier == ExecutionTier::kNone) {</div>
<div class="line"><a id="l03626" name="l03626"></a><span class="lineno"> 3626</span>        new_top_tier = ExecutionTier::kNone;</div>
<div class="line"><a id="l03627" name="l03627"></a><span class="lineno"> 3627</span>      }</div>
<div class="line"><a id="l03628" name="l03628"></a><span class="lineno"> 3628</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03629" name="l03629"></a><span class="lineno"> 3629</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kLazy:</div>
<div class="line"><a id="l03630" name="l03630"></a><span class="lineno"> 3630</span>      new_baseline_tier = ExecutionTier::kNone;</div>
<div class="line"><a id="l03631" name="l03631"></a><span class="lineno"> 3631</span>      new_top_tier = ExecutionTier::kNone;</div>
<div class="line"><a id="l03632" name="l03632"></a><span class="lineno"> 3632</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03633" name="l03633"></a><span class="lineno"> 3633</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kEager:</div>
<div class="line"><a id="l03634" name="l03634"></a><span class="lineno"> 3634</span>      <span class="comment">// Nothing to do, use the encoded (new) tiers.</span></div>
<div class="line"><a id="l03635" name="l03635"></a><span class="lineno"> 3635</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03636" name="l03636"></a><span class="lineno"> 3636</span>    <span class="keywordflow">case</span> WasmCompilationHintStrategy::kLazyBaselineEagerTopTier:</div>
<div class="line"><a id="l03637" name="l03637"></a><span class="lineno"> 3637</span>      new_baseline_tier = ExecutionTier::kNone;</div>
<div class="line"><a id="l03638" name="l03638"></a><span class="lineno"> 3638</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03639" name="l03639"></a><span class="lineno"> 3639</span>  }</div>
<div class="line"><a id="l03640" name="l03640"></a><span class="lineno"> 3640</span> </div>
<div class="line"><a id="l03641" name="l03641"></a><span class="lineno"> 3641</span>  progress = RequiredBaselineTierField::update(progress, new_baseline_tier);</div>
<div class="line"><a id="l03642" name="l03642"></a><span class="lineno"> 3642</span>  progress = RequiredTopTierField::update(progress, new_top_tier);</div>
<div class="line"><a id="l03643" name="l03643"></a><span class="lineno"> 3643</span> </div>
<div class="line"><a id="l03644" name="l03644"></a><span class="lineno"> 3644</span>  <span class="comment">// Update counter for outstanding baseline units.</span></div>
<div class="line"><a id="l03645" name="l03645"></a><span class="lineno"> 3645</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> += (new_baseline_tier != ExecutionTier::kNone) -</div>
<div class="line"><a id="l03646" name="l03646"></a><span class="lineno"> 3646</span>                                 (old_baseline_tier != ExecutionTier::kNone);</div>
<div class="line"><a id="l03647" name="l03647"></a><span class="lineno"> 3647</span>}</div>
<div class="line"><a id="l03648" name="l03648"></a><span class="lineno"> 3648</span> </div>
<div class="line"><a id="l03649" name="l03649"></a><span class="lineno"> 3649</span><span class="keywordtype">void</span> CompilationStateImpl::ApplyPgoInfoToInitialProgress(</div>
<div class="line"><a id="l03650" name="l03650"></a><span class="lineno"> 3650</span>    ProfileInformation* pgo_info) {</div>
<div class="line"><a id="l03651" name="l03651"></a><span class="lineno"> 3651</span>  <span class="comment">// Functions that were executed in the profiling run are eagerly compiled to</span></div>
<div class="line"><a id="l03652" name="l03652"></a><span class="lineno"> 3652</span>  <span class="comment">// Liftoff.</span></div>
<div class="line"><a id="l03653" name="l03653"></a><span class="lineno"> 3653</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module();</div>
<div class="line"><a id="l03654" name="l03654"></a><span class="lineno"> 3654</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> func_index : pgo_info-&gt;executed_functions()) {</div>
<div class="line"><a id="l03655" name="l03655"></a><span class="lineno"> 3655</span>    uint8_t&amp; progress =</div>
<div class="line"><a id="l03656" name="l03656"></a><span class="lineno"> 3656</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)];</div>
<div class="line"><a id="l03657" name="l03657"></a><span class="lineno"> 3657</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_baseline_tier =</div>
<div class="line"><a id="l03658" name="l03658"></a><span class="lineno"> 3658</span>        RequiredBaselineTierField::decode(progress);</div>
<div class="line"><a id="l03659" name="l03659"></a><span class="lineno"> 3659</span>    <span class="comment">// If the function is already marked for eager compilation, we are good.</span></div>
<div class="line"><a id="l03660" name="l03660"></a><span class="lineno"> 3660</span>    <span class="keywordflow">if</span> (old_baseline_tier != ExecutionTier::kNone) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span> </div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>    <span class="comment">// Set the baseline tier to Liftoff, so we eagerly compile to Liftoff.</span></div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span>    <span class="comment">// TODO(13288): Compile Liftoff code in the background, if lazy compilation</span></div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span>    <span class="comment">// is enabled.</span></div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span>    progress =</div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>        RequiredBaselineTierField::update(progress, ExecutionTier::kLiftoff);</div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>    ++<a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a>;</div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span>  }</div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span> </div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span>  <span class="comment">// Functions that were tiered up during PGO generation are eagerly compiled to</span></div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span>  <span class="comment">// TurboFan (in the background, not blocking instantiation).</span></div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> func_index : pgo_info-&gt;tiered_up_functions()) {</div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span>    uint8_t&amp; progress =</div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)];</div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_baseline_tier =</div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span>        RequiredBaselineTierField::decode(progress);</div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_top_tier = RequiredTopTierField::decode(progress);</div>
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"> 3678</span>    <span class="comment">// If the function is already marked for eager or background compilation to</span></div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span>    <span class="comment">// TurboFan, we are good.</span></div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>    <span class="keywordflow">if</span> (old_baseline_tier == ExecutionTier::kTurbofan) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span>    <span class="keywordflow">if</span> (old_top_tier == ExecutionTier::kTurbofan) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span> </div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span>    <span class="comment">// Set top tier to TurboFan, so we eagerly trigger compilation in the</span></div>
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"> 3684</span>    <span class="comment">// background.</span></div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span>    progress = RequiredTopTierField::update(progress, ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span>  }</div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span>}</div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span> </div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span><span class="keywordtype">void</span> CompilationStateImpl::ApplyPgoInfoLate(ProfileInformation* pgo_info) {</div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, <span class="stringliteral">&quot;wasm.ApplyPgoInfo&quot;</span>);</div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module();</div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span>  CompilationUnitBuilder builder{<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>};</div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span> </div>
<div class="line"><a id="l03694" name="l03694"></a><span class="lineno"> 3694</span>  base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03695" name="l03695"></a><span class="lineno"> 3695</span>  <span class="comment">// Functions that were executed in the profiling run are eagerly compiled to</span></div>
<div class="line"><a id="l03696" name="l03696"></a><span class="lineno"> 3696</span>  <span class="comment">// Liftoff (in the background).</span></div>
<div class="line"><a id="l03697" name="l03697"></a><span class="lineno"> 3697</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> func_index : pgo_info-&gt;executed_functions()) {</div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span>    uint8_t&amp; progress =</div>
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"> 3699</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)];</div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_baseline_tier =</div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span>        RequiredBaselineTierField::decode(progress);</div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span>    <span class="comment">// If the function is already marked for eager compilation, we are good.</span></div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span>    <span class="keywordflow">if</span> (old_baseline_tier != ExecutionTier::kNone) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span> </div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>    <span class="comment">// If we already compiled Liftoff or TurboFan code, we are also good.</span></div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> reached_tier = ReachedTierField::decode(progress);</div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>    <span class="keywordflow">if</span> (reached_tier &gt;= ExecutionTier::kLiftoff) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span> </div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span>    <span class="comment">// Set the baseline tier to Liftoff and schedule a compilation unit.</span></div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span>    progress =</div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>        RequiredBaselineTierField::update(progress, ExecutionTier::kLiftoff);</div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>    <span class="comment">// Add this as a &quot;top tier unit&quot; since it does not contribute to initial</span></div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>    <span class="comment">// compilation (&quot;baseline finished&quot; might already be triggered).</span></div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span>    <span class="comment">// TODO(clemensb): Rename &quot;baseline finished&quot; to &quot;initial compile finished&quot;.</span></div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>    <span class="comment">// TODO(clemensb): Avoid scheduling both a Liftoff and a TurboFan unit, or</span></div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>    <span class="comment">// prioritize Liftoff when executing the units.</span></div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span>    builder.AddTopTierUnit(func_index, ExecutionTier::kLiftoff);</div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span>  }</div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span> </div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>  <span class="comment">// Functions that were tiered up during PGO generation are eagerly compiled to</span></div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>  <span class="comment">// TurboFan in the background.</span></div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> func_index : pgo_info-&gt;tiered_up_functions()) {</div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>    uint8_t&amp; progress =</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)];</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_baseline_tier =</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span>        RequiredBaselineTierField::decode(progress);</div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> old_top_tier = RequiredTopTierField::decode(progress);</div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span>    <span class="comment">// If the function is already marked for eager or background compilation to</span></div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span>    <span class="comment">// TurboFan, we are good.</span></div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>    <span class="keywordflow">if</span> (old_baseline_tier == ExecutionTier::kTurbofan) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span>    <span class="keywordflow">if</span> (old_top_tier == ExecutionTier::kTurbofan) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span> </div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span>    <span class="comment">// If we already compiled TurboFan code, we are also good.</span></div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> reached_tier = ReachedTierField::decode(progress);</div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>    <span class="keywordflow">if</span> (reached_tier == ExecutionTier::kTurbofan) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span> </div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>    <span class="comment">// Set top tier to TurboFan and schedule a compilation unit.</span></div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span>    progress = RequiredTopTierField::update(progress, ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span>    builder.AddTopTierUnit(func_index, ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l03740" name="l03740"></a><span class="lineno"> 3740</span>  }</div>
<div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>  builder.Commit();</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>}</div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span> </div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span><span class="keywordtype">void</span> CompilationStateImpl::InitializeCompilationProgress(</div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>    ProfileInformation* pgo_info) {</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!failed());</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span> </div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>  base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span> </div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>    <span class="keyword">auto</span>* <span class="keyword">module</span> = native_module_-&gt;module();</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span> </div>
<div class="line"><a id="l03753" name="l03753"></a><span class="lineno"> 3753</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(0, <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a>);</div>
<div class="line"><a id="l03754" name="l03754"></a><span class="lineno"> 3754</span> </div>
<div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>    <span class="comment">// Compute the default compilation progress for all functions, and set it.</span></div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>    <span class="keyword">const</span> ExecutionTierPair default_tiers = GetDefaultTiersPerModule(</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;IsInDebugState(),</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>        IsLazyModule(module));</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>    <span class="keyword">const</span> uint8_t default_progress =</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>        RequiredBaselineTierField::encode(default_tiers.baseline_tier) |</div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>        RequiredTopTierField::encode(default_tiers.top_tier) |</div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>        ReachedTierField::encode(ExecutionTier::kNone);</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>.assign(module-&gt;num_declared_functions,</div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span>                                 default_progress);</div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span>    <span class="keywordflow">if</span> (default_tiers.baseline_tier != ExecutionTier::kNone) {</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> += <span class="keyword">module</span>-&gt;num_declared_functions;</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>    }</div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span> </div>
<div class="line"><a id="l03769" name="l03769"></a><span class="lineno"> 3769</span>    <span class="comment">// Apply compilation hints, if enabled.</span></div>
<div class="line"><a id="l03770" name="l03770"></a><span class="lineno"> 3770</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;enabled_features().has_compilation_hints()) {</div>
<div class="line"><a id="l03771" name="l03771"></a><span class="lineno"> 3771</span>      <span class="keywordtype">size_t</span> num_hints = std::min(module-&gt;compilation_hints.size(),</div>
<div class="line"><a id="l03772" name="l03772"></a><span class="lineno"> 3772</span>                                  <span class="keywordtype">size_t</span>{module-&gt;num_declared_functions});</div>
<div class="line"><a id="l03773" name="l03773"></a><span class="lineno"> 3773</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> hint_idx = 0; hint_idx &lt; num_hints; ++hint_idx) {</div>
<div class="line"><a id="l03774" name="l03774"></a><span class="lineno"> 3774</span>        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; hint = <span class="keyword">module</span>-&gt;compilation_hints[hint_idx];</div>
<div class="line"><a id="l03775" name="l03775"></a><span class="lineno"> 3775</span>        ApplyCompilationHintToInitialProgress(hint, hint_idx);</div>
<div class="line"><a id="l03776" name="l03776"></a><span class="lineno"> 3776</span>      }</div>
<div class="line"><a id="l03777" name="l03777"></a><span class="lineno"> 3777</span>    }</div>
<div class="line"><a id="l03778" name="l03778"></a><span class="lineno"> 3778</span> </div>
<div class="line"><a id="l03779" name="l03779"></a><span class="lineno"> 3779</span>    <span class="comment">// Transform --wasm-eager-tier-up-function, if given, into a fake</span></div>
<div class="line"><a id="l03780" name="l03780"></a><span class="lineno"> 3780</span>    <span class="comment">// compilation hint.</span></div>
<div class="line"><a id="l03781" name="l03781"></a><span class="lineno"> 3781</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="v8config_8h.html#a67bd29db07c711b0fb11ff1c324ebb60">V8_UNLIKELY</a>(</div>
<div class="line"><a id="l03782" name="l03782"></a><span class="lineno"> 3782</span>            <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_eager_tier_up_function &gt;= 0 &amp;&amp;</div>
<div class="line"><a id="l03783" name="l03783"></a><span class="lineno"> 3783</span>            <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_eager_tier_up_function) &gt;=</div>
<div class="line"><a id="l03784" name="l03784"></a><span class="lineno"> 3784</span>                module-&gt;num_imported_functions &amp;&amp;</div>
<div class="line"><a id="l03785" name="l03785"></a><span class="lineno"> 3785</span>            <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_eager_tier_up_function) &lt;</div>
<div class="line"><a id="l03786" name="l03786"></a><span class="lineno"> 3786</span>                module-&gt;functions.size())) {</div>
<div class="line"><a id="l03787" name="l03787"></a><span class="lineno"> 3787</span>      uint32_t func_idx =</div>
<div class="line"><a id="l03788" name="l03788"></a><span class="lineno"> 3788</span>          <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_eager_tier_up_function - <span class="keyword">module</span>-&gt;num_imported_functions;</div>
<div class="line"><a id="l03789" name="l03789"></a><span class="lineno"> 3789</span>      WasmCompilationHint hint{WasmCompilationHintStrategy::kEager,</div>
<div class="line"><a id="l03790" name="l03790"></a><span class="lineno"> 3790</span>                               WasmCompilationHintTier::kOptimized,</div>
<div class="line"><a id="l03791" name="l03791"></a><span class="lineno"> 3791</span>                               WasmCompilationHintTier::kOptimized};</div>
<div class="line"><a id="l03792" name="l03792"></a><span class="lineno"> 3792</span>      ApplyCompilationHintToInitialProgress(hint, func_idx);</div>
<div class="line"><a id="l03793" name="l03793"></a><span class="lineno"> 3793</span>    }</div>
<div class="line"><a id="l03794" name="l03794"></a><span class="lineno"> 3794</span>  }</div>
<div class="line"><a id="l03795" name="l03795"></a><span class="lineno"> 3795</span> </div>
<div class="line"><a id="l03796" name="l03796"></a><span class="lineno"> 3796</span>  <span class="comment">// Apply PGO information, if available.</span></div>
<div class="line"><a id="l03797" name="l03797"></a><span class="lineno"> 3797</span>  <span class="keywordflow">if</span> (pgo_info) ApplyPgoInfoToInitialProgress(pgo_info);</div>
<div class="line"><a id="l03798" name="l03798"></a><span class="lineno"> 3798</span> </div>
<div class="line"><a id="l03799" name="l03799"></a><span class="lineno"> 3799</span>  <span class="comment">// Trigger callbacks if module needs no baseline or top tier compilation. This</span></div>
<div class="line"><a id="l03800" name="l03800"></a><span class="lineno"> 3800</span>  <span class="comment">// can be the case for an empty or fully lazy module.</span></div>
<div class="line"><a id="l03801" name="l03801"></a><span class="lineno"> 3801</span>  TriggerOutstandingCallbacks();</div>
<div class="line"><a id="l03802" name="l03802"></a><span class="lineno"> 3802</span>}</div>
<div class="line"><a id="l03803" name="l03803"></a><span class="lineno"> 3803</span> </div>
<div class="line"><a id="l03804" name="l03804"></a><span class="lineno"> 3804</span><span class="keywordtype">void</span> CompilationStateImpl::AddCompilationUnitInternal(</div>
<div class="line"><a id="l03805" name="l03805"></a><span class="lineno"> 3805</span>    CompilationUnitBuilder* builder, <span class="keywordtype">int</span> function_index,</div>
<div class="line"><a id="l03806" name="l03806"></a><span class="lineno"> 3806</span>    uint8_t function_progress) {</div>
<div class="line"><a id="l03807" name="l03807"></a><span class="lineno"> 3807</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> required_baseline_tier =</div>
<div class="line"><a id="l03808" name="l03808"></a><span class="lineno"> 3808</span>      CompilationStateImpl::RequiredBaselineTierField::decode(</div>
<div class="line"><a id="l03809" name="l03809"></a><span class="lineno"> 3809</span>          function_progress);</div>
<div class="line"><a id="l03810" name="l03810"></a><span class="lineno"> 3810</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> required_top_tier =</div>
<div class="line"><a id="l03811" name="l03811"></a><span class="lineno"> 3811</span>      CompilationStateImpl::RequiredTopTierField::decode(function_progress);</div>
<div class="line"><a id="l03812" name="l03812"></a><span class="lineno"> 3812</span>  <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> reached_tier =</div>
<div class="line"><a id="l03813" name="l03813"></a><span class="lineno"> 3813</span>      CompilationStateImpl::ReachedTierField::decode(function_progress);</div>
<div class="line"><a id="l03814" name="l03814"></a><span class="lineno"> 3814</span> </div>
<div class="line"><a id="l03815" name="l03815"></a><span class="lineno"> 3815</span>  <span class="keywordflow">if</span> (reached_tier &lt; required_baseline_tier) {</div>
<div class="line"><a id="l03816" name="l03816"></a><span class="lineno"> 3816</span>    builder-&gt;AddBaselineUnit(function_index, required_baseline_tier);</div>
<div class="line"><a id="l03817" name="l03817"></a><span class="lineno"> 3817</span>  }</div>
<div class="line"><a id="l03818" name="l03818"></a><span class="lineno"> 3818</span>  <span class="keywordflow">if</span> (reached_tier &lt; required_top_tier &amp;&amp;</div>
<div class="line"><a id="l03819" name="l03819"></a><span class="lineno"> 3819</span>      required_baseline_tier != required_top_tier) {</div>
<div class="line"><a id="l03820" name="l03820"></a><span class="lineno"> 3820</span>    builder-&gt;AddTopTierUnit(function_index, required_top_tier);</div>
<div class="line"><a id="l03821" name="l03821"></a><span class="lineno"> 3821</span>  }</div>
<div class="line"><a id="l03822" name="l03822"></a><span class="lineno"> 3822</span>}</div>
<div class="line"><a id="l03823" name="l03823"></a><span class="lineno"> 3823</span> </div>
<div class="line"><a id="l03824" name="l03824"></a><span class="lineno"> 3824</span><span class="keywordtype">void</span> CompilationStateImpl::InitializeCompilationUnits(</div>
<div class="line"><a id="l03825" name="l03825"></a><span class="lineno"> 3825</span>    std::unique_ptr&lt;CompilationUnitBuilder&gt; builder) {</div>
<div class="line"><a id="l03826" name="l03826"></a><span class="lineno"> 3826</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l03827" name="l03827"></a><span class="lineno"> 3827</span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module()-&gt;num_imported_functions;</div>
<div class="line"><a id="l03828" name="l03828"></a><span class="lineno"> 3828</span>    {</div>
<div class="line"><a id="l03829" name="l03829"></a><span class="lineno"> 3829</span>      base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03830" name="l03830"></a><span class="lineno"> 3830</span> </div>
<div class="line"><a id="l03831" name="l03831"></a><span class="lineno"> 3831</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0, e = <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>.<a class="code hl_class" href="classsize.html">size</a>(); <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; e; ++<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>) {</div>
<div class="line"><a id="l03832" name="l03832"></a><span class="lineno"> 3832</span>        uint8_t function_progress = <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>];</div>
<div class="line"><a id="l03833" name="l03833"></a><span class="lineno"> 3833</span>        <span class="keywordtype">int</span> func_index = <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>);</div>
<div class="line"><a id="l03834" name="l03834"></a><span class="lineno"> 3834</span>        AddCompilationUnitInternal(builder.get(), func_index,</div>
<div class="line"><a id="l03835" name="l03835"></a><span class="lineno"> 3835</span>                                   function_progress);</div>
<div class="line"><a id="l03836" name="l03836"></a><span class="lineno"> 3836</span>      }</div>
<div class="line"><a id="l03837" name="l03837"></a><span class="lineno"> 3837</span>    }</div>
<div class="line"><a id="l03838" name="l03838"></a><span class="lineno"> 3838</span>  }</div>
<div class="line"><a id="l03839" name="l03839"></a><span class="lineno"> 3839</span>  builder-&gt;Commit();</div>
<div class="line"><a id="l03840" name="l03840"></a><span class="lineno"> 3840</span>}</div>
<div class="line"><a id="l03841" name="l03841"></a><span class="lineno"> 3841</span> </div>
<div class="line"><a id="l03842" name="l03842"></a><span class="lineno"> 3842</span><span class="keywordtype">void</span> CompilationStateImpl::AddCompilationUnit(CompilationUnitBuilder* builder,</div>
<div class="line"><a id="l03843" name="l03843"></a><span class="lineno"> 3843</span>                                              <span class="keywordtype">int</span> func_index) {</div>
<div class="line"><a id="l03844" name="l03844"></a><span class="lineno"> 3844</span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a> = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module()-&gt;num_imported_functions;</div>
<div class="line"><a id="l03845" name="l03845"></a><span class="lineno"> 3845</span>  <span class="keywordtype">int</span> progress_index = func_index - <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a>;</div>
<div class="line"><a id="l03846" name="l03846"></a><span class="lineno"> 3846</span>  uint8_t function_progress = 0;</div>
<div class="line"><a id="l03847" name="l03847"></a><span class="lineno"> 3847</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l03848" name="l03848"></a><span class="lineno"> 3848</span>    <span class="comment">// TODO(ahaas): This lock may cause overhead. If so, we could get rid of the</span></div>
<div class="line"><a id="l03849" name="l03849"></a><span class="lineno"> 3849</span>    <span class="comment">// lock as follows:</span></div>
<div class="line"><a id="l03850" name="l03850"></a><span class="lineno"> 3850</span>    <span class="comment">// 1) Make compilation_progress_ an array of atomic&lt;uint8_t&gt;, and access it</span></div>
<div class="line"><a id="l03851" name="l03851"></a><span class="lineno"> 3851</span>    <span class="comment">// lock-free.</span></div>
<div class="line"><a id="l03852" name="l03852"></a><span class="lineno"> 3852</span>    <span class="comment">// 2) Have a copy of compilation_progress_ that we use for initialization.</span></div>
<div class="line"><a id="l03853" name="l03853"></a><span class="lineno"> 3853</span>    <span class="comment">// 3) Just re-calculate the content of compilation_progress_.</span></div>
<div class="line"><a id="l03854" name="l03854"></a><span class="lineno"> 3854</span>    base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03855" name="l03855"></a><span class="lineno"> 3855</span>    function_progress = <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[progress_index];</div>
<div class="line"><a id="l03856" name="l03856"></a><span class="lineno"> 3856</span>  }</div>
<div class="line"><a id="l03857" name="l03857"></a><span class="lineno"> 3857</span>  AddCompilationUnitInternal(builder, func_index, function_progress);</div>
<div class="line"><a id="l03858" name="l03858"></a><span class="lineno"> 3858</span>}</div>
<div class="line"><a id="l03859" name="l03859"></a><span class="lineno"> 3859</span> </div>
<div class="line"><a id="l03860" name="l03860"></a><span class="lineno"> 3860</span><span class="keywordtype">void</span> CompilationStateImpl::InitializeCompilationProgressAfterDeserialization(</div>
<div class="line"><a id="l03861" name="l03861"></a><span class="lineno"> 3861</span>    base::Vector&lt;const int&gt; lazy_functions,</div>
<div class="line"><a id="l03862" name="l03862"></a><span class="lineno"> 3862</span>    base::Vector&lt;const int&gt; eager_functions) {</div>
<div class="line"><a id="l03863" name="l03863"></a><span class="lineno"> 3863</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#a58927f99d797f77024561f336303380c">TRACE_EVENT2</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, <span class="stringliteral">&quot;wasm.CompilationAfterDeserialization&quot;</span>,</div>
<div class="line"><a id="l03864" name="l03864"></a><span class="lineno"> 3864</span>               <span class="stringliteral">&quot;num_lazy_functions&quot;</span>, lazy_functions.size(),</div>
<div class="line"><a id="l03865" name="l03865"></a><span class="lineno"> 3865</span>               <span class="stringliteral">&quot;num_eager_functions&quot;</span>, eager_functions.size());</div>
<div class="line"><a id="l03866" name="l03866"></a><span class="lineno"> 3866</span>  std::optional&lt;TimedHistogramScope&gt; lazy_compile_time_scope;</div>
<div class="line"><a id="l03867" name="l03867"></a><span class="lineno"> 3867</span>  <span class="keywordflow">if</span> (base::TimeTicks::IsHighResolution()) {</div>
<div class="line"><a id="l03868" name="l03868"></a><span class="lineno"> 3868</span>    lazy_compile_time_scope.emplace(</div>
<div class="line"><a id="l03869" name="l03869"></a><span class="lineno"> 3869</span>        counters()-&gt;wasm_compile_after_deserialize());</div>
<div class="line"><a id="l03870" name="l03870"></a><span class="lineno"> 3870</span>  }</div>
<div class="line"><a id="l03871" name="l03871"></a><span class="lineno"> 3871</span> </div>
<div class="line"><a id="l03872" name="l03872"></a><span class="lineno"> 3872</span>  <span class="keyword">auto</span>* <span class="keyword">module</span> = native_module_-&gt;module();</div>
<div class="line"><a id="l03873" name="l03873"></a><span class="lineno"> 3873</span>  {</div>
<div class="line"><a id="l03874" name="l03874"></a><span class="lineno"> 3874</span>    base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03875" name="l03875"></a><span class="lineno"> 3875</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>.empty());</div>
<div class="line"><a id="l03876" name="l03876"></a><span class="lineno"> 3876</span> </div>
<div class="line"><a id="l03877" name="l03877"></a><span class="lineno"> 3877</span>    <span class="comment">// Initialize the compilation progress as if everything was</span></div>
<div class="line"><a id="l03878" name="l03878"></a><span class="lineno"> 3878</span>    <span class="comment">// TurboFan-compiled.</span></div>
<div class="line"><a id="l03879" name="l03879"></a><span class="lineno"> 3879</span>    <span class="keyword">constexpr</span> uint8_t kProgressAfterTurbofanDeserialization =</div>
<div class="line"><a id="l03880" name="l03880"></a><span class="lineno"> 3880</span>        RequiredBaselineTierField::encode(ExecutionTier::kLiftoff) |</div>
<div class="line"><a id="l03881" name="l03881"></a><span class="lineno"> 3881</span>        RequiredTopTierField::encode(ExecutionTier::kTurbofan) |</div>
<div class="line"><a id="l03882" name="l03882"></a><span class="lineno"> 3882</span>        ReachedTierField::encode(ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l03883" name="l03883"></a><span class="lineno"> 3883</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>.assign(module-&gt;num_declared_functions,</div>
<div class="line"><a id="l03884" name="l03884"></a><span class="lineno"> 3884</span>                                 kProgressAfterTurbofanDeserialization);</div>
<div class="line"><a id="l03885" name="l03885"></a><span class="lineno"> 3885</span> </div>
<div class="line"><a id="l03886" name="l03886"></a><span class="lineno"> 3886</span>    <span class="comment">// Update compilation state for lazy functions.</span></div>
<div class="line"><a id="l03887" name="l03887"></a><span class="lineno"> 3887</span>    <span class="keyword">constexpr</span> uint8_t kProgressForLazyFunctions =</div>
<div class="line"><a id="l03888" name="l03888"></a><span class="lineno"> 3888</span>        RequiredBaselineTierField::encode(ExecutionTier::kNone) |</div>
<div class="line"><a id="l03889" name="l03889"></a><span class="lineno"> 3889</span>        RequiredTopTierField::encode(ExecutionTier::kNone) |</div>
<div class="line"><a id="l03890" name="l03890"></a><span class="lineno"> 3890</span>        ReachedTierField::encode(ExecutionTier::kNone);</div>
<div class="line"><a id="l03891" name="l03891"></a><span class="lineno"> 3891</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> func_index : lazy_functions) {</div>
<div class="line"><a id="l03892" name="l03892"></a><span class="lineno"> 3892</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)] =</div>
<div class="line"><a id="l03893" name="l03893"></a><span class="lineno"> 3893</span>          kProgressForLazyFunctions;</div>
<div class="line"><a id="l03894" name="l03894"></a><span class="lineno"> 3894</span>    }</div>
<div class="line"><a id="l03895" name="l03895"></a><span class="lineno"> 3895</span> </div>
<div class="line"><a id="l03896" name="l03896"></a><span class="lineno"> 3896</span>    <span class="comment">// Update compilation state for eagerly compiled functions.</span></div>
<div class="line"><a id="l03897" name="l03897"></a><span class="lineno"> 3897</span>    <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> kNotLazy = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03898" name="l03898"></a><span class="lineno"> 3898</span>    ExecutionTierPair default_tiers =</div>
<div class="line"><a id="l03899" name="l03899"></a><span class="lineno"> 3899</span>        GetDefaultTiersPerModule(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a>,</div>
<div class="line"><a id="l03900" name="l03900"></a><span class="lineno"> 3900</span>                                 <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;IsInDebugState(), kNotLazy);</div>
<div class="line"><a id="l03901" name="l03901"></a><span class="lineno"> 3901</span>    uint8_t progress_for_eager_functions =</div>
<div class="line"><a id="l03902" name="l03902"></a><span class="lineno"> 3902</span>        RequiredBaselineTierField::encode(default_tiers.baseline_tier) |</div>
<div class="line"><a id="l03903" name="l03903"></a><span class="lineno"> 3903</span>        RequiredTopTierField::encode(default_tiers.top_tier) |</div>
<div class="line"><a id="l03904" name="l03904"></a><span class="lineno"> 3904</span>        ReachedTierField::encode(ExecutionTier::kNone);</div>
<div class="line"><a id="l03905" name="l03905"></a><span class="lineno"> 3905</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> func_index : eager_functions) {</div>
<div class="line"><a id="l03906" name="l03906"></a><span class="lineno"> 3906</span>      <span class="comment">// Check that {func_index} is not contained in {lazy_functions}.</span></div>
<div class="line"><a id="l03907" name="l03907"></a><span class="lineno"> 3907</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(</div>
<div class="line"><a id="l03908" name="l03908"></a><span class="lineno"> 3908</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)],</div>
<div class="line"><a id="l03909" name="l03909"></a><span class="lineno"> 3909</span>          kProgressAfterTurbofanDeserialization);</div>
<div class="line"><a id="l03910" name="l03910"></a><span class="lineno"> 3910</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[<a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(module, func_index)] =</div>
<div class="line"><a id="l03911" name="l03911"></a><span class="lineno"> 3911</span>          progress_for_eager_functions;</div>
<div class="line"><a id="l03912" name="l03912"></a><span class="lineno"> 3912</span>    }</div>
<div class="line"><a id="l03913" name="l03913"></a><span class="lineno"> 3913</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a986dc8f4ec6dcd0644efe205c13f8eb7">DCHECK_NE</a>(ExecutionTier::kNone, default_tiers.baseline_tier);</div>
<div class="line"><a id="l03914" name="l03914"></a><span class="lineno"> 3914</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> += eager_functions.size();</div>
<div class="line"><a id="l03915" name="l03915"></a><span class="lineno"> 3915</span> </div>
<div class="line"><a id="l03916" name="l03916"></a><span class="lineno"> 3916</span>    <span class="comment">// Baseline compilation is done if we do not have any Liftoff functions to</span></div>
<div class="line"><a id="l03917" name="l03917"></a><span class="lineno"> 3917</span>    <span class="comment">// compile.</span></div>
<div class="line"><a id="l03918" name="l03918"></a><span class="lineno"> 3918</span>    <span class="keywordflow">if</span> (eager_functions.empty() || <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation) {</div>
<div class="line"><a id="l03919" name="l03919"></a><span class="lineno"> 3919</span>      <a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>.Add(CompilationEvent::kFinishedBaselineCompilation);</div>
<div class="line"><a id="l03920" name="l03920"></a><span class="lineno"> 3920</span>    }</div>
<div class="line"><a id="l03921" name="l03921"></a><span class="lineno"> 3921</span>  }</div>
<div class="line"><a id="l03922" name="l03922"></a><span class="lineno"> 3922</span>  <span class="keyword">auto</span> builder = std::make_unique&lt;CompilationUnitBuilder&gt;(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>);</div>
<div class="line"><a id="l03923" name="l03923"></a><span class="lineno"> 3923</span>  InitializeCompilationUnits(std::move(builder));</div>
<div class="line"><a id="l03924" name="l03924"></a><span class="lineno"> 3924</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation) {</div>
<div class="line"><a id="l03925" name="l03925"></a><span class="lineno"> 3925</span>    WaitForCompilationEvent(CompilationEvent::kFinishedBaselineCompilation);</div>
<div class="line"><a id="l03926" name="l03926"></a><span class="lineno"> 3926</span>  }</div>
<div class="line"><a id="l03927" name="l03927"></a><span class="lineno"> 3927</span>}</div>
<div class="line"><a id="l03928" name="l03928"></a><span class="lineno"> 3928</span> </div>
<div class="line"><a id="l03929" name="l03929"></a><span class="lineno"> 3929</span><span class="keywordtype">void</span> CompilationStateImpl::AddCallback(</div>
<div class="line"><a id="l03930" name="l03930"></a><span class="lineno"> 3930</span>    std::unique_ptr&lt;CompilationEventCallback&gt; <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>) {</div>
<div class="line"><a id="l03931" name="l03931"></a><span class="lineno"> 3931</span>  base::SpinningMutexGuard callbacks_guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03932" name="l03932"></a><span class="lineno"> 3932</span>  <span class="comment">// Immediately trigger events that already happened.</span></div>
<div class="line"><a id="l03933" name="l03933"></a><span class="lineno"> 3933</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> event : {CompilationEvent::kFinishedBaselineCompilation,</div>
<div class="line"><a id="l03934" name="l03934"></a><span class="lineno"> 3934</span>                     CompilationEvent::kFailedCompilation}) {</div>
<div class="line"><a id="l03935" name="l03935"></a><span class="lineno"> 3935</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>.contains(event)) {</div>
<div class="line"><a id="l03936" name="l03936"></a><span class="lineno"> 3936</span>      <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>-&gt;call(event);</div>
<div class="line"><a id="l03937" name="l03937"></a><span class="lineno"> 3937</span>    }</div>
<div class="line"><a id="l03938" name="l03938"></a><span class="lineno"> 3938</span>  }</div>
<div class="line"><a id="l03939" name="l03939"></a><span class="lineno"> 3939</span>  <span class="keyword">constexpr</span> base::EnumSet&lt;CompilationEvent&gt; kFinalEvents{</div>
<div class="line"><a id="l03940" name="l03940"></a><span class="lineno"> 3940</span>      CompilationEvent::kFailedCompilation};</div>
<div class="line"><a id="l03941" name="l03941"></a><span class="lineno"> 3941</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>.contains_any(kFinalEvents)) {</div>
<div class="line"><a id="l03942" name="l03942"></a><span class="lineno"> 3942</span>    <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.emplace_back(std::move(<a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>));</div>
<div class="line"><a id="l03943" name="l03943"></a><span class="lineno"> 3943</span>  }</div>
<div class="line"><a id="l03944" name="l03944"></a><span class="lineno"> 3944</span>}</div>
<div class="line"><a id="l03945" name="l03945"></a><span class="lineno"> 3945</span> </div>
<div class="line"><a id="l03946" name="l03946"></a><span class="lineno"> 3946</span><span class="keywordtype">void</span> CompilationStateImpl::CommitCompilationUnits(</div>
<div class="line"><a id="l03947" name="l03947"></a><span class="lineno"> 3947</span>    base::Vector&lt;WasmCompilationUnit&gt; baseline_units,</div>
<div class="line"><a id="l03948" name="l03948"></a><span class="lineno"> 3948</span>    base::Vector&lt;WasmCompilationUnit&gt; top_tier_units) {</div>
<div class="line"><a id="l03949" name="l03949"></a><span class="lineno"> 3949</span>  base::SpinningMutexGuard guard{&amp;<a class="code hl_variable" href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a>};</div>
<div class="line"><a id="l03950" name="l03950"></a><span class="lineno"> 3950</span>  <span class="keywordflow">if</span> (!baseline_units.empty() || !top_tier_units.empty()) {</div>
<div class="line"><a id="l03951" name="l03951"></a><span class="lineno"> 3951</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.AddUnits(baseline_units, top_tier_units,</div>
<div class="line"><a id="l03952" name="l03952"></a><span class="lineno"> 3952</span>                                      <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module());</div>
<div class="line"><a id="l03953" name="l03953"></a><span class="lineno"> 3953</span>  }</div>
<div class="line"><a id="l03954" name="l03954"></a><span class="lineno"> 3954</span>  <span class="keywordflow">if</span> (!baseline_units.empty()) {</div>
<div class="line"><a id="l03955" name="l03955"></a><span class="lineno"> 3955</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>-&gt;IsValid());</div>
<div class="line"><a id="l03956" name="l03956"></a><span class="lineno"> 3956</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>-&gt;NotifyConcurrencyIncrease();</div>
<div class="line"><a id="l03957" name="l03957"></a><span class="lineno"> 3957</span>  }</div>
<div class="line"><a id="l03958" name="l03958"></a><span class="lineno"> 3958</span>  <span class="keywordflow">if</span> (!top_tier_units.empty()) {</div>
<div class="line"><a id="l03959" name="l03959"></a><span class="lineno"> 3959</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>-&gt;IsValid());</div>
<div class="line"><a id="l03960" name="l03960"></a><span class="lineno"> 3960</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>-&gt;NotifyConcurrencyIncrease();</div>
<div class="line"><a id="l03961" name="l03961"></a><span class="lineno"> 3961</span>  }</div>
<div class="line"><a id="l03962" name="l03962"></a><span class="lineno"> 3962</span>}</div>
<div class="line"><a id="l03963" name="l03963"></a><span class="lineno"> 3963</span> </div>
<div class="line"><a id="l03964" name="l03964"></a><span class="lineno"> 3964</span><span class="keywordtype">void</span> CompilationStateImpl::CommitTopTierCompilationUnit(</div>
<div class="line"><a id="l03965" name="l03965"></a><span class="lineno"> 3965</span>    WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>) {</div>
<div class="line"><a id="l03966" name="l03966"></a><span class="lineno"> 3966</span>  CommitCompilationUnits({}, {&amp;<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>, 1});</div>
<div class="line"><a id="l03967" name="l03967"></a><span class="lineno"> 3967</span>}</div>
<div class="line"><a id="l03968" name="l03968"></a><span class="lineno"> 3968</span> </div>
<div class="line"><a id="l03969" name="l03969"></a><span class="lineno"> 3969</span><span class="keywordtype">void</span> CompilationStateImpl::AddTopTierPriorityCompilationUnit(</div>
<div class="line"><a id="l03970" name="l03970"></a><span class="lineno"> 3970</span>    WasmCompilationUnit <a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>, <span class="keywordtype">size_t</span> <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>) {</div>
<div class="line"><a id="l03971" name="l03971"></a><span class="lineno"> 3971</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.AddTopTierPriorityUnit(<a class="code hl_variable" href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a>);</div>
<div class="line"><a id="l03972" name="l03972"></a><span class="lineno"> 3972</span>  <span class="comment">// We should not have a {CodeSpaceWriteScope} open at this point, as</span></div>
<div class="line"><a id="l03973" name="l03973"></a><span class="lineno"> 3973</span>  <span class="comment">// {NotifyConcurrencyIncrease} can spawn new threads which could inherit PKU</span></div>
<div class="line"><a id="l03974" name="l03974"></a><span class="lineno"> 3974</span>  <span class="comment">// permissions (which would be a security issue).</span></div>
<div class="line"><a id="l03975" name="l03975"></a><span class="lineno"> 3975</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a>-&gt;NotifyConcurrencyIncrease();</div>
<div class="line"><a id="l03976" name="l03976"></a><span class="lineno"> 3976</span>}</div>
<div class="line"><a id="l03977" name="l03977"></a><span class="lineno"> 3977</span> </div>
<div class="line"><a id="l03978" name="l03978"></a><span class="lineno"> 3978</span>CompilationUnitQueues::Queue* CompilationStateImpl::GetQueueForCompileTask(</div>
<div class="line"><a id="l03979" name="l03979"></a><span class="lineno"> 3979</span>    <span class="keywordtype">int</span> task_id) {</div>
<div class="line"><a id="l03980" name="l03980"></a><span class="lineno"> 3980</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.GetQueueForTask(task_id);</div>
<div class="line"><a id="l03981" name="l03981"></a><span class="lineno"> 3981</span>}</div>
<div class="line"><a id="l03982" name="l03982"></a><span class="lineno"> 3982</span> </div>
<div class="line"><a id="l03983" name="l03983"></a><span class="lineno"> 3983</span>std::optional&lt;WasmCompilationUnit&gt; CompilationStateImpl::GetNextCompilationUnit(</div>
<div class="line"><a id="l03984" name="l03984"></a><span class="lineno"> 3984</span>    CompilationUnitQueues::Queue* queue, CompilationTier tier) {</div>
<div class="line"><a id="l03985" name="l03985"></a><span class="lineno"> 3985</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.GetNextUnit(queue, tier);</div>
<div class="line"><a id="l03986" name="l03986"></a><span class="lineno"> 3986</span>}</div>
<div class="line"><a id="l03987" name="l03987"></a><span class="lineno"> 3987</span> </div>
<div class="line"><a id="l03988" name="l03988"></a><span class="lineno"> 3988</span><span class="keywordtype">void</span> CompilationStateImpl::OnFinishedUnits(</div>
<div class="line"><a id="l03989" name="l03989"></a><span class="lineno"> 3989</span>    base::Vector&lt;WasmCode*&gt; code_vector) {</div>
<div class="line"><a id="l03990" name="l03990"></a><span class="lineno"> 3990</span>  <a class="code hl_define" href="trace-event-no-perfetto_8h.html#ac437f27e15925a9bd53c69692a6c85fe">TRACE_EVENT1</a>(<a class="code hl_define" href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a>(<span class="stringliteral">&quot;v8.wasm.detailed&quot;</span>),</div>
<div class="line"><a id="l03991" name="l03991"></a><span class="lineno"> 3991</span>               <span class="stringliteral">&quot;wasm.OnFinishedUnits&quot;</span>, <span class="stringliteral">&quot;units&quot;</span>, code_vector.size());</div>
<div class="line"><a id="l03992" name="l03992"></a><span class="lineno"> 3992</span> </div>
<div class="line"><a id="l03993" name="l03993"></a><span class="lineno"> 3993</span>  base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l03994" name="l03994"></a><span class="lineno"> 3994</span> </div>
<div class="line"><a id="l03995" name="l03995"></a><span class="lineno"> 3995</span>  <span class="comment">// Assume an order of execution tiers that represents the quality of their</span></div>
<div class="line"><a id="l03996" name="l03996"></a><span class="lineno"> 3996</span>  <span class="comment">// generated code.</span></div>
<div class="line"><a id="l03997" name="l03997"></a><span class="lineno"> 3997</span>  <span class="keyword">static_assert</span>(ExecutionTier::kNone &lt; ExecutionTier::kLiftoff &amp;&amp;</div>
<div class="line"><a id="l03998" name="l03998"></a><span class="lineno"> 3998</span>                    ExecutionTier::kLiftoff &lt; ExecutionTier::kTurbofan,</div>
<div class="line"><a id="l03999" name="l03999"></a><span class="lineno"> 3999</span>                <span class="stringliteral">&quot;Assume an order on execution tiers&quot;</span>);</div>
<div class="line"><a id="l04000" name="l04000"></a><span class="lineno"> 4000</span> </div>
<div class="line"><a id="l04001" name="l04001"></a><span class="lineno"> 4001</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l04002" name="l04002"></a><span class="lineno"> 4002</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>.size(),</div>
<div class="line"><a id="l04003" name="l04003"></a><span class="lineno"> 4003</span>              <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module()-&gt;num_declared_functions);</div>
<div class="line"><a id="l04004" name="l04004"></a><span class="lineno"> 4004</span>  }</div>
<div class="line"><a id="l04005" name="l04005"></a><span class="lineno"> 4005</span> </div>
<div class="line"><a id="l04006" name="l04006"></a><span class="lineno"> 4006</span>  <span class="keywordtype">bool</span> has_top_tier_code = <span class="keyword">false</span>;</div>
<div class="line"><a id="l04007" name="l04007"></a><span class="lineno"> 4007</span> </div>
<div class="line"><a id="l04008" name="l04008"></a><span class="lineno"> 4008</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; code_vector.<a class="code hl_class" href="classsize.html">size</a>(); <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>++) {</div>
<div class="line"><a id="l04009" name="l04009"></a><span class="lineno"> 4009</span>    WasmCode* code = code_vector[<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>];</div>
<div class="line"><a id="l04010" name="l04010"></a><span class="lineno"> 4010</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a>(code);</div>
<div class="line"><a id="l04011" name="l04011"></a><span class="lineno"> 4011</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(code-&gt;index(), <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;num_functions());</div>
<div class="line"><a id="l04012" name="l04012"></a><span class="lineno"> 4012</span> </div>
<div class="line"><a id="l04013" name="l04013"></a><span class="lineno"> 4013</span>    has_top_tier_code |= code-&gt;tier() == ExecutionTier::kTurbofan;</div>
<div class="line"><a id="l04014" name="l04014"></a><span class="lineno"> 4014</span> </div>
<div class="line"><a id="l04015" name="l04015"></a><span class="lineno"> 4015</span>    <span class="keywordflow">if</span> (code-&gt;index() &lt;</div>
<div class="line"><a id="l04016" name="l04016"></a><span class="lineno"> 4016</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;num_imported_functions())) {</div>
<div class="line"><a id="l04017" name="l04017"></a><span class="lineno"> 4017</span>      <span class="comment">// Import wrapper.</span></div>
<div class="line"><a id="l04018" name="l04018"></a><span class="lineno"> 4018</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a>(code-&gt;tier(), ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l04019" name="l04019"></a><span class="lineno"> 4019</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a>--;</div>
<div class="line"><a id="l04020" name="l04020"></a><span class="lineno"> 4020</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l04021" name="l04021"></a><span class="lineno"> 4021</span>      <span class="comment">// Function.</span></div>
<div class="line"><a id="l04022" name="l04022"></a><span class="lineno"> 4022</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a986dc8f4ec6dcd0644efe205c13f8eb7">DCHECK_NE</a>(code-&gt;tier(), ExecutionTier::kNone);</div>
<div class="line"><a id="l04023" name="l04023"></a><span class="lineno"> 4023</span> </div>
<div class="line"><a id="l04024" name="l04024"></a><span class="lineno"> 4024</span>      <span class="comment">// Read function&#39;s compilation progress.</span></div>
<div class="line"><a id="l04025" name="l04025"></a><span class="lineno"> 4025</span>      <span class="comment">// This view on the compilation progress may differ from the actually</span></div>
<div class="line"><a id="l04026" name="l04026"></a><span class="lineno"> 4026</span>      <span class="comment">// compiled code. Any lazily compiled function does not contribute to the</span></div>
<div class="line"><a id="l04027" name="l04027"></a><span class="lineno"> 4027</span>      <span class="comment">// compilation progress but may publish code to the code manager.</span></div>
<div class="line"><a id="l04028" name="l04028"></a><span class="lineno"> 4028</span>      <span class="keywordtype">int</span> slot_index =</div>
<div class="line"><a id="l04029" name="l04029"></a><span class="lineno"> 4029</span>          <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">declared_function_index</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module(), code-&gt;index());</div>
<div class="line"><a id="l04030" name="l04030"></a><span class="lineno"> 4030</span>      uint8_t function_progress = <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[slot_index];</div>
<div class="line"><a id="l04031" name="l04031"></a><span class="lineno"> 4031</span>      <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> required_baseline_tier =</div>
<div class="line"><a id="l04032" name="l04032"></a><span class="lineno"> 4032</span>          RequiredBaselineTierField::decode(function_progress);</div>
<div class="line"><a id="l04033" name="l04033"></a><span class="lineno"> 4033</span>      <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">ExecutionTier</a> reached_tier = ReachedTierField::decode(function_progress);</div>
<div class="line"><a id="l04034" name="l04034"></a><span class="lineno"> 4034</span> </div>
<div class="line"><a id="l04035" name="l04035"></a><span class="lineno"> 4035</span>      <span class="comment">// Check whether required baseline or top tier are reached.</span></div>
<div class="line"><a id="l04036" name="l04036"></a><span class="lineno"> 4036</span>      <span class="keywordflow">if</span> (reached_tier &lt; required_baseline_tier &amp;&amp;</div>
<div class="line"><a id="l04037" name="l04037"></a><span class="lineno"> 4037</span>          required_baseline_tier &lt;= code-&gt;<a class="code hl_variable" href="flag-definitions_8h.html#ab593a76c45473b2e8389090878705e1f">tier</a>()) {</div>
<div class="line"><a id="l04038" name="l04038"></a><span class="lineno"> 4038</span>        <a class="code hl_define" href="src_2base_2logging_8h.html#afd957f297df7e9ee36c46185e961485f">DCHECK_GT</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a>, 0);</div>
<div class="line"><a id="l04039" name="l04039"></a><span class="lineno"> 4039</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a>--;</div>
<div class="line"><a id="l04040" name="l04040"></a><span class="lineno"> 4040</span>      }</div>
<div class="line"><a id="l04041" name="l04041"></a><span class="lineno"> 4041</span>      <span class="keywordflow">if</span> (code-&gt;tier() == ExecutionTier::kTurbofan) {</div>
<div class="line"><a id="l04042" name="l04042"></a><span class="lineno"> 4042</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a> += code-&gt;instructions().size();</div>
<div class="line"><a id="l04043" name="l04043"></a><span class="lineno"> 4043</span>      }</div>
<div class="line"><a id="l04044" name="l04044"></a><span class="lineno"> 4044</span> </div>
<div class="line"><a id="l04045" name="l04045"></a><span class="lineno"> 4045</span>      <span class="comment">// Update function&#39;s compilation progress.</span></div>
<div class="line"><a id="l04046" name="l04046"></a><span class="lineno"> 4046</span>      <span class="keywordflow">if</span> (code-&gt;tier() &gt; reached_tier) {</div>
<div class="line"><a id="l04047" name="l04047"></a><span class="lineno"> 4047</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[slot_index] = ReachedTierField::update(</div>
<div class="line"><a id="l04048" name="l04048"></a><span class="lineno"> 4048</span>            <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[slot_index], code-&gt;tier());</div>
<div class="line"><a id="l04049" name="l04049"></a><span class="lineno"> 4049</span>      }</div>
<div class="line"><a id="l04050" name="l04050"></a><span class="lineno"> 4050</span>      <span class="comment">// Allow another top tier compilation if deopts are enabled and the</span></div>
<div class="line"><a id="l04051" name="l04051"></a><span class="lineno"> 4051</span>      <span class="comment">// currently installed code object is a liftoff object.</span></div>
<div class="line"><a id="l04052" name="l04052"></a><span class="lineno"> 4052</span>      <span class="comment">// Ideally, this would be done only if the code-&gt;tier() ==</span></div>
<div class="line"><a id="l04053" name="l04053"></a><span class="lineno"> 4053</span>      <span class="comment">// ExeuctionTier::Liftoff as the code object for which we run this</span></div>
<div class="line"><a id="l04054" name="l04054"></a><span class="lineno"> 4054</span>      <span class="comment">// function should be the same as the one installed on the native_module.</span></div>
<div class="line"><a id="l04055" name="l04055"></a><span class="lineno"> 4055</span>      <span class="comment">// This is unfortunately not the case as installing a code object on the</span></div>
<div class="line"><a id="l04056" name="l04056"></a><span class="lineno"> 4056</span>      <span class="comment">// native module and updating the compilation_progress_ and the</span></div>
<div class="line"><a id="l04057" name="l04057"></a><span class="lineno"> 4057</span>      <span class="comment">// CompilationUnitQueues::top_tier_compiled_ are not synchronized.</span></div>
<div class="line"><a id="l04058" name="l04058"></a><span class="lineno"> 4058</span>      <span class="comment">// Note: GetCode() acquires the NativeModule::allocation_mutex_, so this</span></div>
<div class="line"><a id="l04059" name="l04059"></a><span class="lineno"> 4059</span>      <span class="comment">// could cause deadlocks if any other place acquires</span></div>
<div class="line"><a id="l04060" name="l04060"></a><span class="lineno"> 4060</span>      <span class="comment">// NativeModule::allocation_mutex_ first and then</span></div>
<div class="line"><a id="l04061" name="l04061"></a><span class="lineno"> 4061</span>      <span class="comment">// CompilationStateImpl::callbacks_mutex_!</span></div>
<div class="line"><a id="l04062" name="l04062"></a><span class="lineno"> 4062</span>      <span class="keyword">const</span> <span class="keywordtype">bool</span> is_liftoff = code-&gt;tier() == ExecutionTier::kLiftoff;</div>
<div class="line"><a id="l04063" name="l04063"></a><span class="lineno"> 4063</span>      <span class="keyword">auto</span> published_code_is_liftoff = [<span class="keyword">this</span>](<span class="keywordtype">int</span> <a class="code hl_variable" href="instruction-selector-ia32_8cc.html#ae55190dbead0a94298bdfa37911694e3">index</a>) {</div>
<div class="line"><a id="l04064" name="l04064"></a><span class="lineno"> 4064</span>        WasmCode* code = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;GetCode(<a class="code hl_variable" href="instruction-selector-ia32_8cc.html#ae55190dbead0a94298bdfa37911694e3">index</a>);</div>
<div class="line"><a id="l04065" name="l04065"></a><span class="lineno"> 4065</span>        <span class="keywordflow">if</span> (code == <span class="keyword">nullptr</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l04066" name="l04066"></a><span class="lineno"> 4066</span>        <span class="keywordflow">return</span> code-&gt;is_liftoff();</div>
<div class="line"><a id="l04067" name="l04067"></a><span class="lineno"> 4067</span>      };</div>
<div class="line"><a id="l04068" name="l04068"></a><span class="lineno"> 4068</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_deopt &amp;&amp;</div>
<div class="line"><a id="l04069" name="l04069"></a><span class="lineno"> 4069</span>          (is_liftoff || published_code_is_liftoff(code-&gt;index()))) {</div>
<div class="line"><a id="l04070" name="l04070"></a><span class="lineno"> 4070</span>        <span class="comment">// Setting the reached tier below the baseline tier would create an</span></div>
<div class="line"><a id="l04071" name="l04071"></a><span class="lineno"> 4071</span>        <span class="comment">// inconsistent state and has actually led to crashes before (see</span></div>
<div class="line"><a id="l04072" name="l04072"></a><span class="lineno"> 4072</span>        <span class="comment">// https://crbug.com/379086474).</span></div>
<div class="line"><a id="l04073" name="l04073"></a><span class="lineno"> 4073</span>        <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(required_baseline_tier, ExecutionTier::kLiftoff);</div>
<div class="line"><a id="l04074" name="l04074"></a><span class="lineno"> 4074</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[slot_index] = ReachedTierField::update(</div>
<div class="line"><a id="l04075" name="l04075"></a><span class="lineno"> 4075</span>            <a class="code hl_variable" href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a>[slot_index], ExecutionTier::kLiftoff);</div>
<div class="line"><a id="l04076" name="l04076"></a><span class="lineno"> 4076</span>        <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.AllowAnotherTopTierJob(code-&gt;index());</div>
<div class="line"><a id="l04077" name="l04077"></a><span class="lineno"> 4077</span>      }</div>
<div class="line"><a id="l04078" name="l04078"></a><span class="lineno"> 4078</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(0, <a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a>);</div>
<div class="line"><a id="l04079" name="l04079"></a><span class="lineno"> 4079</span>    }</div>
<div class="line"><a id="l04080" name="l04080"></a><span class="lineno"> 4080</span>  }</div>
<div class="line"><a id="l04081" name="l04081"></a><span class="lineno"> 4081</span> </div>
<div class="line"><a id="l04082" name="l04082"></a><span class="lineno"> 4082</span>  <span class="comment">// Update the {last_top_tier_compilation_timestamp_} if it is set (i.e. a</span></div>
<div class="line"><a id="l04083" name="l04083"></a><span class="lineno"> 4083</span>  <span class="comment">// delayed task has already been spawned).</span></div>
<div class="line"><a id="l04084" name="l04084"></a><span class="lineno"> 4084</span>  <span class="keywordflow">if</span> (has_top_tier_code &amp;&amp; !<a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a>.IsNull()) {</div>
<div class="line"><a id="l04085" name="l04085"></a><span class="lineno"> 4085</span>    <a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a> = base::TimeTicks::Now();</div>
<div class="line"><a id="l04086" name="l04086"></a><span class="lineno"> 4086</span>  }</div>
<div class="line"><a id="l04087" name="l04087"></a><span class="lineno"> 4087</span> </div>
<div class="line"><a id="l04088" name="l04088"></a><span class="lineno"> 4088</span>  TriggerOutstandingCallbacks();</div>
<div class="line"><a id="l04089" name="l04089"></a><span class="lineno"> 4089</span>}</div>
<div class="line"><a id="l04090" name="l04090"></a><span class="lineno"> 4090</span> </div>
<div class="line"><a id="l04091" name="l04091"></a><span class="lineno"> 4091</span><span class="keyword">namespace </span>{</div>
<div class="line"><a id="l04092" name="l04092"></a><span class="lineno"> 4092</span><span class="keyword">class </span>TriggerCodeCachingAfterTimeoutTask : <span class="keyword">public</span> <a class="code hl_class" href="classv8_1_1Task.html">v8::Task</a> {</div>
<div class="line"><a id="l04093" name="l04093"></a><span class="lineno"> 4093</span> <span class="keyword">public</span>:</div>
<div class="line"><a id="l04094" name="l04094"></a><span class="lineno"> 4094</span>  <span class="keyword">explicit</span> TriggerCodeCachingAfterTimeoutTask(</div>
<div class="line"><a id="l04095" name="l04095"></a><span class="lineno"> 4095</span>      std::weak_ptr&lt;NativeModule&gt; native_module)</div>
<div class="line"><a id="l04096" name="l04096"></a><span class="lineno"> 4096</span>      : <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(native_module)) {}</div>
<div class="line"><a id="l04097" name="l04097"></a><span class="lineno"> 4097</span> </div>
<div class="line"><a id="l04098" name="l04098"></a><span class="lineno"> 4098</span>  <span class="keywordtype">void</span> Run()<span class="keyword"> override </span>{</div>
<div class="line"><a id="l04099" name="l04099"></a><span class="lineno"> 4099</span>    <span class="keywordflow">if</span> (std::shared_ptr&lt;NativeModule&gt; native_module = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>.lock()) {</div>
<div class="line"><a id="l04100" name="l04100"></a><span class="lineno"> 4100</span>      Impl(native_module-&gt;compilation_state())-&gt;TriggerCachingAfterTimeout();</div>
<div class="line"><a id="l04101" name="l04101"></a><span class="lineno"> 4101</span>    }</div>
<div class="line"><a id="l04102" name="l04102"></a><span class="lineno"> 4102</span>  }</div>
<div class="line"><a id="l04103" name="l04103"></a><span class="lineno"> 4103</span> </div>
<div class="line"><a id="l04104" name="l04104"></a><span class="lineno"> 4104</span> <span class="keyword">private</span>:</div>
<div class="line"><a id="l04105" name="l04105"></a><span class="lineno"> 4105</span>  <span class="keyword">const</span> std::weak_ptr&lt;NativeModule&gt; <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>;</div>
<div class="line"><a id="l04106" name="l04106"></a><span class="lineno"> 4106</span>};</div>
<div class="line"><a id="l04107" name="l04107"></a><span class="lineno"> 4107</span>}  <span class="comment">// namespace</span></div>
<div class="line"><a id="l04108" name="l04108"></a><span class="lineno"> 4108</span> </div>
<div class="line"><a id="l04109" name="l04109"></a><span class="lineno"> 4109</span><span class="keywordtype">void</span> CompilationStateImpl::TriggerOutstandingCallbacks() {</div>
<div class="line"><a id="l04110" name="l04110"></a><span class="lineno"> 4110</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>.AssertHeld();</div>
<div class="line"><a id="l04111" name="l04111"></a><span class="lineno"> 4111</span> </div>
<div class="line"><a id="l04112" name="l04112"></a><span class="lineno"> 4112</span>  base::EnumSet&lt;CompilationEvent&gt; triggered_events;</div>
<div class="line"><a id="l04113" name="l04113"></a><span class="lineno"> 4113</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> == 0) {</div>
<div class="line"><a id="l04114" name="l04114"></a><span class="lineno"> 4114</span>    triggered_events.Add(CompilationEvent::kFinishedBaselineCompilation);</div>
<div class="line"><a id="l04115" name="l04115"></a><span class="lineno"> 4115</span>  }</div>
<div class="line"><a id="l04116" name="l04116"></a><span class="lineno"> 4116</span> </div>
<div class="line"><a id="l04117" name="l04117"></a><span class="lineno"> 4117</span>  <span class="comment">// For dynamic tiering, trigger &quot;compilation chunk finished&quot; after a new chunk</span></div>
<div class="line"><a id="l04118" name="l04118"></a><span class="lineno"> 4118</span>  <span class="comment">// of size {v8_flags.wasm_caching_threshold}.</span></div>
<div class="line"><a id="l04119" name="l04119"></a><span class="lineno"> 4119</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a> &amp;&amp;</div>
<div class="line"><a id="l04120" name="l04120"></a><span class="lineno"> 4120</span>      <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_caching_threshold) &lt;=</div>
<div class="line"><a id="l04121" name="l04121"></a><span class="lineno"> 4121</span>          <a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a>) {</div>
<div class="line"><a id="l04122" name="l04122"></a><span class="lineno"> 4122</span>    <span class="comment">// Trigger caching immediately if there is no timeout or the hard threshold</span></div>
<div class="line"><a id="l04123" name="l04123"></a><span class="lineno"> 4123</span>    <span class="comment">// was reached.</span></div>
<div class="line"><a id="l04124" name="l04124"></a><span class="lineno"> 4124</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_caching_timeout_ms &lt;= 0 ||</div>
<div class="line"><a id="l04125" name="l04125"></a><span class="lineno"> 4125</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_caching_hard_threshold) &lt;=</div>
<div class="line"><a id="l04126" name="l04126"></a><span class="lineno"> 4126</span>            <a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a>) {</div>
<div class="line"><a id="l04127" name="l04127"></a><span class="lineno"> 4127</span>      triggered_events.Add(CompilationEvent::kFinishedCompilationChunk);</div>
<div class="line"><a id="l04128" name="l04128"></a><span class="lineno"> 4128</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a> = 0;</div>
<div class="line"><a id="l04129" name="l04129"></a><span class="lineno"> 4129</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a>.IsNull()) {</div>
<div class="line"><a id="l04130" name="l04130"></a><span class="lineno"> 4130</span>      <span class="comment">// Trigger a task after the given timeout; that task will only trigger</span></div>
<div class="line"><a id="l04131" name="l04131"></a><span class="lineno"> 4131</span>      <span class="comment">// caching if no new code was added until then. Otherwise, it will</span></div>
<div class="line"><a id="l04132" name="l04132"></a><span class="lineno"> 4132</span>      <span class="comment">// re-schedule itself.</span></div>
<div class="line"><a id="l04133" name="l04133"></a><span class="lineno"> 4133</span>      V8::GetCurrentPlatform()-&gt;PostDelayedTaskOnWorkerThread(</div>
<div class="line"><a id="l04134" name="l04134"></a><span class="lineno"> 4134</span>          TaskPriority::kUserVisible,</div>
<div class="line"><a id="l04135" name="l04135"></a><span class="lineno"> 4135</span>          std::make_unique&lt;TriggerCodeCachingAfterTimeoutTask&gt;(</div>
<div class="line"><a id="l04136" name="l04136"></a><span class="lineno"> 4136</span>              <a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>),</div>
<div class="line"><a id="l04137" name="l04137"></a><span class="lineno"> 4137</span>          1e-3 * <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_caching_timeout_ms);</div>
<div class="line"><a id="l04138" name="l04138"></a><span class="lineno"> 4138</span> </div>
<div class="line"><a id="l04139" name="l04139"></a><span class="lineno"> 4139</span>      <span class="comment">// Set the timestamp (will be updated by {OnFinishedUnits} if more</span></div>
<div class="line"><a id="l04140" name="l04140"></a><span class="lineno"> 4140</span>      <span class="comment">// top-tier compilation finished before the delayed task is being run).</span></div>
<div class="line"><a id="l04141" name="l04141"></a><span class="lineno"> 4141</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a> = base::TimeTicks::Now();</div>
<div class="line"><a id="l04142" name="l04142"></a><span class="lineno"> 4142</span>    }</div>
<div class="line"><a id="l04143" name="l04143"></a><span class="lineno"> 4143</span>  }</div>
<div class="line"><a id="l04144" name="l04144"></a><span class="lineno"> 4144</span> </div>
<div class="line"><a id="l04145" name="l04145"></a><span class="lineno"> 4145</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a476aa4c8510e0cbb39a63ccd26795727">compile_failed_</a>.load(std::memory_order_relaxed)) {</div>
<div class="line"><a id="l04146" name="l04146"></a><span class="lineno"> 4146</span>    <span class="comment">// *Only* trigger the &quot;failed&quot; event.</span></div>
<div class="line"><a id="l04147" name="l04147"></a><span class="lineno"> 4147</span>    triggered_events =</div>
<div class="line"><a id="l04148" name="l04148"></a><span class="lineno"> 4148</span>        base::EnumSet&lt;CompilationEvent&gt;({CompilationEvent::kFailedCompilation});</div>
<div class="line"><a id="l04149" name="l04149"></a><span class="lineno"> 4149</span>  }</div>
<div class="line"><a id="l04150" name="l04150"></a><span class="lineno"> 4150</span> </div>
<div class="line"><a id="l04151" name="l04151"></a><span class="lineno"> 4151</span>  TriggerCallbacks(triggered_events);</div>
<div class="line"><a id="l04152" name="l04152"></a><span class="lineno"> 4152</span>}</div>
<div class="line"><a id="l04153" name="l04153"></a><span class="lineno"> 4153</span> </div>
<div class="line"><a id="l04154" name="l04154"></a><span class="lineno"> 4154</span><span class="keywordtype">void</span> CompilationStateImpl::TriggerCallbacks(</div>
<div class="line"><a id="l04155" name="l04155"></a><span class="lineno"> 4155</span>    base::EnumSet&lt;CompilationEvent&gt; events) {</div>
<div class="line"><a id="l04156" name="l04156"></a><span class="lineno"> 4156</span>  <span class="keywordflow">if</span> (events.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04157" name="l04157"></a><span class="lineno"> 4157</span> </div>
<div class="line"><a id="l04158" name="l04158"></a><span class="lineno"> 4158</span>  <span class="comment">// Don&#39;t trigger past events again.</span></div>
<div class="line"><a id="l04159" name="l04159"></a><span class="lineno"> 4159</span>  events -= <a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>;</div>
<div class="line"><a id="l04160" name="l04160"></a><span class="lineno"> 4160</span>  <span class="comment">// There can be multiple compilation chunks, thus do not store this.</span></div>
<div class="line"><a id="l04161" name="l04161"></a><span class="lineno"> 4161</span>  <a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a> |= events - CompilationEvent::kFinishedCompilationChunk;</div>
<div class="line"><a id="l04162" name="l04162"></a><span class="lineno"> 4162</span> </div>
<div class="line"><a id="l04163" name="l04163"></a><span class="lineno"> 4163</span>  <span class="keywordflow">for</span> (<span class="keyword">auto</span> event :</div>
<div class="line"><a id="l04164" name="l04164"></a><span class="lineno"> 4164</span>       {std::make_pair(CompilationEvent::kFailedCompilation,</div>
<div class="line"><a id="l04165" name="l04165"></a><span class="lineno"> 4165</span>                       <span class="stringliteral">&quot;wasm.CompilationFailed&quot;</span>),</div>
<div class="line"><a id="l04166" name="l04166"></a><span class="lineno"> 4166</span>        std::make_pair(CompilationEvent::kFinishedBaselineCompilation,</div>
<div class="line"><a id="l04167" name="l04167"></a><span class="lineno"> 4167</span>                       <span class="stringliteral">&quot;wasm.BaselineFinished&quot;</span>),</div>
<div class="line"><a id="l04168" name="l04168"></a><span class="lineno"> 4168</span>        std::make_pair(CompilationEvent::kFinishedCompilationChunk,</div>
<div class="line"><a id="l04169" name="l04169"></a><span class="lineno"> 4169</span>                       <span class="stringliteral">&quot;wasm.CompilationChunkFinished&quot;</span>)}) {</div>
<div class="line"><a id="l04170" name="l04170"></a><span class="lineno"> 4170</span>    <span class="keywordflow">if</span> (!events.contains(event.first)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l04171" name="l04171"></a><span class="lineno"> 4171</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a986dc8f4ec6dcd0644efe205c13f8eb7">DCHECK_NE</a>(<a class="code hl_variable" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#ae042bdad58afd5e550614c9d31238ed3">kInvalidCompilationID</a>);</div>
<div class="line"><a id="l04172" name="l04172"></a><span class="lineno"> 4172</span>    <a class="code hl_define" href="trace-event-no-perfetto_8h.html#ac437f27e15925a9bd53c69692a6c85fe">TRACE_EVENT1</a>(<span class="stringliteral">&quot;v8.wasm&quot;</span>, event.second, <span class="stringliteral">&quot;id&quot;</span>, <a class="code hl_variable" href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a>);</div>
<div class="line"><a id="l04173" name="l04173"></a><span class="lineno"> 4173</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a> : <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>) {</div>
<div class="line"><a id="l04174" name="l04174"></a><span class="lineno"> 4174</span>      <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>-&gt;call(event.first);</div>
<div class="line"><a id="l04175" name="l04175"></a><span class="lineno"> 4175</span>    }</div>
<div class="line"><a id="l04176" name="l04176"></a><span class="lineno"> 4176</span>  }</div>
<div class="line"><a id="l04177" name="l04177"></a><span class="lineno"> 4177</span> </div>
<div class="line"><a id="l04178" name="l04178"></a><span class="lineno"> 4178</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a> == 0) {</div>
<div class="line"><a id="l04179" name="l04179"></a><span class="lineno"> 4179</span>    <span class="keyword">auto</span> new_end = std::remove_if(</div>
<div class="line"><a id="l04180" name="l04180"></a><span class="lineno"> 4180</span>        <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.begin(), <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.end(), [](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_variable" href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a>) {</div>
<div class="line"><a id="l04181" name="l04181"></a><span class="lineno"> 4181</span>          return callback-&gt;release_after_final_event();</div>
<div class="line"><a id="l04182" name="l04182"></a><span class="lineno"> 4182</span>        });</div>
<div class="line"><a id="l04183" name="l04183"></a><span class="lineno"> 4183</span>    <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.erase(new_end, <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.end());</div>
<div class="line"><a id="l04184" name="l04184"></a><span class="lineno"> 4184</span>  }</div>
<div class="line"><a id="l04185" name="l04185"></a><span class="lineno"> 4185</span>}</div>
<div class="line"><a id="l04186" name="l04186"></a><span class="lineno"> 4186</span> </div>
<div class="line"><a id="l04187" name="l04187"></a><span class="lineno"> 4187</span><span class="keywordtype">void</span> CompilationStateImpl::TriggerCachingAfterTimeout() {</div>
<div class="line"><a id="l04188" name="l04188"></a><span class="lineno"> 4188</span>  base::SpinningMutexGuard guard{&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>};</div>
<div class="line"><a id="l04189" name="l04189"></a><span class="lineno"> 4189</span> </div>
<div class="line"><a id="l04190" name="l04190"></a><span class="lineno"> 4190</span>  <span class="comment">// It can happen that we reached the hard threshold while waiting for the</span></div>
<div class="line"><a id="l04191" name="l04191"></a><span class="lineno"> 4191</span>  <span class="comment">// timeout to expire. In that case, {bytes_since_last_chunk_} might be zero</span></div>
<div class="line"><a id="l04192" name="l04192"></a><span class="lineno"> 4192</span>  <span class="comment">// and there is nothing new to cache.</span></div>
<div class="line"><a id="l04193" name="l04193"></a><span class="lineno"> 4193</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a> == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04194" name="l04194"></a><span class="lineno"> 4194</span> </div>
<div class="line"><a id="l04195" name="l04195"></a><span class="lineno"> 4195</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a>.IsNull());</div>
<div class="line"><a id="l04196" name="l04196"></a><span class="lineno"> 4196</span>  base::TimeTicks caching_time =</div>
<div class="line"><a id="l04197" name="l04197"></a><span class="lineno"> 4197</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a> +</div>
<div class="line"><a id="l04198" name="l04198"></a><span class="lineno"> 4198</span>      base::TimeDelta::FromMilliseconds(<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_caching_timeout_ms);</div>
<div class="line"><a id="l04199" name="l04199"></a><span class="lineno"> 4199</span>  base::TimeDelta time_until_caching = caching_time - base::TimeTicks::Now();</div>
<div class="line"><a id="l04200" name="l04200"></a><span class="lineno"> 4200</span>  <span class="comment">// If we are still half a millisecond or more away from the timeout,</span></div>
<div class="line"><a id="l04201" name="l04201"></a><span class="lineno"> 4201</span>  <span class="comment">// reschedule the task. Otherwise, call the caching callback.</span></div>
<div class="line"><a id="l04202" name="l04202"></a><span class="lineno"> 4202</span>  <span class="keywordflow">if</span> (time_until_caching &gt;= base::TimeDelta::FromMicroseconds(500)) {</div>
<div class="line"><a id="l04203" name="l04203"></a><span class="lineno"> 4203</span>    <span class="keywordtype">int</span> ms_remaining =</div>
<div class="line"><a id="l04204" name="l04204"></a><span class="lineno"> 4204</span>        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(time_until_caching.InMillisecondsRoundedUp());</div>
<div class="line"><a id="l04205" name="l04205"></a><span class="lineno"> 4205</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(1, ms_remaining);</div>
<div class="line"><a id="l04206" name="l04206"></a><span class="lineno"> 4206</span>    V8::GetCurrentPlatform()-&gt;PostDelayedTaskOnWorkerThread(</div>
<div class="line"><a id="l04207" name="l04207"></a><span class="lineno"> 4207</span>        TaskPriority::kUserVisible,</div>
<div class="line"><a id="l04208" name="l04208"></a><span class="lineno"> 4208</span>        std::make_unique&lt;TriggerCodeCachingAfterTimeoutTask&gt;(</div>
<div class="line"><a id="l04209" name="l04209"></a><span class="lineno"> 4209</span>            <a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>),</div>
<div class="line"><a id="l04210" name="l04210"></a><span class="lineno"> 4210</span>        ms_remaining);</div>
<div class="line"><a id="l04211" name="l04211"></a><span class="lineno"> 4211</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04212" name="l04212"></a><span class="lineno"> 4212</span>  }</div>
<div class="line"><a id="l04213" name="l04213"></a><span class="lineno"> 4213</span> </div>
<div class="line"><a id="l04214" name="l04214"></a><span class="lineno"> 4214</span>  TriggerCallbacks({CompilationEvent::kFinishedCompilationChunk});</div>
<div class="line"><a id="l04215" name="l04215"></a><span class="lineno"> 4215</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a> = {};</div>
<div class="line"><a id="l04216" name="l04216"></a><span class="lineno"> 4216</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a> = 0;</div>
<div class="line"><a id="l04217" name="l04217"></a><span class="lineno"> 4217</span>}</div>
<div class="line"><a id="l04218" name="l04218"></a><span class="lineno"> 4218</span> </div>
<div class="line"><a id="l04219" name="l04219"></a><span class="lineno"> 4219</span><span class="keywordtype">void</span> CompilationStateImpl::OnCompilationStopped(</div>
<div class="line"><a id="l04220" name="l04220"></a><span class="lineno"> 4220</span>    WasmDetectedFeatures detected_features) {</div>
<div class="line"><a id="l04221" name="l04221"></a><span class="lineno"> 4221</span>  WasmDetectedFeatures new_detected_features =</div>
<div class="line"><a id="l04222" name="l04222"></a><span class="lineno"> 4222</span>      UpdateDetectedFeatures(detected_features);</div>
<div class="line"><a id="l04223" name="l04223"></a><span class="lineno"> 4223</span>  <span class="keywordflow">if</span> (new_detected_features.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04224" name="l04224"></a><span class="lineno"> 4224</span> </div>
<div class="line"><a id="l04225" name="l04225"></a><span class="lineno"> 4225</span>  <span class="comment">// New detected features can only happen during eager compilation or if lazy</span></div>
<div class="line"><a id="l04226" name="l04226"></a><span class="lineno"> 4226</span>  <span class="comment">// validation is enabled.</span></div>
<div class="line"><a id="l04227" name="l04227"></a><span class="lineno"> 4227</span>  <span class="comment">// The exceptions are currently stringref and imported strings, which are only</span></div>
<div class="line"><a id="l04228" name="l04228"></a><span class="lineno"> 4228</span>  <span class="comment">// detected on top-tier compilation.</span></div>
<div class="line"><a id="l04229" name="l04229"></a><span class="lineno"> 4229</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(!<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_compilation || <a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_lazy_validation ||</div>
<div class="line"><a id="l04230" name="l04230"></a><span class="lineno"> 4230</span>         (new_detected_features -</div>
<div class="line"><a id="l04231" name="l04231"></a><span class="lineno"> 4231</span>          WasmDetectedFeatures{{WasmDetectedFeature::stringref,</div>
<div class="line"><a id="l04232" name="l04232"></a><span class="lineno"> 4232</span>                                WasmDetectedFeature::imported_strings_utf8,</div>
<div class="line"><a id="l04233" name="l04233"></a><span class="lineno"> 4233</span>                                WasmDetectedFeature::imported_strings}})</div>
<div class="line"><a id="l04234" name="l04234"></a><span class="lineno"> 4234</span>             .empty());</div>
<div class="line"><a id="l04235" name="l04235"></a><span class="lineno"> 4235</span>  <span class="comment">// TODO(clemensb): Fix reporting of late detected features (relevant for lazy</span></div>
<div class="line"><a id="l04236" name="l04236"></a><span class="lineno"> 4236</span>  <span class="comment">// validation and for stringref).</span></div>
<div class="line"><a id="l04237" name="l04237"></a><span class="lineno"> 4237</span>}</div>
<div class="line"><a id="l04238" name="l04238"></a><span class="lineno"> 4238</span> </div>
<div class="line"><a id="l04239" name="l04239"></a><span class="lineno"> 4239</span>WasmDetectedFeatures CompilationStateImpl::UpdateDetectedFeatures(</div>
<div class="line"><a id="l04240" name="l04240"></a><span class="lineno"> 4240</span>    WasmDetectedFeatures detected_features) {</div>
<div class="line"><a id="l04241" name="l04241"></a><span class="lineno"> 4241</span>  WasmDetectedFeatures old_features =</div>
<div class="line"><a id="l04242" name="l04242"></a><span class="lineno"> 4242</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a>.load(std::memory_order_relaxed);</div>
<div class="line"><a id="l04243" name="l04243"></a><span class="lineno"> 4243</span>  <span class="keywordflow">while</span> (!<a class="code hl_variable" href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a>.compare_exchange_weak(</div>
<div class="line"><a id="l04244" name="l04244"></a><span class="lineno"> 4244</span>      old_features, old_features | detected_features,</div>
<div class="line"><a id="l04245" name="l04245"></a><span class="lineno"> 4245</span>      std::memory_order_relaxed)) {</div>
<div class="line"><a id="l04246" name="l04246"></a><span class="lineno"> 4246</span>    <span class="comment">// Retry with updated {old_features}.</span></div>
<div class="line"><a id="l04247" name="l04247"></a><span class="lineno"> 4247</span>  }</div>
<div class="line"><a id="l04248" name="l04248"></a><span class="lineno"> 4248</span>  <span class="keywordflow">return</span> detected_features - old_features;</div>
<div class="line"><a id="l04249" name="l04249"></a><span class="lineno"> 4249</span>}</div>
<div class="line"><a id="l04250" name="l04250"></a><span class="lineno"> 4250</span> </div>
<div class="line"><a id="l04251" name="l04251"></a><span class="lineno"> 4251</span><span class="keywordtype">void</span> CompilationStateImpl::PublishCompilationResults(</div>
<div class="line"><a id="l04252" name="l04252"></a><span class="lineno"> 4252</span>    std::vector&lt;UnpublishedWasmCode&gt; unpublished_code) {</div>
<div class="line"><a id="l04253" name="l04253"></a><span class="lineno"> 4253</span>  <span class="keywordflow">if</span> (unpublished_code.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04254" name="l04254"></a><span class="lineno"> 4254</span> </div>
<div class="line"><a id="l04255" name="l04255"></a><span class="lineno"> 4255</span><span class="preprocessor">#if DEBUG</span></div>
<div class="line"><a id="l04256" name="l04256"></a><span class="lineno"> 4256</span>  <span class="comment">// We don&#39;t compile import wrappers eagerly.</span></div>
<div class="line"><a id="l04257" name="l04257"></a><span class="lineno"> 4257</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [code, assumptions] : unpublished_code) {</div>
<div class="line"><a id="l04258" name="l04258"></a><span class="lineno"> 4258</span>    <span class="keywordtype">int</span> func_index = code-&gt;index();</div>
<div class="line"><a id="l04259" name="l04259"></a><span class="lineno"> 4259</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a>(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;num_imported_functions(), func_index);</div>
<div class="line"><a id="l04260" name="l04260"></a><span class="lineno"> 4260</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a>(func_index, <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;num_functions());</div>
<div class="line"><a id="l04261" name="l04261"></a><span class="lineno"> 4261</span>  }</div>
<div class="line"><a id="l04262" name="l04262"></a><span class="lineno"> 4262</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04263" name="l04263"></a><span class="lineno"> 4263</span>  PublishCode(base::VectorOf(unpublished_code));</div>
<div class="line"><a id="l04264" name="l04264"></a><span class="lineno"> 4264</span>}</div>
<div class="line"><a id="l04265" name="l04265"></a><span class="lineno"> 4265</span> </div>
<div class="line"><a id="l04266" name="l04266"></a><span class="lineno"> 4266</span>std::vector&lt;WasmCode*&gt; CompilationStateImpl::PublishCode(</div>
<div class="line"><a id="l04267" name="l04267"></a><span class="lineno"> 4267</span>    base::Vector&lt;UnpublishedWasmCode&gt; code) {</div>
<div class="line"><a id="l04268" name="l04268"></a><span class="lineno"> 4268</span>  WasmCodeRefScope code_ref_scope;</div>
<div class="line"><a id="l04269" name="l04269"></a><span class="lineno"> 4269</span>  std::vector&lt;WasmCode*&gt; published_code =</div>
<div class="line"><a id="l04270" name="l04270"></a><span class="lineno"> 4270</span>      <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;PublishCode(std::move(code));</div>
<div class="line"><a id="l04271" name="l04271"></a><span class="lineno"> 4271</span>  <span class="comment">// Defer logging code in case wire bytes were not fully received yet.</span></div>
<div class="line"><a id="l04272" name="l04272"></a><span class="lineno"> 4272</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;log_code() &amp;&amp; <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;HasWireBytes()) {</div>
<div class="line"><a id="l04273" name="l04273"></a><span class="lineno"> 4273</span>    <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">GetWasmEngine</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a2b1c94eee0072e6f73f9262078571a4f">LogCode</a>(base::VectorOf(published_code));</div>
<div class="line"><a id="l04274" name="l04274"></a><span class="lineno"> 4274</span>  }</div>
<div class="line"><a id="l04275" name="l04275"></a><span class="lineno"> 4275</span> </div>
<div class="line"><a id="l04276" name="l04276"></a><span class="lineno"> 4276</span>  OnFinishedUnits(base::VectorOf(published_code));</div>
<div class="line"><a id="l04277" name="l04277"></a><span class="lineno"> 4277</span>  <span class="keywordflow">return</span> published_code;</div>
<div class="line"><a id="l04278" name="l04278"></a><span class="lineno"> 4278</span>}</div>
<div class="line"><a id="l04279" name="l04279"></a><span class="lineno"> 4279</span> </div>
<div class="line"><a id="l04280" name="l04280"></a><span class="lineno"> 4280</span><span class="keywordtype">void</span> CompilationStateImpl::SchedulePublishCompilationResults(</div>
<div class="line"><a id="l04281" name="l04281"></a><span class="lineno"> 4281</span>    std::vector&lt;UnpublishedWasmCode&gt; unpublished_code, CompilationTier tier) {</div>
<div class="line"><a id="l04282" name="l04282"></a><span class="lineno"> 4282</span>  PublishState&amp; state = <a class="code hl_variable" href="module-compiler_8cc.html#a49d5b294402367d1e82540d38ed1229d">publish_state_</a>[<a class="code hl_variable" href="flag-definitions_8h.html#ab593a76c45473b2e8389090878705e1f">tier</a>];</div>
<div class="line"><a id="l04283" name="l04283"></a><span class="lineno"> 4283</span>  {</div>
<div class="line"><a id="l04284" name="l04284"></a><span class="lineno"> 4284</span>    base::SpinningMutexGuard guard(&amp;state.mutex_);</div>
<div class="line"><a id="l04285" name="l04285"></a><span class="lineno"> 4285</span>    <span class="keywordflow">if</span> (state.publisher_running_) {</div>
<div class="line"><a id="l04286" name="l04286"></a><span class="lineno"> 4286</span>      <span class="comment">// Add new code to the queue and return.</span></div>
<div class="line"><a id="l04287" name="l04287"></a><span class="lineno"> 4287</span>      state.publish_queue_.reserve(state.publish_queue_.size() +</div>
<div class="line"><a id="l04288" name="l04288"></a><span class="lineno"> 4288</span>                                   unpublished_code.size());</div>
<div class="line"><a id="l04289" name="l04289"></a><span class="lineno"> 4289</span>      <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; c : unpublished_code) {</div>
<div class="line"><a id="l04290" name="l04290"></a><span class="lineno"> 4290</span>        state.publish_queue_.emplace_back(std::move(c));</div>
<div class="line"><a id="l04291" name="l04291"></a><span class="lineno"> 4291</span>      }</div>
<div class="line"><a id="l04292" name="l04292"></a><span class="lineno"> 4292</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04293" name="l04293"></a><span class="lineno"> 4293</span>    }</div>
<div class="line"><a id="l04294" name="l04294"></a><span class="lineno"> 4294</span>    state.publisher_running_ = <span class="keyword">true</span>;</div>
<div class="line"><a id="l04295" name="l04295"></a><span class="lineno"> 4295</span>  }</div>
<div class="line"><a id="l04296" name="l04296"></a><span class="lineno"> 4296</span>  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l04297" name="l04297"></a><span class="lineno"> 4297</span>    PublishCompilationResults(std::move(unpublished_code));</div>
<div class="line"><a id="l04298" name="l04298"></a><span class="lineno"> 4298</span>    unpublished_code.clear();</div>
<div class="line"><a id="l04299" name="l04299"></a><span class="lineno"> 4299</span> </div>
<div class="line"><a id="l04300" name="l04300"></a><span class="lineno"> 4300</span>    <span class="comment">// Keep publishing new code that came in.</span></div>
<div class="line"><a id="l04301" name="l04301"></a><span class="lineno"> 4301</span>    base::SpinningMutexGuard guard(&amp;state.mutex_);</div>
<div class="line"><a id="l04302" name="l04302"></a><span class="lineno"> 4302</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(state.publisher_running_);</div>
<div class="line"><a id="l04303" name="l04303"></a><span class="lineno"> 4303</span>    <span class="keywordflow">if</span> (state.publish_queue_.empty()) {</div>
<div class="line"><a id="l04304" name="l04304"></a><span class="lineno"> 4304</span>      state.publisher_running_ = <span class="keyword">false</span>;</div>
<div class="line"><a id="l04305" name="l04305"></a><span class="lineno"> 4305</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l04306" name="l04306"></a><span class="lineno"> 4306</span>    }</div>
<div class="line"><a id="l04307" name="l04307"></a><span class="lineno"> 4307</span>    unpublished_code.swap(state.publish_queue_);</div>
<div class="line"><a id="l04308" name="l04308"></a><span class="lineno"> 4308</span>  }</div>
<div class="line"><a id="l04309" name="l04309"></a><span class="lineno"> 4309</span>}</div>
<div class="line"><a id="l04310" name="l04310"></a><span class="lineno"> 4310</span> </div>
<div class="line"><a id="l04311" name="l04311"></a><span class="lineno"> 4311</span><span class="keywordtype">size_t</span> CompilationStateImpl::NumOutstandingCompilations(</div>
<div class="line"><a id="l04312" name="l04312"></a><span class="lineno"> 4312</span>    CompilationTier tier)<span class="keyword"> const </span>{</div>
<div class="line"><a id="l04313" name="l04313"></a><span class="lineno"> 4313</span>  <span class="keywordflow">return</span> <a class="code hl_variable" href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a>.GetSizeForTier(tier);</div>
<div class="line"><a id="l04314" name="l04314"></a><span class="lineno"> 4314</span>}</div>
<div class="line"><a id="l04315" name="l04315"></a><span class="lineno"> 4315</span> </div>
<div class="line"><a id="l04316" name="l04316"></a><span class="lineno"> 4316</span><span class="keywordtype">void</span> CompilationStateImpl::SetError() {</div>
<div class="line"><a id="l04317" name="l04317"></a><span class="lineno"> 4317</span>  <a class="code hl_variable" href="module-compiler_8cc.html#a8be0288f8228634650c4bea900954c65">compile_cancelled_</a>.store(<span class="keyword">true</span>, std::memory_order_relaxed);</div>
<div class="line"><a id="l04318" name="l04318"></a><span class="lineno"> 4318</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a476aa4c8510e0cbb39a63ccd26795727">compile_failed_</a>.exchange(<span class="keyword">true</span>, std::memory_order_relaxed)) {</div>
<div class="line"><a id="l04319" name="l04319"></a><span class="lineno"> 4319</span>    <span class="keywordflow">return</span>;  <span class="comment">// Already failed before.</span></div>
<div class="line"><a id="l04320" name="l04320"></a><span class="lineno"> 4320</span>  }</div>
<div class="line"><a id="l04321" name="l04321"></a><span class="lineno"> 4321</span> </div>
<div class="line"><a id="l04322" name="l04322"></a><span class="lineno"> 4322</span>  base::SpinningMutexGuard callbacks_guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l04323" name="l04323"></a><span class="lineno"> 4323</span>  TriggerOutstandingCallbacks();</div>
<div class="line"><a id="l04324" name="l04324"></a><span class="lineno"> 4324</span>  <a class="code hl_variable" href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a>.clear();</div>
<div class="line"><a id="l04325" name="l04325"></a><span class="lineno"> 4325</span>}</div>
<div class="line"><a id="l04326" name="l04326"></a><span class="lineno"> 4326</span> </div>
<div class="line"><a id="l04327" name="l04327"></a><span class="lineno"> 4327</span><span class="keywordtype">void</span> CompilationStateImpl::WaitForCompilationEvent(</div>
<div class="line"><a id="l04328" name="l04328"></a><span class="lineno"> 4328</span>    <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29">CompilationEvent</a> expect_event) {</div>
<div class="line"><a id="l04329" name="l04329"></a><span class="lineno"> 4329</span>  <span class="keywordflow">switch</span> (expect_event) {</div>
<div class="line"><a id="l04330" name="l04330"></a><span class="lineno"> 4330</span>    <span class="keywordflow">case</span> CompilationEvent::kFinishedBaselineCompilation:</div>
<div class="line"><a id="l04331" name="l04331"></a><span class="lineno"> 4331</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>-&gt;IsValid()) <a class="code hl_variable" href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a>-&gt;Join();</div>
<div class="line"><a id="l04332" name="l04332"></a><span class="lineno"> 4332</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l04333" name="l04333"></a><span class="lineno"> 4333</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l04334" name="l04334"></a><span class="lineno"> 4334</span>      <span class="comment">// Waiting on other CompilationEvent doesn&#39;t make sense.</span></div>
<div class="line"><a id="l04335" name="l04335"></a><span class="lineno"> 4335</span>      <a class="code hl_define" href="src_2base_2logging_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a>();</div>
<div class="line"><a id="l04336" name="l04336"></a><span class="lineno"> 4336</span>  }</div>
<div class="line"><a id="l04337" name="l04337"></a><span class="lineno"> 4337</span><span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a id="l04338" name="l04338"></a><span class="lineno"> 4338</span>  base::EnumSet&lt;CompilationEvent&gt; events{expect_event,</div>
<div class="line"><a id="l04339" name="l04339"></a><span class="lineno"> 4339</span>                                         CompilationEvent::kFailedCompilation};</div>
<div class="line"><a id="l04340" name="l04340"></a><span class="lineno"> 4340</span>  base::SpinningMutexGuard guard(&amp;<a class="code hl_variable" href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a>);</div>
<div class="line"><a id="l04341" name="l04341"></a><span class="lineno"> 4341</span>  <a class="code hl_define" href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a>(<a class="code hl_variable" href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a>.contains_any(events));</div>
<div class="line"><a id="l04342" name="l04342"></a><span class="lineno"> 4342</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l04343" name="l04343"></a><span class="lineno"> 4343</span>}</div>
<div class="line"><a id="l04344" name="l04344"></a><span class="lineno"> 4344</span> </div>
<div class="line"><a id="l04345" name="l04345"></a><span class="lineno"> 4345</span><span class="keywordtype">void</span> CompilationStateImpl::TierUpAllFunctions() {</div>
<div class="line"><a id="l04346" name="l04346"></a><span class="lineno"> 4346</span>  <span class="keyword">const</span> <a class="code hl_typedef" href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">WasmModule</a>* module = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;module();</div>
<div class="line"><a id="l04347" name="l04347"></a><span class="lineno"> 4347</span>  uint32_t num_wasm_functions = <span class="keyword">module</span>-&gt;num_declared_functions;</div>
<div class="line"><a id="l04348" name="l04348"></a><span class="lineno"> 4348</span>  WasmCodeRefScope code_ref_scope;</div>
<div class="line"><a id="l04349" name="l04349"></a><span class="lineno"> 4349</span>  CompilationUnitBuilder builder(<a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>);</div>
<div class="line"><a id="l04350" name="l04350"></a><span class="lineno"> 4350</span>  <span class="keywordflow">for</span> (uint32_t <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; num_wasm_functions; ++<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>) {</div>
<div class="line"><a id="l04351" name="l04351"></a><span class="lineno"> 4351</span>    <span class="keywordtype">int</span> func_index = <span class="keyword">module</span>-&gt;num_imported_functions + i;</div>
<div class="line"><a id="l04352" name="l04352"></a><span class="lineno"> 4352</span>    WasmCode* code = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;GetCode(func_index);</div>
<div class="line"><a id="l04353" name="l04353"></a><span class="lineno"> 4353</span>    <span class="keywordflow">if</span> (!code || !code-&gt;is_turbofan()) {</div>
<div class="line"><a id="l04354" name="l04354"></a><span class="lineno"> 4354</span>      builder.AddTopTierUnit(func_index, ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l04355" name="l04355"></a><span class="lineno"> 4355</span>    }</div>
<div class="line"><a id="l04356" name="l04356"></a><span class="lineno"> 4356</span>  }</div>
<div class="line"><a id="l04357" name="l04357"></a><span class="lineno"> 4357</span>  builder.Commit();</div>
<div class="line"><a id="l04358" name="l04358"></a><span class="lineno"> 4358</span> </div>
<div class="line"><a id="l04359" name="l04359"></a><span class="lineno"> 4359</span>  <span class="comment">// Join the compilation, until no compilation units are left anymore.</span></div>
<div class="line"><a id="l04360" name="l04360"></a><span class="lineno"> 4360</span>  <span class="keyword">class </span>DummyDelegate final : <span class="keyword">public</span> <a class="code hl_typedef" href="namespacecppgc.html#a7f42cfb1ddad320141f6c9eadaff84c7">JobDelegate</a> {</div>
<div class="line"><a id="l04361" name="l04361"></a><span class="lineno"> 4361</span>    <span class="keywordtype">bool</span> ShouldYield()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line"><a id="l04362" name="l04362"></a><span class="lineno"> 4362</span>    <span class="keywordtype">bool</span> IsJoiningThread()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div>
<div class="line"><a id="l04363" name="l04363"></a><span class="lineno"> 4363</span>    <span class="keywordtype">void</span> NotifyConcurrencyIncrease()<span class="keyword"> override </span>{ <a class="code hl_define" href="src_2base_2logging_8h.html#add09d39ec888c2d7e12877586f29368d">UNIMPLEMENTED</a>(); }</div>
<div class="line"><a id="l04364" name="l04364"></a><span class="lineno"> 4364</span>    uint8_t GetTaskId()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> kMainTaskId; }</div>
<div class="line"><a id="l04365" name="l04365"></a><span class="lineno"> 4365</span>  };</div>
<div class="line"><a id="l04366" name="l04366"></a><span class="lineno"> 4366</span> </div>
<div class="line"><a id="l04367" name="l04367"></a><span class="lineno"> 4367</span>  DummyDelegate delegate;</div>
<div class="line"><a id="l04368" name="l04368"></a><span class="lineno"> 4368</span>  ExecuteCompilationUnits(<a class="code hl_variable" href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a>, <a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>.get(), &amp;delegate,</div>
<div class="line"><a id="l04369" name="l04369"></a><span class="lineno"> 4369</span>                          CompilationTier::kTopTier);</div>
<div class="line"><a id="l04370" name="l04370"></a><span class="lineno"> 4370</span> </div>
<div class="line"><a id="l04371" name="l04371"></a><span class="lineno"> 4371</span>  <span class="comment">// We cannot wait for other compilation threads to finish, so we explicitly</span></div>
<div class="line"><a id="l04372" name="l04372"></a><span class="lineno"> 4372</span>  <span class="comment">// compile all functions which are not yet available as TurboFan code.</span></div>
<div class="line"><a id="l04373" name="l04373"></a><span class="lineno"> 4373</span>  <span class="keywordflow">for</span> (uint32_t <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> = 0; <a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a> &lt; num_wasm_functions; ++<a class="code hl_namespace" href="namespacev8_1_1internal.html">i</a>) {</div>
<div class="line"><a id="l04374" name="l04374"></a><span class="lineno"> 4374</span>    uint32_t func_index = <span class="keyword">module</span>-&gt;num_imported_functions + i;</div>
<div class="line"><a id="l04375" name="l04375"></a><span class="lineno"> 4375</span>    WasmCode* code = <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>-&gt;GetCode(func_index);</div>
<div class="line"><a id="l04376" name="l04376"></a><span class="lineno"> 4376</span>    <span class="keywordflow">if</span> (!code || !code-&gt;is_turbofan()) {</div>
<div class="line"><a id="l04377" name="l04377"></a><span class="lineno"> 4377</span>      wasm::GetWasmEngine()-&gt;CompileFunction(<a class="code hl_variable" href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a>.get(),</div>
<div class="line"><a id="l04378" name="l04378"></a><span class="lineno"> 4378</span>                                             <a class="code hl_variable" href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a>, func_index,</div>
<div class="line"><a id="l04379" name="l04379"></a><span class="lineno"> 4379</span>                                             wasm::ExecutionTier::kTurbofan);</div>
<div class="line"><a id="l04380" name="l04380"></a><span class="lineno"> 4380</span>    }</div>
<div class="line"><a id="l04381" name="l04381"></a><span class="lineno"> 4381</span>  }</div>
<div class="line"><a id="l04382" name="l04382"></a><span class="lineno"> 4382</span>}</div>
<div class="line"><a id="l04383" name="l04383"></a><span class="lineno"> 4383</span> </div>
<div class="foldopen" id="foldopen04384" data-start="{" data-end="}">
<div class="line"><a id="l04384" name="l04384"></a><span class="lineno"><a class="line" href="namespacev8_1_1internal_1_1wasm.html#a8de46d135ac8060c6d4fbe5677da3934"> 4384</a></span><a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmCode.html">WasmCode</a>* <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a8de46d135ac8060c6d4fbe5677da3934">CompileImportWrapperForTest</a>(<a class="code hl_class" href="classv8_1_1internal_1_1Isolate.html">Isolate</a>* isolate,</div>
<div class="line"><a id="l04385" name="l04385"></a><span class="lineno"> 4385</span>                                      <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">NativeModule</a>* native_module,</div>
<div class="line"><a id="l04386" name="l04386"></a><span class="lineno"> 4386</span>                                      <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#ac0c0d417be648d20ef96581e5d3bd63a">ImportCallKind</a> kind,</div>
<div class="line"><a id="l04387" name="l04387"></a><span class="lineno"> 4387</span>                                      <span class="keyword">const</span> <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1CanonicalSig.html">CanonicalSig</a>* <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>,</div>
<div class="line"><a id="l04388" name="l04388"></a><span class="lineno"> 4388</span>                                      <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1CanonicalTypeIndex.html">CanonicalTypeIndex</a> type_index,</div>
<div class="line"><a id="l04389" name="l04389"></a><span class="lineno"> 4389</span>                                      <span class="keywordtype">int</span> expected_arity, <a class="code hl_enumeration" href="namespacev8_1_1internal_1_1wasm.html#a6eef6d24980961199f34fb770039843a">Suspend</a> suspend) {</div>
<div class="line"><a id="l04390" name="l04390"></a><span class="lineno"> 4390</span>  <span class="keywordtype">bool</span> <a class="code hl_variable" href="graph-builder_8cc.html#acc2fa1f7c7062f53a2840f0064a43ef1">source_positions</a> = <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a70bbfcab50b20ba5da8696e0373a8af4">is_asmjs_module</a>(native_module-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a443a4c6a0f2bedcc6e0ac7f03ece629e">module</a>());</div>
<div class="line"><a id="l04391" name="l04391"></a><span class="lineno"> 4391</span>  <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8_flags</a>.wasm_jitless) {</div>
<div class="line"><a id="l04392" name="l04392"></a><span class="lineno"> 4392</span>    <a class="code hl_class" href="classv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_1_1ModificationScope.html">WasmImportWrapperCache::ModificationScope</a> cache_scope(</div>
<div class="line"><a id="l04393" name="l04393"></a><span class="lineno"> 4393</span>        <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a36345041662f17bb39d27709c1cb78ac">GetWasmImportWrapperCache</a>());</div>
<div class="line"><a id="l04394" name="l04394"></a><span class="lineno"> 4394</span>    <a class="code hl_struct" href="structv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_1_1CacheKey.html">WasmImportWrapperCache::CacheKey</a> <a class="code hl_variable" href="namespacev8_1_1internal.html#a67a51b6314a9bc8a8c44c5fe14149e6c">key</a>(kind, type_index, expected_arity,</div>
<div class="line"><a id="l04395" name="l04395"></a><span class="lineno"> 4395</span>                                         suspend);</div>
<div class="line"><a id="l04396" name="l04396"></a><span class="lineno"> 4396</span>    <a class="code hl_define" href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a>(cache_scope[<a class="code hl_variable" href="namespacev8_1_1internal.html#a67a51b6314a9bc8a8c44c5fe14149e6c">key</a>]);</div>
<div class="line"><a id="l04397" name="l04397"></a><span class="lineno"> 4397</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l04398" name="l04398"></a><span class="lineno"> 4398</span>  }</div>
<div class="line"><a id="l04399" name="l04399"></a><span class="lineno"> 4399</span> </div>
<div class="line"><a id="l04400" name="l04400"></a><span class="lineno"> 4400</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="namespacev8_1_1internal_1_1wasm.html#a36345041662f17bb39d27709c1cb78ac">GetWasmImportWrapperCache</a>()-&gt;<a class="code hl_function" href="classv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache.html#a409ab39613cfb26dd995d842021bfc8f">CompileWasmImportCallWrapper</a>(</div>
<div class="line"><a id="l04401" name="l04401"></a><span class="lineno"> 4401</span>      isolate, kind, <a class="code hl_variable" href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">sig</a>, type_index, <a class="code hl_variable" href="graph-builder_8cc.html#acc2fa1f7c7062f53a2840f0064a43ef1">source_positions</a>, expected_arity,</div>
<div class="line"><a id="l04402" name="l04402"></a><span class="lineno"> 4402</span>      suspend);</div>
<div class="line"><a id="l04403" name="l04403"></a><span class="lineno"> 4403</span>}</div>
</div>
<div class="line"><a id="l04404" name="l04404"></a><span class="lineno"> 4404</span> </div>
<div class="line"><a id="l04405" name="l04405"></a><span class="lineno"> 4405</span>}  <span class="comment">// namespace v8::internal::wasm</span></div>
<div class="line"><a id="l04406" name="l04406"></a><span class="lineno"> 4406</span> </div>
<div class="line"><a id="l04407" name="l04407"></a><span class="lineno"> 4407</span><span class="preprocessor">#undef TRACE_COMPILE</span></div>
<div class="line"><a id="l04408" name="l04408"></a><span class="lineno"> 4408</span><span class="preprocessor">#undef TRACE_STREAMING</span></div>
<div class="line"><a id="l04409" name="l04409"></a><span class="lineno"> 4409</span><span class="preprocessor">#undef TRACE_LAZY</span></div>
<div class="ttc" id="aapi-inl_8h_html"><div class="ttname"><a href="api-inl_8h.html">api-inl.h</a></div></div>
<div class="ttc" id="aapi-natives_8cc_html_a68072bca3fef7bd8b0d3cbac971cbf4b"><div class="ttname"><a href="api-natives_8cc.html#a68072bca3fef7bd8b0d3cbac971cbf4b">isolate_</a></div><div class="ttdeci">Isolate * isolate_</div><div class="ttdef"><b>Definition</b> <a href="api-natives_8cc_source.html#l00037">api-natives.cc:37</a></div></div>
<div class="ttc" id="aapi_8cc_html_a0b79990e09c5971befdb526ccfb8deed"><div class="ttname"><a href="api_8cc.html#a0b79990e09c5971befdb526ccfb8deed">name</a></div><div class="ttdeci">i::DirectHandle&lt; i::String &gt; name</div><div class="ttdef"><b>Definition</b> <a href="api_8cc_source.html#l07178">api.cc:7178</a></div></div>
<div class="ttc" id="aasm-types_8cc_html_a3ec7489f692d014c845cc17e64456793"><div class="ttname"><a href="asm-types_8cc.html#a3ec7489f692d014c845cc17e64456793">Zone</a></div><div class="ttdeci">friend Zone</div><div class="ttdef"><b>Definition</b> <a href="asm-types_8cc_source.html#l00195">asm-types.cc:195</a></div></div>
<div class="ttc" id="acheck_8h_html_a0331d7a4dc5d6372d25e946af1f96588"><div class="ttname"><a href="check_8h.html#a0331d7a4dc5d6372d25e946af1f96588">SBXCHECK_LE</a></div><div class="ttdeci">#define SBXCHECK_LE(lhs, rhs)</div><div class="ttdef"><b>Definition</b> <a href="check_8h_source.html#l00066">check.h:66</a></div></div>
<div class="ttc" id="acheck_8h_html_a6e67d209c0a0c9c55b7b563275f63bdd"><div class="ttname"><a href="check_8h.html#a6e67d209c0a0c9c55b7b563275f63bdd">SBXCHECK_EQ</a></div><div class="ttdeci">#define SBXCHECK_EQ(lhs, rhs)</div><div class="ttdef"><b>Definition</b> <a href="check_8h_source.html#l00061">check.h:61</a></div></div>
<div class="ttc" id="achecks_8h_html_a8c8b326bb3d6944234eb74fbd0952061"><div class="ttname"><a href="checks_8h.html#a8c8b326bb3d6944234eb74fbd0952061">SLOW_DCHECK</a></div><div class="ttdeci">#define SLOW_DCHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="checks_8h_source.html#l00021">checks.h:21</a></div></div>
<div class="ttc" id="aclasslength_html"><div class="ttname"><a href="classlength.html">length</a></div></div>
<div class="ttc" id="aclasssize_html"><div class="ttname"><a href="classsize.html">size</a></div></div>
<div class="ttc" id="aclassv8_1_1Context_1_1BackupIncumbentScope_html"><div class="ttname"><a href="classv8_1_1Context_1_1BackupIncumbentScope.html">v8::Context::BackupIncumbentScope</a></div><div class="ttdef"><b>Definition</b> <a href="v8-context_8h_source.html#l00399">v8-context.h:399</a></div></div>
<div class="ttc" id="aclassv8_1_1Isolate_html"><div class="ttname"><a href="classv8_1_1Isolate.html">v8::Isolate</a></div><div class="ttdef"><b>Definition</b> <a href="v8-isolate_8h_source.html#l00261">v8-isolate.h:261</a></div></div>
<div class="ttc" id="aclassv8_1_1Isolate_html_aed6909379c3f2820cb3084710b73385d"><div class="ttname"><a href="classv8_1_1Isolate.html#aed6909379c3f2820cb3084710b73385d">v8::Isolate::UseCounterFeature</a></div><div class="ttdeci">UseCounterFeature</div><div class="ttdef"><b>Definition</b> <a href="v8-isolate_8h_source.html#l00455">v8-isolate.h:455</a></div></div>
<div class="ttc" id="aclassv8_1_1Isolate_html_aed6909379c3f2820cb3084710b73385dad1e675fc33b2507b66ca7fddb849dbbf"><div class="ttname"><a href="classv8_1_1Isolate.html#aed6909379c3f2820cb3084710b73385dad1e675fc33b2507b66ca7fddb849dbbf">v8::Isolate::kWasmSharedMemory</a></div><div class="ttdeci">@ kWasmSharedMemory</div><div class="ttdef"><b>Definition</b> <a href="v8-isolate_8h_source.html#l00506">v8-isolate.h:506</a></div></div>
<div class="ttc" id="aclassv8_1_1JobDelegate_html"><div class="ttname"><a href="classv8_1_1JobDelegate.html">v8::JobDelegate</a></div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00206">v8-platform.h:206</a></div></div>
<div class="ttc" id="aclassv8_1_1JobDelegate_html_a7180a73d20fc8a240c742163001d8b3a"><div class="ttname"><a href="classv8_1_1JobDelegate.html#a7180a73d20fc8a240c742163001d8b3a">v8::JobDelegate::ShouldYield</a></div><div class="ttdeci">virtual bool ShouldYield()=0</div></div>
<div class="ttc" id="aclassv8_1_1JobHandle_html"><div class="ttname"><a href="classv8_1_1JobHandle.html">v8::JobHandle</a></div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00241">v8-platform.h:241</a></div></div>
<div class="ttc" id="aclassv8_1_1JobHandle_html_a3c6d3e309521026696e24f36438520a5"><div class="ttname"><a href="classv8_1_1JobHandle.html#a3c6d3e309521026696e24f36438520a5">v8::JobHandle::NotifyConcurrencyIncrease</a></div><div class="ttdeci">virtual void NotifyConcurrencyIncrease()=0</div></div>
<div class="ttc" id="aclassv8_1_1JobTask_html"><div class="ttname"><a href="classv8_1_1JobTask.html">v8::JobTask</a></div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00300">v8-platform.h:300</a></div></div>
<div class="ttc" id="aclassv8_1_1Local_html"><div class="ttname"><a href="classv8_1_1Local.html">v8::Local</a></div><div class="ttdef"><b>Definition</b> <a href="v8-local-handle_8h_source.html#l00260">v8-local-handle.h:266</a></div></div>
<div class="ttc" id="aclassv8_1_1Platform_html"><div class="ttname"><a href="classv8_1_1Platform.html">v8::Platform</a></div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l01058">v8-platform.h:1058</a></div></div>
<div class="ttc" id="aclassv8_1_1Platform_html_a061c7d8b981dab5da6a04a8f6f8419b6"><div class="ttname"><a href="classv8_1_1Platform.html#a061c7d8b981dab5da6a04a8f6f8419b6">v8::Platform::PostTaskOnWorkerThread</a></div><div class="ttdeci">void PostTaskOnWorkerThread(TaskPriority priority, std::unique_ptr&lt; Task &gt; task, const SourceLocation &amp;location=SourceLocation::Current())</div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l01178">v8-platform.h:1178</a></div></div>
<div class="ttc" id="aclassv8_1_1Platform_html_ab919eff7610c970ccff4c605617289db"><div class="ttname"><a href="classv8_1_1Platform.html#ab919eff7610c970ccff4c605617289db">v8::Platform::CreateJob</a></div><div class="ttdeci">std::unique_ptr&lt; JobHandle &gt; CreateJob(TaskPriority priority, std::unique_ptr&lt; JobTask &gt; job_task, const SourceLocation &amp;location=SourceLocation::Current())</div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l01271">v8-platform.h:1271</a></div></div>
<div class="ttc" id="aclassv8_1_1Platform_html_ad820bea109ed527e917bf042daf82ac0"><div class="ttname"><a href="classv8_1_1Platform.html#ad820bea109ed527e917bf042daf82ac0">v8::Platform::GetForegroundTaskRunner</a></div><div class="ttdeci">std::shared_ptr&lt; v8::TaskRunner &gt; GetForegroundTaskRunner(Isolate *isolate)</div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l01102">v8-platform.h:1102</a></div></div>
<div class="ttc" id="aclassv8_1_1Task_html"><div class="ttname"><a href="classv8_1_1Task.html">v8::Task</a></div><div class="ttdef"><b>Definition</b> <a href="v8-platform_8h_source.html#l00049">v8-platform.h:49</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1EnumSet_html_a66b0696fe38f3541c9df3c5dc0e300f1"><div class="ttname"><a href="classv8_1_1base_1_1EnumSet.html#a66b0696fe38f3541c9df3c5dc0e300f1">v8::base::EnumSet::contains_all</a></div><div class="ttdeci">constexpr bool contains_all(EnumSet set) const</div><div class="ttdef"><b>Definition</b> <a href="enum-set_8h_source.html#l00038">enum-set.h:38</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1EnumSet_html_ae4b456a7bb23f2a76c4526748fcc911a"><div class="ttname"><a href="classv8_1_1base_1_1EnumSet.html#ae4b456a7bb23f2a76c4526748fcc911a">v8::base::EnumSet::contains</a></div><div class="ttdeci">constexpr bool contains(E element) const</div><div class="ttdef"><b>Definition</b> <a href="enum-set_8h_source.html#l00035">enum-set.h:35</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Hasher_html"><div class="ttname"><a href="classv8_1_1base_1_1Hasher.html">v8::base::Hasher</a></div><div class="ttdef"><b>Definition</b> <a href="hashing_8h_source.html#l00105">hashing.h:105</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Hasher_html_a2c18a03340bfe2dcb77dd407a4c42168"><div class="ttname"><a href="classv8_1_1base_1_1Hasher.html#a2c18a03340bfe2dcb77dd407a4c42168">v8::base::Hasher::AddRange</a></div><div class="ttdeci">Hasher &amp; AddRange(Iterator first, Iterator last)</div><div class="ttdef"><b>Definition</b> <a href="hashing_8h_source.html#l00127">hashing.h:127</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Hasher_html_a3a8bff6d95b05559657966cf880d5025"><div class="ttname"><a href="classv8_1_1base_1_1Hasher.html#a3a8bff6d95b05559657966cf880d5025">v8::base::Hasher::Add</a></div><div class="ttdeci">Hasher &amp; Add(const T &amp;t)</div><div class="ttdef"><b>Definition</b> <a href="hashing_8h_source.html#l00121">hashing.h:121</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Hasher_html_a70be1a634ad5c9c0d93ac9ead95ff163"><div class="ttname"><a href="classv8_1_1base_1_1Hasher.html#a70be1a634ad5c9c0d93ac9ead95ff163">v8::base::Hasher::hash</a></div><div class="ttdeci">constexpr size_t hash() const</div><div class="ttdef"><b>Definition</b> <a href="hashing_8h_source.html#l00111">hashing.h:111</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1LockGuard_html"><div class="ttname"><a href="classv8_1_1base_1_1LockGuard.html">v8::base::LockGuard</a></div><div class="ttdef"><b>Definition</b> <a href="mutex_8h_source.html#l00534">mutex.h:534</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1OwnedVector_html"><div class="ttname"><a href="classv8_1_1base_1_1OwnedVector.html">v8::base::OwnedVector</a></div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00209">vector.h:209</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1OwnedVector_html_af39d85796ffd00480472cde62fb36012"><div class="ttname"><a href="classv8_1_1base_1_1OwnedVector.html#af39d85796ffd00480472cde62fb36012">v8::base::OwnedVector::as_vector</a></div><div class="ttdeci">Vector&lt; T &gt; as_vector() const</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00276">vector.h:276</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1OwnedVector_html_affe5e36cb00bedefbfee8762910e34d0"><div class="ttname"><a href="classv8_1_1base_1_1OwnedVector.html#affe5e36cb00bedefbfee8762910e34d0">v8::base::OwnedVector::NewForOverwrite</a></div><div class="ttdeci">static OwnedVector&lt; T &gt; NewForOverwrite(size_t size)</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00294">vector.h:294</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1SharedMutexGuard_html"><div class="ttname"><a href="classv8_1_1base_1_1SharedMutexGuard.html">v8::base::SharedMutexGuard</a></div><div class="ttdef"><b>Definition</b> <a href="mutex_8h_source.html#l00568">mutex.h:568</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1SmallVector_html"><div class="ttname"><a href="classv8_1_1base_1_1SmallVector.html">v8::base::SmallVector</a></div><div class="ttdef"><b>Definition</b> <a href="small-vector_8h_source.html#l00022">small-vector.h:22</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1SmallVector_html_ac89f2f50c3d6d75b9d2a62c97cd79408"><div class="ttname"><a href="classv8_1_1base_1_1SmallVector.html#ac89f2f50c3d6d75b9d2a62c97cd79408">v8::base::SmallVector::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition</b> <a href="small-vector_8h_source.html#l00117">small-vector.h:117</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1SmallVector_html_ad8177749a526ab128a35c4ec8b0cddf7"><div class="ttname"><a href="classv8_1_1base_1_1SmallVector.html#ad8177749a526ab128a35c4ec8b0cddf7">v8::base::SmallVector::push_back</a></div><div class="ttdeci">void push_back(T x)</div><div class="ttdef"><b>Definition</b> <a href="small-vector_8h_source.html#l00163">small-vector.h:163</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1TimeDelta_html"><div class="ttname"><a href="classv8_1_1base_1_1TimeDelta.html">v8::base::TimeDelta</a></div><div class="ttdef"><b>Definition</b> <a href="time_8h_source.html#l00067">time.h:67</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1TimeDelta_html_ad9006b332aa15e66f2ddb8e8ba910892"><div class="ttname"><a href="classv8_1_1base_1_1TimeDelta.html#ad9006b332aa15e66f2ddb8e8ba910892">v8::base::TimeDelta::InMicroseconds</a></div><div class="ttdeci">int64_t InMicroseconds() const</div><div class="ttdef"><b>Definition</b> <a href="time_8cc_source.html#l00250">time.cc:250</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1TimeTicks_html_ab0886bf0e84f1e1fcdc101021c2c0775"><div class="ttname"><a href="classv8_1_1base_1_1TimeTicks.html#ab0886bf0e84f1e1fcdc101021c2c0775">v8::base::TimeTicks::Now</a></div><div class="ttdeci">static TimeTicks Now()</div><div class="ttdef"><b>Definition</b> <a href="time_8cc_source.html#l00735">time.cc:735</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1TimeTicks_html_acdd9f8482c321164c58f46bc65372c9b"><div class="ttname"><a href="classv8_1_1base_1_1TimeTicks.html#acdd9f8482c321164c58f46bc65372c9b">v8::base::TimeTicks::IsHighResolution</a></div><div class="ttdeci">static bool IsHighResolution()</div><div class="ttdef"><b>Definition</b> <a href="time_8cc_source.html#l00762">time.cc:762</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Vector_html"><div class="ttname"><a href="classv8_1_1base_1_1Vector.html">v8::base::Vector</a></div><div class="ttdef"><b>Definition</b> <a href="zone-list_8h_source.html#l00015">zone-list.h:15</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Vector_html_a1eb4ed5d322a219428bdb9f9a2cb6708"><div class="ttname"><a href="classv8_1_1base_1_1Vector.html#a1eb4ed5d322a219428bdb9f9a2cb6708">v8::base::Vector::length</a></div><div class="ttdeci">int length() const</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00064">vector.h:64</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Vector_html_a2a7f93a33a4938bd73b628789f214d3d"><div class="ttname"><a href="classv8_1_1base_1_1Vector.html#a2a7f93a33a4938bd73b628789f214d3d">v8::base::Vector::SubVector</a></div><div class="ttdeci">Vector&lt; T &gt; SubVector(size_t from, size_t to) const</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00041">vector.h:41</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Vector_html_a8f91dff816409fb9bceaa94c6caeec32"><div class="ttname"><a href="classv8_1_1base_1_1Vector.html#a8f91dff816409fb9bceaa94c6caeec32">v8::base::Vector::size</a></div><div class="ttdeci">constexpr size_t size() const</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00070">vector.h:70</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Vector_html_aab9b38b61ae9c6ca2c00f0f3f579e088"><div class="ttname"><a href="classv8_1_1base_1_1Vector.html#aab9b38b61ae9c6ca2c00f0f3f579e088">v8::base::Vector::SubVectorFrom</a></div><div class="ttdeci">Vector&lt; T &gt; SubVectorFrom(size_t from) const</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00046">vector.h:46</a></div></div>
<div class="ttc" id="aclassv8_1_1base_1_1Vector_html_adc40a57a246645ccf947f03f5c8dee62"><div class="ttname"><a href="classv8_1_1base_1_1Vector.html#adc40a57a246645ccf947f03f5c8dee62">v8::base::Vector::data</a></div><div class="ttdeci">constexpr T * data() const</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00100">vector.h:100</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1CancelableTaskManager_html_a3c90c3d841ccd5255387b37fcfbc03c0"><div class="ttname"><a href="classv8_1_1internal_1_1CancelableTaskManager.html#a3c90c3d841ccd5255387b37fcfbc03c0">v8::internal::CancelableTaskManager::CancelAndWait</a></div><div class="ttdeci">void CancelAndWait()</div><div class="ttdef"><b>Definition</b> <a href="cancelable-task_8cc_source.html#l00076">cancelable-task.cc:76</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1CancelableTask_html"><div class="ttname"><a href="classv8_1_1internal_1_1CancelableTask.html">v8::internal::CancelableTask</a></div><div class="ttdef"><b>Definition</b> <a href="cancelable-task_8h_source.html#l00144">cancelable-task.h:145</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1CancelableTask_html_ae1851dd66f2539be51f60f2ad041af0d"><div class="ttname"><a href="classv8_1_1internal_1_1CancelableTask.html#ae1851dd66f2539be51f60f2ad041af0d">v8::internal::CancelableTask::Run</a></div><div class="ttdeci">void Run() final</div><div class="ttdef"><b>Definition</b> <a href="cancelable-task_8h_source.html#l00153">cancelable-task.h:153</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Counters_html"><div class="ttname"><a href="classv8_1_1internal_1_1Counters.html">v8::internal::Counters</a></div><div class="ttdef"><b>Definition</b> <a href="counters_8h_source.html#l00502">counters.h:502</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Debug_html_ab727677cfc3df584b90bfdcd5328c727"><div class="ttname"><a href="classv8_1_1internal_1_1Debug.html#ab727677cfc3df584b90bfdcd5328c727">v8::internal::Debug::OnAfterCompile</a></div><div class="ttdeci">void OnAfterCompile(DirectHandle&lt; Script &gt; script)</div><div class="ttdef"><b>Definition</b> <a href="debug_8cc_source.html#l02761">debug.cc:2761</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1DirectHandle_html"><div class="ttname"><a href="classv8_1_1internal_1_1DirectHandle.html">v8::internal::DirectHandle</a></div><div class="ttdef"><b>Definition</b> <a href="handles_8h_source.html#l00643">handles.h:652</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Factory_html_a770976a9ab8638f5c4a009dc3701a7e1"><div class="ttname"><a href="classv8_1_1internal_1_1Factory.html#a770976a9ab8638f5c4a009dc3701a7e1">v8::internal::Factory::NewStringFromUtf8</a></div><div class="ttdeci">V8_WARN_UNUSED_RESULT MaybeHandle&lt; String &gt; NewStringFromUtf8(base::Vector&lt; const char &gt; str, AllocationType allocation=AllocationType::kYoung)</div><div class="ttdef"><b>Definition</b> <a href="factory_8cc_source.html#l00733">factory.cc:733</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalHandles_html_a1a31391c097b88af06b7e0cf673bcf00"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalHandles.html#a1a31391c097b88af06b7e0cf673bcf00">v8::internal::GlobalHandles::Destroy</a></div><div class="ttdeci">static void Destroy(Address *location)</div><div class="ttdef"><b>Definition</b> <a href="global-handles_8cc_source.html#l00661">global-handles.cc:661</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1GlobalHandles_html_a486c475da54faf1fe78e4752ed20e23c"><div class="ttname"><a href="classv8_1_1internal_1_1GlobalHandles.html#a486c475da54faf1fe78e4752ed20e23c">v8::internal::GlobalHandles::Create</a></div><div class="ttdeci">IndirectHandle&lt; Object &gt; Create(Tagged&lt; Object &gt; value)</div><div class="ttdef"><b>Definition</b> <a href="global-handles_8cc_source.html#l00624">global-handles.cc:624</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1HandleScope_html"><div class="ttname"><a href="classv8_1_1internal_1_1HandleScope.html">v8::internal::HandleScope</a></div><div class="ttdef"><b>Definition</b> <a href="handles_8h_source.html#l00258">handles.h:258</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html">v8::internal::Isolate</a></div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l00575">isolate.h:575</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_a0567c99c2a3ff016df9e7abb30688075"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#a0567c99c2a3ff016df9e7abb30688075">v8::internal::Isolate::global_handles</a></div><div class="ttdeci">GlobalHandles * global_handles() const</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l01405">isolate.h:1405</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_a267e21e771e72483e74bf9c13c9cd267"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#a267e21e771e72483e74bf9c13c9cd267">v8::internal::Isolate::counters</a></div><div class="ttdeci">Counters * counters()</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l01169">isolate.h:1169</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_a27baa7cc0332d0dfeecf77a91df33444"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#a27baa7cc0332d0dfeecf77a91df33444">v8::internal::Isolate::async_counters</a></div><div class="ttdeci">const std::shared_ptr&lt; Counters &gt; &amp; async_counters()</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l01171">isolate.h:1171</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_a2fbd063d0fbd9a69e5e5adebceefddf1"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#a2fbd063d0fbd9a69e5e5adebceefddf1">v8::internal::Isolate::CountUsage</a></div><div class="ttdeci">void CountUsage(v8::Isolate::UseCounterFeature feature)</div><div class="ttdef"><b>Definition</b> <a href="isolate_8cc_source.html#l06986">isolate.cc:6986</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_a4af947c29f68bce811026dd9878cd257"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#a4af947c29f68bce811026dd9878cd257">v8::internal::Isolate::context</a></div><div class="ttdeci">Tagged&lt; Context &gt; context() const</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l00791">isolate.h:791</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_ab7dd326c7e0e0d5d2cba90947b2ef48b"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#ab7dd326c7e0e0d5d2cba90947b2ef48b">v8::internal::Isolate::factory</a></div><div class="ttdeci">v8::internal::Factory * factory()</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l01517">isolate.h:1517</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_ace16c5dc61b180c3b77f9de769bb9de7"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#ace16c5dc61b180c3b77f9de769bb9de7">v8::internal::Isolate::debug</a></div><div class="ttdeci">Debug * debug() const</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l01463">isolate.h:1463</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Isolate_html_ae2a2e88c3939f4c98fbb0fb2d91f26a7"><div class="ttname"><a href="classv8_1_1internal_1_1Isolate.html#ae2a2e88c3939f4c98fbb0fb2d91f26a7">v8::internal::Isolate::metrics_recorder</a></div><div class="ttdeci">const std::shared_ptr&lt; metrics::Recorder &gt; &amp; metrics_recorder()</div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l01176">isolate.h:1176</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1MaybeDirectHandle_html"><div class="ttname"><a href="classv8_1_1internal_1_1MaybeDirectHandle.html">v8::internal::MaybeDirectHandle</a></div><div class="ttdef"><b>Definition</b> <a href="maybe-handles_8h_source.html#l00239">maybe-handles.h:239</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1MaybeDirectHandle_html_a3ac1ac2ef3cc31fca3efa79567a7d4ad"><div class="ttname"><a href="classv8_1_1internal_1_1MaybeDirectHandle.html#a3ac1ac2ef3cc31fca3efa79567a7d4ad">v8::internal::MaybeDirectHandle::ToHandleChecked</a></div><div class="ttdeci">V8_INLINE DirectHandle&lt; T &gt; ToHandleChecked() const</div><div class="ttdef"><b>Definition</b> <a href="maybe-handles_8h_source.html#l00271">maybe-handles.h:271</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1PerThreadAssertScopeEmpty_html"><div class="ttname"><a href="classv8_1_1internal_1_1PerThreadAssertScopeEmpty.html">v8::internal::PerThreadAssertScopeEmpty&lt; kAllow, kTypes... &gt;</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1ReadOnlyRoots_html"><div class="ttname"><a href="classv8_1_1internal_1_1ReadOnlyRoots.html">v8::internal::ReadOnlyRoots</a></div><div class="ttdef"><b>Definition</b> <a href="roots_8h_source.html#l00699">roots.h:699</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1SaveAndSwitchContext_html"><div class="ttname"><a href="classv8_1_1internal_1_1SaveAndSwitchContext.html">v8::internal::SaveAndSwitchContext</a></div><div class="ttdef"><b>Definition</b> <a href="execution_2isolate_8h_source.html#l02899">isolate.h:2899</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Signature_html"><div class="ttname"><a href="classv8_1_1internal_1_1Signature.html">v8::internal::Signature&lt; ValueType &gt;</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Tagged_html"><div class="ttname"><a href="classv8_1_1internal_1_1Tagged.html">v8::internal::Tagged</a></div><div class="ttdef"><b>Definition</b> <a href="waiter-queue-node_8h_source.html#l00022">waiter-queue-node.h:22</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1V8_html_a5eb1d47c492fa1e85e7d7c31dd5cf2bb"><div class="ttname"><a href="classv8_1_1internal_1_1V8.html#a5eb1d47c492fa1e85e7d7c31dd5cf2bb">v8::internal::V8::GetCurrentPlatform</a></div><div class="ttdeci">static V8_EXPORT_PRIVATE v8::Platform * GetCurrentPlatform()</div><div class="ttdef"><b>Definition</b> <a href="v8_8cc_source.html#l00290">v8.cc:290</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1WasmCodePointer_html"><div class="ttname"><a href="classv8_1_1internal_1_1WasmCodePointer.html">v8::internal::WasmCodePointer</a></div><div class="ttdef"><b>Definition</b> <a href="common_2globals_8h_source.html#l02798">globals.h:2798</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1WasmModuleObject_html_a2d0c6490148366c81d5ea7e05913f3f8"><div class="ttname"><a href="classv8_1_1internal_1_1WasmModuleObject.html#a2d0c6490148366c81d5ea7e05913f3f8">v8::internal::WasmModuleObject::New</a></div><div class="ttdeci">static V8_EXPORT_PRIVATE Handle&lt; WasmModuleObject &gt; New(Isolate *isolate, std::shared_ptr&lt; wasm::NativeModule &gt; native_module, DirectHandle&lt; Script &gt; script)</div><div class="ttdef"><b>Definition</b> <a href="wasm-objects_8cc_source.html#l00112">wasm-objects.cc:112</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1Zone_html"><div class="ttname"><a href="classv8_1_1internal_1_1Zone.html">v8::internal::Zone</a></div><div class="ttdef"><b>Definition</b> <a href="zone_8h_source.html#l00043">zone.h:43</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html">v8::internal::wasm::AsyncCompileJob::CompilationStateCallback</a></div><div class="ttdef"><b>Definition</b> <a href="#l02846">module-compiler.cc:2847</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback_html_a78a39f3673bf5ded7f231a9201b16fa0"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78a39f3673bf5ded7f231a9201b16fa0">v8::internal::wasm::AsyncCompileJob::CompilationStateCallback::CompilationStateCallback</a></div><div class="ttdeci">CompilationStateCallback(AsyncCompileJob *job)</div><div class="ttdef"><b>Definition</b> <a href="#l02849">module-compiler.cc:2849</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback_html_a78e60c61e792a9b4a003ec26ba892749"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#a78e60c61e792a9b4a003ec26ba892749">v8::internal::wasm::AsyncCompileJob::CompilationStateCallback::job_</a></div><div class="ttdeci">AsyncCompileJob * job_</div><div class="ttdef"><b>Definition</b> <a href="#l02891">module-compiler.cc:2891</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback_html_af03a6f2a5c03d334ec0a8337e73b1da3"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompilationStateCallback.html#af03a6f2a5c03d334ec0a8337e73b1da3">v8::internal::wasm::AsyncCompileJob::CompilationStateCallback::call</a></div><div class="ttdeci">void call(CompilationEvent event) override</div><div class="ttdef"><b>Definition</b> <a href="#l02851">module-compiler.cc:2851</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html">v8::internal::wasm::AsyncCompileJob::CompileStep</a></div><div class="ttdef"><b>Definition</b> <a href="#l02901">module-compiler.cc:2901</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep_html_a0069e90545f2e9dfecaf6c3bb149e172"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a0069e90545f2e9dfecaf6c3bb149e172">v8::internal::wasm::AsyncCompileJob::CompileStep::~CompileStep</a></div><div class="ttdeci">virtual ~CompileStep()=default</div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep_html_a97ba94766f9dd48e4c3f3685904eff16"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#a97ba94766f9dd48e4c3f3685904eff16">v8::internal::wasm::AsyncCompileJob::CompileStep::RunInBackground</a></div><div class="ttdeci">virtual void RunInBackground(AsyncCompileJob *)</div><div class="ttdef"><b>Definition</b> <a href="#l02916">module-compiler.cc:2916</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep_html_abfcaead40f2f15dbf84cee35a2f02623"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#abfcaead40f2f15dbf84cee35a2f02623">v8::internal::wasm::AsyncCompileJob::CompileStep::Run</a></div><div class="ttdeci">void Run(AsyncCompileJob *job, bool on_foreground)</div><div class="ttdef"><b>Definition</b> <a href="#l02905">module-compiler.cc:2905</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep_html_ad5029dd7594af476720c9304999a85bf"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileStep.html#ad5029dd7594af476720c9304999a85bf">v8::internal::wasm::AsyncCompileJob::CompileStep::RunInForeground</a></div><div class="ttdeci">virtual void RunInForeground(AsyncCompileJob *)</div><div class="ttdef"><b>Definition</b> <a href="#l02915">module-compiler.cc:2915</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html">v8::internal::wasm::AsyncCompileJob::CompileTask</a></div><div class="ttdef"><b>Definition</b> <a href="#l02919">module-compiler.cc:2919</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_a204415cbd9628d948c738372bcc6139a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a204415cbd9628d948c738372bcc6139a">v8::internal::wasm::AsyncCompileJob::CompileTask::Cancel</a></div><div class="ttdeci">void Cancel()</div><div class="ttdef"><b>Definition</b> <a href="#l02944">module-compiler.cc:2944</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_a3a8517f046dbb29af2bc0f0ec24762e8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a3a8517f046dbb29af2bc0f0ec24762e8">v8::internal::wasm::AsyncCompileJob::CompileTask::~CompileTask</a></div><div class="ttdeci">~CompileTask() override</div><div class="ttdef"><b>Definition</b> <a href="#l02931">module-compiler.cc:2931</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_a55184f48bc8c3f2d1d4f5e5f190592f7"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a55184f48bc8c3f2d1d4f5e5f190592f7">v8::internal::wasm::AsyncCompileJob::CompileTask::job_</a></div><div class="ttdeci">AsyncCompileJob * job_</div><div class="ttdef"><b>Definition</b> <a href="#l02951">module-compiler.cc:2951</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_a7d63a654af3c6d05fdfb94d9d98152c7"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#a7d63a654af3c6d05fdfb94d9d98152c7">v8::internal::wasm::AsyncCompileJob::CompileTask::ResetPendingForegroundTask</a></div><div class="ttdeci">void ResetPendingForegroundTask() const</div><div class="ttdef"><b>Definition</b> <a href="#l02954">module-compiler.cc:2954</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_ab9b5e4559ae086d12357cb0349cc18b4"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#ab9b5e4559ae086d12357cb0349cc18b4">v8::internal::wasm::AsyncCompileJob::CompileTask::CompileTask</a></div><div class="ttdeci">CompileTask(AsyncCompileJob *job, bool on_foreground)</div><div class="ttdef"><b>Definition</b> <a href="#l02921">module-compiler.cc:2921</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_ada0c2b9f7ae434853a08d3a84a017d06"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#ada0c2b9f7ae434853a08d3a84a017d06">v8::internal::wasm::AsyncCompileJob::CompileTask::RunInternal</a></div><div class="ttdeci">void RunInternal() final</div><div class="ttdef"><b>Definition</b> <a href="#l02935">module-compiler.cc:2935</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask_html_afdc778fbae0b29aed1de49316ff646ff"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1CompileTask.html#afdc778fbae0b29aed1de49316ff646ff">v8::internal::wasm::AsyncCompileJob::CompileTask::on_foreground_</a></div><div class="ttdeci">bool on_foreground_</div><div class="ttdef"><b>Definition</b> <a href="#l02952">module-compiler.cc:2952</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html">v8::internal::wasm::AsyncCompileJob::DecodeModule</a></div><div class="ttdef"><b>Definition</b> <a href="#l03024">module-compiler.cc:3024</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule_html_a2bce50c3ea578bc818214bba82cbb656"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a2bce50c3ea578bc818214bba82cbb656">v8::internal::wasm::AsyncCompileJob::DecodeModule::RunInBackground</a></div><div class="ttdeci">void RunInBackground(AsyncCompileJob *job) override</div><div class="ttdef"><b>Definition</b> <a href="#l03030">module-compiler.cc:3030</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule_html_a441dd7c72c35e06dfb95c4efc6f19d5f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a441dd7c72c35e06dfb95c4efc6f19d5f">v8::internal::wasm::AsyncCompileJob::DecodeModule::DecodeModule</a></div><div class="ttdeci">DecodeModule(Counters *counters, std::shared_ptr&lt; metrics::Recorder &gt; metrics_recorder)</div><div class="ttdef"><b>Definition</b> <a href="#l03026">module-compiler.cc:3026</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule_html_a9ed32c7c7b2617e667833307d0e0163d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#a9ed32c7c7b2617e667833307d0e0163d">v8::internal::wasm::AsyncCompileJob::DecodeModule::metrics_recorder_</a></div><div class="ttdeci">std::shared_ptr&lt; metrics::Recorder &gt; metrics_recorder_</div><div class="ttdef"><b>Definition</b> <a href="#l03081">module-compiler.cc:3081</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule_html_af5503437c181b102ff658c10bc329816"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1DecodeModule.html#af5503437c181b102ff658c10bc329816">v8::internal::wasm::AsyncCompileJob::DecodeModule::counters_</a></div><div class="ttdeci">Counters *const counters_</div><div class="ttdef"><b>Definition</b> <a href="#l03080">module-compiler.cc:3080</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html">v8::internal::wasm::AsyncCompileJob::Fail</a></div><div class="ttdef"><b>Definition</b> <a href="#l03191">module-compiler.cc:3191</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail_html_ac25f2c0a02c26e155b40b1d81740688b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1Fail.html#ac25f2c0a02c26e155b40b1d81740688b">v8::internal::wasm::AsyncCompileJob::Fail::RunInForeground</a></div><div class="ttdeci">void RunInForeground(AsyncCompileJob *job) override</div><div class="ttdef"><b>Definition</b> <a href="#l03193">module-compiler.cc:3193</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html">v8::internal::wasm::AsyncCompileJob::FinishCompilation</a></div><div class="ttdef"><b>Definition</b> <a href="#l03170">module-compiler.cc:3170</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation_html_a6f953f4a930cf5da320864312c15586c"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#a6f953f4a930cf5da320864312c15586c">v8::internal::wasm::AsyncCompileJob::FinishCompilation::FinishCompilation</a></div><div class="ttdeci">FinishCompilation(std::shared_ptr&lt; NativeModule &gt; cached_native_module)</div><div class="ttdef"><b>Definition</b> <a href="#l03172">module-compiler.cc:3172</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation_html_ab8a07eeec21e874700651ffe51950447"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ab8a07eeec21e874700651ffe51950447">v8::internal::wasm::AsyncCompileJob::FinishCompilation::cached_native_module_</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; cached_native_module_</div><div class="ttdef"><b>Definition</b> <a href="#l03185">module-compiler.cc:3185</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation_html_ae0e81a512dd4e7cbc11da9d17e828a75"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1FinishCompilation.html#ae0e81a512dd4e7cbc11da9d17e828a75">v8::internal::wasm::AsyncCompileJob::FinishCompilation::RunInForeground</a></div><div class="ttdeci">void RunInForeground(AsyncCompileJob *job) override</div><div class="ttdef"><b>Definition</b> <a href="#l03176">module-compiler.cc:3176</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile</a></div><div class="ttdef"><b>Definition</b> <a href="#l03087">module-compiler.cc:3087</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html_a0fd85bcabaef22e5f7c3d7bbdbd3458b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a0fd85bcabaef22e5f7c3d7bbdbd3458b">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile::code_size_estimate_</a></div><div class="ttdeci">const size_t code_size_estimate_</div><div class="ttdef"><b>Definition</b> <a href="#l03164">module-compiler.cc:3164</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html_a1d33784fa9eaa4136df95aaac7494d79"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#a1d33784fa9eaa4136df95aaac7494d79">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile::start_compilation_</a></div><div class="ttdeci">const bool start_compilation_</div><div class="ttdef"><b>Definition</b> <a href="#l03162">module-compiler.cc:3162</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html_aab1de8b23d4aa589a08ae97f6feb3220"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aab1de8b23d4aa589a08ae97f6feb3220">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile::RunInForeground</a></div><div class="ttdeci">void RunInForeground(AsyncCompileJob *job) override</div><div class="ttdef"><b>Definition</b> <a href="#l03099">module-compiler.cc:3099</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html_ac5dccdcb6738c90ba8c230cf7450e8b2"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ac5dccdcb6738c90ba8c230cf7450e8b2">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile::PrepareAndStartCompile</a></div><div class="ttdeci">PrepareAndStartCompile(std::shared_ptr&lt; const WasmModule &gt; module, bool start_compilation, bool lazy_functions_are_validated, size_t code_size_estimate)</div><div class="ttdef"><b>Definition</b> <a href="#l03089">module-compiler.cc:3089</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html_ae660c8c041906fd2f5aac072b6ab12d8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#ae660c8c041906fd2f5aac072b6ab12d8">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile::module_</a></div><div class="ttdeci">const std::shared_ptr&lt; const WasmModule &gt; module_</div><div class="ttdef"><b>Definition</b> <a href="#l03161">module-compiler.cc:3161</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile_html_aea65721b6185ebe2e1d51762fbb14079"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob_1_1PrepareAndStartCompile.html#aea65721b6185ebe2e1d51762fbb14079">v8::internal::wasm::AsyncCompileJob::PrepareAndStartCompile::lazy_functions_are_validated_</a></div><div class="ttdeci">const bool lazy_functions_are_validated_</div><div class="ttdef"><b>Definition</b> <a href="#l03163">module-compiler.cc:3163</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html">v8::internal::wasm::AsyncCompileJob</a></div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00115">module-compiler.h:115</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a035c432ed94d826d1746c7d879003dc4"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a035c432ed94d826d1746c7d879003dc4">v8::internal::wasm::AsyncCompileJob::compile_imports_</a></div><div class="ttdeci">CompileTimeImports compile_imports_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00226">module-compiler.h:226</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a04c750e47b50446d0e7b808014cd1adc"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a04c750e47b50446d0e7b808014cd1adc">v8::internal::wasm::AsyncCompileJob::api_method_name_</a></div><div class="ttdeci">const char *const api_method_name_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00223">module-compiler.h:223</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a09dd6dc4ecfe89eba438d934fdc99b48"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a09dd6dc4ecfe89eba438d934fdc99b48">v8::internal::wasm::AsyncCompileJob::Failed</a></div><div class="ttdeci">void Failed()</div><div class="ttdef"><b>Definition</b> <a href="#l02819">module-compiler.cc:2819</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a0a4a22d3cbec712dad3fe9a6c3846106"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0a4a22d3cbec712dad3fe9a6c3846106">v8::internal::wasm::AsyncCompileJob::Start</a></div><div class="ttdeci">void Start()</div><div class="ttdef"><b>Definition</b> <a href="#l02461">module-compiler.cc:2461</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a0c031fff1a73728be15eea6c0a576e85"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0c031fff1a73728be15eea6c0a576e85">v8::internal::wasm::AsyncCompileJob::isolate</a></div><div class="ttdeci">Isolate * isolate() const</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00134">module-compiler.h:134</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a0f21c0af12e028ae3c120b03fbe2c835"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a0f21c0af12e028ae3c120b03fbe2c835">v8::internal::wasm::AsyncCompileJob::DecrementAndCheckFinisherCount</a></div><div class="ttdeci">V8_WARN_UNUSED_RESULT bool DecrementAndCheckFinisherCount()</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00170">module-compiler.h:170</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a1251219f828730c4c64d1b96b4e80973"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1251219f828730c4c64d1b96b4e80973">v8::internal::wasm::AsyncCompileJob::enabled_features_</a></div><div class="ttdeci">const WasmEnabledFeatures enabled_features_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00224">module-compiler.h:224</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a139187b697c7eb6b4a94d3473d7d555b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a139187b697c7eb6b4a94d3473d7d555b">v8::internal::wasm::AsyncCompileJob::NextStep</a></div><div class="ttdeci">void NextStep(Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="#l03017">module-compiler.cc:3017</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a1969624508b5f667f28f0bb9ff9dfb1a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a1969624508b5f667f28f0bb9ff9dfb1a">v8::internal::wasm::AsyncCompileJob::Abort</a></div><div class="ttdeci">void Abort()</div><div class="ttdef"><b>Definition</b> <a href="#l02466">module-compiler.cc:2466</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a2136db2ee2be12a3efaca49297536eb1"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a2136db2ee2be12a3efaca49297536eb1">v8::internal::wasm::AsyncCompileJob::FinishCompile</a></div><div class="ttdeci">void FinishCompile(bool is_after_cache_hit)</div><div class="ttdef"><b>Definition</b> <a href="#l02724">module-compiler.cc:2724</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a32567b0fa26ffcea6e894c54e5bbbc94"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a32567b0fa26ffcea6e894c54e5bbbc94">v8::internal::wasm::AsyncCompileJob::background_task_manager_</a></div><div class="ttdeci">CancelableTaskManager background_task_manager_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00245">module-compiler.h:245</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a3baacc156ce42c61fa72fefff5552930"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a3baacc156ce42c61fa72fefff5552930">v8::internal::wasm::AsyncCompileJob::module_object_</a></div><div class="ttdeci">IndirectHandle&lt; WasmModuleObject &gt; module_object_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00241">module-compiler.h:241</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a4025ea6ad5b7cac05d76451054ae6829"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4025ea6ad5b7cac05d76451054ae6829">v8::internal::wasm::AsyncCompileJob::resolver_</a></div><div class="ttdeci">const std::shared_ptr&lt; CompilationResultResolver &gt; resolver_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00239">module-compiler.h:239</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a4578e31793025cea1409125dcd09c0a9"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4578e31793025cea1409125dcd09c0a9">v8::internal::wasm::AsyncCompileJob::detected_features_</a></div><div class="ttdeci">WasmDetectedFeatures detected_features_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00225">module-compiler.h:225</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a4dff42fd647b975ce6708820a34fffe2"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a4dff42fd647b975ce6708820a34fffe2">v8::internal::wasm::AsyncCompileJob::incumbent_context_</a></div><div class="ttdeci">IndirectHandle&lt; NativeContext &gt; incumbent_context_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00236">module-compiler.h:236</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a5323277e186f3ae7566581ed5e08e518"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5323277e186f3ae7566581ed5e08e518">v8::internal::wasm::AsyncCompileJob::CreateStreamingDecoder</a></div><div class="ttdeci">std::shared_ptr&lt; StreamingDecoder &gt; CreateStreamingDecoder()</div><div class="ttdef"><b>Definition</b> <a href="#l02651">module-compiler.cc:2651</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a5770958190200f2689b976a6a38ed15b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5770958190200f2689b976a6a38ed15b">v8::internal::wasm::AsyncCompileJob::isolate_</a></div><div class="ttdeci">Isolate *const isolate_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00222">module-compiler.h:222</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a5d62877a0c3d97edb19bcefa2e452c57"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a5d62877a0c3d97edb19bcefa2e452c57">v8::internal::wasm::AsyncCompileJob::context_id_</a></div><div class="ttdeci">v8::metrics::Recorder::ContextId context_id_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00237">module-compiler.h:237</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a60c83d8ce32a32ad052ad7a308c64d6c"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a60c83d8ce32a32ad052ad7a308c64d6c">v8::internal::wasm::AsyncCompileJob::foreground_task_runner_</a></div><div class="ttdeci">std::shared_ptr&lt; v8::TaskRunner &gt; foreground_task_runner_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00247">module-compiler.h:247</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a64f04fcf6cdb5b478e9aa48809ae9566"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a64f04fcf6cdb5b478e9aa48809ae9566">v8::internal::wasm::AsyncCompileJob::native_context_</a></div><div class="ttdeci">IndirectHandle&lt; NativeContext &gt; native_context_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00235">module-compiler.h:235</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a793199d0fbb4820d9397652ca4ff8be9"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a793199d0fbb4820d9397652ca4ff8be9">v8::internal::wasm::AsyncCompileJob::stream_</a></div><div class="ttdeci">std::shared_ptr&lt; StreamingDecoder &gt; stream_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00261">module-compiler.h:261</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a7a578d0a0c6dc346c8b242ff3ba6708a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a7a578d0a0c6dc346c8b242ff3ba6708a">v8::internal::wasm::AsyncCompileJob::native_module_</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; native_module_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00242">module-compiler.h:242</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a80e0dfd6274908a644fcc877c72607a9"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a80e0dfd6274908a644fcc877c72607a9">v8::internal::wasm::AsyncCompileJob::FinishSuccessfully</a></div><div class="ttdeci">void FinishSuccessfully()</div><div class="ttdef"><b>Definition</b> <a href="#l03200">module-compiler.cc:3200</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a88a441ca477b50b987fc34ae1c949c35"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a88a441ca477b50b987fc34ae1c949c35">v8::internal::wasm::AsyncCompileJob::context_id</a></div><div class="ttdeci">v8::metrics::Recorder::ContextId context_id() const</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00137">module-compiler.h:137</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a902952b2ef0c0a8cc6d4afb53b4480ce"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a902952b2ef0c0a8cc6d4afb53b4480ce">v8::internal::wasm::AsyncCompileJob::dynamic_tiering_</a></div><div class="ttdeci">const DynamicTiering dynamic_tiering_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00227">module-compiler.h:227</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_a9b511b12a269d1a9e7e8b50cfdce26a9"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#a9b511b12a269d1a9e7e8b50cfdce26a9">v8::internal::wasm::AsyncCompileJob::~AsyncCompileJob</a></div><div class="ttdeci">~AsyncCompileJob()</div><div class="ttdef"><b>Definition</b> <a href="#l02658">module-compiler.cc:2658</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_aa6f6ab41891c7f7149927275445fe100"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#aa6f6ab41891c7f7149927275445fe100">v8::internal::wasm::AsyncCompileJob::context</a></div><div class="ttdeci">Handle&lt; NativeContext &gt; context() const</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00136">module-compiler.h:136</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_aa84200caacc713311e166e63a9b3759f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#aa84200caacc713311e166e63a9b3759f">v8::internal::wasm::AsyncCompileJob::CancelPendingForegroundTask</a></div><div class="ttdeci">void CancelPendingForegroundTask()</div><div class="ttdef"><b>Definition</b> <a href="#l02976">module-compiler.cc:2976</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ab2345a7e23a4b90636bf3986bb22f54e"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab2345a7e23a4b90636bf3986bb22f54e">v8::internal::wasm::AsyncCompileJob::StartBackgroundTask</a></div><div class="ttdeci">void StartBackgroundTask()</div><div class="ttdef"><b>Definition</b> <a href="#l02982">module-compiler.cc:2982</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ab4666e785e9acaa99d4290e9e21f8a9e"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab4666e785e9acaa99d4290e9e21f8a9e">v8::internal::wasm::AsyncCompileJob::StartForegroundTask</a></div><div class="ttdeci">void StartForegroundTask()</div><div class="ttdef"><b>Definition</b> <a href="#l02960">module-compiler.cc:2960</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ab632923d90b8ad7e8d6b3bbb8e985a7f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ab632923d90b8ad7e8d6b3bbb8e985a7f">v8::internal::wasm::AsyncCompileJob::start_time_</a></div><div class="ttdeci">base::TimeTicks start_time_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00228">module-compiler.h:228</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_abb47c3e3846b0ae191c5c1c9c2ef0b84"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#abb47c3e3846b0ae191c5c1c9c2ef0b84">v8::internal::wasm::AsyncCompileJob::DoImmediately</a></div><div class="ttdeci">void DoImmediately(Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="#l03005">module-compiler.cc:3005</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ac2da5dad6fdcf531d99f2ddf886d3898"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ac2da5dad6fdcf531d99f2ddf886d3898">v8::internal::wasm::AsyncCompileJob::outstanding_finishers_</a></div><div class="ttdeci">std::atomic&lt; int32_t &gt; outstanding_finishers_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00252">module-compiler.h:252</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ac48b6808fbb2e4a304b8bfb011ba8988"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ac48b6808fbb2e4a304b8bfb011ba8988">v8::internal::wasm::AsyncCompileJob::compilation_id_</a></div><div class="ttdeci">const int compilation_id_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00264">module-compiler.h:264</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ad155f15fbc01d3537cbaf00b74c2f382"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad155f15fbc01d3537cbaf00b74c2f382">v8::internal::wasm::AsyncCompileJob::GetOrCreateNativeModule</a></div><div class="ttdeci">bool GetOrCreateNativeModule(std::shared_ptr&lt; const WasmModule &gt; module, size_t code_size_estimate)</div><div class="ttdef"><b>Definition</b> <a href="#l02697">module-compiler.cc:2697</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ad958c48b5e4f28453ed24da4dc46602f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ad958c48b5e4f28453ed24da4dc46602f">v8::internal::wasm::AsyncCompileJob::ExecuteForegroundTaskImmediately</a></div><div class="ttdeci">void ExecuteForegroundTaskImmediately()</div><div class="ttdef"><b>Definition</b> <a href="#l02968">module-compiler.cc:2968</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_adc4f41e503922e7570bc5d1fbfc95bec"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adc4f41e503922e7570bc5d1fbfc95bec">v8::internal::wasm::AsyncCompileJob::metrics_event_</a></div><div class="ttdeci">v8::metrics::WasmModuleDecoded metrics_event_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00238">module-compiler.h:238</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_add267630191de419bf4467180a938b3b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#add267630191de419bf4467180a938b3b">v8::internal::wasm::AsyncCompileJob::DoAsync</a></div><div class="ttdeci">void DoAsync(Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="#l03011">module-compiler.cc:3011</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_adef95f093ae1dc1da035c1ec5d338c23"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#adef95f093ae1dc1da035c1ec5d338c23">v8::internal::wasm::AsyncCompileJob::CreateNativeModule</a></div><div class="ttdeci">void CreateNativeModule(std::shared_ptr&lt; const WasmModule &gt; module, size_t code_size_estimate)</div><div class="ttdef"><b>Definition</b> <a href="#l02677">module-compiler.cc:2677</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ae77c020ba9cb9930263e6ef833d5186d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae77c020ba9cb9930263e6ef833d5186d">v8::internal::wasm::AsyncCompileJob::pending_foreground_task_</a></div><div class="ttdeci">CompileTask * pending_foreground_task_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00255">module-compiler.h:255</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ae9267b6a79f50110f5e4a79b38d0678d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9267b6a79f50110f5e4a79b38d0678d">v8::internal::wasm::AsyncCompileJob::bytes_copy_</a></div><div class="ttdeci">base::OwnedVector&lt; const uint8_t &gt; bytes_copy_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00231">module-compiler.h:231</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_ae9af46f338ef59099371aabe35332e84"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#ae9af46f338ef59099371aabe35332e84">v8::internal::wasm::AsyncCompileJob::PrepareRuntimeObjects</a></div><div class="ttdeci">void PrepareRuntimeObjects()</div><div class="ttdef"><b>Definition</b> <a href="#l02708">module-compiler.cc:2708</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_af3c71b1c92469d246d929fe3f6ea1061"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af3c71b1c92469d246d929fe3f6ea1061">v8::internal::wasm::AsyncCompileJob::step_</a></div><div class="ttdeci">std::unique_ptr&lt; CompileStep &gt; step_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00244">module-compiler.h:244</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_af40a1ad30e0fb57f80aa1d76af7bdc84"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af40a1ad30e0fb57f80aa1d76af7bdc84">v8::internal::wasm::AsyncCompileJob::DoSync</a></div><div class="ttdeci">void DoSync(Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="#l02998">module-compiler.cc:2998</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_af6b76f3ffe061364d7d7b2e2b2090e5b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af6b76f3ffe061364d7d7b2e2b2090e5b">v8::internal::wasm::AsyncCompileJob::wire_bytes_</a></div><div class="ttdeci">ModuleWireBytes wire_bytes_</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00234">module-compiler.h:234</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncCompileJob_html_af8542ed1d50257c03ea1bd612150af14"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncCompileJob.html#af8542ed1d50257c03ea1bd612150af14">v8::internal::wasm::AsyncCompileJob::UseExistingForegroundTask</a></div><div class="ttdeci">UseExistingForegroundTask</div><div class="ttdef"><b>Definition</b> <a href="module-compiler_8h_source.html#l00195">module-compiler.h:195</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html">v8::internal::wasm::AsyncStreamingProcessor</a></div><div class="ttdef"><b>Definition</b> <a href="#l02604">module-compiler.cc:2604</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a0658423182f9a376a82ffb6a3ea18529"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a0658423182f9a376a82ffb6a3ea18529">v8::internal::wasm::AsyncStreamingProcessor::decoder_</a></div><div class="ttdeci">ModuleDecoder decoder_</div><div class="ttdef"><b>Definition</b> <a href="#l02636">module-compiler.cc:2636</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a1299b61f757fe2cfa5ec698e755650e0"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a1299b61f757fe2cfa5ec698e755650e0">v8::internal::wasm::AsyncStreamingProcessor::OnFinishedStream</a></div><div class="ttdeci">void OnFinishedStream(base::OwnedVector&lt; const uint8_t &gt; bytes, bool after_error) override</div><div class="ttdef"><b>Definition</b> <a href="#l03379">module-compiler.cc:3379</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a19842d57ed6e47f88fc3ccb57cd43619"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a19842d57ed6e47f88fc3ccb57cd43619">v8::internal::wasm::AsyncStreamingProcessor::OnFinishedChunk</a></div><div class="ttdeci">void OnFinishedChunk() override</div><div class="ttdef"><b>Definition</b> <a href="#l03373">module-compiler.cc:3373</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a221daf9573abdb3dd51a8c6b5b90f240"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a221daf9573abdb3dd51a8c6b5b90f240">v8::internal::wasm::AsyncStreamingProcessor::job_</a></div><div class="ttdeci">AsyncCompileJob * job_</div><div class="ttdef"><b>Definition</b> <a href="#l02637">module-compiler.cc:2637</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a41aab3efc6dfb1d49db122d8d43176f6"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a41aab3efc6dfb1d49db122d8d43176f6">v8::internal::wasm::AsyncStreamingProcessor::before_code_section_</a></div><div class="ttdeci">bool before_code_section_</div><div class="ttdef"><b>Definition</b> <a href="#l02641">module-compiler.cc:2641</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a51402d2262d54931c0b503f9c652f89f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a51402d2262d54931c0b503f9c652f89f">v8::internal::wasm::AsyncStreamingProcessor::prefix_hasher_</a></div><div class="ttdeci">base::Hasher prefix_hasher_</div><div class="ttdef"><b>Definition</b> <a href="#l02648">module-compiler.cc:2648</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a537df0ea5bce7272d916cb863442a908"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a537df0ea5bce7272d916cb863442a908">v8::internal::wasm::AsyncStreamingProcessor::validate_functions_job_handle_</a></div><div class="ttdeci">std::unique_ptr&lt; JobHandle &gt; validate_functions_job_handle_</div><div class="ttdef"><b>Definition</b> <a href="#l02643">module-compiler.cc:2643</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a707cf5b73e892c3ddd7b74cef826c429"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a707cf5b73e892c3ddd7b74cef826c429">v8::internal::wasm::AsyncStreamingProcessor::ProcessCodeSectionHeader</a></div><div class="ttdeci">bool ProcessCodeSectionHeader(int num_functions, uint32_t functions_mismatch_error_offset, std::shared_ptr&lt; WireBytesStorage &gt;, int code_section_start, int code_section_length) override</div><div class="ttdef"><b>Definition</b> <a href="#l03263">module-compiler.cc:3263</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a807224ecf5ba4eaf8434dea9b99a78a8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a807224ecf5ba4eaf8434dea9b99a78a8">v8::internal::wasm::AsyncStreamingProcessor::OnAbort</a></div><div class="ttdeci">void OnAbort() override</div><div class="ttdef"><b>Definition</b> <a href="#l03514">module-compiler.cc:3514</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_a9da068ebd21214867da972e51689bee5"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#a9da068ebd21214867da972e51689bee5">v8::internal::wasm::AsyncStreamingProcessor::AsyncStreamingProcessor</a></div><div class="ttdeci">AsyncStreamingProcessor(AsyncCompileJob *job)</div><div class="ttdef"><b>Definition</b> <a href="#l03215">module-compiler.cc:3215</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_aa26940dbb1434275daab70cdf12e8326"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aa26940dbb1434275daab70cdf12e8326">v8::internal::wasm::AsyncStreamingProcessor::ProcessFunctionBody</a></div><div class="ttdeci">bool ProcessFunctionBody(base::Vector&lt; const uint8_t &gt; bytes, uint32_t offset) override</div><div class="ttdef"><b>Definition</b> <a href="#l03319">module-compiler.cc:3319</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_aac7514bd78200ea2d33761023d266de4"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aac7514bd78200ea2d33761023d266de4">v8::internal::wasm::AsyncStreamingProcessor::ProcessSection</a></div><div class="ttdeci">bool ProcessSection(SectionCode section_code, base::Vector&lt; const uint8_t &gt; bytes, uint32_t offset) override</div><div class="ttdef"><b>Definition</b> <a href="#l03232">module-compiler.cc:3232</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_abd92e250972b00568ca25570a16ab1f1"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#abd92e250972b00568ca25570a16ab1f1">v8::internal::wasm::AsyncStreamingProcessor::validate_functions_job_data_</a></div><div class="ttdeci">ValidateFunctionsStreamingJobData validate_functions_job_data_</div><div class="ttdef"><b>Definition</b> <a href="#l02642">module-compiler.cc:2642</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_ac33024dbe8bff894aec911642a350dc6"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac33024dbe8bff894aec911642a350dc6">v8::internal::wasm::AsyncStreamingProcessor::Deserialize</a></div><div class="ttdeci">bool Deserialize(base::Vector&lt; const uint8_t &gt; wire_bytes, base::Vector&lt; const uint8_t &gt; module_bytes) override</div><div class="ttdef"><b>Definition</b> <a href="#l03529">module-compiler.cc:3529</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_ac67a8f7664b800ae0d94e1bb983cbae3"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ac67a8f7664b800ae0d94e1bb983cbae3">v8::internal::wasm::AsyncStreamingProcessor::num_functions_</a></div><div class="ttdeci">int num_functions_</div><div class="ttdef"><b>Definition</b> <a href="#l02639">module-compiler.cc:2639</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_aded301ffb872d0ebb5f27eb3ee0d06a3"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aded301ffb872d0ebb5f27eb3ee0d06a3">v8::internal::wasm::AsyncStreamingProcessor::compilation_unit_builder_</a></div><div class="ttdeci">std::unique_ptr&lt; CompilationUnitBuilder &gt; compilation_unit_builder_</div><div class="ttdef"><b>Definition</b> <a href="#l02638">module-compiler.cc:2638</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_ae4c1a9be1a289f121f11888233dc2065"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#ae4c1a9be1a289f121f11888233dc2065">v8::internal::wasm::AsyncStreamingProcessor::CommitCompilationUnits</a></div><div class="ttdeci">void CommitCompilationUnits()</div><div class="ttdef"><b>Definition</b> <a href="#l03368">module-compiler.cc:3368</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_aee9a0b6fb579488ab89cc95ea9e6caef"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aee9a0b6fb579488ab89cc95ea9e6caef">v8::internal::wasm::AsyncStreamingProcessor::ProcessModuleHeader</a></div><div class="ttdeci">bool ProcessModuleHeader(base::Vector&lt; const uint8_t &gt; bytes) override</div><div class="ttdef"><b>Definition</b> <a href="#l03221">module-compiler.cc:3221</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor_html_aef24faaab0279a141c00469c1e66b617"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1AsyncStreamingProcessor.html#aef24faaab0279a141c00469c1e66b617">v8::internal::wasm::AsyncStreamingProcessor::prefix_cache_hit_</a></div><div class="ttdeci">bool prefix_cache_hit_</div><div class="ttdef"><b>Definition</b> <a href="#l02640">module-compiler.cc:2640</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CallSiteFeedback_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html">v8::internal::wasm::CallSiteFeedback</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00512">wasm-module.h:512</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CallSiteFeedback_html_a6088a3693fde5bfe38d4c287cb3ef006"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a6088a3693fde5bfe38d4c287cb3ef006">v8::internal::wasm::CallSiteFeedback::is_megamorphic</a></div><div class="ttdeci">bool is_megamorphic() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00597">wasm-module.h:597</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CallSiteFeedback_html_a6d80e8276ad897f0d1bb2157b33aaf0d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a6d80e8276ad897f0d1bb2157b33aaf0d">v8::internal::wasm::CallSiteFeedback::num_cases</a></div><div class="ttdeci">int num_cases() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00575">wasm-module.h:575</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CallSiteFeedback_html_a7a74f41aeae304037366748ed360538a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a7a74f41aeae304037366748ed360538a">v8::internal::wasm::CallSiteFeedback::call_count</a></div><div class="ttdeci">int call_count(int i) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00585">wasm-module.h:585</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CallSiteFeedback_html_a8c5e0d187ba12d271429ec0d6b1f93fe"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#a8c5e0d187ba12d271429ec0d6b1f93fe">v8::internal::wasm::CallSiteFeedback::has_non_inlineable_targets</a></div><div class="ttdeci">bool has_non_inlineable_targets() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00590">wasm-module.h:590</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CallSiteFeedback_html_aa53156b01a8f7b14b7fb11da2e2c150c"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CallSiteFeedback.html#aa53156b01a8f7b14b7fb11da2e2c150c">v8::internal::wasm::CallSiteFeedback::function_index</a></div><div class="ttdeci">int function_index(int i) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00580">wasm-module.h:580</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CanonicalSig_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CanonicalSig.html">v8::internal::wasm::CanonicalSig</a></div><div class="ttdef"><b>Definition</b> <a href="value-type_8h_source.html#l01173">value-type.h:1173</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompilationEventCallback_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompilationEventCallback.html">v8::internal::wasm::CompilationEventCallback</a></div><div class="ttdef"><b>Definition</b> <a href="compilation-environment_8h_source.html#l00107">compilation-environment.h:107</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompilationState_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompilationState.html">v8::internal::wasm::CompilationState</a></div><div class="ttdef"><b>Definition</b> <a href="compilation-environment_8h_source.html#l00129">compilation-environment.h:129</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompilationState_html_a2badfff8eee4ca33ffd54ab30ae5b1bf"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompilationState.html#a2badfff8eee4ca33ffd54ab30ae5b1bf">v8::internal::wasm::CompilationState::failed</a></div><div class="ttdeci">bool failed() const</div><div class="ttdef"><b>Definition</b> <a href="#l00928">module-compiler.cc:928</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompileTimeImports_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html">v8::internal::wasm::CompileTimeImports</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00146">wasm-features.h:146</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompileTimeImports_html_a3a42250749ca938e52a5116f2e5720eb"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#a3a42250749ca938e52a5116f2e5720eb">v8::internal::wasm::CompileTimeImports::has_string_constants</a></div><div class="ttdeci">bool has_string_constants(base::Vector&lt; const uint8_t &gt; name) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00172">wasm-features.h:172</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompileTimeImports_html_a7bddfd43d06279d0cc613b668aa7e052"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#a7bddfd43d06279d0cc613b668aa7e052">v8::internal::wasm::CompileTimeImports::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00171">wasm-features.h:171</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1CompileTimeImports_html_aa10cbaf2a25c618bfdda0ed3cf4b76da"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1CompileTimeImports.html#aa10cbaf2a25c618bfdda0ed3cf4b76da">v8::internal::wasm::CompileTimeImports::contains</a></div><div class="ttdeci">bool contains(CompileTimeImport imp) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00177">wasm-features.h:177</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ErrorThrower_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html">v8::internal::wasm::ErrorThrower</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00123">wasm-result.h:123</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ErrorThrower_html_a2d32c2f4fadecb8c1434fa2998171e23"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html#a2d32c2f4fadecb8c1434fa2998171e23">v8::internal::wasm::ErrorThrower::CompileFailed</a></div><div class="ttdeci">void CompileFailed(const WasmError &amp;error)</div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00138">wasm-result.h:138</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ErrorThrower_html_aef25eb132a83562c6c06e62a247b625f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ErrorThrower.html#aef25eb132a83562c6c06e62a247b625f">v8::internal::wasm::ErrorThrower::Reify</a></div><div class="ttdeci">V8_WARN_UNUSED_RESULT Handle&lt; Object &gt; Reify()</div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8cc_source.html#l00107">wasm-result.cc:107</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html">v8::internal::wasm::FeedbackMaker</a></div><div class="ttdef"><b>Definition</b> <a href="#l01354">module-compiler.cc:1354</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a0cdc61b56b654326fae1c9dd7b0e5f73"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a0cdc61b56b654326fae1c9dd7b0e5f73">v8::internal::wasm::FeedbackMaker::AddCall</a></div><div class="ttdeci">void AddCall(int target, int count)</div><div class="ttdef"><b>Definition</b> <a href="#l01417">module-compiler.cc:1417</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a1228df35a1034986937d698a12ec48d5"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1228df35a1034986937d698a12ec48d5">v8::internal::wasm::FeedbackMaker::AddCallRefCandidate</a></div><div class="ttdeci">void AddCallRefCandidate(Tagged&lt; WasmFuncRef &gt; funcref, int count)</div><div class="ttdef"><b>Definition</b> <a href="#l01367">module-compiler.cc:1367</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a1de5839ed3afdbc96278501fce06c95a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a1de5839ed3afdbc96278501fce06c95a">v8::internal::wasm::FeedbackMaker::instance_data_</a></div><div class="ttdeci">const Tagged&lt; WasmTrustedInstanceData &gt; instance_data_</div><div class="ttdef"><b>Definition</b> <a href="#l01492">module-compiler.cc:1492</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a21cb7646a6fd34c811c71f4651fcb9d2"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a21cb7646a6fd34c811c71f4651fcb9d2">v8::internal::wasm::FeedbackMaker::AddCallIndirectCandidate</a></div><div class="ttdeci">void AddCallIndirectCandidate(Tagged&lt; Object &gt; target_truncated_obj, int count)</div><div class="ttdef"><b>Definition</b> <a href="#l01383">module-compiler.cc:1383</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a2213da6f4221efbea81330fd8638df66"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a2213da6f4221efbea81330fd8638df66">v8::internal::wasm::FeedbackMaker::FinalizeCall</a></div><div class="ttdeci">void FinalizeCall()</div><div class="ttdef"><b>Definition</b> <a href="#l01446">module-compiler.cc:1446</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a35024221f0a5d84611039a0670393b88"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a35024221f0a5d84611039a0670393b88">v8::internal::wasm::FeedbackMaker::HasTargetCached</a></div><div class="ttdeci">bool HasTargetCached(int target)</div><div class="ttdef"><b>Definition</b> <a href="#l01440">module-compiler.cc:1440</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a421bfdaf8fe8b4f0e852affdc3da0352"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a421bfdaf8fe8b4f0e852affdc3da0352">v8::internal::wasm::FeedbackMaker::set_has_non_inlineable_targets</a></div><div class="ttdeci">void set_has_non_inlineable_targets()</div><div class="ttdef"><b>Definition</b> <a href="#l01483">module-compiler.cc:1483</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a5494dd4e759c71ec8dfab525fb7cb4e1"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5494dd4e759c71ec8dfab525fb7cb4e1">v8::internal::wasm::FeedbackMaker::isolate_</a></div><div class="ttdeci">Isolate *const isolate_</div><div class="ttdef"><b>Definition</b> <a href="#l01491">module-compiler.cc:1491</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a5824f218ec16cec709f6c8edfb415ecc"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5824f218ec16cec709f6c8edfb415ecc">v8::internal::wasm::FeedbackMaker::result_</a></div><div class="ttdeci">std::vector&lt; CallSiteFeedback &gt; result_</div><div class="ttdef"><b>Definition</b> <a href="#l01493">module-compiler.cc:1493</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a5e77f5f48f3444fbf75a8a66ee8690f1"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a5e77f5f48f3444fbf75a8a66ee8690f1">v8::internal::wasm::FeedbackMaker::FeedbackMaker</a></div><div class="ttdeci">FeedbackMaker(Isolate *const isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data, int func_index, int num_calls)</div><div class="ttdef"><b>Definition</b> <a href="#l01356">module-compiler.cc:1356</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_a66eb2e349511d93e32a382a683834e17"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#a66eb2e349511d93e32a382a683834e17">v8::internal::wasm::FeedbackMaker::set_megamorphic</a></div><div class="ttdeci">void set_megamorphic()</div><div class="ttdef"><b>Definition</b> <a href="#l01484">module-compiler.cc:1484</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_ab949e31f99ea4d685c9ad55c495d3743"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ab949e31f99ea4d685c9ad55c495d3743">v8::internal::wasm::FeedbackMaker::func_index_</a></div><div class="ttdeci">const int func_index_</div><div class="ttdef"><b>Definition</b> <a href="#l01495">module-compiler.cc:1495</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_ac1fedc3038162cdb2114c5d24663afdc"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#ac1fedc3038162cdb2114c5d24663afdc">v8::internal::wasm::FeedbackMaker::GetResult</a></div><div class="ttdeci">std::vector&lt; CallSiteFeedback &gt; &amp;&amp; GetResult() &amp;&amp;</div><div class="ttdef"><b>Definition</b> <a href="#l01488">module-compiler.cc:1488</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_adbcf8884373c5ab48d1fe9e7b6cdbb6a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#adbcf8884373c5ab48d1fe9e7b6cdbb6a">v8::internal::wasm::FeedbackMaker::targets_cache_</a></div><div class="ttdeci">std::array&lt; int, kMaxPolymorphism &gt; targets_cache_</div><div class="ttdef"><b>Definition</b> <a href="#l01497">module-compiler.cc:1497</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_aea42c4ef1afb972bf2797399683207e7"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#aea42c4ef1afb972bf2797399683207e7">v8::internal::wasm::FeedbackMaker::counts_cache_</a></div><div class="ttdeci">std::array&lt; int, kMaxPolymorphism &gt; counts_cache_</div><div class="ttdef"><b>Definition</b> <a href="#l01498">module-compiler.cc:1498</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1FeedbackMaker_html_af5d6075341ff19ff2ae481c9df75665a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1FeedbackMaker.html#af5d6075341ff19ff2ae481c9df75665a">v8::internal::wasm::FeedbackMaker::num_imported_functions_</a></div><div class="ttdeci">const int num_imported_functions_</div><div class="ttdef"><b>Definition</b> <a href="#l01494">module-compiler.cc:1494</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html">v8::internal::wasm::ModuleDecoder</a></div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8h_source.html#l00157">module-decoder.h:157</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_a09b197766daf7d8a7b45b449d393cdcd"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a09b197766daf7d8a7b45b449d393cdcd">v8::internal::wasm::ModuleDecoder::module</a></div><div class="ttdeci">WasmModule * module() const</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8h_source.html#l00178">module-decoder.h:178</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_a158d159abc6eff4987e7b574305f6efd"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a158d159abc6eff4987e7b574305f6efd">v8::internal::wasm::ModuleDecoder::DecodeSection</a></div><div class="ttdeci">void DecodeSection(SectionCode section_code, base::Vector&lt; const uint8_t &gt; bytes, uint32_t offset)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00156">module-decoder.cc:156</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_a6261e2904d468325a0ce31fc10e95b65"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a6261e2904d468325a0ce31fc10e95b65">v8::internal::wasm::ModuleDecoder::ok</a></div><div class="ttdeci">bool ok() const</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00189">module-decoder.cc:189</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_a80a8197a6d39d2a6cf242bdcf6b01425"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a80a8197a6d39d2a6cf242bdcf6b01425">v8::internal::wasm::ModuleDecoder::StartCodeSection</a></div><div class="ttdeci">void StartCodeSection(WireBytesRef section_bytes)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00167">module-decoder.cc:167</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_a8acb438d35687ddde33f2711f57fc43e"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#a8acb438d35687ddde33f2711f57fc43e">v8::internal::wasm::ModuleDecoder::shared_module</a></div><div class="ttdeci">const std::shared_ptr&lt; WasmModule &gt; &amp; shared_module() const</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00148">module-decoder.cc:148</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_ab269c7b3c86924c81fcad654b3e3a446"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#ab269c7b3c86924c81fcad654b3e3a446">v8::internal::wasm::ModuleDecoder::FinishDecoding</a></div><div class="ttdeci">ModuleResult FinishDecoding()</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00176">module-decoder.cc:176</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_adf6bbeca3b9ea708958affa0b8901d9c"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#adf6bbeca3b9ea708958affa0b8901d9c">v8::internal::wasm::ModuleDecoder::DecodeModuleHeader</a></div><div class="ttdeci">void DecodeModuleHeader(base::Vector&lt; const uint8_t &gt; bytes)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00152">module-decoder.cc:152</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_ae4fc5f48b45481886c6146a470de6498"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#ae4fc5f48b45481886c6146a470de6498">v8::internal::wasm::ModuleDecoder::IdentifyUnknownSection</a></div><div class="ttdeci">static size_t IdentifyUnknownSection(ModuleDecoder *decoder, base::Vector&lt; const uint8_t &gt; bytes, uint32_t offset, SectionCode *result)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00178">module-decoder.cc:178</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_aefc7fd0a74afba7f3300dde744b3c09d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#aefc7fd0a74afba7f3300dde744b3c09d">v8::internal::wasm::ModuleDecoder::DecodeFunctionBody</a></div><div class="ttdeci">void DecodeFunctionBody(uint32_t index, uint32_t size, uint32_t offset)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00162">module-decoder.cc:162</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ModuleDecoder_html_af1e71390300a70d4322bbff2ec9c641e"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ModuleDecoder.html#af1e71390300a70d4322bbff2ec9c641e">v8::internal::wasm::ModuleDecoder::CheckFunctionsCount</a></div><div class="ttdeci">bool CheckFunctionsCount(uint32_t functions_count, uint32_t error_offset)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00171">module-decoder.cc:171</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModuleCache_html_ac7e973c109cc4129f87b3cc3c775f10b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModuleCache.html#ac7e973c109cc4129f87b3cc3c775f10b">v8::internal::wasm::NativeModuleCache::PrefixHash</a></div><div class="ttdeci">static size_t PrefixHash(base::Vector&lt; const uint8_t &gt; wire_bytes)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l00402">wasm-engine.cc:402</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html">v8::internal::wasm::NativeModule</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00548">wasm-code-manager.h:548</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a07182fe52910a2cd8573302ceb5e624a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a07182fe52910a2cd8573302ceb5e624a">v8::internal::wasm::NativeModule::compilation_state</a></div><div class="ttdeci">CompilationState * compilation_state() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00679">wasm-code-manager.h:679</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a4210dcf60ee0c22b95de93af93f17f86"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a4210dcf60ee0c22b95de93af93f17f86">v8::internal::wasm::NativeModule::num_functions</a></div><div class="ttdeci">uint32_t num_functions() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00683">wasm-code-manager.h:683</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a443a4c6a0f2bedcc6e0ac7f03ece629e"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a443a4c6a0f2bedcc6e0ac7f03ece629e">v8::internal::wasm::NativeModule::module</a></div><div class="ttdeci">const WasmModule * module() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00694">wasm-code-manager.h:694</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a5a7bb5fd0dd2615fbbb6b608df1fdd68"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a5a7bb5fd0dd2615fbbb6b608df1fdd68">v8::internal::wasm::NativeModule::wire_bytes</a></div><div class="ttdeci">base::Vector&lt; const uint8_t &gt; wire_bytes() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00691">wasm-code-manager.h:691</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a7394f35597a2e806ed37a5131279919d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a7394f35597a2e806ed37a5131279919d">v8::internal::wasm::NativeModule::log_code</a></div><div class="ttdeci">bool log_code() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00826">wasm-code-manager.h:826</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a74d82ac97a7bb02ac5781d209ffe2bc5"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a74d82ac97a7bb02ac5781d209ffe2bc5">v8::internal::wasm::NativeModule::HasCodeWithTier</a></div><div class="ttdeci">bool HasCodeWithTier(uint32_t index, ExecutionTier tier) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8cc_source.html#l01654">wasm-code-manager.cc:1654</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a91db58c0a3ed6efdba8d82e23a659fa7"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a91db58c0a3ed6efdba8d82e23a659fa7">v8::internal::wasm::NativeModule::PublishCode</a></div><div class="ttdeci">WasmCode * PublishCode(UnpublishedWasmCode)</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8cc_source.html#l01380">wasm-code-manager.cc:1380</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a95dc87711f2fbd647080305bf39e447f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a95dc87711f2fbd647080305bf39e447f">v8::internal::wasm::NativeModule::IsInDebugState</a></div><div class="ttdeci">DebugState IsInDebugState() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00776">wasm-code-manager.h:776</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_a9a49a036ab412a6c462feba4042ef5e8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#a9a49a036ab412a6c462feba4042ef5e8">v8::internal::wasm::NativeModule::lazy_compile_frozen</a></div><div class="ttdeci">bool lazy_compile_frozen() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00690">wasm-code-manager.h:690</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_abc4f3edf1e0fcd8adc53f38952345aed"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#abc4f3edf1e0fcd8adc53f38952345aed">v8::internal::wasm::NativeModule::AddCompiledCode</a></div><div class="ttdeci">V8_WARN_UNUSED_RESULT UnpublishedWasmCode AddCompiledCode(WasmCompilationResult &amp;)</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8cc_source.html#l02569">wasm-code-manager.cc:2569</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_ac8900d676fd063b88a6876f464dd8a07"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#ac8900d676fd063b88a6876f464dd8a07">v8::internal::wasm::NativeModule::enabled_features</a></div><div class="ttdeci">WasmEnabledFeatures enabled_features() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00756">wasm-code-manager.h:756</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_addb6002d53e166907484bf3715ff599caeb1f31c38f14cfa2fb295e63efdbdfbd"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#addb6002d53e166907484bf3715ff599caeb1f31c38f14cfa2fb295e63efdbdfbd">v8::internal::wasm::NativeModule::RemoveFilter::kRemoveNonDebugCode</a></div><div class="ttdeci">@ kRemoveNonDebugCode</div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1NativeModule_html_af886dc3d493824b7a1ae1e1f5ae02e42"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1NativeModule.html#af886dc3d493824b7a1ae1e1f5ae02e42">v8::internal::wasm::NativeModule::num_imported_functions</a></div><div class="ttdeci">uint32_t num_imported_functions() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00686">wasm-code-manager.h:686</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ProfileInformation_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ProfileInformation.html">v8::internal::wasm::ProfileInformation</a></div><div class="ttdef"><b>Definition</b> <a href="pgo_8h_source.html#l00020">pgo.h:20</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1Result_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1Result.html">v8::internal::wasm::Result</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00068">wasm-result.h:68</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1Result_html_a084b2eb633d37457622cd4dc1cd2e506"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1Result.html#a084b2eb633d37457622cd4dc1cd2e506">v8::internal::wasm::Result::ok</a></div><div class="ttdeci">bool ok() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00099">wasm-result.h:99</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1Result_html_a4f23066466cbb5c5f8e7b3962e642479"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1Result.html#a4f23066466cbb5c5f8e7b3962e642479">v8::internal::wasm::Result::value</a></div><div class="ttdeci">const T &amp; value() const &amp;</div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00108">wasm-result.h:108</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1Result_html_aff1e1589e6852f41ed5a060d5e4517f9"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1Result.html#aff1e1589e6852f41ed5a060d5e4517f9">v8::internal::wasm::Result::failed</a></div><div class="ttdeci">bool failed() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00100">wasm-result.h:100</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1StreamingDecoder_html_a64bbde97cda65ad78a00333670c8fb05"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1StreamingDecoder.html#a64bbde97cda65ad78a00333670c8fb05">v8::internal::wasm::StreamingDecoder::CreateAsyncStreamingDecoder</a></div><div class="ttdeci">static std::unique_ptr&lt; StreamingDecoder &gt; CreateAsyncStreamingDecoder(std::unique_ptr&lt; StreamingProcessor &gt; processor)</div><div class="ttdef"><b>Definition</b> <a href="streaming-decoder_8cc_source.html#l00771">streaming-decoder.cc:771</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1StreamingProcessor_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1StreamingProcessor.html">v8::internal::wasm::StreamingProcessor</a></div><div class="ttdef"><b>Definition</b> <a href="streaming-decoder_8h_source.html#l00027">streaming-decoder.h:27</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html">v8::internal::wasm::TransitiveTypeFeedbackProcessor</a></div><div class="ttdef"><b>Definition</b> <a href="#l01284">module-compiler.cc:1284</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a14ad0c368dcdb3b57a95a18ae4b3e245"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a14ad0c368dcdb3b57a95a18ae4b3e245">v8::internal::wasm::TransitiveTypeFeedbackProcessor::instance_data_</a></div><div class="ttdeci">const Tagged&lt; WasmTrustedInstanceData &gt; instance_data_</div><div class="ttdef"><b>Definition</b> <a href="#l01341">module-compiler.cc:1341</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a2eda69ab016a1f105368d8d2df5073f1"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a2eda69ab016a1f105368d8d2df5073f1">v8::internal::wasm::TransitiveTypeFeedbackProcessor::queue_</a></div><div class="ttdeci">std::set&lt; int &gt; queue_</div><div class="ttdef"><b>Definition</b> <a href="#l01347">module-compiler.cc:1347</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a35a64452e0fd990b109dab7ebae86f8b"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a35a64452e0fd990b109dab7ebae86f8b">v8::internal::wasm::TransitiveTypeFeedbackProcessor::feedback_for_function_</a></div><div class="ttdeci">std::unordered_map&lt; uint32_t, FunctionTypeFeedback &gt; &amp; feedback_for_function_</div><div class="ttdef"><b>Definition</b> <a href="#l01346">module-compiler.cc:1346</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a381518a62cb3d6130a6eb99d495c0bd5"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a381518a62cb3d6130a6eb99d495c0bd5">v8::internal::wasm::TransitiveTypeFeedbackProcessor::TransitiveTypeFeedbackProcessor</a></div><div class="ttdeci">TransitiveTypeFeedbackProcessor(Isolate *isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="#l01294">module-compiler.cc:1294</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a3f876a92081673138a39d2fcb31a8065"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a3f876a92081673138a39d2fcb31a8065">v8::internal::wasm::TransitiveTypeFeedbackProcessor::no_gc_scope_</a></div><div class="ttdeci">DisallowGarbageCollection no_gc_scope_</div><div class="ttdef"><b>Definition</b> <a href="#l01339">module-compiler.cc:1339</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a475d63f384ad03f4ce9c1b216f3cbb69"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a475d63f384ad03f4ce9c1b216f3cbb69">v8::internal::wasm::TransitiveTypeFeedbackProcessor::mutex_guard</a></div><div class="ttdeci">base::SharedMutexGuard&lt; base::kExclusive &gt; mutex_guard</div><div class="ttdef"><b>Definition</b> <a href="#l01345">module-compiler.cc:1345</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a4947e196aa46dccc9b331ec8c6eae7bd"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a4947e196aa46dccc9b331ec8c6eae7bd">v8::internal::wasm::TransitiveTypeFeedbackProcessor::Process</a></div><div class="ttdeci">static void Process(Isolate *isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="#l01286">module-compiler.cc:1286</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a53de8c5be24369460263267dc7785ac8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a53de8c5be24369460263267dc7785ac8">v8::internal::wasm::TransitiveTypeFeedbackProcessor::isolate_</a></div><div class="ttdeci">Isolate *const isolate_</div><div class="ttdef"><b>Definition</b> <a href="#l01340">module-compiler.cc:1340</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a719d9a5ae78f1fa03211a6a7e4e240db"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a719d9a5ae78f1fa03211a6a7e4e240db">v8::internal::wasm::TransitiveTypeFeedbackProcessor::ProcessQueue</a></div><div class="ttdeci">void ProcessQueue()</div><div class="ttdef"><b>Definition</b> <a href="#l01307">module-compiler.cc:1307</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_a9b2c124bd62fdb1a3bb32f7dfce3dd65"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#a9b2c124bd62fdb1a3bb32f7dfce3dd65">v8::internal::wasm::TransitiveTypeFeedbackProcessor::EnqueueCallees</a></div><div class="ttdeci">void EnqueueCallees(const std::vector&lt; CallSiteFeedback &gt; &amp;feedback)</div><div class="ttdef"><b>Definition</b> <a href="#l01317">module-compiler.cc:1317</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_ab274acbc08982b7464834a65ce4d898c"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#ab274acbc08982b7464834a65ce4d898c">v8::internal::wasm::TransitiveTypeFeedbackProcessor::module_</a></div><div class="ttdeci">const WasmModule *const module_</div><div class="ttdef"><b>Definition</b> <a href="#l01342">module-compiler.cc:1342</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor_html_ae8e82bee771b314c3d1a1c4034244776"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TransitiveTypeFeedbackProcessor.html#ae8e82bee771b314c3d1a1c4034244776">v8::internal::wasm::TransitiveTypeFeedbackProcessor::~TransitiveTypeFeedbackProcessor</a></div><div class="ttdeci">~TransitiveTypeFeedbackProcessor()</div><div class="ttdef"><b>Definition</b> <a href="#l01305">module-compiler.cc:1305</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1TruncatedUserString_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1TruncatedUserString.html">v8::internal::wasm::TruncatedUserString</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l01086">wasm-module.h:1086</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html">v8::internal::wasm::ValidateFunctionsStreamingJob</a></div><div class="ttdef"><b>Definition</b> <a href="#l02565">module-compiler.cc:2565</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html_a595f738885e4ddc54dfbee0facb094d6"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a595f738885e4ddc54dfbee0facb094d6">v8::internal::wasm::ValidateFunctionsStreamingJob::enabled_features_</a></div><div class="ttdeci">const WasmEnabledFeatures enabled_features_</div><div class="ttdef"><b>Definition</b> <a href="#l02600">module-compiler.cc:2600</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html_a5d40c7e666a805a418e6d6d3d7c8d8ee"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#a5d40c7e666a805a418e6d6d3d7c8d8ee">v8::internal::wasm::ValidateFunctionsStreamingJob::Run</a></div><div class="ttdeci">void Run(JobDelegate *delegate) override</div><div class="ttdef"><b>Definition</b> <a href="#l02572">module-compiler.cc:2572</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html_aaa06eba946895bf88516bb729e8c732f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aaa06eba946895bf88516bb729e8c732f">v8::internal::wasm::ValidateFunctionsStreamingJob::ValidateFunctionsStreamingJob</a></div><div class="ttdeci">ValidateFunctionsStreamingJob(const WasmModule *module, WasmEnabledFeatures enabled_features, ValidateFunctionsStreamingJobData *data)</div><div class="ttdef"><b>Definition</b> <a href="#l02567">module-compiler.cc:2567</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html_aac419dc4aa81f2d2594dd1976794f310"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#aac419dc4aa81f2d2594dd1976794f310">v8::internal::wasm::ValidateFunctionsStreamingJob::data_</a></div><div class="ttdeci">ValidateFunctionsStreamingJobData * data_</div><div class="ttdef"><b>Definition</b> <a href="#l02601">module-compiler.cc:2601</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html_ac6923ee5bb39b2a4b6475d72e8db7183"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac6923ee5bb39b2a4b6475d72e8db7183">v8::internal::wasm::ValidateFunctionsStreamingJob::module_</a></div><div class="ttdeci">const WasmModule *const module_</div><div class="ttdef"><b>Definition</b> <a href="#l02599">module-compiler.cc:2599</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob_html_ac9bebc6c772148aee5f452ca0aea569a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJob.html#ac9bebc6c772148aee5f452ca0aea569a">v8::internal::wasm::ValidateFunctionsStreamingJob::GetMaxConcurrency</a></div><div class="ttdeci">size_t GetMaxConcurrency(size_t worker_count) const override</div><div class="ttdef"><b>Definition</b> <a href="#l02594">module-compiler.cc:2594</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1ValueType_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1ValueType.html">v8::internal::wasm::ValueType</a></div><div class="ttdef"><b>Definition</b> <a href="value-type_8h_source.html#l00932">value-type.h:932</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmCodeManager_html_ab90b2371ac3c63fcc039e3189203dbb3"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmCodeManager.html#ab90b2371ac3c63fcc039e3189203dbb3">v8::internal::wasm::WasmCodeManager::EstimateNativeModuleCodeSize</a></div><div class="ttdeci">static size_t EstimateNativeModuleCodeSize(const WasmModule *module, bool include_liftoff, DynamicTiering dynamic_tiering)</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8cc_source.html#l02333">wasm-code-manager.cc:2333</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmCodePointerTable_html_a65882a1f49bd2c6a667cd3054f3dc2e2"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmCodePointerTable.html#a65882a1f49bd2c6a667cd3054f3dc2e2">v8::internal::wasm::WasmCodePointerTable::GetEntrypointWithoutSignatureCheck</a></div><div class="ttdeci">Address GetEntrypointWithoutSignatureCheck(WasmCodePointer index) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-code-pointer-table-inl_8h_source.html#l00062">wasm-code-pointer-table-inl.h:62</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmCodeRefScope_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmCodeRefScope.html">v8::internal::wasm::WasmCodeRefScope</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l01206">wasm-code-manager.h:1206</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmCode_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmCode.html">v8::internal::wasm::WasmCode</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-code-manager_8h_source.html#l00090">wasm-code-manager.h:90</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmCompilationUnit_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmCompilationUnit.html">v8::internal::wasm::WasmCompilationUnit</a></div><div class="ttdef"><b>Definition</b> <a href="function-compiler_8h_source.html#l00096">function-compiler.h:96</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmDetectedFeatures.html">v8::internal::wasm::WasmDetectedFeatures</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00087">wasm-features.h:87</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEnabledFeatures_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEnabledFeatures.html">v8::internal::wasm::WasmEnabledFeatures</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00054">wasm-features.h:54</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a26391b903e117ed93787d080f0bc2fe4"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a26391b903e117ed93787d080f0bc2fe4">v8::internal::wasm::WasmEngine::MaybeGetNativeModule</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; MaybeGetNativeModule(ModuleOrigin origin, base::Vector&lt; const uint8_t &gt; wire_bytes, const CompileTimeImports &amp;compile_imports, Isolate *isolate)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01599">wasm-engine.cc:1599</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a2b1c94eee0072e6f73f9262078571a4f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a2b1c94eee0072e6f73f9262078571a4f">v8::internal::wasm::WasmEngine::LogCode</a></div><div class="ttdeci">void LogCode(base::Vector&lt; WasmCode * &gt;)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01369">wasm-engine.cc:1369</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a33108f98a3342746166d6242b9c7b072"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a33108f98a3342746166d6242b9c7b072">v8::internal::wasm::WasmEngine::allocator</a></div><div class="ttdeci">AccountingAllocator * allocator()</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8h_source.html#l00244">wasm-engine.h:244</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a75db6b0cc6f0a8f29a208579c9cf145d"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a75db6b0cc6f0a8f29a208579c9cf145d">v8::internal::wasm::WasmEngine::GetOrCreateScript</a></div><div class="ttdeci">Handle&lt; Script &gt; GetOrCreateScript(Isolate *, const std::shared_ptr&lt; NativeModule &gt; &amp;, base::Vector&lt; const char &gt; source_url)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01892">wasm-engine.cc:1892</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a80a2af861380fd22a236025164b81737"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a80a2af861380fd22a236025164b81737">v8::internal::wasm::WasmEngine::LogOutstandingCodesForIsolate</a></div><div class="ttdeci">void LogOutstandingCodesForIsolate(Isolate *)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01511">wasm-engine.cc:1511</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a8378f5ecdd236147a0b3c590c12899b8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a8378f5ecdd236147a0b3c590c12899b8">v8::internal::wasm::WasmEngine::RemoveCompileJob</a></div><div class="ttdeci">std::unique_ptr&lt; AsyncCompileJob &gt; RemoveCompileJob(AsyncCompileJob *job)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01158">wasm-engine.cc:1158</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_a9df42171758a2a5af30388a2b7e97de8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#a9df42171758a2a5af30388a2b7e97de8">v8::internal::wasm::WasmEngine::StreamingCompilationFailed</a></div><div class="ttdeci">void StreamingCompilationFailed(size_t prefix_hash, const CompileTimeImports &amp;compile_imports)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01681">wasm-engine.cc:1681</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_ac7a8ec2f950e76dfa9e2ec483c15a372"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ac7a8ec2f950e76dfa9e2ec483c15a372">v8::internal::wasm::WasmEngine::NewNativeModule</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; NewNativeModule(Isolate *isolate, WasmEnabledFeatures enabled_features, WasmDetectedFeatures detected_features, CompileTimeImports compile_imports, std::shared_ptr&lt; const WasmModule &gt; module, size_t code_size_estimate)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01538">wasm-engine.cc:1538</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmEngine_html_ae049eb40219a3e542bf2811e42ac1bb8"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmEngine.html#ae049eb40219a3e542bf2811e42ac1bb8">v8::internal::wasm::WasmEngine::UpdateNativeModuleCache</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; UpdateNativeModuleCache(bool has_error, std::shared_ptr&lt; NativeModule &gt; native_module, Isolate *isolate)</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l01634">wasm-engine.cc:1634</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmError_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmError.html">v8::internal::wasm::WasmError</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00026">wasm-result.h:26</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmError_html_a814cbe82c25f67faffa1de4801d10574"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmError.html#a814cbe82c25f67faffa1de4801d10574">v8::internal::wasm::WasmError::has_error</a></div><div class="ttdeci">bool has_error() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-result_8h_source.html#l00046">wasm-result.h:46</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_1_1ModificationScope_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_1_1ModificationScope.html">v8::internal::wasm::WasmImportWrapperCache::ModificationScope</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-import-wrapper-cache_8h_source.html#l00054">wasm-import-wrapper-cache.h:54</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_html_a409ab39613cfb26dd995d842021bfc8f"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache.html#a409ab39613cfb26dd995d842021bfc8f">v8::internal::wasm::WasmImportWrapperCache::CompileWasmImportCallWrapper</a></div><div class="ttdeci">WasmCode * CompileWasmImportCallWrapper(Isolate *isolate, ImportCallKind kind, const CanonicalSig *sig, CanonicalTypeIndex sig_index, bool source_positions, int expected_arity, Suspend suspend)</div><div class="ttdef"><b>Definition</b> <a href="wasm-import-wrapper-cache_8cc_source.html#l00152">wasm-import-wrapper-cache.cc:152</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WireBytesRef_html"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WireBytesRef.html">v8::internal::wasm::WireBytesRef</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00057">wasm-module.h:57</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WireBytesRef_html_a1853a6fc4a88a37d2bb8a91b58781daf"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WireBytesRef.html#a1853a6fc4a88a37d2bb8a91b58781daf">v8::internal::wasm::WireBytesRef::end_offset</a></div><div class="ttdeci">uint32_t end_offset() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00068">wasm-module.h:68</a></div></div>
<div class="ttc" id="aclassv8_1_1internal_1_1wasm_1_1WireBytesRef_html_a4f2dffb7efc3721571b5f1604d5d448a"><div class="ttname"><a href="classv8_1_1internal_1_1wasm_1_1WireBytesRef.html#a4f2dffb7efc3721571b5f1604d5d448a">v8::internal::wasm::WireBytesRef::offset</a></div><div class="ttdeci">uint32_t offset() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00066">wasm-module.h:66</a></div></div>
<div class="ttc" id="aclassv8_1_1metrics_1_1Recorder_1_1ContextId_html"><div class="ttname"><a href="classv8_1_1metrics_1_1Recorder_1_1ContextId.html">v8::metrics::Recorder::ContextId</a></div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00190">v8-metrics.h:190</a></div></div>
<div class="ttc" id="acode-generator-arm_8cc_html_a4d8c0017809aaa1049579c91f87ea54e"><div class="ttname"><a href="code-generator-arm_8cc.html#a4d8c0017809aaa1049579c91f87ea54e">result_</a></div><div class="ttdeci">T const result_</div><div class="ttdef"><b>Definition</b> <a href="code-generator-arm_8cc_source.html#l00242">code-generator-arm.cc:242</a></div></div>
<div class="ttc" id="acode-memory-access_8cc_html_a4cce83e2a3313f207c5d77da0b1e0198"><div class="ttname"><a href="code-memory-access_8cc.html#a4cce83e2a3313f207c5d77da0b1e0198">mutex_</a></div><div class="ttdeci">base::SpinningMutex &amp; mutex_</div><div class="ttdef"><b>Definition</b> <a href="code-memory-access_8cc_source.html#l00623">code-memory-access.cc:623</a></div></div>
<div class="ttc" id="acode-space-access_8h_html"><div class="ttname"><a href="code-space-access_8h.html">code-space-access.h</a></div></div>
<div class="ttc" id="acompilation-environment-inl_8h_html"><div class="ttname"><a href="compilation-environment-inl_8h.html">compilation-environment-inl.h</a></div></div>
<div class="ttc" id="acompiler_8h_html"><div class="ttname"><a href="compiler_8h.html">compiler.h</a></div></div>
<div class="ttc" id="acounters-scopes_8h_html"><div class="ttname"><a href="counters-scopes_8h.html">counters-scopes.h</a></div></div>
<div class="ttc" id="adebug-coverage_8cc_html_a37722a150250e2a5a98e5e0d11e53449"><div class="ttname"><a href="debug-coverage_8cc.html#a37722a150250e2a5a98e5e0d11e53449">start</a></div><div class="ttdeci">int start</div><div class="ttdef"><b>Definition</b> <a href="debug-coverage_8cc_source.html#l00595">debug-coverage.cc:595</a></div></div>
<div class="ttc" id="adebug-coverage_8cc_html_a86988a65e0d3ece7990c032c159786d6"><div class="ttname"><a href="debug-coverage_8cc.html#a86988a65e0d3ece7990c032c159786d6">count</a></div><div class="ttdeci">uint32_t count</div><div class="ttdef"><b>Definition</b> <a href="debug-coverage_8cc_source.html#l00594">debug-coverage.cc:594</a></div></div>
<div class="ttc" id="adebug-coverage_8cc_html_abce9f5dc9c83f2639b72024fdee5d388"><div class="ttname"><a href="debug-coverage_8cc.html#abce9f5dc9c83f2639b72024fdee5d388">end</a></div><div class="ttdeci">int end</div><div class="ttdef"><b>Definition</b> <a href="debug-coverage_8cc_source.html#l00596">debug-coverage.cc:596</a></div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div></div>
<div class="ttc" id="aenum-set_8h_html"><div class="ttname"><a href="enum-set_8h.html">enum-set.h</a></div></div>
<div class="ttc" id="aexecution_8cc_html_a1d8217e3925e66477879e51a11ceb4b7"><div class="ttname"><a href="execution_8cc.html#a1d8217e3925e66477879e51a11ceb4b7">args</a></div><div class="ttdeci">base::Vector&lt; const DirectHandle&lt; Object &gt; &gt; args</div><div class="ttdef"><b>Definition</b> <a href="execution_8cc_source.html#l00074">execution.cc:74</a></div></div>
<div class="ttc" id="aflag-definitions_8h_html_ab593a76c45473b2e8389090878705e1f"><div class="ttname"><a href="flag-definitions_8h.html#ab593a76c45473b2e8389090878705e1f">tier</a></div><div class="ttdeci">force emit tier up logic from all non turbofan even if it is the top enabled tier make OptimizeFunctionOnNextCall optimize to maglev instead of turbofan enable loop peeling in the maglev optimizing compiler max loop size for loop peeling in the maglev optimizing compiler Generate deopt data on background thread maglev_deopt_data_on_background Inline CallApiCallback builtin into generated code use high priority compiler threads for concurrent Maglev max depth of functions that Maglev will incl small functions maximum cumulative size of bytecode considered for inlining excl small functions minimum frequency for inlining reuse stack slots in the maglev optimizing compiler enable phi untagging to hoist untagging of osr values filter for maglev s tracing printing options print feedback vector for maglev compiled code trace maglev print verbose deopt info trace maglev phi untagging print Maglev statistics in machine readable format skip generating a migration check when some maps of polymorpic property access are migration targets Use const tracking on dictionary properties Use heap numbers in script contexts Use compilation dependency to avoid dynamic checks for non empty context extensions Set the maximal optimisation tier</div><div class="ttdef"><b>Definition</b> <a href="flag-definitions_8h_source.html#l00715">flag-definitions.h:714</a></div></div>
<div class="ttc" id="agc-extension_8cc_html_a00fa11a25071aa074f09fb8376ba359f"><div class="ttname"><a href="gc-extension_8cc.html#a00fa11a25071aa074f09fb8376ba359f">resolver_</a></div><div class="ttdeci">v8::Global&lt; v8::Promise::Resolver &gt; resolver_</div><div class="ttdef"><b>Definition</b> <a href="gc-extension_8cc_source.html#l00260">gc-extension.cc:260</a></div></div>
<div class="ttc" id="aglobal-handles-inl_8h_html"><div class="ttname"><a href="global-handles-inl_8h.html">global-handles-inl.h</a></div></div>
<div class="ttc" id="agraph-builder_8cc_html_a9990dda08de44f6aee0aaf44c50da7d9"><div class="ttname"><a href="graph-builder_8cc.html#a9990dda08de44f6aee0aaf44c50da7d9">isolate</a></div><div class="ttdeci">Isolate * isolate</div><div class="ttdef"><b>Definition</b> <a href="graph-builder_8cc_source.html#l00058">graph-builder.cc:58</a></div></div>
<div class="ttc" id="agraph-builder_8cc_html_acc2fa1f7c7062f53a2840f0064a43ef1"><div class="ttname"><a href="graph-builder_8cc.html#acc2fa1f7c7062f53a2840f0064a43ef1">source_positions</a></div><div class="ttdeci">SourcePositionTable * source_positions</div><div class="ttdef"><b>Definition</b> <a href="graph-builder_8cc_source.html#l00063">graph-builder.cc:63</a></div></div>
<div class="ttc" id="ainstruction-selector-ia32_8cc_html_a115c48491bb37004f5ac67eb46ac2c23"><div class="ttname"><a href="instruction-selector-ia32_8cc.html#a115c48491bb37004f5ac67eb46ac2c23">base</a></div><div class="ttdeci">turboshaft::OpIndex base</div><div class="ttdef"><b>Definition</b> <a href="instruction-selector-ia32_8cc_source.html#l00070">instruction-selector-ia32.cc:70</a></div></div>
<div class="ttc" id="ainstruction-selector-ia32_8cc_html_a97bd6c077f3c7769f575b82988b9b668"><div class="ttname"><a href="instruction-selector-ia32_8cc.html#a97bd6c077f3c7769f575b82988b9b668">offset</a></div><div class="ttdeci">int32_t offset</div><div class="ttdef"><b>Definition</b> <a href="instruction-selector-ia32_8cc_source.html#l00072">instruction-selector-ia32.cc:72</a></div></div>
<div class="ttc" id="ainstruction-selector-ia32_8cc_html_ae55190dbead0a94298bdfa37911694e3"><div class="ttname"><a href="instruction-selector-ia32_8cc.html#ae55190dbead0a94298bdfa37911694e3">index</a></div><div class="ttdeci">turboshaft::OptionalOpIndex index</div><div class="ttdef"><b>Definition</b> <a href="instruction-selector-ia32_8cc_source.html#l00071">instruction-selector-ia32.cc:71</a></div></div>
<div class="ttc" id="ajs-call-reducer_8cc_html_a0835767fe473cead88c1afdf3175bce8"><div class="ttname"><a href="js-call-reducer_8cc.html#a0835767fe473cead88c1afdf3175bce8">context</a></div><div class="ttdeci">TNode&lt; Context &gt; context</div><div class="ttdef"><b>Definition</b> <a href="js-call-reducer_8cc_source.html#l01496">js-call-reducer.cc:1496</a></div></div>
<div class="ttc" id="ajs-call-reducer_8cc_html_a160b46cc89e1d0807731be8c2d2257c0"><div class="ttname"><a href="js-call-reducer_8cc.html#a160b46cc89e1d0807731be8c2d2257c0">target</a></div><div class="ttdeci">TNode&lt; Object &gt; target</div><div class="ttdef"><b>Definition</b> <a href="js-call-reducer_8cc_source.html#l01497">js-call-reducer.cc:1497</a></div></div>
<div class="ttc" id="ajs-call-reducer_8cc_html_ad83e8682ed733ee0cf359fa4f48441b0"><div class="ttname"><a href="js-call-reducer_8cc.html#ad83e8682ed733ee0cf359fa4f48441b0">callback</a></div><div class="ttdeci">TNode&lt; Object &gt; callback</div><div class="ttdef"><b>Definition</b> <a href="js-call-reducer_8cc_source.html#l01500">js-call-reducer.cc:1500</a></div></div>
<div class="ttc" id="ajs-temporal-objects_8cc_html_aaa0d61fcdf7a0b9f0f2b48c9946cbd10"><div class="ttname"><a href="js-temporal-objects_8cc.html#aaa0d61fcdf7a0b9f0f2b48c9946cbd10">unit</a></div><div class="ttdeci">Unit unit</div><div class="ttdef"><b>Definition</b> <a href="js-temporal-objects_8cc_source.html#l09443">js-temporal-objects.cc:9443</a></div></div>
<div class="ttc" id="ajump-table-assembler_8h_html"><div class="ttname"><a href="jump-table-assembler_8h.html">jump-table-assembler.h</a></div></div>
<div class="ttc" id="ajump-threading_8cc_html_a41f8c58d2c01bf65b8ee199c3f87fc80"><div class="ttname"><a href="jump-threading_8cc.html#a41f8c58d2c01bf65b8ee199c3f87fc80">result</a></div><div class="ttdeci">ZoneVector&lt; RpoNumber &gt; &amp; result</div><div class="ttdef"><b>Definition</b> <a href="jump-threading_8cc_source.html#l00021">jump-threading.cc:21</a></div></div>
<div class="ttc" id="aliftoff-compiler_8cc_html_ac4910f82010f186c641d38b0d1616003"><div class="ttname"><a href="liftoff-compiler_8cc.html#ac4910f82010f186c641d38b0d1616003">func_index_</a></div><div class="ttdeci">const int func_index_</div><div class="ttdef"><b>Definition</b> <a href="liftoff-compiler_8cc_source.html#l09321">liftoff-compiler.cc:9321</a></div></div>
<div class="ttc" id="ametrics_8h_html"><div class="ttname"><a href="metrics_8h.html">metrics.h</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a0b4818bf02f4086ff5cda6099b6d8359"><div class="ttname"><a href="module-compiler_8cc.html#a0b4818bf02f4086ff5cda6099b6d8359">bytes_since_last_chunk_</a></div><div class="ttdeci">size_t bytes_since_last_chunk_</div><div class="ttdef"><b>Definition</b> <a href="#l00798">module-compiler.cc:798</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a0b64f93045c33bf33392097c6a3aef2e"><div class="ttname"><a href="module-compiler_8cc.html#a0b64f93045c33bf33392097c6a3aef2e">native_module_</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; native_module_</div><div class="ttdef"><b>Definition</b> <a href="#l00099">module-compiler.cc:99</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a1117b728b07a51697a39f72749a6d74b"><div class="ttname"><a href="module-compiler_8cc.html#a1117b728b07a51697a39f72749a6d74b">timer_</a></div><div class="ttdeci">base::ElapsedTimer timer_</div><div class="ttdef"><b>Definition</b> <a href="#l01176">module-compiler.cc:1176</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a12a507bc765598b5db4100af52f045e3"><div class="ttname"><a href="module-compiler_8cc.html#a12a507bc765598b5db4100af52f045e3">priority</a></div><div class="ttdeci">size_t priority</div><div class="ttdef"><b>Definition</b> <a href="#l00294">module-compiler.cc:294</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a18329324175d88d28dc9e56d8ebbc5eb"><div class="ttname"><a href="module-compiler_8cc.html#a18329324175d88d28dc9e56d8ebbc5eb">CHECK_SIG</a></div><div class="ttdeci">#define CHECK_SIG(import_name, kSigName, kEnumName)</div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a1866e6e2be9e7969dc78e90ce17587af"><div class="ttname"><a href="module-compiler_8cc.html#a1866e6e2be9e7969dc78e90ce17587af">dynamic_tiering_</a></div><div class="ttdeci">const DynamicTiering dynamic_tiering_</div><div class="ttdef"><b>Definition</b> <a href="#l00751">module-compiler.cc:751</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a1a491440e4d708a4d8720688abdfd7c7"><div class="ttname"><a href="module-compiler_8cc.html#a1a491440e4d708a4d8720688abdfd7c7">num_units_</a></div><div class="ttdeci">std::atomic&lt; size_t &gt; num_units_[CompilationTier::kNumTiers]</div><div class="ttdef"><b>Definition</b> <a href="#l00513">module-compiler.cc:513</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a22b87d0db8ca143a8a7af20e15065940"><div class="ttname"><a href="module-compiler_8cc.html#a22b87d0db8ca143a8a7af20e15065940">context_id_</a></div><div class="ttdeci">v8::metrics::Recorder::ContextId context_id_</div><div class="ttdef"><b>Definition</b> <a href="#l02228">module-compiler.cc:2228</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a39362646122bdc4765ab29ccfe930bcf"><div class="ttname"><a href="module-compiler_8cc.html#a39362646122bdc4765ab29ccfe930bcf">top_tier_priority_units</a></div><div class="ttdeci">std::priority_queue&lt; TopTierPriorityUnit &gt; top_tier_priority_units</div><div class="ttdef"><b>Definition</b> <a href="#l00333">module-compiler.cc:333</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a3d1f803aa879d16ef4ed9a5df51ca676"><div class="ttname"><a href="module-compiler_8cc.html#a3d1f803aa879d16ef4ed9a5df51ca676">last_top_tier_compilation_timestamp_</a></div><div class="ttdeci">base::TimeTicks last_top_tier_compilation_timestamp_</div><div class="ttdef"><b>Definition</b> <a href="#l00805">module-compiler.cc:805</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a41fb1d2eb2e61c5b16160348b3d536a1"><div class="ttname"><a href="module-compiler_8cc.html#a41fb1d2eb2e61c5b16160348b3d536a1">top_tier_compiled_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; bool &gt;[]&gt; top_tier_compiled_</div><div class="ttdef"><b>Definition</b> <a href="#l00515">module-compiler.cc:515</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a476aa4c8510e0cbb39a63ccd26795727"><div class="ttname"><a href="module-compiler_8cc.html#a476aa4c8510e0cbb39a63ccd26795727">compile_failed_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; compile_failed_</div><div class="ttdef"><b>Definition</b> <a href="#l00741">module-compiler.cc:741</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a49d5b294402367d1e82540d38ed1229d"><div class="ttname"><a href="module-compiler_8cc.html#a49d5b294402367d1e82540d38ed1229d">publish_state_</a></div><div class="ttdeci">PublishState publish_state_[CompilationTier::kNumTiers]</div><div class="ttdef"><b>Definition</b> <a href="#l00816">module-compiler.cc:816</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a4fc5a2545cef793618498b58d311c739"><div class="ttname"><a href="module-compiler_8cc.html#a4fc5a2545cef793618498b58d311c739">engine_barrier_</a></div><div class="ttdeci">std::shared_ptr&lt; OperationsBarrier &gt; engine_barrier_</div><div class="ttdef"><b>Definition</b> <a href="#l02354">module-compiler.cc:2354</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a5507dd369623c9c2ef776c4f0dc0758c"><div class="ttname"><a href="module-compiler_8cc.html#a5507dd369623c9c2ef776c4f0dc0758c">num_priority_units_</a></div><div class="ttdeci">std::atomic&lt; size_t &gt; num_priority_units_</div><div class="ttdef"><b>Definition</b> <a href="#l00514">module-compiler.cc:514</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a575a329615456430d15706bb97d5365f"><div class="ttname"><a href="module-compiler_8cc.html#a575a329615456430d15706bb97d5365f">compile_mode_</a></div><div class="ttdeci">const CompileMode compile_mode_</div><div class="ttdef"><b>Definition</b> <a href="#l02230">module-compiler.cc:2230</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a593b02d411833c56828ed981177b30c7"><div class="ttname"><a href="module-compiler_8cc.html#a593b02d411833c56828ed981177b30c7">kBigUnitsLimit</a></div><div class="ttdeci">static constexpr size_t kBigUnitsLimit</div><div class="ttdef"><b>Definition</b> <a href="#l00276">module-compiler.cc:276</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a59dbfc4b198447bb18669932e0122db0"><div class="ttname"><a href="module-compiler_8cc.html#a59dbfc4b198447bb18669932e0122db0">metrics_recorder_</a></div><div class="ttdeci">std::shared_ptr&lt; metrics::Recorder &gt; metrics_recorder_</div><div class="ttdef"><b>Definition</b> <a href="#l02227">module-compiler.cc:2227</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a5a08d5ef6e517cf7c12d925c1bd208b4"><div class="ttname"><a href="module-compiler_8cc.html#a5a08d5ef6e517cf7c12d925c1bd208b4">outstanding_baseline_units_</a></div><div class="ttdeci">int outstanding_baseline_units_</div><div class="ttdef"><b>Definition</b> <a href="#l00795">module-compiler.cc:795</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a626bc8c9b53986d5f0754393bac40759"><div class="ttname"><a href="module-compiler_8cc.html#a626bc8c9b53986d5f0754393bac40759">compilation_progress_</a></div><div class="ttdeci">std::vector&lt; uint8_t &gt; compilation_progress_</div><div class="ttdef"><b>Definition</b> <a href="#l00799">module-compiler.cc:799</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a65a251dd194c9051f59997205d6d02b1"><div class="ttname"><a href="module-compiler_8cc.html#a65a251dd194c9051f59997205d6d02b1">queues_mutex_</a></div><div class="ttdeci">base::SharedMutex queues_mutex_</div><div class="ttdef"><b>Definition</b> <a href="#l00506">module-compiler.cc:506</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a67f54021709e2e21e2d5a7173fd1bdd6"><div class="ttname"><a href="module-compiler_8cc.html#a67f54021709e2e21e2d5a7173fd1bdd6">tier_</a></div><div class="ttdeci">const CompilationTier tier_</div><div class="ttdef"><b>Definition</b> <a href="#l02356">module-compiler.cc:2356</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a69caaaf26a7b909470fc6e389add669d"><div class="ttname"><a href="module-compiler_8cc.html#a69caaaf26a7b909470fc6e389add669d">func_size</a></div><div class="ttdeci">size_t func_size</div><div class="ttdef"><b>Definition</b> <a href="#l00282">module-compiler.cc:282</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a6bd7a9a17353a5f805e54f7044e44ebf"><div class="ttname"><a href="module-compiler_8cc.html#a6bd7a9a17353a5f805e54f7044e44ebf">top_tier_compile_job_</a></div><div class="ttdeci">std::unique_ptr&lt; JobHandle &gt; top_tier_compile_job_</div><div class="ttdef"><b>Definition</b> <a href="#l00760">module-compiler.cc:760</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a6e978c63340c33bc1dfa95a9fdbad525"><div class="ttname"><a href="module-compiler_8cc.html#a6e978c63340c33bc1dfa95a9fdbad525">TRACE_COMPILE</a></div><div class="ttdeci">#define TRACE_COMPILE(...)</div><div class="ttdef"><b>Definition</b> <a href="#l00042">module-compiler.cc:42</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a6fcf7dd1613d67775b21911e2df9c991"><div class="ttname"><a href="module-compiler_8cc.html#a6fcf7dd1613d67775b21911e2df9c991">wire_bytes_storage_</a></div><div class="ttdeci">std::shared_ptr&lt; WireBytesStorage &gt; wire_bytes_storage_</div><div class="ttdef"><b>Definition</b> <a href="#l00776">module-compiler.cc:776</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a73e8444199dcb8227139e8dbaae11b8a"><div class="ttname"><a href="module-compiler_8cc.html#a73e8444199dcb8227139e8dbaae11b8a">start_time_</a></div><div class="ttdeci">base::TimeTicks start_time_</div><div class="ttdef"><b>Definition</b> <a href="#l02225">module-compiler.cc:2225</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a8431676c8b868e1127589ec7fb9977c8"><div class="ttname"><a href="module-compiler_8cc.html#a8431676c8b868e1127589ec7fb9977c8">baseline_compile_job_</a></div><div class="ttdeci">std::unique_ptr&lt; JobHandle &gt; baseline_compile_job_</div><div class="ttdef"><b>Definition</b> <a href="#l00759">module-compiler.cc:759</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a8470212b7e5563736a09b9077b2760da"><div class="ttname"><a href="module-compiler_8cc.html#a8470212b7e5563736a09b9077b2760da">detected_features_</a></div><div class="ttdeci">std::atomic&lt; WasmDetectedFeatures &gt; detected_features_</div><div class="ttdef"><b>Definition</b> <a href="#l00768">module-compiler.cc:768</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a8b223a7d05c0f7e91aaf1ab0e567defb"><div class="ttname"><a href="module-compiler_8cc.html#a8b223a7d05c0f7e91aaf1ab0e567defb">compilation_unit_queues_</a></div><div class="ttdeci">CompilationUnitQueues compilation_unit_queues_</div><div class="ttdef"><b>Definition</b> <a href="#l00747">module-compiler.cc:747</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a8be0288f8228634650c4bea900954c65"><div class="ttname"><a href="module-compiler_8cc.html#a8be0288f8228634650c4bea900954c65">compile_cancelled_</a></div><div class="ttdeci">std::atomic&lt; bool &gt; compile_cancelled_</div><div class="ttdef"><b>Definition</b> <a href="#l00745">module-compiler.cc:745</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a8dbe388e49c902e861aaef4740aeacbf"><div class="ttname"><a href="module-compiler_8cc.html#a8dbe388e49c902e861aaef4740aeacbf">big_units_queue_</a></div><div class="ttdeci">BigUnitsQueue big_units_queue_</div><div class="ttdef"><b>Definition</b> <a href="#l00511">module-compiler.cc:511</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a8f5d461597871da3917aa66d1aff3723"><div class="ttname"><a href="module-compiler_8cc.html#a8f5d461597871da3917aa66d1aff3723">native_module_weak_</a></div><div class="ttdeci">std::weak_ptr&lt; NativeModule &gt; const native_module_weak_</div><div class="ttdef"><b>Definition</b> <a href="#l00736">module-compiler.cc:736</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a93240d2dd5bf16a5319e1f5fb025717f"><div class="ttname"><a href="module-compiler_8cc.html#a93240d2dd5bf16a5319e1f5fb025717f">async_counters_</a></div><div class="ttdeci">const std::shared_ptr&lt; Counters &gt; async_counters_</div><div class="ttdef"><b>Definition</b> <a href="#l00737">module-compiler.cc:737</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a9360e0ed93b0246f46a712a3c72faa88"><div class="ttname"><a href="module-compiler_8cc.html#a9360e0ed93b0246f46a712a3c72faa88">queues_</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; QueueImpl &gt; &gt; queues_</div><div class="ttdef"><b>Definition</b> <a href="#l00507">module-compiler.cc:507</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a998df6898feb1fed3f3ad8e45b4c366a"><div class="ttname"><a href="module-compiler_8cc.html#a998df6898feb1fed3f3ad8e45b4c366a">callbacks_mutex_</a></div><div class="ttdeci">base::SpinningMutex callbacks_mutex_</div><div class="ttdef"><b>Definition</b> <a href="#l00784">module-compiler.cc:784</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a9be7c0e07f9f182d632a3efe8586aa85"><div class="ttname"><a href="module-compiler_8cc.html#a9be7c0e07f9f182d632a3efe8586aa85">baseline_tier</a></div><div class="ttdeci">ExecutionTier baseline_tier</div><div class="ttdef"><b>Definition</b> <a href="#l01023">module-compiler.cc:1023</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_a9e94c333d2361d2355d9d3511b313379"><div class="ttname"><a href="module-compiler_8cc.html#a9e94c333d2361d2355d9d3511b313379">baseline_units_</a></div><div class="ttdeci">std::vector&lt; WasmCompilationUnit &gt; baseline_units_</div><div class="ttdef"><b>Definition</b> <a href="#l01127">module-compiler.cc:1127</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_aa60eff3769722cba29beed1ffacef4f8"><div class="ttname"><a href="module-compiler_8cc.html#aa60eff3769722cba29beed1ffacef4f8">has_units</a></div><div class="ttdeci">std::atomic&lt; bool &gt; has_units[CompilationTier::kNumTiers]</div><div class="ttdef"><b>Definition</b> <a href="#l00313">module-compiler.cc:313</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_aaf621869b776bf1875191fe8fbe39c07"><div class="ttname"><a href="module-compiler_8cc.html#aaf621869b776bf1875191fe8fbe39c07">RETURN_ERROR</a></div><div class="ttdeci">#define RETURN_ERROR(module_name_string, import_name)</div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ab7047c1a4737b951ed82b3ac41f9bd15"><div class="ttname"><a href="module-compiler_8cc.html#ab7047c1a4737b951ed82b3ac41f9bd15">publisher_running_</a></div><div class="ttdeci">bool publisher_running_</div><div class="ttdef"><b>Definition</b> <a href="#l00814">module-compiler.cc:814</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_aba33ee421effa5ecbb3fadcbf73dc7e1"><div class="ttname"><a href="module-compiler_8cc.html#aba33ee421effa5ecbb3fadcbf73dc7e1">counters_</a></div><div class="ttdeci">Counters * counters_</div><div class="ttdef"><b>Definition</b> <a href="#l01174">module-compiler.cc:1174</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_abd7f88aeabcd878dedeb96d85dc7c4cc"><div class="ttname"><a href="module-compiler_8cc.html#abd7f88aeabcd878dedeb96d85dc7c4cc">num_declared_functions_</a></div><div class="ttdeci">const int num_declared_functions_</div><div class="ttdef"><b>Definition</b> <a href="#l00509">module-compiler.cc:509</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_abfd1a7e26d1c1f362b3ad859adc4da64"><div class="ttname"><a href="module-compiler_8cc.html#abfd1a7e26d1c1f362b3ad859adc4da64">compilation_id_</a></div><div class="ttdeci">int compilation_id_</div><div class="ttdef"><b>Definition</b> <a href="#l00764">module-compiler.cc:764</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ac4872e36e3e8f96addfd5055ed3c4e2d"><div class="ttname"><a href="module-compiler_8cc.html#ac4872e36e3e8f96addfd5055ed3c4e2d">next_steal_task_id</a></div><div class="ttdeci">int next_steal_task_id</div><div class="ttdef"><b>Definition</b> <a href="#l00334">module-compiler.cc:334</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ad0e56b939512b07a9f4022e490043302"><div class="ttname"><a href="module-compiler_8cc.html#ad0e56b939512b07a9f4022e490043302">TRACE_STREAMING</a></div><div class="ttdeci">#define TRACE_STREAMING(...)</div><div class="ttdef"><b>Definition</b> <a href="#l00047">module-compiler.cc:47</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ad2bae691c0e698bc9c20b394f89ffb3c"><div class="ttname"><a href="module-compiler_8cc.html#ad2bae691c0e698bc9c20b394f89ffb3c">TRACE_LAZY</a></div><div class="ttdeci">#define TRACE_LAZY(...)</div><div class="ttdef"><b>Definition</b> <a href="#l00052">module-compiler.cc:52</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ad5bf842f9f3c87546d300dcc801980d3"><div class="ttname"><a href="module-compiler_8cc.html#ad5bf842f9f3c87546d300dcc801980d3">callbacks_</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; CompilationEventCallback &gt; &gt; callbacks_</div><div class="ttdef"><b>Definition</b> <a href="#l00790">module-compiler.cc:790</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ad6ea6260c0d7d730cf765a9801aef142"><div class="ttname"><a href="module-compiler_8cc.html#ad6ea6260c0d7d730cf765a9801aef142">tiering_units_</a></div><div class="ttdeci">std::vector&lt; WasmCompilationUnit &gt; tiering_units_</div><div class="ttdef"><b>Definition</b> <a href="#l01128">module-compiler.cc:1128</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ad70c69cb084f8c59623a841f63444b2a"><div class="ttname"><a href="module-compiler_8cc.html#ad70c69cb084f8c59623a841f63444b2a">units</a></div><div class="ttdeci">std::priority_queue&lt; BigUnit &gt; units[CompilationTier::kNumTiers]</div><div class="ttdef"><b>Definition</b> <a href="#l00316">module-compiler.cc:316</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_ae042bdad58afd5e550614c9d31238ed3"><div class="ttname"><a href="module-compiler_8cc.html#ae042bdad58afd5e550614c9d31238ed3">kInvalidCompilationID</a></div><div class="ttdeci">static constexpr int kInvalidCompilationID</div><div class="ttdef"><b>Definition</b> <a href="#l00763">module-compiler.cc:763</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_aec3689174da91b668a97dc27f690530a"><div class="ttname"><a href="module-compiler_8cc.html#aec3689174da91b668a97dc27f690530a">next_queue_to_add</a></div><div class="ttdeci">std::atomic&lt; int &gt; next_queue_to_add</div><div class="ttdef"><b>Definition</b> <a href="#l00516">module-compiler.cc:516</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_aedff3ff1cb0c614ca85fec25ca73bd48"><div class="ttname"><a href="module-compiler_8cc.html#aedff3ff1cb0c614ca85fec25ca73bd48">top_tier</a></div><div class="ttdeci">ExecutionTier top_tier</div><div class="ttdef"><b>Definition</b> <a href="#l01024">module-compiler.cc:1024</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_af1984de7c4fac1acc9f8ac66d4bac7fc"><div class="ttname"><a href="module-compiler_8cc.html#af1984de7c4fac1acc9f8ac66d4bac7fc">finished_events_</a></div><div class="ttdeci">base::EnumSet&lt; CompilationEvent &gt; finished_events_</div><div class="ttdef"><b>Definition</b> <a href="#l00793">module-compiler.cc:793</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_af2d8a33fed48845da59999a542b2b9f3"><div class="ttname"><a href="module-compiler_8cc.html#af2d8a33fed48845da59999a542b2b9f3">publish_queue_</a></div><div class="ttdeci">std::vector&lt; UnpublishedWasmCode &gt; publish_queue_</div><div class="ttdef"><b>Definition</b> <a href="#l00813">module-compiler.cc:813</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_af6befd6f98ada7aaa0bb9f802cf519a9"><div class="ttname"><a href="module-compiler_8cc.html#af6befd6f98ada7aaa0bb9f802cf519a9">mutex</a></div><div class="ttdeci">base::SpinningMutex mutex</div><div class="ttdef"><b>Definition</b> <a href="#l00310">module-compiler.cc:310</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_afcf5c4fbc12b5850864b5c388f4c98cc"><div class="ttname"><a href="module-compiler_8cc.html#afcf5c4fbc12b5850864b5c388f4c98cc">publish_limit</a></div><div class="ttdeci">std::atomic&lt; int &gt; publish_limit</div><div class="ttdef"><b>Definition</b> <a href="#l00327">module-compiler.cc:327</a></div></div>
<div class="ttc" id="amodule-compiler_8cc_html_aff4abc3a4fa9f8a9d5100a8532691198"><div class="ttname"><a href="module-compiler_8cc.html#aff4abc3a4fa9f8a9d5100a8532691198">CHECK_USE_COUNTER</a></div><div class="ttdeci">#define CHECK_USE_COUNTER(feat,...)</div></div>
<div class="ttc" id="amodule-compiler_8h_html"><div class="ttname"><a href="module-compiler_8h.html">module-compiler.h</a></div></div>
<div class="ttc" id="amodule-decoder_8cc_html_a26f77f4247dd0ac0b1f91ae3212af4cc"><div class="ttname"><a href="module-decoder_8cc.html#a26f77f4247dd0ac0b1f91ae3212af4cc">wire_bytes_</a></div><div class="ttdeci">const base::Vector&lt; const uint8_t &gt; wire_bytes_</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00511">module-decoder.cc:511</a></div></div>
<div class="ttc" id="amodule-decoder_8cc_html_a288adc12dc38d2126f4ebbb0b1595788"><div class="ttname"><a href="module-decoder_8cc.html#a288adc12dc38d2126f4ebbb0b1595788">enabled_features_</a></div><div class="ttdeci">const WasmEnabledFeatures enabled_features_</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00513">module-decoder.cc:513</a></div></div>
<div class="ttc" id="amodule-decoder_8h_html"><div class="ttname"><a href="module-decoder_8h.html">module-decoder.h</a></div></div>
<div class="ttc" id="amutex_8h_html"><div class="ttname"><a href="mutex_8h.html">mutex.h</a></div></div>
<div class="ttc" id="anamespacecppgc_html_a06ee5a4d448425d5856ef0ba02629834"><div class="ttname"><a href="namespacecppgc.html#a06ee5a4d448425d5856ef0ba02629834">cppgc::JobTask</a></div><div class="ttdeci">v8::JobTask JobTask</div><div class="ttdef"><b>Definition</b> <a href="include_2cppgc_2platform_8h_source.html#l00021">platform.h:21</a></div></div>
<div class="ttc" id="anamespacecppgc_html_a7f42cfb1ddad320141f6c9eadaff84c7"><div class="ttname"><a href="namespacecppgc.html#a7f42cfb1ddad320141f6c9eadaff84c7">cppgc::JobDelegate</a></div><div class="ttdeci">v8::JobDelegate JobDelegate</div><div class="ttdef"><b>Definition</b> <a href="include_2cppgc_2platform_8h_source.html#l00020">platform.h:20</a></div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition</b> <a href="hashing_8h_source.html#l00364">hashing.h:364</a></div></div>
<div class="ttc" id="anamespacev8_1_1base_1_1bits_html_a4d06086712ebcd60838caae1a21fcfa3"><div class="ttname"><a href="namespacev8_1_1base_1_1bits.html#a4d06086712ebcd60838caae1a21fcfa3">v8::base::bits::IsPowerOfTwo</a></div><div class="ttdeci">constexpr bool IsPowerOfTwo(T value)</div><div class="ttdef"><b>Definition</b> <a href="bits_8h_source.html#l00187">bits.h:187</a></div></div>
<div class="ttc" id="anamespacev8_1_1base_html_a3279492e34e391eefba807ff6a59576e"><div class="ttname"><a href="namespacev8_1_1base.html#a3279492e34e391eefba807ff6a59576e">v8::base::SpinningMutexGuard</a></div><div class="ttdeci">LockGuard&lt; SpinningMutex &gt; SpinningMutexGuard</div><div class="ttdef"><b>Definition</b> <a href="mutex_8h_source.html#l00562">mutex.h:562</a></div></div>
<div class="ttc" id="anamespacev8_1_1base_html_ab277246c6caecad159bbc8755cf6bb54"><div class="ttname"><a href="namespacev8_1_1base.html#ab277246c6caecad159bbc8755cf6bb54">v8::base::VectorOf</a></div><div class="ttdeci">constexpr Vector&lt; T &gt; VectorOf(T *start, size_t size)</div><div class="ttdef"><b>Definition</b> <a href="vector_8h_source.html#l00360">vector.h:360</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1compiler_html_a28d08f40d5dc488600051ba2ef537284"><div class="ttname"><a href="namespacev8_1_1internal_1_1compiler.html#a28d08f40d5dc488600051ba2ef537284">v8::internal::compiler::bool</a></div><div class="ttdeci">template const Signature&lt; wasm::ValueType &gt; bool</div><div class="ttdef"><b>Definition</b> <a href="wasm-compiler-definitions_8cc_source.html#l00116">wasm-compiler-definitions.cc:116</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html">v8::internal::wasm</a></div><div class="ttdef"><b>Definition</b> <a href="asm-parser_8cc_source.html#l00024">asm-parser.cc:24</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a014ea81f0b1504833e290d4a98601282"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a014ea81f0b1504833e290d4a98601282">v8::internal::wasm::WasmCompilationHintTier</a></div><div class="ttdeci">WasmCompilationHintTier</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00304">wasm-module.h:304</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a014ea81f0b1504833e290d4a98601282a65ffc7d8b4dceb3661bbcf4c6c12118d"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a014ea81f0b1504833e290d4a98601282a65ffc7d8b4dceb3661bbcf4c6c12118d">v8::internal::wasm::WasmCompilationHintTier::kBaseline</a></div><div class="ttdeci">@ kBaseline</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a020d8fcab0133f11030d7b8ef6259e29"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29">v8::internal::wasm::CompilationEvent</a></div><div class="ttdeci">CompilationEvent</div><div class="ttdef"><b>Definition</b> <a href="compilation-environment_8h_source.html#l00101">compilation-environment.h:101</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a020d8fcab0133f11030d7b8ef6259e29a41b18f40e8022b599bc6360f216daba4"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a41b18f40e8022b599bc6360f216daba4">v8::internal::wasm::CompilationEvent::kFinishedBaselineCompilation</a></div><div class="ttdeci">@ kFinishedBaselineCompilation</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a020d8fcab0133f11030d7b8ef6259e29a9ac6b83a7cebbcdae83cb92173c10599"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29a9ac6b83a7cebbcdae83cb92173c10599">v8::internal::wasm::CompilationEvent::kFinishedCompilationChunk</a></div><div class="ttdeci">@ kFinishedCompilationChunk</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a020d8fcab0133f11030d7b8ef6259e29af90d51f0b738cedabb652e72ffd7b8ed"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a020d8fcab0133f11030d7b8ef6259e29af90d51f0b738cedabb652e72ffd7b8ed">v8::internal::wasm::CompilationEvent::kFailedCompilation</a></div><div class="ttdeci">@ kFailedCompilation</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a0a36931b3d2bbcdfcbb253b229838952"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a0a36931b3d2bbcdfcbb253b229838952">v8::internal::wasm::GetProcessWideWasmCodePointerTable</a></div><div class="ttdeci">V8_EXPORT_PRIVATE WasmCodePointerTable * GetProcessWideWasmCodePointerTable()</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a11df36d2f23b22c6772f3a5f08731b5ba1874820c42ab45140e0e50e44f8e96d5"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a11df36d2f23b22c6772f3a5f08731b5ba1874820c42ab45140e0e50e44f8e96d5">v8::internal::wasm::kNotForDebugging</a></div><div class="ttdeci">@ kNotForDebugging</div><div class="ttdef"><b>Definition</b> <a href="wasm-tier_8h_source.html#l00047">wasm-tier.h:47</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a11df36d2f23b22c6772f3a5f08731b5ba43d94925083957d680eef3a3987e0de0"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a11df36d2f23b22c6772f3a5f08731b5ba43d94925083957d680eef3a3987e0de0">v8::internal::wasm::kForDebugging</a></div><div class="ttdeci">@ kForDebugging</div><div class="ttdef"><b>Definition</b> <a href="wasm-tier_8h_source.html#l00048">wasm-tier.h:48</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a19827f93e7ddd7bfc05feb71b9a55407"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a19827f93e7ddd7bfc05feb71b9a55407">v8::internal::wasm::TierUpNowForTesting</a></div><div class="ttdeci">void TierUpNowForTesting(Isolate *isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="#l01682">module-compiler.cc:1682</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a25f59e94501ad0ce6680be236623cc3c"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a25f59e94501ad0ce6680be236623cc3c">v8::internal::wasm::DebugState</a></div><div class="ttdeci">DebugState</div><div class="ttdef"><b>Definition</b> <a href="wasm-tier_8h_source.html#l00053">wasm-tier.h:53</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a36345041662f17bb39d27709c1cb78ac"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a36345041662f17bb39d27709c1cb78ac">v8::internal::wasm::GetWasmImportWrapperCache</a></div><div class="ttdeci">WasmImportWrapperCache * GetWasmImportWrapperCache()</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l02124">wasm-engine.cc:2124</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a3adc957d22d860687fc2579215adeb80ad75c39b2587910e64fbca44ad513c9e0">v8::internal::wasm::kWasmOrigin</a></div><div class="ttdeci">@ kWasmOrigin</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00121">wasm-module.h:121</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a42a2fc870f8946e6ffe986e629a5693b"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a42a2fc870f8946e6ffe986e629a5693b">v8::internal::wasm::SectionCode</a></div><div class="ttdeci">SectionCode</div><div class="ttdef"><b>Definition</b> <a href="wasm-constants_8h_source.html#l00096">wasm-constants.h:96</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a42a2fc870f8946e6ffe986e629a5693ba8cfdeb9213a3d517aed3c0ca252a5e6f"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a42a2fc870f8946e6ffe986e629a5693ba8cfdeb9213a3d517aed3c0ca252a5e6f">v8::internal::wasm::kUnknownSectionCode</a></div><div class="ttdeci">@ kUnknownSectionCode</div><div class="ttdef"><b>Definition</b> <a href="wasm-constants_8h_source.html#l00097">wasm-constants.h:97</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a4a0161ce7e2c0b500e243be3a2c329ea"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a4a0161ce7e2c0b500e243be3a2c329ea">v8::internal::wasm::DecodeResult</a></div><div class="ttdeci">VoidResult DecodeResult</div><div class="ttdef"><b>Definition</b> <a href="decoder_8h_source.html#l00039">decoder.h:39</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a5d346308124847f8fc36bfd05b5079a3"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a5d346308124847f8fc36bfd05b5079a3">v8::internal::wasm::TriggerTierUp</a></div><div class="ttdeci">void TriggerTierUp(Isolate *isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="#l01641">module-compiler.cc:1641</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a5deccc3082c791de6590472f43f92299"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a5deccc3082c791de6590472f43f92299">v8::internal::wasm::DeserializeNativeModule</a></div><div class="ttdeci">MaybeHandle&lt; WasmModuleObject &gt; DeserializeNativeModule(Isolate *isolate, base::Vector&lt; const uint8_t &gt; data, base::Vector&lt; const uint8_t &gt; wire_bytes_vec, const CompileTimeImports &amp;compile_imports, base::Vector&lt; const char &gt; source_url)</div><div class="ttdef"><b>Definition</b> <a href="wasm-serialization_8cc_source.html#l01088">wasm-serialization.cc:1088</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a5fb16976eb8924e08ec6616b1527f636"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a5fb16976eb8924e08ec6616b1527f636">v8::internal::wasm::TierUpAllForTesting</a></div><div class="ttdeci">void TierUpAllForTesting(Isolate *isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data)</div><div class="ttdef"><b>Definition</b> <a href="#l01696">module-compiler.cc:1696</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a60a035009507dcad49f342b8e4676bfc"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a60a035009507dcad49f342b8e4676bfc">v8::internal::wasm::InitializeCompilationForTesting</a></div><div class="ttdeci">void InitializeCompilationForTesting(NativeModule *native_module)</div><div class="ttdef"><b>Definition</b> <a href="#l01711">module-compiler.cc:1711</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a690faef021ab529c2506ff4cc19f23d3a9f2b960005d2a3a5f35ac32809d84db7"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a690faef021ab529c2506ff4cc19f23d3a9f2b960005d2a3a5f35ac32809d84db7">v8::internal::wasm::DecodingMethod::kAsync</a></div><div class="ttdeci">@ kAsync</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a6eef6d24980961199f34fb770039843a"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a6eef6d24980961199f34fb770039843a">v8::internal::wasm::Suspend</a></div><div class="ttdeci">Suspend</div><div class="ttdef"><b>Definition</b> <a href="module-instantiate_8h_source.html#l00034">module-instantiate.h:34</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a70bbfcab50b20ba5da8696e0373a8af4"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a70bbfcab50b20ba5da8696e0373a8af4">v8::internal::wasm::is_asmjs_module</a></div><div class="ttdeci">bool is_asmjs_module(const WasmModule *module)</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00954">wasm-module.h:954</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a74094ea879a0bfb89fbc40b97dd862b9"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a74094ea879a0bfb89fbc40b97dd862b9">v8::internal::wasm::ExecutionTier</a></div><div class="ttdeci">ExecutionTier</div><div class="ttdef"><b>Definition</b> <a href="wasm-tier_8h_source.html#l00019">wasm-tier.h:19</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a83ed1297167cba9f8c8971bacab69dbf"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a83ed1297167cba9f8c8971bacab69dbf">v8::internal::wasm::DecodeWasmModule</a></div><div class="ttdeci">ModuleResult DecodeWasmModule(WasmEnabledFeatures enabled_features, base::Vector&lt; const uint8_t &gt; wire_bytes, bool validate_functions, ModuleOrigin origin, Counters *counters, std::shared_ptr&lt; metrics::Recorder &gt; metrics_recorder, v8::metrics::Recorder::ContextId context_id, DecodingMethod decoding_method, WasmDetectedFeatures *detected_features)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00075">module-decoder.cc:75</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a8de46d135ac8060c6d4fbe5677da3934"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a8de46d135ac8060c6d4fbe5677da3934">v8::internal::wasm::CompileImportWrapperForTest</a></div><div class="ttdeci">WasmCode * CompileImportWrapperForTest(Isolate *isolate, NativeModule *native_module, ImportCallKind kind, const CanonicalSig *sig, CanonicalTypeIndex type_index, int expected_arity, Suspend suspend)</div><div class="ttdef"><b>Definition</b> <a href="#l04384">module-compiler.cc:4384</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a8f515217a2a720fd696212a68a5cd87a"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a8f515217a2a720fd696212a68a5cd87a">v8::internal::wasm::ThrowLazyCompilationError</a></div><div class="ttdeci">void ThrowLazyCompilationError(Isolate *isolate, const NativeModule *native_module, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="#l01251">module-compiler.cc:1251</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a967972baab540f22d49f12d2fae66b46"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a967972baab540f22d49f12d2fae66b46">v8::internal::wasm::CompileToNativeModule</a></div><div class="ttdeci">std::shared_ptr&lt; NativeModule &gt; CompileToNativeModule(Isolate *isolate, WasmEnabledFeatures enabled_features, WasmDetectedFeatures detected_features, CompileTimeImports compile_imports, ErrorThrower *thrower, std::shared_ptr&lt; const WasmModule &gt; module, base::OwnedVector&lt; const uint8_t &gt; wire_bytes, int compilation_id, v8::metrics::Recorder::ContextId context_id, ProfileInformation *pgo_info)</div><div class="ttdef"><b>Definition</b> <a href="#l02408">module-compiler.cc:2408</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_a97644489c4ab86ae3156930153cd1b5e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#a97644489c4ab86ae3156930153cd1b5e">v8::internal::wasm::ValidateAndSetBuiltinImports</a></div><div class="ttdeci">WasmError ValidateAndSetBuiltinImports(const WasmModule *module, base::Vector&lt; const uint8_t &gt; wire_bytes, const CompileTimeImports &amp;imports, WasmDetectedFeatures *detected)</div><div class="ttdef"><b>Definition</b> <a href="#l01829">module-compiler.cc:1829</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_aa122591443234c1d0b597dadc9d55c5e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#aa122591443234c1d0b597dadc9d55c5e">v8::internal::wasm::ContentSize</a></div><div class="ttdeci">size_t ContentSize(const std::vector&lt; T &gt; &amp;vector)</div><div class="ttdef"><b>Definition</b> <a href="std-object-sizes_8h_source.html#l00027">std-object-sizes.h:27</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_aa7549c056d2ab9e5a9cf2558f1478051"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#aa7549c056d2ab9e5a9cf2558f1478051">v8::internal::wasm::kMaxPolymorphism</a></div><div class="ttdeci">constexpr int kMaxPolymorphism</div><div class="ttdef"><b>Definition</b> <a href="wasm-constants_8h_source.html#l00201">wasm-constants.h:201</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ab14c5d1b4e1be5a5465678002c82ef10"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ab14c5d1b4e1be5a5465678002c82ef10">v8::internal::wasm::ValidateFunctions</a></div><div class="ttdeci">WasmError ValidateFunctions(const WasmModule *module, WasmEnabledFeatures enabled_features, base::Vector&lt; const uint8_t &gt; wire_bytes, std::function&lt; bool(int)&gt; filter, WasmDetectedFeatures *detected_features_out)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00523">module-decoder.cc:523</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ab650db3bf6479d5dfe0cb087f6880f73"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ab650db3bf6479d5dfe0cb087f6880f73">v8::internal::wasm::ValidateFunctionBody</a></div><div class="ttdeci">DecodeResult ValidateFunctionBody(Zone *zone, WasmEnabledFeatures enabled, const WasmModule *module, WasmDetectedFeatures *detected, const FunctionBody &amp;body)</div><div class="ttdef"><b>Definition</b> <a href="function-body-decoder_8cc_source.html#l00072">function-body-decoder.cc:72</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_abc12fc3b25ebfb54c20b8479642acb94"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#abc12fc3b25ebfb54c20b8479642acb94">v8::internal::wasm::GetWasmEngine</a></div><div class="ttdeci">WasmEngine * GetWasmEngine()</div><div class="ttdef"><b>Definition</b> <a href="wasm-engine_8cc_source.html#l02114">wasm-engine.cc:2114</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_abd9cf6cdda997dfabf862a6048202195"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#abd9cf6cdda997dfabf862a6048202195">v8::internal::wasm::declared_function_index</a></div><div class="ttdeci">int declared_function_index(const WasmModule *module, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l01070">wasm-module.h:1070</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_abe108c96012d3726499466455f359115"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#abe108c96012d3726499466455f359115">v8::internal::wasm::kWasmI32</a></div><div class="ttdeci">constexpr ValueType kWasmI32</div><div class="ttdef"><b>Definition</b> <a href="value-type_8h_source.html#l01104">value-type.h:1104</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ac0c0d417be648d20ef96581e5d3bd63a"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ac0c0d417be648d20ef96581e5d3bd63a">v8::internal::wasm::ImportCallKind</a></div><div class="ttdeci">ImportCallKind</div><div class="ttdef"><b>Definition</b> <a href="module-instantiate_8h_source.html#l00045">module-instantiate.h:45</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_aca357743e710fa56c5fabec8b006584e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#aca357743e710fa56c5fabec8b006584e">v8::internal::wasm::LoadProfileFromFile</a></div><div class="ttdeci">std::unique_ptr&lt; ProfileInformation &gt; LoadProfileFromFile(const WasmModule *module, base::Vector&lt; const uint8_t &gt; wire_bytes)</div><div class="ttdef"><b>Definition</b> <a href="pgo_8cc_source.html#l00221">pgo.cc:221</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_acb10c8534fdb3edc15e3f45d7ee6d547a6f3a1cfcc3386739303f7d10b0075ac5"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#acb10c8534fdb3edc15e3f45d7ee6d547a6f3a1cfcc3386739303f7d10b0075ac5">v8::internal::wasm::kExternalGlobal</a></div><div class="ttdeci">@ kExternalGlobal</div><div class="ttdef"><b>Definition</b> <a href="wasm-constants_8h_source.html#l00072">wasm-constants.h:72</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_acb10c8534fdb3edc15e3f45d7ee6d547a841c234519f90eb88be0020af3622a4d"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#acb10c8534fdb3edc15e3f45d7ee6d547a841c234519f90eb88be0020af3622a4d">v8::internal::wasm::kExternalFunction</a></div><div class="ttdeci">@ kExternalFunction</div><div class="ttdef"><b>Definition</b> <a href="wasm-constants_8h_source.html#l00069">wasm-constants.h:69</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ad2b94e9a247149c2f2a19be54a08f7e1a1f85c8fbccc9bb4fcda482bf840bc3e2"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a1f85c8fbccc9bb4fcda482bf840bc3e2">v8::internal::wasm::WasmCompilationHintStrategy::kEager</a></div><div class="ttdeci">@ kEager</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ad2b94e9a247149c2f2a19be54a08f7e1a1fede85ba930eef5832cf35bc93cb2cb"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a1fede85ba930eef5832cf35bc93cb2cb">v8::internal::wasm::WasmCompilationHintStrategy::kLazyBaselineEagerTopTier</a></div><div class="ttdeci">@ kLazyBaselineEagerTopTier</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ad2b94e9a247149c2f2a19be54a08f7e1a6867faeaa475fda467e48267db2bb8a8"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1a6867faeaa475fda467e48267db2bb8a8">v8::internal::wasm::WasmCompilationHintStrategy::kDefault</a></div><div class="ttdeci">@ kDefault</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ad2b94e9a247149c2f2a19be54a08f7e1ae3c54a7917f0c719b11db86b1dd59b0f"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ad2b94e9a247149c2f2a19be54a08f7e1ae3c54a7917f0c719b11db86b1dd59b0f">v8::internal::wasm::WasmCompilationHintStrategy::kLazy</a></div><div class="ttdeci">@ kLazy</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ad817bffa6a445b9979513a6933576055"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ad817bffa6a445b9979513a6933576055">v8::internal::wasm::IsCrossInstanceCall</a></div><div class="ttdeci">bool IsCrossInstanceCall(Tagged&lt; Object &gt; obj, Isolate *const isolate)</div><div class="ttdef"><b>Definition</b> <a href="#l01350">module-compiler.cc:1350</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_adfc648b4e5d05b43110df728650e4e4e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#adfc648b4e5d05b43110df728650e4e4e">v8::internal::wasm::WasmDetectedFeature</a></div><div class="ttdeci">WasmDetectedFeature</div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00047">wasm-features.h:47</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ae73da17de18352a106bb4e622f610d85"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ae73da17de18352a106bb4e622f610d85">v8::internal::wasm::DynamicTiering</a></div><div class="ttdeci">DynamicTiering</div><div class="ttdef"><b>Definition</b> <a href="compilation-environment_8h_source.html#l00037">compilation-environment.h:37</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_ae7a6dc8061ff4f4860d0efa2cca75d9d"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#ae7a6dc8061ff4f4860d0efa2cca75d9d">v8::internal::wasm::PublishDetectedFeatures</a></div><div class="ttdeci">void PublishDetectedFeatures(WasmDetectedFeatures detected_features, Isolate *isolate, bool is_initial_compilation)</div><div class="ttdef"><b>Definition</b> <a href="#l01716">module-compiler.cc:1716</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_aed8b0c264ada0ac0e941efbc9bf943a1"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#aed8b0c264ada0ac0e941efbc9bf943a1">v8::internal::wasm::kWasmExternRef</a></div><div class="ttdeci">constexpr ValueType kWasmExternRef</div><div class="ttdef"><b>Definition</b> <a href="value-type_8h_source.html#l01119">value-type.h:1119</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afa7a500801a38cc98469c31192f78468"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afa7a500801a38cc98469c31192f78468">v8::internal::wasm::CompileLazy</a></div><div class="ttdeci">bool CompileLazy(Isolate *isolate, Tagged&lt; WasmTrustedInstanceData &gt; trusted_instance_data, int func_index)</div><div class="ttdef"><b>Definition</b> <a href="#l01181">module-compiler.cc:1181</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6e">v8::internal::wasm::WellKnownImport</a></div><div class="ttdeci">WellKnownImport</div><div class="ttdef"><b>Definition</b> <a href="well-known-imports_8h_source.html#l00020">well-known-imports.h:20</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6ea025e1c9f27557f20869f4e447d8e2650"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea025e1c9f27557f20869f4e447d8e2650">v8::internal::wasm::WellKnownImport::kStringSubstring</a></div><div class="ttdeci">@ kStringSubstring</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6ea3da24690aec2adcb83a65afb07d2a81f"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea3da24690aec2adcb83a65afb07d2a81f">v8::internal::wasm::WellKnownImport::kStringFromCharCode</a></div><div class="ttdeci">@ kStringFromCharCode</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6ea4458d686d446ba3cb74e46d8c85ba791"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea4458d686d446ba3cb74e46d8c85ba791">v8::internal::wasm::WellKnownImport::kStringEquals</a></div><div class="ttdeci">@ kStringEquals</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6ea880a1d9d17a0fea09c4f88e7e3a5b3c8"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea880a1d9d17a0fea09c4f88e7e3a5b3c8">v8::internal::wasm::WellKnownImport::kStringCodePointAt</a></div><div class="ttdeci">@ kStringCodePointAt</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6ea974aaaa059c6fba0dfb3f7e60ca0edc8"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea974aaaa059c6fba0dfb3f7e60ca0edc8">v8::internal::wasm::WellKnownImport::kStringCompare</a></div><div class="ttdeci">@ kStringCompare</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6ea9e97c9e6af7667c3fe85b7834c4ae470"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6ea9e97c9e6af7667c3fe85b7834c4ae470">v8::internal::wasm::WellKnownImport::kStringFromCodePoint</a></div><div class="ttdeci">@ kStringFromCodePoint</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6eaae69b44fefda9823ba38a5e442454d7e"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eaae69b44fefda9823ba38a5e442454d7e">v8::internal::wasm::WellKnownImport::kStringCharCodeAt</a></div><div class="ttdeci">@ kStringCharCodeAt</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6eab0a05b1529f7334a8bf654350c064fd1"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eab0a05b1529f7334a8bf654350c064fd1">v8::internal::wasm::WellKnownImport::kStringTest</a></div><div class="ttdeci">@ kStringTest</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6eac87da7065fd2c38b65c88900f0136159"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eac87da7065fd2c38b65c88900f0136159">v8::internal::wasm::WellKnownImport::kStringLength</a></div><div class="ttdeci">@ kStringLength</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afaaaa7fd7a0bc697a4d91133566c5c6eada036082fdf62d64e75d6c2a78977904"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afaaaa7fd7a0bc697a4d91133566c5c6eada036082fdf62d64e75d6c2a78977904">v8::internal::wasm::WellKnownImport::kStringCast</a></div><div class="ttdeci">@ kStringCast</div></div>
<div class="ttc" id="anamespacev8_1_1internal_1_1wasm_html_afca7dc31d6cfc38c235556c27dec960b"><div class="ttname"><a href="namespacev8_1_1internal_1_1wasm.html#afca7dc31d6cfc38c235556c27dec960b">v8::internal::wasm::GetWasmErrorWithName</a></div><div class="ttdeci">WasmError GetWasmErrorWithName(base::Vector&lt; const uint8_t &gt; wire_bytes, int func_index, const WasmModule *module, WasmError error)</div><div class="ttdef"><b>Definition</b> <a href="module-decoder_8cc_source.html#l00566">module-decoder.cc:566</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html"><div class="ttname"><a href="namespacev8_1_1internal.html">v8::internal</a></div><div class="ttdef"><b>Definition</b> <a href="api-arguments-inl_8h_source.html#l00018">api-arguments-inl.h:18</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a3430752cde9f29d73e97ceed1bce0856"><div class="ttname"><a href="namespacev8_1_1internal.html#a3430752cde9f29d73e97ceed1bce0856">v8::internal::PrintF</a></div><div class="ttdeci">void PrintF(const char *format,...)</div><div class="ttdef"><b>Definition</b> <a href="utils_2utils_8cc_source.html#l00039">utils.cc:39</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a3537741c9c2331491d22d53de5115350"><div class="ttname"><a href="namespacev8_1_1internal.html#a3537741c9c2331491d22d53de5115350">v8::internal::tier</a></div><div class="ttdeci">force emit tier up logic from all non turbofan even if it is the top enabled tier make OptimizeFunctionOnNextCall optimize to maglev instead of turbofan enable loop peeling in the maglev optimizing compiler max loop size for loop peeling in the maglev optimizing compiler Generate deopt data on background thread maglev_deopt_data_on_background Inline CallApiCallback builtin into generated code use high priority compiler threads for concurrent Maglev max depth of functions that Maglev will incl small functions maximum cumulative size of bytecode considered for inlining excl small functions minimum frequency for inlining reuse stack slots in the maglev optimizing compiler enable phi untagging to hoist untagging of osr values filter for maglev s tracing printing options print feedback vector for maglev compiled code trace maglev print verbose deopt info trace maglev phi untagging print Maglev statistics in machine readable format skip generating a migration check when some maps of polymorpic property access are migration targets Use const tracking on dictionary properties Use heap numbers in script contexts Use compilation dependency to avoid dynamic checks for non empty context extensions Set the maximal optimisation tier</div><div class="ttdef"><b>Definition</b> <a href="flags_8cc_source.html#l00716">flags.cc:715</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a420e377bba6b25b38450dd44912cd5f6a21ed2c08d58afea3d6b70cec9fbc377b"><div class="ttname"><a href="namespacev8_1_1internal.html#a420e377bba6b25b38450dd44912cd5f6a21ed2c08d58afea3d6b70cec9fbc377b">v8::internal::ConcurrencyMode::kSynchronous</a></div><div class="ttdeci">@ kSynchronous</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a441e4c4a255cdc8d844a7fe362ef05d4"><div class="ttname"><a href="namespacev8_1_1internal.html#a441e4c4a255cdc8d844a7fe362ef05d4">v8::internal::WasmModule</a></div><div class="ttdeci">wasm::WasmModule WasmModule</div><div class="ttdef"><b>Definition</b> <a href="wasm-objects_8cc_source.html#l00109">wasm-objects.cc:109</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a4e2118a7c0d730210e0cb87b511cba70"><div class="ttname"><a href="namespacev8_1_1internal.html#a4e2118a7c0d730210e0cb87b511cba70">v8::internal::bool</a></div><div class="ttdeci">bool</div><div class="ttdef"><b>Definition</b> <a href="js-function-inl_8h_source.html#l00452">js-function-inl.h:452</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a511c3dd03bb4fc2b91ed9ef5535e202e"><div class="ttname"><a href="namespacev8_1_1internal.html#a511c3dd03bb4fc2b91ed9ef5535e202e">v8::internal::IsSmi</a></div><div class="ttdeci">V8_INLINE constexpr bool IsSmi(TaggedImpl&lt; kRefType, StorageType &gt; obj)</div><div class="ttdef"><b>Definition</b> <a href="objects_8h_source.html#l00655">objects.h:655</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a604d5beeb6fc8639670f737ed201e20aa0aa38c28f349d65a6819e03844b73dff"><div class="ttname"><a href="namespacev8_1_1internal.html#a604d5beeb6fc8639670f737ed201e20aa0aa38c28f349d65a6819e03844b73dff">v8::internal::AllocationType::kOld</a></div><div class="ttdeci">@ kOld</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a6135f0ef57de8d381e3225f6659c617a"><div class="ttname"><a href="namespacev8_1_1internal.html#a6135f0ef57de8d381e3225f6659c617a">v8::internal::sig</a></div><div class="ttdeci">kWasmInternalFunctionIndirectPointerTag kProtectedInstanceDataOffset sig</div><div class="ttdef"><b>Definition</b> <a href="wasm-objects-inl_8h_source.html#l00475">wasm-objects-inl.h:475</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a67a51b6314a9bc8a8c44c5fe14149e6c"><div class="ttname"><a href="namespacev8_1_1internal.html#a67a51b6314a9bc8a8c44c5fe14149e6c">v8::internal::key</a></div><div class="ttdeci">int32_t key</div><div class="ttdef"><b>Definition</b> <a href="external-reference_8cc_source.html#l01345">external-reference.cc:1345</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a812835f99758ef0970dfe7872beb4e8f"><div class="ttname"><a href="namespacev8_1_1internal.html#a812835f99758ef0970dfe7872beb4e8f">v8::internal::operator&lt;</a></div><div class="ttdeci">V8_INLINE constexpr bool operator&lt;(Builtin a, Builtin b)</div><div class="ttdef"><b>Definition</b> <a href="builtins_8h_source.html#l00075">builtins.h:75</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_a87c83cc0cb9799c767aaa72c71567680a9f2b960005d2a3a5f35ac32809d84db7"><div class="ttname"><a href="namespacev8_1_1internal.html#a87c83cc0cb9799c767aaa72c71567680a9f2b960005d2a3a5f35ac32809d84db7">v8::internal::IteratorType::kAsync</a></div><div class="ttdeci">@ kAsync</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_aa9db791c05a0359859a321dcfec42e37"><div class="ttname"><a href="namespacev8_1_1internal.html#aa9db791c05a0359859a321dcfec42e37">v8::internal::v8_flags</a></div><div class="ttdeci">V8_EXPORT_PRIVATE FlagValues v8_flags</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_ab9df0bf289155b5ae1d6da682adf1d6f"><div class="ttname"><a href="namespacev8_1_1internal.html#ab9df0bf289155b5ae1d6da682adf1d6f">v8::internal::handle</a></div><div class="ttdeci">V8_INLINE Handle&lt; T &gt; handle(Tagged&lt; T &gt; object, Isolate *isolate)</div><div class="ttdef"><b>Definition</b> <a href="handles-inl_8h_source.html#l00070">handles-inl.h:70</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293"><div class="ttname"><a href="namespacev8_1_1internal.html#abb767b639fb9b3ebabe15c8e91e99210a0a0ecdb4eded286c722877578774a293">v8::internal::WasmValueType::kI32</a></div><div class="ttdeci">@ kI32</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_acdec713c25068019f935e35976f5b666"><div class="ttname"><a href="namespacev8_1_1internal.html#acdec713c25068019f935e35976f5b666">v8::internal::UNREACHABLE</a></div><div class="ttdeci">UNREACHABLE()</div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_ad03e50e4d15ee0da6a722254f350e7eb"><div class="ttname"><a href="namespacev8_1_1internal.html#ad03e50e4d15ee0da6a722254f350e7eb">v8::internal::kMaxInt</a></div><div class="ttdeci">constexpr int kMaxInt</div><div class="ttdef"><b>Definition</b> <a href="common_2globals_8h_source.html#l00366">globals.h:366</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_adee95482032a93e07f59341fed5c909f"><div class="ttname"><a href="namespacev8_1_1internal.html#adee95482032a93e07f59341fed5c909f">v8::internal::is_shared</a></div><div class="ttdeci">JSArrayBuffer::IsDetachableBit is_shared</div><div class="ttdef"><b>Definition</b> <a href="js-array-buffer-inl_8h_source.html#l00180">js-array-buffer-inl.h:180</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_af265e8d13c88f8408dc6b23e691652c5"><div class="ttname"><a href="namespacev8_1_1internal.html#af265e8d13c88f8408dc6b23e691652c5">v8::internal::WasmFunction</a></div><div class="ttdeci">wasm::WasmFunction WasmFunction</div><div class="ttdef"><b>Definition</b> <a href="wasm-objects_8cc_source.html#l00108">wasm-objects.cc:108</a></div></div>
<div class="ttc" id="anamespacev8_1_1internal_html_afb7e5cd394b9632dddc2e7807b11b2ab"><div class="ttname"><a href="namespacev8_1_1internal.html#afb7e5cd394b9632dddc2e7807b11b2ab">v8::internal::script</a></div><div class="ttdeci">kInterpreterTrampolineOffset script</div><div class="ttdef"><b>Definition</b> <a href="shared-function-info-inl_8h_source.html#l00116">shared-function-info-inl.h:116</a></div></div>
<div class="ttc" id="anamespacev8_html_a680c1a715d1d5df94b21e8b1ee1bf051a495bb545d1c5053ead9743a8b7692209"><div class="ttname"><a href="namespacev8.html#a680c1a715d1d5df94b21e8b1ee1bf051a495bb545d1c5053ead9743a8b7692209">v8::TaskPriority::kUserBlocking</a></div><div class="ttdeci">@ kUserBlocking</div></div>
<div class="ttc" id="anamespacev8_html_a680c1a715d1d5df94b21e8b1ee1bf051a602dfdb2b16ea7a1f4392dc3d5761f7d"><div class="ttname"><a href="namespacev8.html#a680c1a715d1d5df94b21e8b1ee1bf051a602dfdb2b16ea7a1f4392dc3d5761f7d">v8::TaskPriority::kUserVisible</a></div><div class="ttdeci">@ kUserVisible</div></div>
<div class="ttc" id="apgo_8h_html"><div class="ttname"><a href="pgo_8h.html">pgo.h</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_a1ad2b9239773cbd418818106711ed087"><div class="ttname"><a href="random-module-generation_8cc.html#a1ad2b9239773cbd418818106711ed087">equals</a></div><div class="ttdeci">uint32_t equals</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00057">random-module-generation.cc:57</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_a2a94af96b48ededb482be8d77265360c"><div class="ttname"><a href="random-module-generation_8cc.html#a2a94af96b48ededb482be8d77265360c">fromCharCode</a></div><div class="ttdeci">uint32_t fromCharCode</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00050">random-module-generation.cc:50</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_a4b3721456d8a061caa13e8b30f5d4f74"><div class="ttname"><a href="random-module-generation_8cc.html#a4b3721456d8a061caa13e8b30f5d4f74">charCodeAt</a></div><div class="ttdeci">uint32_t charCodeAt</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00052">random-module-generation.cc:52</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_a64a83922e1e2fa0a4a08d4e89e716389"><div class="ttname"><a href="random-module-generation_8cc.html#a64a83922e1e2fa0a4a08d4e89e716389">fromCodePoint</a></div><div class="ttdeci">uint32_t fromCodePoint</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00051">random-module-generation.cc:51</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_a8721885a13fdab545fa508803154d20d"><div class="ttname"><a href="random-module-generation_8cc.html#a8721885a13fdab545fa508803154d20d">cast</a></div><div class="ttdeci">uint32_t cast</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00048">random-module-generation.cc:48</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_aa002b1b2006b2e38b143b322a892d9ba"><div class="ttname"><a href="random-module-generation_8cc.html#aa002b1b2006b2e38b143b322a892d9ba">codePointAt</a></div><div class="ttdeci">uint32_t codePointAt</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00053">random-module-generation.cc:53</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_ac36537f594f783ae9323e25e7f8317b2"><div class="ttname"><a href="random-module-generation_8cc.html#ac36537f594f783ae9323e25e7f8317b2">compare</a></div><div class="ttdeci">uint32_t compare</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00058">random-module-generation.cc:58</a></div></div>
<div class="ttc" id="arandom-module-generation_8cc_html_aecf167532df97fbf5d2f2fa85eda6397"><div class="ttname"><a href="random-module-generation_8cc.html#aecf167532df97fbf5d2f2fa85eda6397">concat</a></div><div class="ttdeci">uint32_t concat</div><div class="ttdef"><b>Definition</b> <a href="random-module-generation_8cc_source.html#l00055">random-module-generation.cc:55</a></div></div>
<div class="ttc" id="asemaphore_8h_html"><div class="ttname"><a href="semaphore_8h.html">semaphore.h</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a0bc63b24b654ca433be7b97a3edde132"><div class="ttname"><a href="src_2base_2logging_8h.html#a0bc63b24b654ca433be7b97a3edde132">UNREACHABLE</a></div><div class="ttdeci">#define UNREACHABLE()</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00067">logging.h:67</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a16b382527f19b805fc8f856668f2270b"><div class="ttname"><a href="src_2base_2logging_8h.html#a16b382527f19b805fc8f856668f2270b">DCHECK_LE</a></div><div class="ttdeci">#define DCHECK_LE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00490">logging.h:490</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a2209830df6b59d1ec1fdf66b9352924f"><div class="ttname"><a href="src_2base_2logging_8h.html#a2209830df6b59d1ec1fdf66b9352924f">DCHECK_NULL</a></div><div class="ttdeci">#define DCHECK_NULL(val)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00491">logging.h:491</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a2c0c4cea27d0690467662bb05131b2af"><div class="ttname"><a href="src_2base_2logging_8h.html#a2c0c4cea27d0690467662bb05131b2af">CHECK_IMPLIES</a></div><div class="ttdeci">#define CHECK_IMPLIES(lhs, rhs)</div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a3e1cfef60e774a81f30eaddf26a3a274"><div class="ttname"><a href="src_2base_2logging_8h.html#a3e1cfef60e774a81f30eaddf26a3a274">CHECK</a></div><div class="ttdeci">#define CHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00124">logging.h:124</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a7b9f9517fedacc2a1a56c2bbb9d03688"><div class="ttname"><a href="src_2base_2logging_8h.html#a7b9f9517fedacc2a1a56c2bbb9d03688">DCHECK_NOT_NULL</a></div><div class="ttdeci">#define DCHECK_NOT_NULL(val)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00492">logging.h:492</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a96a75539aa82216cdde2250a11126ea0"><div class="ttname"><a href="src_2base_2logging_8h.html#a96a75539aa82216cdde2250a11126ea0">DCHECK_IMPLIES</a></div><div class="ttdeci">#define DCHECK_IMPLIES(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00493">logging.h:493</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_a986dc8f4ec6dcd0644efe205c13f8eb7"><div class="ttname"><a href="src_2base_2logging_8h.html#a986dc8f4ec6dcd0644efe205c13f8eb7">DCHECK_NE</a></div><div class="ttdeci">#define DCHECK_NE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00486">logging.h:486</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_aabec5c3b7a8628298a25f044dcf89c25"><div class="ttname"><a href="src_2base_2logging_8h.html#aabec5c3b7a8628298a25f044dcf89c25">DCHECK_GE</a></div><div class="ttdeci">#define DCHECK_GE(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00488">logging.h:488</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_add09d39ec888c2d7e12877586f29368d"><div class="ttname"><a href="src_2base_2logging_8h.html#add09d39ec888c2d7e12877586f29368d">UNIMPLEMENTED</a></div><div class="ttdeci">#define UNIMPLEMENTED()</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00066">logging.h:66</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_ae17f8119c108cf3070bad3449c7e0006"><div class="ttname"><a href="src_2base_2logging_8h.html#ae17f8119c108cf3070bad3449c7e0006">DCHECK</a></div><div class="ttdeci">#define DCHECK(condition)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00482">logging.h:482</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_af1a711c8d5520dff78858ddefd2ad668"><div class="ttname"><a href="src_2base_2logging_8h.html#af1a711c8d5520dff78858ddefd2ad668">DCHECK_LT</a></div><div class="ttdeci">#define DCHECK_LT(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00489">logging.h:489</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_af9c313d74155f7f201955a939e24c71f"><div class="ttname"><a href="src_2base_2logging_8h.html#af9c313d74155f7f201955a939e24c71f">DCHECK_EQ</a></div><div class="ttdeci">#define DCHECK_EQ(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00485">logging.h:485</a></div></div>
<div class="ttc" id="asrc_2base_2logging_8h_html_afd957f297df7e9ee36c46185e961485f"><div class="ttname"><a href="src_2base_2logging_8h.html#afd957f297df7e9ee36c46185e961485f">DCHECK_GT</a></div><div class="ttdeci">#define DCHECK_GT(v1, v2)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2logging_8h_source.html#l00487">logging.h:487</a></div></div>
<div class="ttc" id="asrc_2base_2macros_8h_html_a280b0798f270f4b3f361c9ab64832956"><div class="ttname"><a href="src_2base_2macros_8h.html#a280b0798f270f4b3f361c9ab64832956">USE</a></div><div class="ttdeci">#define USE(...)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2macros_8h_source.html#l00281">macros.h:281</a></div></div>
<div class="ttc" id="asrc_2base_2macros_8h_html_ac55fdd6aa61539c49b1b1f5d38a0ed73"><div class="ttname"><a href="src_2base_2macros_8h.html#ac55fdd6aa61539c49b1b1f5d38a0ed73">arraysize</a></div><div class="ttdeci">#define arraysize(array)</div><div class="ttdef"><b>Definition</b> <a href="src_2base_2macros_8h_source.html#l00067">macros.h:67</a></div></div>
<div class="ttc" id="astd-object-sizes_8h_html"><div class="ttname"><a href="std-object-sizes_8h.html">std-object-sizes.h</a></div></div>
<div class="ttc" id="astd-object-sizes_8h_html_a56caa02a4280c4f0c82adab429400770"><div class="ttname"><a href="std-object-sizes_8h.html#a56caa02a4280c4f0c82adab429400770">UPDATE_WHEN_CLASS_CHANGES</a></div><div class="ttdeci">#define UPDATE_WHEN_CLASS_CHANGES(classname, size)</div><div class="ttdef"><b>Definition</b> <a href="std-object-sizes_8h_source.html#l00073">std-object-sizes.h:73</a></div></div>
<div class="ttc" id="astreaming-decoder_8h_html"><div class="ttname"><a href="streaming-decoder_8h.html">streaming-decoder.h</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1count_html"><div class="ttname"><a href="structv8_1_1internal_1_1count.html">v8::internal::count</a></div><div class="ttdef"><b>Definition</b> <a href="v8-fast-api-calls_8h_source.html#l00567">v8-fast-api-calls.h:567</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html">v8::internal::wasm::CallSiteFeedback::PolymorphicCase</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00514">wasm-module.h:514</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase_html_a1dbb576c2c349f34231cd2504d72d952"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html#a1dbb576c2c349f34231cd2504d72d952">v8::internal::wasm::CallSiteFeedback::PolymorphicCase::function_index</a></div><div class="ttdeci">int function_index</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00515">wasm-module.h:515</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase_html_a335adc6abf34fc2ab937f4849c46006d"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1CallSiteFeedback_1_1PolymorphicCase.html#a335adc6abf34fc2ab937f4849c46006d">v8::internal::wasm::CallSiteFeedback::PolymorphicCase::absolute_call_frequency</a></div><div class="ttdeci">int absolute_call_frequency</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00516">wasm-module.h:516</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1CanonicalTypeIndex_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1CanonicalTypeIndex.html">v8::internal::wasm::CanonicalTypeIndex</a></div><div class="ttdef"><b>Definition</b> <a href="value-type_8h_source.html#l00077">value-type.h:77</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1CompilationEnv_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1CompilationEnv.html">v8::internal::wasm::CompilationEnv</a></div><div class="ttdef"><b>Definition</b> <a href="compilation-environment_8h_source.html#l00056">compilation-environment.h:56</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ModuleWireBytes_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html">v8::internal::wasm::ModuleWireBytes</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00986">wasm-module.h:986</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ModuleWireBytes_html_a31e859ce9fbc3561f23d5411edd92c4b"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#a31e859ce9fbc3561f23d5411edd92c4b">v8::internal::wasm::ModuleWireBytes::length</a></div><div class="ttdeci">size_t length() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l01019">wasm-module.h:1019</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ModuleWireBytes_html_aad25d74a24c1f21b337f94460ecc662c"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#aad25d74a24c1f21b337f94460ecc662c">v8::internal::wasm::ModuleWireBytes::GetNameOrNull</a></div><div class="ttdeci">WasmName GetNameOrNull(WireBytesRef ref) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8cc_source.html#l00188">wasm-module.cc:188</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ModuleWireBytes_html_af538fbe064092b19f8841de4f52873e2"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ModuleWireBytes.html#af538fbe064092b19f8841de4f52873e2">v8::internal::wasm::ModuleWireBytes::module_bytes</a></div><div class="ttdeci">base::Vector&lt; const uint8_t &gt; module_bytes() const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l01016">wasm-module.h:1016</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1TypeFeedbackStorage_html_a850d35d90f98dbdc412f91a397c77424"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1TypeFeedbackStorage.html#a850d35d90f98dbdc412f91a397c77424">v8::internal::wasm::TypeFeedbackStorage::mutex</a></div><div class="ttdeci">base::SharedMutex mutex</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00662">wasm-module.h:662</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html">v8::internal::wasm::ValidateFunctionsStreamingJobData::Unit</a></div><div class="ttdef"><b>Definition</b> <a href="#l02476">module-compiler.cc:2476</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit_html_a1aa9923e94571d28a762b1a20f6c753b"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#a1aa9923e94571d28a762b1a20f6c753b">v8::internal::wasm::ValidateFunctionsStreamingJobData::Unit::code</a></div><div class="ttdeci">base::Vector&lt; const uint8_t &gt; code</div><div class="ttdef"><b>Definition</b> <a href="#l02479">module-compiler.cc:2479</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit_html_aee8a6605ef805e75bf5ee61c0f638e7d"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_1_1Unit.html#aee8a6605ef805e75bf5ee61c0f638e7d">v8::internal::wasm::ValidateFunctionsStreamingJobData::Unit::func_index</a></div><div class="ttdeci">int func_index</div><div class="ttdef"><b>Definition</b> <a href="#l02478">module-compiler.cc:2478</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html">v8::internal::wasm::ValidateFunctionsStreamingJobData</a></div><div class="ttdef"><b>Definition</b> <a href="#l02475">module-compiler.cc:2475</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a19f07dd2194cf5b0c00412210dc91b92"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a19f07dd2194cf5b0c00412210dc91b92">v8::internal::wasm::ValidateFunctionsStreamingJobData::units</a></div><div class="ttdeci">base::OwnedVector&lt; Unit &gt; units</div><div class="ttdef"><b>Definition</b> <a href="#l02558">module-compiler.cc:2558</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a30537e9b0e0f4d0160b17f97f2ceed43"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a30537e9b0e0f4d0160b17f97f2ceed43">v8::internal::wasm::ValidateFunctionsStreamingJobData::Initialize</a></div><div class="ttdeci">void Initialize(int num_declared_functions)</div><div class="ttdef"><b>Definition</b> <a href="#l02488">module-compiler.cc:2488</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a3fbf9bebc526ac76149545b2e6b1e5bc"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a3fbf9bebc526ac76149545b2e6b1e5bc">v8::internal::wasm::ValidateFunctionsStreamingJobData::end_of_available_units</a></div><div class="ttdeci">std::atomic&lt; Unit * &gt; end_of_available_units</div><div class="ttdef"><b>Definition</b> <a href="#l02560">module-compiler.cc:2560</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a4ec50926fec4429aac9d5d81a5d9a705"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a4ec50926fec4429aac9d5d81a5d9a705">v8::internal::wasm::ValidateFunctionsStreamingJobData::next_available_unit</a></div><div class="ttdeci">std::atomic&lt; Unit * &gt; next_available_unit</div><div class="ttdef"><b>Definition</b> <a href="#l02559">module-compiler.cc:2559</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a5552012797ffa8222c56b7b65fcc4c45"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a5552012797ffa8222c56b7b65fcc4c45">v8::internal::wasm::ValidateFunctionsStreamingJobData::UpdateDetectedFeatures</a></div><div class="ttdeci">void UpdateDetectedFeatures(WasmDetectedFeatures new_detected_features)</div><div class="ttdef"><b>Definition</b> <a href="#l02548">module-compiler.cc:2548</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a82498d65506cdd9a96e15cbc43061da0"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a82498d65506cdd9a96e15cbc43061da0">v8::internal::wasm::ValidateFunctionsStreamingJobData::NumOutstandingUnits</a></div><div class="ttdeci">size_t NumOutstandingUnits() const</div><div class="ttdef"><b>Definition</b> <a href="#l02524">module-compiler.cc:2524</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_a9cfdfc887c8e71d8e6f5e70352b372c2"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#a9cfdfc887c8e71d8e6f5e70352b372c2">v8::internal::wasm::ValidateFunctionsStreamingJobData::found_error</a></div><div class="ttdeci">std::atomic&lt; bool &gt; found_error</div><div class="ttdef"><b>Definition</b> <a href="#l02561">module-compiler.cc:2561</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_aa3640734bcf13379124fb8a689e3865f"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aa3640734bcf13379124fb8a689e3865f">v8::internal::wasm::ValidateFunctionsStreamingJobData::GetUnit</a></div><div class="ttdeci">Unit GetUnit()</div><div class="ttdef"><b>Definition</b> <a href="#l02533">module-compiler.cc:2533</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_ace23482eb9e8803b07a5f797fb9a0985"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#ace23482eb9e8803b07a5f797fb9a0985">v8::internal::wasm::ValidateFunctionsStreamingJobData::detected_features</a></div><div class="ttdeci">std::atomic&lt; WasmDetectedFeatures &gt; detected_features</div><div class="ttdef"><b>Definition</b> <a href="#l02562">module-compiler.cc:2562</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData_html_aea4d7941a772b26e34a901b0e3dad6c9"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1ValidateFunctionsStreamingJobData.html#aea4d7941a772b26e34a901b0e3dad6c9">v8::internal::wasm::ValidateFunctionsStreamingJobData::AddUnit</a></div><div class="ttdeci">void AddUnit(int declared_func_index, base::Vector&lt; const uint8_t &gt; code, JobHandle *job_handle)</div><div class="ttdef"><b>Definition</b> <a href="#l02496">module-compiler.cc:2496</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmCompilationResult_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmCompilationResult.html">v8::internal::wasm::WasmCompilationResult</a></div><div class="ttdef"><b>Definition</b> <a href="function-compiler_8h_source.html#l00062">function-compiler.h:62</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmDebugSymbols_html_a8532d4e68c0d024103622db816fcf401ab6753b928ffa3762e2c24aca9e607a80"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmDebugSymbols.html#a8532d4e68c0d024103622db816fcf401ab6753b928ffa3762e2c24aca9e607a80">v8::internal::wasm::WasmDebugSymbols::None</a></div><div class="ttdeci">@ None</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00507">wasm-module.h:507</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmFunction_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html">v8::internal::wasm::WasmFunction</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00078">wasm-module.h:78</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmFunction_html_ab4f3d0ecf1a3e6eab1bb917b4568d547"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html#ab4f3d0ecf1a3e6eab1bb917b4568d547">v8::internal::wasm::WasmFunction::sig</a></div><div class="ttdeci">const FunctionSig * sig</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00079">wasm-module.h:79</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmFunction_html_aec97739a140bf8da830c55636434adcf"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmFunction.html#aec97739a140bf8da830c55636434adcf">v8::internal::wasm::WasmFunction::code</a></div><div class="ttdeci">WireBytesRef code</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00083">wasm-module.h:83</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_1_1CacheKey_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmImportWrapperCache_1_1CacheKey.html">v8::internal::wasm::WasmImportWrapperCache::CacheKey</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-import-wrapper-cache_8h_source.html#l00026">wasm-import-wrapper-cache.h:26</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmImport_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmImport.html">v8::internal::wasm::WasmImport</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00283">wasm-module.h:283</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html">v8::internal::wasm::WasmModule</a></div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00686">wasm-module.h:686</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_a4d7f2eb3c584f9a7b9d79754dd29a315"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a4d7f2eb3c584f9a7b9d79754dd29a315">v8::internal::wasm::WasmModule::has_array</a></div><div class="ttdeci">bool has_array(ModuleTypeIndex index) const</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00865">wasm-module.h:865</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_a4f710e1d1dd945669cbebae2b51835e5"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a4f710e1d1dd945669cbebae2b51835e5">v8::internal::wasm::WasmModule::import_table</a></div><div class="ttdeci">std::vector&lt; WasmImport &gt; import_table</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00735">wasm-module.h:735</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_a5a60fa14372f7bc06d7d6f51d23b0bee"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a5a60fa14372f7bc06d7d6f51d23b0bee">v8::internal::wasm::WasmModule::num_declared_functions</a></div><div class="ttdeci">uint32_t num_declared_functions</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00704">wasm-module.h:704</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_a7871ace0ad8518a7de0c52ac35e43eb2"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a7871ace0ad8518a7de0c52ac35e43eb2">v8::internal::wasm::WasmModule::origin</a></div><div class="ttdeci">const ModuleOrigin origin</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00750">wasm-module.h:750</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_a81b4b2b056e744758f875acafe4c909a"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#a81b4b2b056e744758f875acafe4c909a">v8::internal::wasm::WasmModule::num_imported_functions</a></div><div class="ttdeci">uint32_t num_imported_functions</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00701">wasm-module.h:701</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_abee9ee3ec87853b99da8df1432ce7f4d"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#abee9ee3ec87853b99da8df1432ce7f4d">v8::internal::wasm::WasmModule::code</a></div><div class="ttdeci">WireBytesRef code</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00716">wasm-module.h:716</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_ac6101242a2a805d0e982fff4ddcc4677"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#ac6101242a2a805d0e982fff4ddcc4677">v8::internal::wasm::WasmModule::globals</a></div><div class="ttdeci">std::vector&lt; WasmGlobal &gt; globals</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00731">wasm-module.h:731</a></div></div>
<div class="ttc" id="astructv8_1_1internal_1_1wasm_1_1WasmModule_html_aceb39daaf893b7024baceccf7571a97d"><div class="ttname"><a href="structv8_1_1internal_1_1wasm_1_1WasmModule.html#aceb39daaf893b7024baceccf7571a97d">v8::internal::wasm::WasmModule::type_feedback</a></div><div class="ttdeci">TypeFeedbackStorage type_feedback</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00748">wasm-module.h:748</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleCompiled_html"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleCompiled.html">v8::metrics::WasmModuleCompiled</a></div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00134">v8-metrics.h:134</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleDecoded_html_a0c885c3b1441ebec57f9287097d22c8a"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a0c885c3b1441ebec57f9287097d22c8a">v8::metrics::WasmModuleDecoded::module_size_in_bytes</a></div><div class="ttdeci">size_t module_size_in_bytes</div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00129">v8-metrics.h:129</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleDecoded_html_a1ab324a8f990e43dc13988c126633619"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a1ab324a8f990e43dc13988c126633619">v8::metrics::WasmModuleDecoded::async</a></div><div class="ttdeci">bool async</div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00126">v8-metrics.h:126</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleDecoded_html_a3a12992a55d6b19a482b62b19ca4897f"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a3a12992a55d6b19a482b62b19ca4897f">v8::metrics::WasmModuleDecoded::function_count</a></div><div class="ttdeci">size_t function_count</div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00130">v8-metrics.h:130</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleDecoded_html_a4cee86a201704ae118af2b1ca9ace654"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a4cee86a201704ae118af2b1ca9ace654">v8::metrics::WasmModuleDecoded::success</a></div><div class="ttdeci">bool success</div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00128">v8-metrics.h:128</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleDecoded_html_a6411b52c7ce98217b836614f6c3169e9"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a6411b52c7ce98217b836614f6c3169e9">v8::metrics::WasmModuleDecoded::wall_clock_duration_in_us</a></div><div class="ttdeci">int64_t wall_clock_duration_in_us</div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00131">v8-metrics.h:131</a></div></div>
<div class="ttc" id="astructv8_1_1metrics_1_1WasmModuleDecoded_html_a74b4fc4ae92e15fb9f6c73dbff7d9a16"><div class="ttname"><a href="structv8_1_1metrics_1_1WasmModuleDecoded.html#a74b4fc4ae92e15fb9f6c73dbff7d9a16">v8::metrics::WasmModuleDecoded::streamed</a></div><div class="ttdeci">bool streamed</div><div class="ttdef"><b>Definition</b> <a href="v8-metrics_8h_source.html#l00127">v8-metrics.h:127</a></div></div>
<div class="ttc" id="atime_8h_html"><div class="ttname"><a href="time_8h.html">time.h</a></div></div>
<div class="ttc" id="atrace-event-no-perfetto_8h_html_a3feabb76c0ac2918798bc11ab55c6a79"><div class="ttname"><a href="trace-event-no-perfetto_8h.html#a3feabb76c0ac2918798bc11ab55c6a79">TRACE_EVENT0</a></div><div class="ttdeci">#define TRACE_EVENT0(category_group, name)</div><div class="ttdef"><b>Definition</b> <a href="trace-event-no-perfetto_8h_source.html#l00032">trace-event-no-perfetto.h:32</a></div></div>
<div class="ttc" id="atrace-event-no-perfetto_8h_html_a58927f99d797f77024561f336303380c"><div class="ttname"><a href="trace-event-no-perfetto_8h.html#a58927f99d797f77024561f336303380c">TRACE_EVENT2</a></div><div class="ttdeci">#define TRACE_EVENT2(category_group, name, arg1_name, arg1_val, arg2_name, arg2_val)</div><div class="ttdef"><b>Definition</b> <a href="trace-event-no-perfetto_8h_source.html#l00043">trace-event-no-perfetto.h:43</a></div></div>
<div class="ttc" id="atrace-event-no-perfetto_8h_html_a97689377430b094caec680dd7dd230fe"><div class="ttname"><a href="trace-event-no-perfetto_8h.html#a97689377430b094caec680dd7dd230fe">TRACE_DISABLED_BY_DEFAULT</a></div><div class="ttdeci">#define TRACE_DISABLED_BY_DEFAULT(name)</div><div class="ttdef"><b>Definition</b> <a href="trace-event-no-perfetto_8h_source.html#l00025">trace-event-no-perfetto.h:25</a></div></div>
<div class="ttc" id="atrace-event-no-perfetto_8h_html_ac437f27e15925a9bd53c69692a6c85fe"><div class="ttname"><a href="trace-event-no-perfetto_8h.html#ac437f27e15925a9bd53c69692a6c85fe">TRACE_EVENT1</a></div><div class="ttdeci">#define TRACE_EVENT1(category_group, name, arg1_name, arg1_val)</div><div class="ttdef"><b>Definition</b> <a href="trace-event-no-perfetto_8h_source.html#l00037">trace-event-no-perfetto.h:37</a></div></div>
<div class="ttc" id="atracing_2trace-event_8h_html"><div class="ttname"><a href="tracing_2trace-event_8h.html">trace-event.h</a></div></div>
<div class="ttc" id="av8config_8h_html_a4f489f1b838163ab33f251c9e470d938"><div class="ttname"><a href="v8config_8h.html#a4f489f1b838163ab33f251c9e470d938">V8_LIKELY</a></div><div class="ttdeci">#define V8_LIKELY(condition)</div><div class="ttdef"><b>Definition</b> <a href="v8config_8h_source.html#l00650">v8config.h:650</a></div></div>
<div class="ttc" id="av8config_8h_html_a63258e4bf5dc9fb8c78f881c8405d83b"><div class="ttname"><a href="v8config_8h.html#a63258e4bf5dc9fb8c78f881c8405d83b">V8_WARN_UNUSED_RESULT</a></div><div class="ttdeci">#define V8_WARN_UNUSED_RESULT</div><div class="ttdef"><b>Definition</b> <a href="v8config_8h_source.html#l00660">v8config.h:660</a></div></div>
<div class="ttc" id="av8config_8h_html_a67bd29db07c711b0fb11ff1c324ebb60"><div class="ttname"><a href="v8config_8h.html#a67bd29db07c711b0fb11ff1c324ebb60">V8_UNLIKELY</a></div><div class="ttdeci">#define V8_UNLIKELY(condition)</div><div class="ttdef"><b>Definition</b> <a href="v8config_8h_source.html#l00649">v8config.h:649</a></div></div>
<div class="ttc" id="av8config_8h_html_ae5350bf5d731891583a34f9c8c52b532"><div class="ttname"><a href="v8config_8h.html#ae5350bf5d731891583a34f9c8c52b532">V8_NODISCARD</a></div><div class="ttdeci">#define V8_NODISCARD</div><div class="ttdef"><b>Definition</b> <a href="v8config_8h_source.html#l00682">v8config.h:682</a></div></div>
<div class="ttc" id="awasm-code-manager_8h_html"><div class="ttname"><a href="wasm-code-manager_8h.html">wasm-code-manager.h</a></div></div>
<div class="ttc" id="awasm-code-pointer-table-inl_8h_html"><div class="ttname"><a href="wasm-code-pointer-table-inl_8h.html">wasm-code-pointer-table-inl.h</a></div></div>
<div class="ttc" id="awasm-compiler_8h_html"><div class="ttname"><a href="wasm-compiler_8h.html">wasm-compiler.h</a></div></div>
<div class="ttc" id="awasm-engine_8h_html"><div class="ttname"><a href="wasm-engine_8h.html">wasm-engine.h</a></div></div>
<div class="ttc" id="awasm-feature-flags_8h_html"><div class="ttname"><a href="wasm-feature-flags_8h.html">wasm-feature-flags.h</a></div></div>
<div class="ttc" id="awasm-feature-flags_8h_html_a7cdfb27e220029d969e05e0c5dafbe5e"><div class="ttname"><a href="wasm-feature-flags_8h.html#a7cdfb27e220029d969e05e0c5dafbe5e">FOREACH_WASM_STAGING_FEATURE_FLAG</a></div><div class="ttdeci">#define FOREACH_WASM_STAGING_FEATURE_FLAG(V)</div><div class="ttdef"><b>Definition</b> <a href="wasm-feature-flags_8h_source.html#l00085">wasm-feature-flags.h:85</a></div></div>
<div class="ttc" id="awasm-feature-flags_8h_html_ade45dbfc8a894dfb754e489442d41c4a"><div class="ttname"><a href="wasm-feature-flags_8h.html#ade45dbfc8a894dfb754e489442d41c4a">FOREACH_WASM_SHIPPED_FEATURE_FLAG</a></div><div class="ttdeci">#define FOREACH_WASM_SHIPPED_FEATURE_FLAG(V)</div><div class="ttdef"><b>Definition</b> <a href="wasm-feature-flags_8h_source.html#l00115">wasm-feature-flags.h:115</a></div></div>
<div class="ttc" id="awasm-features_8h_html_af51d8ba1d0c550a316bafe40d335ff01"><div class="ttname"><a href="wasm-features_8h.html#af51d8ba1d0c550a316bafe40d335ff01">FOREACH_WASM_NON_FLAG_FEATURE</a></div><div class="ttdeci">#define FOREACH_WASM_NON_FLAG_FEATURE(V)</div><div class="ttdef"><b>Definition</b> <a href="wasm-features_8h_source.html#l00021">wasm-features.h:21</a></div></div>
<div class="ttc" id="awasm-import-wrapper-cache_8h_html"><div class="ttname"><a href="wasm-import-wrapper-cache_8h.html">wasm-import-wrapper-cache.h</a></div></div>
<div class="ttc" id="awasm-inlining-into-js_8cc_html_af0a4546fb3d729452321b14ff6c9c7ae"><div class="ttname"><a href="wasm-inlining-into-js_8cc.html#af0a4546fb3d729452321b14ff6c9c7ae">module_</a></div><div class="ttdeci">const wasm::WasmModule * module_</div><div class="ttdef"><b>Definition</b> <a href="wasm-inlining-into-js_8cc_source.html#l00363">wasm-inlining-into-js.cc:363</a></div></div>
<div class="ttc" id="awasm-js_8h_html"><div class="ttname"><a href="wasm-js_8h.html">wasm-js.h</a></div></div>
<div class="ttc" id="awasm-limits_8h_html"><div class="ttname"><a href="wasm-limits_8h.html">wasm-limits.h</a></div></div>
<div class="ttc" id="awasm-module_8h_html_a97da966b01775707b360f5ace2370c0e"><div class="ttname"><a href="wasm-module_8h.html#a97da966b01775707b360f5ace2370c0e">SELECT_WASM_COUNTER</a></div><div class="ttdeci">#define SELECT_WASM_COUNTER(counters, origin, prefix, suffix)</div><div class="ttdef"><b>Definition</b> <a href="wasm-module_8h_source.html#l00317">wasm-module.h:317</a></div></div>
<div class="ttc" id="awasm-objects-inl_8h_html"><div class="ttname"><a href="wasm-objects-inl_8h.html">wasm-objects-inl.h</a></div></div>
<div class="ttc" id="awasm-result_8h_html"><div class="ttname"><a href="wasm-result_8h.html">wasm-result.h</a></div></div>
<div class="ttc" id="awasm-serialization_8h_html"><div class="ttname"><a href="wasm-serialization_8h.html">wasm-serialization.h</a></div></div>
<div class="ttc" id="azone_8h_html_a6b1fd0a126df3f1b788cee19d9cce66e"><div class="ttname"><a href="zone_8h.html#a6b1fd0a126df3f1b788cee19d9cce66e">ZONE_NAME</a></div><div class="ttdeci">#define ZONE_NAME</div><div class="ttdef"><b>Definition</b> <a href="zone_8h_source.html#l00022">zone.h:22</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_2b581e8501b9ee14adb2dc81ebf46f49.html">wasm</a></li><li class="navelem"><a class="el" href="module-compiler_8cc.html">module-compiler.cc</a></li>
    <li class="footer">Generated on Thu Apr 3 2025 09:56:18 for v8 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
